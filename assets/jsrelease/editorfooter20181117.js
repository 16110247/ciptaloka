/*
 noUiSlider - 7.0.10 - 2014-12-27 14:50:47  jQuery blockUI plugin
 Version 2.70.0-2014.11.23
 Requires jQuery v1.7 or later

 Examples at: http://malsup.com/jquery/block/
 Copyright (c) 2007-2013 M. Alsup
 Dual licensed under the MIT and GPL licenses:
 http://www.opensource.org/licenses/mit-license.php
 http://www.gnu.org/licenses/gpl.html

 Thanks to Amir-Hossein Sobhi for some excellent contributions!
 Fine Uploader

 Copyright 2013, Widen Enterprises, Inc. info@fineuploader.com

 Version: 5.0.8

 Homepage: http://fineuploader.com

 Repository: git://github.com/Widen/fine-uploader.git

 Licensed under GNU GPL v3, see LICENSE
 2014-10-20  Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports&&"object"==typeof module?module.exports=a:a(jQuery)})(function(a,b){function e(c,d,b,g){for(var e=[],f=0;f<c.length;f++){var h=c[f];if(h){var k=tinycolor(h),l=.5>k.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";l+=tinycolor.equals(d,h)?" sp-thumb-active":"";h=k.toString(g.preferredFormat||"rgb");var n=w?"background-color:"+k.toRgbString():"filter:"+k.toFilter();e.push('<span title="'+
h+'" data-color="'+k.toRgbString()+'" class="'+l+'"><span class="sp-thumb-inner" style="'+n+';" /></span>')}else e.push(a("<div />").append(a('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",g.noColorSelectedText)).html())}return"<div class='sp-cf "+b+"'>"+e.join("")+"</div>"}function f(c,d){var b=a.extend({},n,c);b.callbacks={move:k(b.move,d),change:k(b.change,d),show:k(b.show,d),hide:k(b.hide,d),beforeShow:k(b.beforeShow,d)};return b}function d(c,
d){function k(){E.showPaletteOnly&&(E.showPalette=!0);Ia.text(E.showPaletteOnly?E.togglePaletteMoreText:E.togglePaletteLessText);if(E.palette){ya=E.palette.slice(0);qa=a.isArray(ya[0])?ya:[ya];za={};for(var c=0;c<qa.length;c++)for(var d=0;d<qa[c].length;d++){var b=tinycolor(qa[c][d]).toRgbString();za[b]=!0}}N.toggleClass("sp-flat",ca);N.toggleClass("sp-input-disabled",!E.showInput);N.toggleClass("sp-alpha-enabled",E.showAlpha);N.toggleClass("sp-clear-enabled",ka);N.toggleClass("sp-buttons-disabled",
!E.showButtons);N.toggleClass("sp-palette-buttons-disabled",!E.togglePaletteOnly);N.toggleClass("sp-palette-disabled",!E.showPalette);N.toggleClass("sp-palette-only",E.showPaletteOnly);N.toggleClass("sp-initial-disabled",!E.showInitial);N.addClass(E.className).addClass(E.containerClassName);aa()}function n(){if(J&&window.localStorage){try{var c=window.localStorage[J].split(",#");1<c.length&&(delete window.localStorage[J],a.each(c,function(a,c){B(c)}))}catch(Qa){}try{da=window.localStorage[J].split(";")}catch(Qa){}}}
function B(c){if(U){c=tinycolor(c).toRgbString();if(!za[c]&&-1===a.inArray(c,da))for(da.push(c);da.length>Xa;)da.shift();if(J&&window.localStorage)try{window.localStorage[J]=da.join(";")}catch(Qa){}}}function x(){var a=[];if(E.showPalette)for(var c=0;c<da.length;c++){var d=tinycolor(da[c]).toRgbString();za[d]||a.push(da[c])}return a.reverse().slice(0,E.maxSelectionSize)}function y(){var c=R(),d=a.map(qa,function(a,d){return e(a,c,"sp-palette-row sp-palette-row-"+d,E)});n();da&&d.push(e(x(),c,"sp-palette-row sp-palette-row-selection",
E));Ra.html(d.join(""))}function A(){if(E.showInitial){var a=la,c=R();Sa.html(e([a,c],c,"sp-palette-row-initial",E))}}function C(){(0>=ba||0>=ea||0>=Aa)&&aa();N.addClass("sp-dragging");ha=null;V.trigger("dragstart.spectrum",[R()])}function H(){N.removeClass("sp-dragging");V.trigger("dragstop.spectrum",[R()])}function G(){var a=ia.val();null!==a&&""!==a||!ka?(a=tinycolor(a),a.isValid()?(L(a),Z(!0)):ia.addClass("sp-validation-error")):(L(null),Z(!0))}function P(){I?S():M()}function M(){var c=a.Event("beforeShow.spectrum");
if(I)aa();else if(V.trigger(c,[R()]),!1!==W.beforeShow(R())&&!c.isDefaultPrevented()){for(c=0;c<q.length;c++)q[c]&&q[c].hide();I=!0;a(Ja).bind("click.spectrum",O);a(window).bind("resize.spectrum",ma);na.addClass("sp-active");N.removeClass("sp-hidden");aa();T();la=R();A();W.show(la);V.trigger("show.spectrum",[la])}}function O(a){2!=a.button&&(Ya?Z(!0):L(la,!0),S())}function S(){I&&!ca&&(I=!1,a(Ja).unbind("click.spectrum",O),a(window).unbind("resize.spectrum",ma),na.removeClass("sp-active"),N.addClass("sp-hidden"),
W.hide(R()),V.trigger("hide.spectrum",[R()]))}function L(a,c){if(tinycolor.equals(a,R()))T();else{if(!a&&ka)ja=!0;else{ja=!1;var d=tinycolor(a);var b=d.toHsv();ra=b.h%360/360;sa=b.s;ta=b.v;fa=b.a}T();d&&d.isValid()&&!c&&(ua=Ka||d.getFormat())}}function R(a){a=a||{};return ka&&ja?null:tinycolor.fromRatio({h:ra,s:sa,v:ta,a:Math.round(100*fa)/100},{format:a.format||ua})}function K(){T();W.move(R());V.trigger("move.spectrum",[R()])}function T(){ia.removeClass("sp-validation-error");Q();var a=tinycolor.fromRatio({h:ra,
s:1,v:1});Ba.css("background-color",a.toHexString());a=ua;!(1>fa)||0===fa&&"name"===a||"hex"!==a&&"hex3"!==a&&"hex6"!==a&&"name"!==a||(a="rgb");var c=R({format:a}),d="";oa.removeClass("sp-clear-display");oa.css("background-color","transparent");if(!c&&ka)oa.addClass("sp-clear-display");else{d=c.toHexString();var b=c.toRgbString();w||1===c.alpha?oa.css("background-color",b):(oa.css("background-color","transparent"),oa.css("filter",c.toFilter()));if(E.showAlpha){b=c.toRgb();b.a=0;b=tinycolor(b).toRgbString();
var g="linear-gradient(left, "+b+", "+d+")";r?va.css("filter",tinycolor(b).toFilter({gradientType:1},d)):(va.css("background","-webkit-"+g),va.css("background","-moz-"+g),va.css("background","-ms-"+g),va.css("background","linear-gradient(to right, "+b+", "+d+")"))}d=c.toString(a)}E.showInput&&ia.val(d);E.showPalette&&y();A()}function Q(){var a=sa,c=ta;ka&&ja?(Ca.hide(),Da.hide(),Ea.hide()):(Ca.show(),Da.show(),Ea.show(),a*=ea,c=ba-c*ba,a=Math.max(-X,Math.min(ea-X,a-X)),c=Math.max(-X,Math.min(ba-X,
c-X)),Ea.css({top:c+"px",left:a+"px"}),Ca.css({left:fa*La-Ta/2+"px"}),Da.css({top:ra*Aa-pa+"px"}))}function Z(a){var c=R(),d="",b=!tinycolor.equals(c,la);c&&(d=c.toString(ua),B(c));Fa&&V.val(d);a&&b&&(W.change(c),V.trigger("change",[c]))}function aa(){ea=Ba.width();ba=Ba.height();X=Ea.height();Ma.width();Aa=Ma.height();pa=Da.height();La=Ua.width();Ta=Ca.width();ca||(N.css("position","absolute"),E.offset?N.offset(E.offset):N.offset(g(N,wa)));Q();E.showPalette&&y();V.trigger("reflow.spectrum")}function Ga(){S();
Na=!0;V.attr("disabled",!0);wa.addClass("sp-disabled")}var E=f(d,c),ca=E.flat,U=E.showSelectionPalette,J=E.localStorageKey,Y=E.theme,W=E.callbacks,ma=l(aa,10),I=!1,ea=0,ba=0,X=0,Aa=0,La=0,Ta=0,pa=0,ra=0,sa=0,ta=0,fa=1,ya=[],qa=[],za={},da=E.selectionPalette.slice(0),Xa=E.maxSelectionSize,ha=null,Ja=c.ownerDocument,V=a(c),Na=!1,N=a(u,Ja).addClass(Y),Za=N.find(".sp-picker-container"),Ba=N.find(".sp-color"),Ea=N.find(".sp-dragger"),Ma=N.find(".sp-hue"),Da=N.find(".sp-slider"),va=N.find(".sp-alpha-inner"),
Ua=N.find(".sp-alpha"),Ca=N.find(".sp-alpha-handle"),ia=N.find(".sp-input"),Ra=N.find(".sp-palette"),Sa=N.find(".sp-initial"),Va=N.find(".sp-cancel"),Oa=N.find(".sp-clear"),Wa=N.find(".sp-choose"),Ia=N.find(".sp-palette-toggle"),Fa=V.is("input"),$a=Fa&&t&&"color"===V.attr("type"),Pa=Fa&&!ca,na=Pa?a("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(Y).addClass(E.className).addClass(E.replacerClassName):a([]),
wa=Pa?na:V,oa=na.find(".sp-preview-inner"),xa=E.color||Fa&&V.val(),la=!1,Ka=E.preferredFormat,ua=Ka,Ya=!E.showButtons||E.clickoutFiresChange,ja=!xa,ka=E.allowEmpty&&!$a;(function(){function c(c){c.data&&c.data.ignore?(L(a(c.target).closest(".sp-thumb-el").data("color")),K()):(L(a(c.target).closest(".sp-thumb-el").data("color")),K(),Z(!0),E.hideAfterPaletteSelect&&S());return!1}r&&N.find("*:not(input)").attr("unselectable","on");k();Pa&&V.after(na).hide();ka||Oa.hide();if(ca)V.after(N).hide();else{var d=
"parent"===E.appendTo?V.parent():a(E.appendTo);1!==d.length&&(d=a("body"));d.append(N)}n();wa.bind("click.spectrum touchstart.spectrum",function(c){Na||P();c.stopPropagation();a(c.target).is("input")||c.preventDefault()});(V.is(":disabled")||!0===E.disabled)&&Ga();N.click(h);ia.change(G);ia.bind("paste",function(){setTimeout(G,1)});ia.keydown(function(a){13==a.keyCode&&G()});Va.text(E.cancelText);Va.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();L(la,!0);S()});Oa.attr("title",
E.clearText);Oa.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();ja=!0;K();ca&&Z(!0)});Wa.text(E.chooseText);Wa.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();ia.hasClass("sp-validation-error")||(Z(!0),S())});Ia.text(E.showPaletteOnly?E.togglePaletteMoreText:E.togglePaletteLessText);Ia.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();E.showPaletteOnly=!E.showPaletteOnly;E.showPaletteOnly||ca||N.css("left","-="+(Za.outerWidth(!0)+
5));k()});m(Ua,function(a,c,d){fa=a/La;ja=!1;d.shiftKey&&(fa=Math.round(10*fa)/10);K()},C,H);m(Ma,function(a,c){ra=parseFloat(c/Aa);ja=!1;E.showAlpha||(fa=1);K()},C,H);m(Ba,function(a,c,d){d.shiftKey?ha||(ha=Math.abs(a-sa*ea)>Math.abs(c-(ba-ta*ba))?"x":"y"):ha=null;d=!ha||"y"===ha;ha&&"x"!==ha||(sa=parseFloat(a/ea));d&&(ta=parseFloat((ba-c)/ba));ja=!1;E.showAlpha||(fa=1);K()},C,H);xa?(L(xa),T(),ua=Ka||tinycolor(xa).format,B(xa)):T();ca&&M();d=r?"mousedown.spectrum":"click.spectrum touchstart.spectrum";
Ra.delegate(".sp-thumb-el",d,c);Sa.delegate(".sp-thumb-el:nth-child(1)",d,{ignore:!0},c)})();var Ha={show:M,hide:S,toggle:P,reflow:aa,option:function(c,d){if(c===b)return a.extend({},E);if(d===b)return E[c];E[c]=d;k()},enable:function(){Na=!1;V.attr("disabled",!1);wa.removeClass("sp-disabled")},disable:Ga,offset:function(a){E.offset=a;aa()},set:function(a){L(a);Z()},get:R,destroy:function(){V.show();wa.unbind("click.spectrum touchstart.spectrum");N.remove();na.remove();q[Ha.id]=null},container:N};
Ha.id=q.push(Ha)-1;return Ha}function g(c,d){var b=c.outerWidth(),g=c.outerHeight(),e=d.outerHeight(),f=c[0].ownerDocument,h=f.documentElement,k=h.clientWidth+a(f).scrollLeft();f=h.clientHeight+a(f).scrollTop();h=d.offset();h.top+=e;h.left-=Math.min(h.left,h.left+b>k&&k>b?Math.abs(h.left+b-k):0);h.top-=Math.min(h.top,h.top+g>f&&f>g?Math.abs(g+e-0):0);return h}function c(){}function h(a){a.stopPropagation()}function k(a,c){var d=Array.prototype.slice,b=d.call(arguments,2);return function(){return a.apply(c,
b.concat(d.call(arguments)))}}function m(c,d,b,g){function e(a){a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();a.returnValue=!1}function f(a){if(l){if(r&&9>k.documentMode&&!a.button)return h();var b=a.originalEvent&&a.originalEvent.touches,g=Math.max(0,Math.min((b?b[0].pageX:a.pageX)-n.left,B));b=Math.max(0,Math.min((b?b[0].pageY:a.pageY)-n.top,m));q&&e(a);d.apply(c,[g,b,a])}}function h(){l&&(a(k).unbind(x),a(k.body).removeClass("sp-dragging"),g.apply(c,arguments));l=
!1}d=d||function(){};b=b||function(){};g=g||function(){};var k=document,l=!1,n={},m=0,B=0,q="ontouchstart"in window,x={};x.selectstart=e;x.dragstart=e;x["touchmove mousemove"]=f;x["touchend mouseup"]=h;a(c).bind("touchstart mousedown",function(d){(d.which?3==d.which:2==d.button)||l||!1===b.apply(c,arguments)||(l=!0,m=a(c).height(),B=a(c).width(),n=a(c).offset(),a(k).bind(x),a(k.body).addClass("sp-dragging"),q||f(d),e(d))})}function l(a,c,d){var b;return function(){var g=this,e=arguments,f=function(){b=
null;a.apply(g,e)};d&&clearTimeout(b);if(d||!b)b=setTimeout(f,c)}}var n={beforeShow:c,move:c,change:c,show:c,hide:c,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",
noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:["#ffffff #000000 #ff0000 #ff8000 #ffff00 #008000 #0000ff #4b0082 #9400d3".split(" ")],selectionPalette:[],disabled:!1,offset:null},q=[],r=!!/msie/i.exec(window.navigator.userAgent),w=function(){var a=document.createElement("div").style;a.cssText="background-color:rgba(0,0,0,.5)";return!!~(""+a.backgroundColor).indexOf("rgba")||!!~(""+a.backgroundColor).indexOf("hsla")}(),
t=function(){var c=a("<input type='color' value='!' />")[0];return"color"===c.type&&"!"!==c.value}(),u=function(){var a="";if(r)for(var c=1;6>=c;c++)a+="<div class='sp-"+c+"'></div>";return["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div><div class='sp-palette-button-container sp-cf'><button type='button' class='sp-palette-toggle'></button></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-clear sp-clear-display'></div><div class='sp-hue'><div class='sp-slider'></div>",
a,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button type='button' class='sp-choose'></button></div></div></div>"].join("")}();a.fn.spectrum=function(c,b){if("string"==typeof c){var g=this,e=Array.prototype.slice.call(arguments,
1);this.each(function(){var d=q[a(this).data("spectrum.id")];if(d){var b=d[c];if(!b)throw Error("Spectrum: no such method: '"+c+"'");"get"==c?g=d.get():"container"==c?g=d.container:"option"==c?g=d.option.apply(d,e):"destroy"==c?(d.destroy(),a(this).removeData("spectrum.id")):b.apply(d,e)}});return g}return this.spectrum("destroy").each(function(){var b=a.extend({},c,a(this).data());b=d(this,b);a(this).data("spectrum.id",b.id)})};a.fn.spectrum.load=!0;a.fn.spectrum.loadOpts={};a.fn.spectrum.draggable=
m;a.fn.spectrum.defaults=n;a.spectrum={};a.spectrum.localization={};a.spectrum.palettes={};a.fn.spectrum.processNativeColorInputs=function(){t||a("input[type=color]").spectrum({preferredFormat:"hex6"})};(function(){function a(a,c,d){a=Q(a,255);c=Q(c,255);d=Q(d,255);var b=W(a,c,d),g=Y(a,c,d),e=(b+g)/2;if(b==g)var f=g=0;else{var h=b-g;g=.5<e?h/(2-b-g):h/(b+g);switch(b){case a:f=(c-d)/h+(c<d?6:0);break;case c:f=(d-a)/h+2;break;case d:f=(a-c)/h+4}f/=6}return{h:f,s:g,l:e}}function c(a,c,d){function b(a,
c,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+(c-a)*(2/3-d)*6:a}a=Q(a,360);c=Q(c,100);d=Q(d,100);if(0===c)d=c=a=d;else{var g=.5>d?d*(1+c):d+c-d*c,e=2*d-g;d=b(e,g,a+1/3);c=b(e,g,a);a=b(e,g,a-1/3)}return{r:255*d,g:255*c,b:255*a}}function d(a,c,d){a=Q(a,255);c=Q(c,255);d=Q(d,255);var b=W(a,c,d),g=Y(a,c,d),e=b-g;if(b==g)var f=0;else{switch(b){case a:f=(c-d)/e+(c<d?6:0);break;case c:f=(d-a)/e+2;break;case d:f=(a-c)/e+4}f/=6}return{h:f,s:0===b?0:e/b,v:b}}function b(a,c,d,b){a=[Z(J(a).toString(16)),
Z(J(c).toString(16)),Z(J(d).toString(16))];return b&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function g(a,c,d,b){return[Z(Math.round(255*parseFloat(b)).toString(16)),Z(J(a).toString(16)),Z(J(c).toString(16)),Z(J(d).toString(16))].join("")}function e(a,c){c=0===c?0:c||10;var d=I(a).toHsl();d.s-=c/100;d.s=Y(1,W(0,d.s));return I(d)}function f(a,c){c=0===c?0:c||10;var d=I(a).toHsl();d.s+=c/100;
d.s=Y(1,W(0,d.s));return I(d)}function h(a){return I(a).desaturate(100)}function k(a,c){c=0===c?0:c||10;var d=I(a).toHsl();d.l+=c/100;d.l=Y(1,W(0,d.l));return I(d)}function l(a,c){c=0===c?0:c||10;var d=I(a).toRgb();d.r=W(0,Y(255,d.r-J(255*-(c/100))));d.g=W(0,Y(255,d.g-J(255*-(c/100))));d.b=W(0,Y(255,d.b-J(255*-(c/100))));return I(d)}function n(a,c){c=0===c?0:c||10;var d=I(a).toHsl();d.l-=c/100;d.l=Y(1,W(0,d.l));return I(d)}function r(a,c){var d=I(a).toHsl(),b=(J(d.h)+c)%360;d.h=0>b?360+b:b;return I(d)}
function m(a){a=I(a).toHsl();a.h=(a.h+180)%360;return I(a)}function q(a){var c=I(a).toHsl(),d=c.h;return[I(a),I({h:(d+120)%360,s:c.s,l:c.l}),I({h:(d+240)%360,s:c.s,l:c.l})]}function t(a){var c=I(a).toHsl(),d=c.h;return[I(a),I({h:(d+90)%360,s:c.s,l:c.l}),I({h:(d+180)%360,s:c.s,l:c.l}),I({h:(d+270)%360,s:c.s,l:c.l})]}function w(a){var c=I(a).toHsl(),d=c.h;return[I(a),I({h:(d+72)%360,s:c.s,l:c.l}),I({h:(d+216)%360,s:c.s,l:c.l})]}function u(a,c,d){c=c||6;d=d||30;var b=I(a).toHsl();d=360/d;a=[I(a)];for(b.h=
(b.h-(d*c>>1)+720)%360;--c;)b.h=(b.h+d)%360,a.push(I(b));return a}function K(a,c){c=c||6;var d=I(a).toHsv(),b=d.h,g=d.s;d=d.v;for(var e=[],f=1/c;c--;)e.push(I({h:b,s:g,v:d})),d=(d+f)%1;return e}function T(a){a=parseFloat(a);if(isNaN(a)||0>a||1<a)a=1;return a}function Q(a,c){var d=a;"string"==typeof d&&-1!=d.indexOf(".")&&1===parseFloat(d)&&(a="100%");d="string"===typeof a&&-1!=a.indexOf("%");a=Y(c,W(0,parseFloat(a)));d&&(a=parseInt(a*c,10)/100);return 1E-6>U.abs(a-c)?1:a%c/parseFloat(c)}function Z(a){return 1==
a.length?"0"+a:""+a}function aa(a){1>=a&&(a=100*a+"%");return a}var Ga=/^[\s,#]+/,E=/\s+$/,ca=0,U=Math,J=U.round,Y=U.min,W=U.max,ma=U.random,I=function pa(a,d){var b,g;a=a?a:"";d=d||{};if(a instanceof pa)return a;if(!(this instanceof pa))return new pa(a,d);var e=a;var f={r:0,g:0,b:0};var h=1;var k=b=!1;if("string"==typeof e)a:{e=e.replace(Ga,"").replace(E,"").toLowerCase();var l=!1;if(ea[e])e=ea[e],l=!0;else if("transparent"==e){e={r:0,g:0,b:0,a:0,format:"name"};break a}e=(g=X.rgb.exec(e))?{r:g[1],
g:g[2],b:g[3]}:(g=X.rgba.exec(e))?{r:g[1],g:g[2],b:g[3],a:g[4]}:(g=X.hsl.exec(e))?{h:g[1],s:g[2],l:g[3]}:(g=X.hsla.exec(e))?{h:g[1],s:g[2],l:g[3],a:g[4]}:(g=X.hsv.exec(e))?{h:g[1],s:g[2],v:g[3]}:(g=X.hsva.exec(e))?{h:g[1],s:g[2],v:g[3],a:g[4]}:(g=X.hex8.exec(e))?{a:parseInt(g[1],16)/255,r:parseInt(g[2],16),g:parseInt(g[3],16),b:parseInt(g[4],16),format:l?"name":"hex8"}:(g=X.hex6.exec(e))?{r:parseInt(g[1],16),g:parseInt(g[2],16),b:parseInt(g[3],16),format:l?"name":"hex"}:(g=X.hex3.exec(e))?{r:parseInt(g[1]+
""+g[1],16),g:parseInt(g[2]+""+g[2],16),b:parseInt(g[3]+""+g[3],16),format:l?"name":"hex"}:!1}if("object"==typeof e){if(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b"))f=e.g,b=e.b,f={r:255*Q(e.r,255),g:255*Q(f,255),b:255*Q(b,255)},b=!0,k="%"===String(e.r).substr(-1)?"prgb":"rgb";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")){e.s=aa(e.s);e.v=aa(e.v);k=e.h;l=e.s;f=e.v;k=6*Q(k,360);l=Q(l,100);f=Q(f,100);b=U.floor(k);var n=k-b;k=f*(1-l);g=f*(1-n*l);l=
f*(1-(1-n)*l);b%=6;f={r:255*[f,g,k,k,l,f][b],g:255*[l,f,f,g,k,k][b],b:255*[k,k,l,f,f,g][b]};b=!0;k="hsv"}else e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=aa(e.s),e.l=aa(e.l),f=c(e.h,e.s,e.l),b=!0,k="hsl");e.hasOwnProperty("a")&&(h=e.a)}h=T(h);e=e.format||k;k=Y(255,W(f.r,0));g=Y(255,W(f.g,0));f=Y(255,W(f.b,0));this._originalInput=a;this._r=k;this._g=g;this._b=f;this._a=h;this._roundA=J(100*this._a)/100;this._format=d.format||e;this._gradientType=d.gradientType;1>this._r&&
(this._r=J(this._r));1>this._g&&(this._g=J(this._g));1>this._b&&(this._b=J(this._b));this._ok=b;this._tc_id=ca++};I.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var a=this.toRgb();return(299*a.r+587*a.g+114*a.b)/1E3},setAlpha:function(a){this._a=T(a);
this._roundA=J(100*this._a)/100;return this},toHsv:function(){var a=d(this._r,this._g,this._b);return{h:360*a.h,s:a.s,v:a.v,a:this._a}},toHsvString:function(){var a=d(this._r,this._g,this._b),c=J(360*a.h),b=J(100*a.s);a=J(100*a.v);return 1==this._a?"hsv("+c+", "+b+"%, "+a+"%)":"hsva("+c+", "+b+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var c=a(this._r,this._g,this._b);return{h:360*c.h,s:c.s,l:c.l,a:this._a}},toHslString:function(){var c=a(this._r,this._g,this._b),d=J(360*c.h),b=J(100*c.s);c=
J(100*c.l);return 1==this._a?"hsl("+d+", "+b+"%, "+c+"%)":"hsla("+d+", "+b+"%, "+c+"%, "+this._roundA+")"},toHex:function(a){return b(this._r,this._g,this._b,a)},toHexString:function(a){return"#"+this.toHex(a)},toHex8:function(){return g(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:J(this._r),g:J(this._g),b:J(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+J(this._r)+", "+J(this._g)+", "+J(this._b)+")":"rgba("+J(this._r)+
", "+J(this._g)+", "+J(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:J(100*Q(this._r,255))+"%",g:J(100*Q(this._g,255))+"%",b:J(100*Q(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+J(100*Q(this._r,255))+"%, "+J(100*Q(this._g,255))+"%, "+J(100*Q(this._b,255))+"%)":"rgba("+J(100*Q(this._r,255))+"%, "+J(100*Q(this._g,255))+"%, "+J(100*Q(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":1>this._a?!1:ba[b(this._r,
this._g,this._b,!0)]||!1},toFilter:function(a){var c="#"+g(this._r,this._g,this._b,this._a),d=c,b=this._gradientType?"GradientType = 1, ":"";a&&(d=I(a).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+b+"startColorstr="+c+",endColorstr="+d+")"},toString:function(a){var c=!!a;a=a||this._format;var d=!1,b=1>this._a&&0<=this._a;if(!c&&b&&("hex"===a||"hex6"===a||"hex3"===a||"name"===a))return"name"===a&&0===this._a?this.toName():this.toRgbString();"rgb"===a&&(d=this.toRgbString());
"prgb"===a&&(d=this.toPercentageRgbString());if("hex"===a||"hex6"===a)d=this.toHexString();"hex3"===a&&(d=this.toHexString(!0));"hex8"===a&&(d=this.toHex8String());"name"===a&&(d=this.toName());"hsl"===a&&(d=this.toHslString());"hsv"===a&&(d=this.toHsvString());return d||this.toHexString()},_applyModification:function(a,c){var d=a.apply(null,[this].concat([].slice.call(c)));this._r=d._r;this._g=d._g;this._b=d._b;this.setAlpha(d._a);return this},lighten:function(){return this._applyModification(k,
arguments)},brighten:function(){return this._applyModification(l,arguments)},darken:function(){return this._applyModification(n,arguments)},desaturate:function(){return this._applyModification(e,arguments)},saturate:function(){return this._applyModification(f,arguments)},greyscale:function(){return this._applyModification(h,arguments)},spin:function(){return this._applyModification(r,arguments)},_applyCombination:function(a,c){return a.apply(null,[this].concat([].slice.call(c)))},analogous:function(){return this._applyCombination(u,
arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(K,arguments)},splitcomplement:function(){return this._applyCombination(w,arguments)},triad:function(){return this._applyCombination(q,arguments)},tetrad:function(){return this._applyCombination(t,arguments)}};I.fromRatio=function(a,c){if("object"==typeof a){var d={},b;for(b in a)a.hasOwnProperty(b)&&(d[b]="a"===b?a[b]:aa(a[b]));a=d}return I(a,c)};I.equals=function(a,
c){return a&&c?I(a).toRgbString()==I(c).toRgbString():!1};I.random=function(){return I.fromRatio({r:ma(),g:ma(),b:ma()})};I.mix=function(a,c,d){d=0===d?0:d||50;a=I(a).toRgb();c=I(c).toRgb();d/=100;var b=2*d-1,g=c.a-a.a;b=((-1==b*g?b:(b+g)/(1+b*g))+1)/2;g=1-b;return I({r:c.r*b+a.r*g,g:c.g*b+a.g*g,b:c.b*b+a.b*g,a:c.a*d+a.a*(1-d)})};I.readability=function(a,c){var d=I(a),b=I(c),g=d.toRgb(),e=b.toRgb();d=d.getBrightness();b=b.getBrightness();return{brightness:Math.abs(d-b),color:Math.max(g.r,e.r)-Math.min(g.r,
e.r)+Math.max(g.g,e.g)-Math.min(g.g,e.g)+Math.max(g.b,e.b)-Math.min(g.b,e.b)}};I.isReadable=function(a,c){var d=I.readability(a,c);return 125<d.brightness&&500<d.color};I.mostReadable=function(a,c){for(var d=null,b=0,g=!1,e=0;e<c.length;e++){var f=I.readability(a,c[e]),h=125<f.brightness&&500<f.color;f=f.brightness/125*3+f.color/500;if(h&&!g||h&&g&&f>b||!h&&!g&&f>b)g=h,b=f,d=I(c[e])}return d};var ea=I.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",
bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",
darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",
indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",
maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",
palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",
tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},ba=I.hexNames=function(a){var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[a[d]]=d);return c}(ea),X={rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,
hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,
hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};window.tinycolor=I})();a(function(){a.fn.spectrum.load&&a.fn.spectrum.processNativeColorInputs()})});
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){var b=Math.max,e=Math.min;var f={};f.d=a(document);f.t=function(a){return a.originalEvent.touches.length-1};var d=function(){var c=this;this.cv=this.v=this.g=this.i=this.$=this.o=null;this.h=this.w=this.y=this.x=0;this.c=this.$c=null;this.t=0;this.isInit=!1;this.rH=this.eH=this.cH=this.dH=this.pColor=this.fgColor=null;this.scale=1;this.relativeHeight=this.relativeWidth=this.relative=!1;this.$div=null;
this.run=function(){var d=function(a,d){for(var b in d)c.o[b]=d[b];c._carve().init();c._configure()._draw()};if(!this.$.data("kontroled")){this.$.data("kontroled",!0);this.extend();this.o=a.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:!0===this.$.data("cursor")&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),
1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,
release:null,format:function(a){return a},parse:function(a){return parseFloat(a)}},this.o);this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation;this.o.inputColor||(this.o.inputColor=this.o.fgColor);this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(d){var b=a(this);c.i[d]=b;c.v[d]=c.o.parse(b.val());b.bind("change blur",function(){var a={};a[d]=b.val();c.val(c._validate(a))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),
""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){c.val(c._validate(c.o.parse(c.$.val())))}));!this.o.displayInput&&this.$.hide();this.$c=a(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height});this.$div=a('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>');this.$.wrap(this.$div).before(this.$c);this.$div=this.$.parent();"undefined"!==typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]);
this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null;if(!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1);this.relativeWidth=0!==this.o.width%1&&this.o.width.indexOf("%");
this.relativeHeight=0!==this.o.height%1&&this.o.height.indexOf("%");this.relative=this.relativeWidth||this.relativeHeight;this._carve();this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v;this.$.bind("configure",d).parent().bind("configure",d);this._listen()._configure()._xy().init();this.isInit=!0;this.$.val(this.o.format(this.v));this._draw();return this}};this._carve=function(){if(this.relative){var a=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/
100:this.$div.parent().width(),c=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(a,c)}else this.w=this.o.width,this.h=this.o.height;this.$div.css({width:this.w+"px",height:this.h+"px"});this.$c.attr({width:this.w,height:this.h});1!==this.scale&&(this.$c[0].width*=this.scale,this.$c[0].height*=this.scale,this.$c.width(this.w),this.$c.height(this.h));return this};this._draw=function(){var a=!0;c.g=c.c;c.clear();c.dH&&(a=
c.dH());!1!==a&&c.draw()};this._touch=function(a){var d=function(a){a=c.xy2val(a.originalEvent.touches[c.t].pageX,a.originalEvent.touches[c.t].pageY);a==c.cv||c.cH&&!1===c.cH(a)||(c.change(c._validate(a)),c._draw())};this.t=f.t(a);d(a);f.d.bind("touchmove.k",d).bind("touchend.k",function(){f.d.unbind("touchmove.k touchend.k");c.val(c.cv)});return this};this._mouse=function(a){var d=function(a){a=c.xy2val(a.pageX,a.pageY);a==c.cv||c.cH&&!1===c.cH(a)||(c.change(c._validate(a)),c._draw())};d(a);f.d.bind("mousemove.k",
d).bind("keyup.k",function(a){27===a.keyCode&&(f.d.unbind("mouseup.k mousemove.k keyup.k"),c.eH&&!1===c.eH()||c.cancel())}).bind("mouseup.k",function(a){f.d.unbind("mousemove.k mouseup.k keyup.k");c.val(c.cv)});return this};this._xy=function(){var a=this.$c.offset();this.x=a.left;this.y=a.top;return this};this._listen=function(){this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(a){a.preventDefault();c._xy()._mouse(a)}).bind("touchstart",function(a){a.preventDefault();
c._xy()._touch(a)}),this.listen());this.relative&&a(window).resize(function(){c._carve().init();c._draw()});return this};this._configure=function(){this.o.draw&&(this.dH=this.o.draw);this.o.change&&(this.cH=this.o.change);this.o.cancel&&(this.eH=this.o.cancel);this.o.release&&(this.rH=this.o.release);this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor;return this};this._clear=function(){this.$c[0].width=
this.$c[0].width};this._validate=function(a){return Math.round(~~((0>a?-.5:.5)+a/this.o.step)*this.o.step*100)/100};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(a){};this.val=function(a){};this.xy2val=function(a,c){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(a,c){a=a.substring(1,7);var d=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)];return"rgba("+d[0]+","+d[1]+","+
d[2]+","+c+")"};this.copy=function(a,c){for(var d in a)c[d]=a[d]}};var g=function(){d.call(this);this.w2=this.cursorExt=this.lineWidth=this.radius=this.xy=this.startAngle=null;this.PI2=2*Math.PI;this.extend=function(){this.o=a.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)};this.val=function(a,d){if(null!=a)a=this.o.parse(a),!1!==d&&a!=this.v&&this.rH&&!1===this.rH(a)||(this.v=this.cv=this.o.stopper?
b(e(a,this.o.max),this.o.min):a,this.$.val(this.o.format(this.v)),this._draw());else return this.v};this.xy2val=function(a,d){var c=Math.atan2(a-(this.x+this.w2),-(d-this.y-this.w2))-this.angleOffset;this.o.flip&&(c=this.angleArc-c-this.PI2);this.angleArc!=this.PI2&&0>c&&-.5<c?c=0:0>c&&(c+=this.PI2);c=c*(this.o.max-this.o.min)/this.angleArc+this.o.min;this.o.stopper&&(c=b(e(c,this.o.max),this.o.min));return c};this.listen=function(){var c=this,d,g,f=function(a){a.preventDefault();var f=a.originalEvent;
a=f.detail||f.wheelDeltaX;f=f.detail||f.wheelDeltaY;var h=c._validate(c.o.parse(c.$.val()))+(0<a||0<f?c.o.step:0>a||0>f?-c.o.step:0);h=b(e(h,c.o.max),c.o.min);c.val(h,!1);c.rH&&(clearTimeout(d),d=setTimeout(function(){c.rH(h);d=null},100),g||(g=setTimeout(function(){d&&c.rH(h);g=null},200)))},l,n,q=1,r={37:-c.o.step,38:c.o.step,39:c.o.step,40:-c.o.step};this.$.bind("keydown",function(d){var g=d.keyCode;96<=g&&105>=g&&(g=d.keyCode=g-48);l=parseInt(String.fromCharCode(g));isNaN(l)&&(13!==g&&8!==g&&
9!==g&&189!==g&&(190!==g||c.$.val().match(/\./))&&d.preventDefault(),-1<a.inArray(g,[37,38,39,40])&&(d.preventDefault(),d=c.o.parse(c.$.val())+r[g]*q,c.o.stopper&&(d=b(e(d,c.o.max),c.o.min)),c.change(c._validate(d)),c._draw(),n=window.setTimeout(function(){q*=2},30)))}).bind("keyup",function(a){isNaN(l)?n&&(window.clearTimeout(n),n=null,q=1,c.val(c.$.val())):c.$.val()>c.o.max&&c.$.val(c.o.max)||c.$.val()<c.o.min&&c.$.val(c.o.min)});this.$c.bind("mousewheel DOMMouseScroll",f);this.$.bind("mousewheel DOMMouseScroll",
f)};this.init=function(){if(this.v<this.o.min||this.v>this.o.max)this.v=this.o.min;this.$.val(this.v);this.w2=this.w/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2*this.scale;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;
this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var a=b(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/a>>0)+
"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(a){this.cv=a;this.$.val(this.o.format(a))};this.angle=function(a){return(a-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.arc=function(a){a=this.angle(a);if(this.o.flip){var c=this.endAngle+1E-5;a=c-a-1E-5}else c=this.startAngle-1E-5,a=c+a+1E-5;this.o.cursor&&(c=a-this.cursorExt)&&(a+=this.cursorExt);
return{s:c,e:a,d:this.o.flip&&!this.o.cursor}};this.draw=function(){var a=this.g,d=this.arc(this.cv);var b=1;a.lineWidth=this.lineWidth;a.lineCap=this.lineCap;"none"!==this.o.bgColor&&(a.beginPath(),a.strokeStyle=this.o.bgColor,a.arc(this.xy,this.xy,this.radius,this.endAngle-1E-5,this.startAngle+1E-5,!0),a.stroke());this.o.displayPrevious&&(b=this.arc(this.v),a.beginPath(),a.strokeStyle=this.pColor,a.arc(this.xy,this.xy,this.radius,b.s,b.e,b.d),a.stroke(),b=this.cv==this.v);a.beginPath();a.strokeStyle=
b?this.o.fgColor:this.fgColor;a.arc(this.xy,this.xy,this.radius,d.s,d.e,d.d);a.stroke()};this.cancel=function(){this.val(this.v)}};a.fn.dial=a.fn.knob=function(c){return this.each(function(){var d=new g;d.o=c;d.$=a(this);d.run()}).parent()}});
!function(a){function b(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)}function e(a,c,d){a.addClass(c);setTimeout(function(){a.removeClass(c)},d)}function f(c){return a.isArray(c)?c:[c]}function d(a,c){return 100*c/(a[1]-a[0])}function g(a,c){for(var d=1;a>=c[d];)d+=1;return d}function c(a,c,d){var g;if("number"==typeof c&&(c=[c]),"[object Array]"!==Object.prototype.toString.call(c))throw Error("noUiSlider: 'range' contains invalid value.");if(g="min"===a?0:"max"===a?100:parseFloat(a),!b(g)||
!b(c[0]))throw Error("noUiSlider: 'range' value isn't numeric.");d.xPct.push(g);d.xVal.push(c[0]);g?d.xSteps.push(isNaN(c[1])?!1:c[1]):isNaN(c[1])||(d.xSteps[0]=c[1])}function h(a,c,b){return c?void(b.xSteps[a]=d([b.xVal[a],b.xVal[a+1]],c)/(100/(b.xPct[a+1]-b.xPct[a]))):!0}function k(a,d,b,g){this.xPct=[];this.xVal=[];this.xSteps=[g||!1];this.xNumSteps=[!1];this.snap=d;this.direction=b;var e;d=[];for(e in a)a.hasOwnProperty(e)&&d.push([a[e],e]);d.sort(function(a,c){return a[0]-c[0]});for(e=0;e<d.length;e++)c(d[e][1],
d[e][0],this);this.xNumSteps=this.xSteps.slice(0);for(e=0;e<this.xNumSteps.length;e++)h(e,this.xNumSteps[e],this)}function m(a,c){if(!b(c))throw Error("noUiSlider: 'step' is not numeric.");a.singleStep=c}function l(c,d){if("object"!=typeof d||a.isArray(d))throw Error("noUiSlider: 'range' is not an object.");if(void 0===d.min||void 0===d.max)throw Error("noUiSlider: Missing 'min' or 'max' in 'range'.");c.spectrum=new k(d,c.snap,c.dir,c.singleStep)}function n(c,d){if(d=f(d),!a.isArray(d)||!d.length||
2<d.length)throw Error("noUiSlider: 'start' option is incorrect.");c.handles=d.length;c.start=d}function q(a,c){if(a.snap=c,"boolean"!=typeof c)throw Error("noUiSlider: 'snap' option must be a boolean.");}function r(a,c){if(a.animate=c,"boolean"!=typeof c)throw Error("noUiSlider: 'animate' option must be a boolean.");}function w(a,c){if("lower"===c&&1===a.handles)a.connect=1;else if("upper"===c&&1===a.handles)a.connect=2;else if(!0===c&&2===a.handles)a.connect=3;else{if(!1!==c)throw Error("noUiSlider: 'connect' option doesn't match handle count.");
a.connect=0}}function t(a,c){switch(c){case "horizontal":a.ort=0;break;case "vertical":a.ort=1;break;default:throw Error("noUiSlider: 'orientation' option is invalid.");}}function u(a,c){if(!b(c))throw Error("noUiSlider: 'margin' option must be numeric.");if(a.margin=a.spectrum.getMargin(c),!a.margin)throw Error("noUiSlider: 'margin' option is only supported on linear sliders.");}function x(a,c){if(!b(c))throw Error("noUiSlider: 'limit' option must be numeric.");if(a.limit=a.spectrum.getMargin(c),
!a.limit)throw Error("noUiSlider: 'limit' option is only supported on linear sliders.");}function B(a,c){switch(c){case "ltr":a.dir=0;break;case "rtl":a.dir=1;a.connect=[0,2,1,3][a.connect];break;default:throw Error("noUiSlider: 'direction' option was not recognized.");}}function D(a,c){if("string"!=typeof c)throw Error("noUiSlider: 'behaviour' must be a string containing options.");var d=0<=c.indexOf("tap"),b=0<=c.indexOf("drag"),g=0<=c.indexOf("fixed"),e=0<=c.indexOf("snap");a.events={tap:d||e,
drag:b,fixed:g,snap:e}}function F(a,c){if(a.format=c,"function"==typeof c.to&&"function"==typeof c.from)return!0;throw Error("noUiSlider: 'format' requires 'to' and 'from' methods.");}function z(c){var d,b={margin:0,limit:0,animate:!0,format:T};return d={step:{r:!1,t:m},start:{r:!0,t:n},connect:{r:!0,t:w},direction:{r:!0,t:B},snap:{r:!1,t:q},animate:{r:!1,t:r},range:{r:!0,t:l},orientation:{r:!1,t:t},margin:{r:!1,t:u},limit:{r:!1,t:x},behaviour:{r:!0,t:D},format:{r:!1,t:F}},c=a.extend({connect:!1,
direction:"ltr",behaviour:"tap",orientation:"horizontal"},c),a.each(d,function(a,d){if(void 0===c[a]){if(d.r)throw Error("noUiSlider: '"+a+"' is required.");return!0}d.t(b,c[a])}),b.style=b.ort?"top":"left",b}function v(c,d){var b=a("<div><div/></div>").addClass(K[2]),g=["-lower","-upper"];return c&&g.reverse(),b.children().addClass(K[3]+" "+K[3]+g[d]),b}function y(a,c,d){switch(a){case 1:c.addClass(K[7]);d[0].addClass(K[6]);break;case 3:d[1].addClass(K[6]);case 2:d[0].addClass(K[7]);case 0:c.addClass(K[6])}}
function A(a,c,d){var b,g=[];for(b=0;a>b;b+=1)g.push(v(c,b).appendTo(d));return g}function C(c,d,b){return b.addClass([K[0],K[8+c],K[4+d]].join(" ")),a("<div/>").appendTo(b).addClass(K[1])}function H(c,d,b){function g(){return G[["width","height"][d.ort]]()}function h(a){var c,d=[w.val()];for(c=0;c<a.length;c+=1)w.trigger(a[c],d)}function k(a){return 1===a.length?a[0]:d.dir?a.reverse():a}function l(a){return function(c,d){w.val([a?null:d,a?d:null],!0)}}function n(c){var d=a.inArray(c,P);w[0].linkAPI&&
w[0].linkAPI[c]&&w[0].linkAPI[c].change(v[d],M[d].children(),w)}function r(a,c,b,g){return a=a.replace(/\s/g,L+" ")+L,c.on(a,function(a){if(w.attr("disabled"))a=!1;else{if(w.hasClass(K[14]))var c=!1;else{var e=a;e.preventDefault();var f,h;c=0===e.type.indexOf("touch");var k=0===e.type.indexOf("mouse"),l=0===e.type.indexOf("pointer"),n=e;c=(a=(0===e.type.indexOf("MSPointer")&&(l=!0),e.originalEvent&&(e=e.originalEvent),c&&(f=e.changedTouches[0].pageX,h=e.changedTouches[0].pageY),(k||l)&&(l||void 0!==
window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),f=e.clientX+window.pageXOffset,h=e.clientY+window.pageYOffset),n.points=[f,h],n.cursor=k,n),a.calcPoint=a.points[d.ort],void b(a,g))}a=c}return a})}function m(a,c){var d=c.handles||M,b=100*(a.calcPoint-c.start)/g(),e=d[0][0]!==M[0][0]?1:0,f=c.positions;var k=b+f[0];f=b+f[1];b=1<d.length?(0>k&&(f+=Math.abs(k)),100<f&&(k-=f-100),[Math.max(Math.min(k,100),0),Math.max(Math.min(f,
100),0)]):[k,f];k=t(d[0],b[e],1===d.length);1<d.length&&(k=t(d[1],b[e?0:1],!1)||k);k&&h(["slide"])}function B(c){a("."+K[15]).removeClass(K[15]);c.cursor&&a("body").css("cursor","").off(L);O.off(L);w.removeClass(K[12]);h(["set","change"])}function q(c,d){1===d.handles.length&&d.handles[0].children().addClass(K[15]);c.stopPropagation();r(R.move,O,m,{start:c.calcPoint,handles:d.handles,positions:[u[0],u[M.length-1]]});r(R.end,O,B,null);c.cursor&&(a("body").css("cursor",a(c.target).css("cursor")),1<
M.length&&w.addClass(K[12]),a("body").on("selectstart"+L,!1))}function x(c){var b=c.calcPoint;var f=0;c.stopPropagation();a.each(M,function(){f+=this.offset()[d.style]});f=f/2>b||1===M.length?0:1;b-=G.offset()[d.style];b=100*b/g();d.events.snap||e(w,K[14],300);t(M[f],b);h(["slide","set","change"]);d.events.snap&&q(c,{handles:[M[f]]})}function t(a,c,b){var g=a[0]!==M[0][0]?1:0,e=u[0]+d.margin,f=u[1]-d.margin,h=u[0]+d.limit,k=u[1]-d.limit;return 1<M.length&&(c=g?Math.max(c,e):Math.min(c,f)),!1!==b&&
d.limit&&1<M.length&&(c=g?Math.min(c,h):Math.max(c,k)),c=D.getStep(c),c=Math.max(Math.min(parseFloat(c.toFixed(7)),100),0),c===u[g]?!1:(a.css(d.style,c+"%"),a.is(":first-child")&&a.toggleClass(K[17],50<c),u[g]=c,v[g]=D.fromStepping(c),n(P[g]),!0)}var w=a(c),u=[-1,-1],D=d.spectrum,v=[],P=["lower","upper"].slice(0,d.handles);if(d.dir&&P.reverse(),c.LinkUpdate=n,c.LinkConfirm=function(c,b){var g=a.inArray(c,P);return b&&b.appendTo(M[g].children()),d.dir&&1<d.handles&&(g=1===g?0:1),l(g)},c.LinkDefaultFormatter=
d.format,c.LinkDefaultFlag="lower",c.reappend=function(){var a,c;for(a=0;a<P.length;a+=1)this.linkAPI&&this.linkAPI[c=P[a]]&&this.linkAPI[c].reconfirm(c)},w.hasClass(K[0]))throw Error("Slider was already initialized.");var G=C(d.dir,d.ort,w);var M=A(d.handles,d.dir,G);y(d.connect,w,M);(function(a){var c,d;if(!a.fixed)for(c=0;c<M.length;c+=1)r(R.start,M[c].children(),q,{handles:[M[c]]});a.tap&&r(R.start,G,x,{handles:M});a.drag&&(d=G.find("."+K[7]).addClass(K[10]),a.fixed&&(d=d.add(G.children().not(d).children())),
r(R.start,d,q,{handles:M}))})(d.events);c.vSet=function(a){if(w[0].LinkIsEmitting)return this;a=f(a);d.dir&&1<d.handles&&a.reverse();d.animate&&-1!==u[0]&&e(w,K[14],300);var c=1<M.length?3:1;1===a.length&&(c=1);var b;d.limit&&(c+=1);for(b=0;c>b;b+=1){var g=b%2;var k=a[g];null!==k&&!1!==k&&("number"==typeof k&&(k=String(k)),k=d.format.from(k),(!1===k||isNaN(k)||!1===t(M[g],D.toStepping(k),b===3-d.dir))&&n(P[g]))}return h(["set"]),this};c.vGet=function(){var a,c=[];for(a=0;a<d.handles;a+=1)c[a]=d.format.to(v[a]);
return k(c)};c.destroy=function(){return a(this).off(L).removeClass(K.join(" ")).empty(),delete this.LinkUpdate,delete this.LinkConfirm,delete this.LinkDefaultFormatter,delete this.LinkDefaultFlag,delete this.reappend,delete this.vGet,delete this.vSet,delete this.getCurrentStep,delete this.getInfo,delete this.destroy,b};c.getCurrentStep=function(){var c=a.map(u,function(a,c){var d=D.getApplicableStep(a),b=String(d[2]).split("."),g=100===a?null:d[2];b=Number((v[c]-d[2]).toFixed(1<b.length?b[1].length:
0));return[[0===a?null:b>=d[1]?d[2]:d[0]||!1,g]]});return k(c)};c.getOriginalOptions=function(){return b};c.getInfo=function(){return[D,d.style,d.ort]};w.val(d.start)}function G(a){var c=z(a,this);return this.each(function(){H(this,c,a)})}function P(c){return this.each(function(){if(!this.destroy)return void a(this).noUiSlider(c);var d=a(this).val(),b=this.destroy(),g=a.extend({},b,c);a(this).noUiSlider(g);this.reappend();b.start===g.start&&a(this).val(d)})}function M(){return this[0][arguments.length?
"vSet":"vGet"].apply(this[0],arguments)}var O=a(document),S=a.fn.val,L=".nui",R=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},K="noUi-target noUi-base noUi-origin noUi-handle noUi-horizontal noUi-vertical noUi-background noUi-connect noUi-ltr noUi-rtl noUi-dragable  noUi-state-drag  noUi-state-tap noUi-active  noUi-stacking".split(" ");
k.prototype.getMargin=function(a){return 2===this.xPct.length?d(this.xVal,a):!1};k.prototype.toStepping=function(a){var c=this.xVal,b=this.xPct;var e=a;if(e>=c.slice(-1)[0])e=100;else{var f=g(e,c);var h=c[f-1];var k=c[f];c=b[f-1];b=b[f];h=[h,k];e=d(h,0>h[0]?e+Math.abs(h[0]):e-h[0]);e=c+e/(100/(b-c))}return a=e,this.direction&&(a=100-a),a};k.prototype.fromStepping=function(a){this.direction&&(a=100-a);var c=this.xVal;var d=this.xPct;if(100<=a)d=c.slice(-1)[0];else{var b=g(a,d);var e=c[b-1];var f=c[b];
c=d[b-1];e=[e,f];d=100/(d[b]-c)*(a-c)*(e[1]-e[0])/100+e[0]}a=Math.pow(10,7);return Number((Math.round(d*a)/a).toFixed(7))};k.prototype.getStep=function(a){this.direction&&(a=100-a);var c=this.xPct;var d=this.xSteps,b=this.snap,e=a;if(100===e)c=e;else{var f,h,k=g(e,c);b?c=(f=c[k-1],h=c[k],e-f>(h-f)/2?h:f):d[k-1]?(f=d[k-1],c=c[k-1]+Math.round((e-c[k-1])/f)*f):c=e}return a=c,this.direction&&(a=100-a),a};k.prototype.getApplicableStep=function(a){var c=g(a,this.xPct);a=100===a?2:1;return[this.xNumSteps[c-
2],this.xVal[c-a],this.xNumSteps[c-a]]};k.prototype.convert=function(a){return this.getStep(this.toStepping(a))};var T={to:function(a){return a.toFixed(2)},from:Number};a.fn.val=function(c){if(!arguments.length){var d=a(this[0]);return(d.hasClass(K[0])?M:S).call(d)}var b=a.isFunction(c);return this.each(function(d){var g=c,e=a(this);b&&(g=c.call(this,d,e.val()));(e.hasClass(K[0])?M:S).call(e,g)})};a.fn.noUiSlider=function(a,c){switch(a){case "step":return this[0].getCurrentStep();case "options":return this[0].getOriginalOptions()}return(c?
P:G).call(this,a)}}(window.jQuery||window.Zepto);
(function(){function a(a){function b(c,d){var b=c==window,e=d&&void 0!==d.message?d.message:void 0;d=a.extend({},a.blockUI.defaults,d||{});if(!d.ignoreIfBlocked||!a(c).data("blockUI.isBlocked")){d.overlayCSS=a.extend({},a.blockUI.defaults.overlayCSS,d.overlayCSS||{});var t=a.extend({},a.blockUI.defaults.css,d.css||{});d.onOverlayClick&&(d.overlayCSS.cursor="pointer");var u=a.extend({},a.blockUI.defaults.themedCSS,d.themedCSS||{});e=void 0===e?d.message:e;b&&r&&f(window,{fadeOut:0});if(e&&"string"!=
typeof e&&(e.parentNode||e.jquery)){var z=e.jquery?e[0]:e,v={};a(c).data("blockUI.history",v);v.el=z;v.parent=z.parentNode;v.display=z.style.display;v.position=z.style.position;v.parent&&v.parent.removeChild(z)}a(c).data("blockUI.onUnblock",d.onUnblock);v=d.baseZ;var y=l||d.forceIframe?a('<iframe class="blockUI" style="z-index:'+v++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+d.iframeSrc+'"></iframe>'):a('<div class="blockUI" style="display:none"></div>');
z=d.theme?a('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+v++ +';display:none"></div>'):a('<div class="blockUI blockOverlay" style="z-index:'+v++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');d.theme&&b?(v='<div class="blockUI '+d.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(v+10)+';display:none;position:fixed">',d.title&&(v+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+
(d.title||"&nbsp;")+"</div>"),v+='<div class="ui-widget-content ui-dialog-content"></div></div>'):d.theme?(v='<div class="blockUI '+d.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(v+10)+';display:none;position:absolute">',d.title&&(v+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(d.title||"&nbsp;")+"</div>"),v+='<div class="ui-widget-content ui-dialog-content"></div></div>'):v=b?'<div class="blockUI '+d.blockMsgClass+' blockPage" style="z-index:'+
(v+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+d.blockMsgClass+' blockElement" style="z-index:'+(v+10)+';display:none;position:absolute"></div>';v=a(v);e&&(d.theme?(v.css(u),v.addClass("ui-widget-content")):v.css(t));d.theme||z.css(d.overlayCSS);z.css("position",b?"fixed":"absolute");(l||d.forceIframe)&&y.css("opacity",0);t=[y,z,v];var A=b?a("body"):a(c);a.each(t,function(){this.appendTo(A)});d.theme&&d.draggable&&a.fn.draggable&&v.draggable({handle:".ui-dialog-titlebar",cancel:"li"});
u=q&&(!a.support.boxModel||0<a("object,embed",b?null:c).length);if(n||u){b&&d.allowBodyStretch&&a.support.boxModel&&a("html,body").css("height","100%");if((n||!a.support.boxModel)&&!b){u=parseInt(a.css(c,"borderTopWidth"),10)||0;var C=parseInt(a.css(c,"borderLeftWidth"),10)||0,H=u?"(0 - "+u+")":0,G=C?"(0 - "+C+")":0}a.each(t,function(a,c){var g=c[0].style;g.position="absolute";if(2>a)b?g.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+
d.quirksmodeOffsetHack+') + "px"'):g.setExpression("height",'this.parentNode.offsetHeight + "px"'),b?g.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):g.setExpression("width",'this.parentNode.offsetWidth + "px"'),G&&g.setExpression("left",G),H&&g.setExpression("top",H);else if(d.centerY)b&&g.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),
g.marginTop=0;else if(!d.centerY&&b){var e=d.css&&d.css.top?parseInt(d.css.top,10):0;g.setExpression("top","((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+e+') + "px"')}})}e&&(d.theme?v.find(".ui-widget-content").append(e):v.append(e),(e.jquery||e.nodeType)&&a(e).show());(l||d.forceIframe)&&d.showOverlay&&y.show();d.fadeIn?(t=d.onBlock?d.onBlock:m,y=d.showOverlay&&!e?t:m,t=e?t:m,d.showOverlay&&z._fadeIn(d.fadeIn,y),e&&v._fadeIn(d.fadeIn,t)):
(d.showOverlay&&z.show(),e&&v.show(),d.onBlock&&d.onBlock.bind(v)());g(1,c,d);b?(r=v[0],w=a(d.focusableElements,r),d.focusInput&&setTimeout(h,20)):k(v[0],d.centerX,d.centerY);d.timeout&&(e=setTimeout(function(){b?a.unblockUI(d):a(c).unblock(d)},d.timeout),a(c).data("blockUI.timeout",e))}}function f(c,b){var e=c==window,f=a(c),h=f.data("blockUI.history"),k=f.data("blockUI.timeout");k&&(clearTimeout(k),f.removeData("blockUI.timeout"));b=a.extend({},a.blockUI.defaults,b||{});g(0,c,b);null===b.onUnblock&&
(b.onUnblock=f.data("blockUI.onUnblock"),f.removeData("blockUI.onUnblock"));var l=e?a("body").children().filter(".blockUI").add("body > .blockUI"):f.find(">.blockUI");b.cursorReset&&(1<l.length&&(l[1].style.cursor=b.cursorReset),2<l.length&&(l[2].style.cursor=b.cursorReset));e&&(r=w=null);if(b.fadeOut){var n=l.length;l.stop().fadeOut(b.fadeOut,function(){0===--n&&d(l,h,b,c)})}else d(l,h,b,c)}function d(c,d,b,g){var e=a(g);if(!e.data("blockUI.isBlocked")){c.each(function(a,c){this.parentNode&&this.parentNode.removeChild(this)});
d&&d.el&&(d.el.style.display=d.display,d.el.style.position=d.position,d.el.style.cursor="default",d.parent&&d.parent.appendChild(d.el),e.removeData("blockUI.history"));e.data("blockUI.static")&&e.css("position","static");if("function"==typeof b.onUnblock)b.onUnblock(g,b);c=a(document.body);d=c.width();b=c[0].style.width;c.width(d-1).width(d);c[0].style.width=b}}function g(d,b,g){var e=b==window;b=a(b);if(d||(!e||r)&&(e||b.data("blockUI.isBlocked")))b.data("blockUI.isBlocked",d),e&&g.bindEvents&&(!d||
g.showOverlay)&&(d?a(document).bind("mousedown mouseup keydown keypress keyup touchstart touchend touchmove",g,c):a(document).unbind("mousedown mouseup keydown keypress keyup touchstart touchend touchmove",c))}function c(c){if("keydown"===c.type&&c.keyCode&&9==c.keyCode&&r&&c.data.constrainTabKey){var d=w,b=c.shiftKey&&c.target===d[0];if(!c.shiftKey&&c.target===d[d.length-1]||b)return setTimeout(function(){h(b)},10),!1}d=c.data;var g=a(c.target);if(g.hasClass("blockOverlay")&&d.onOverlayClick)d.onOverlayClick(c);
return 0<g.parents("div."+d.blockMsgClass).length?!0:0===g.parents().children().filter("div.blockUI").length}function h(a){w&&(a=w[!0===a?w.length-1:0])&&a.focus()}function k(c,d,b){var g=c.parentNode,e=c.style,f=(g.offsetWidth-c.offsetWidth)/2-(parseInt(a.css(g,"borderLeftWidth"),10)||0);c=(g.offsetHeight-c.offsetHeight)/2-(parseInt(a.css(g,"borderTopWidth"),10)||0);d&&(e.left=0<f?f+"px":"0");b&&(e.top=0<c?c+"px":"0")}a.fn._fadeIn=a.fn.fadeIn;var m=a.noop||function(){},l=/MSIE/.test(navigator.userAgent),
n=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),q=a.isFunction(document.createElement("div").style.setExpression);a.blockUI=function(a){b(window,a)};a.unblockUI=function(a){f(window,a)};a.growlUI=function(c,d,b,g){var e=a('<div class="growlUI"></div>');c&&e.append("<h1>"+c+"</h1>");d&&e.append("<h2>"+d+"</h2>");void 0===b&&(b=3E3);var f=function(c){c=c||{};a.blockUI({message:e,fadeIn:"undefined"!==typeof c.fadeIn?c.fadeIn:700,fadeOut:"undefined"!==typeof c.fadeOut?c.fadeOut:
1E3,timeout:"undefined"!==typeof c.timeout?c.timeout:b,centerY:!1,showOverlay:!1,onUnblock:g,css:a.blockUI.defaults.growlCSS})};f();e.css("opacity");e.mouseover(function(){f({fadeIn:0,timeout:3E4});var c=a(".blockMsg");c.stop();c.fadeTo(300,1)}).mouseout(function(){a(".blockMsg").fadeOut(1E3)})};a.fn.block=function(c){if(this[0]===window)return a.blockUI(c),this;var d=a.extend({},a.blockUI.defaults,c||{});this.each(function(){var c=a(this);d.ignoreIfBlocked&&c.data("blockUI.isBlocked")||c.unblock({fadeOut:0})});
return this.each(function(){"static"==a.css(this,"position")&&(this.style.position="relative",a(this).data("blockUI.static",!0));this.style.zoom=1;b(this,c)})};a.fn.unblock=function(c){return this[0]===window?(a.unblockUI(c),this):this.each(function(){f(this,c)})};a.blockUI.version=2.7;a.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",
cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1E3,centerX:!0,centerY:!0,
allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var r=null,w=[]}"function"===typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],a):a(jQuery)})();
(function(a,b,e){function f(a,c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent("on"+c,d)}function d(a){if("keypress"==a.type){var c=String.fromCharCode(a.which);a.shiftKey||(c=c.toLowerCase());return c}return w[a.which]?w[a.which]:t[a.which]?t[a.which]:String.fromCharCode(a.which).toLowerCase()}function g(a){a=a||{};var c=!1,d;for(d in z)a[d]?c=!0:z[d]=0;c||(C=!1)}function c(a,c,d,b,g,e){var f,h,k=[],n=d.type;if(!D[a])return[];"keyup"==n&&l(a)&&(c=[a]);for(f=0;f<D[a].length;++f)if(h=
D[a][f],!(!b&&h.seq&&z[h.seq]!=h.level||n!=h.action||("keypress"!=n||d.metaKey||d.ctrlKey)&&c.sort().join(",")!==h.modifiers.sort().join(","))){var r=b&&h.seq==b&&h.level==e;(!b&&h.combo==g||r)&&D[a].splice(f,1);k.push(h)}return k}function h(a){var c=[];a.shiftKey&&c.push("shift");a.altKey&&c.push("alt");a.ctrlKey&&c.push("ctrl");a.metaKey&&c.push("meta");return c}function k(a,c,d,b){H.stopCallback(c,c.target||c.srcElement,d,b)||!1!==a(c,d)||(c.preventDefault?c.preventDefault():c.returnValue=!1,c.stopPropagation?
c.stopPropagation():c.cancelBubble=!0)}function m(a){"number"!==typeof a.which&&(a.which=a.keyCode);var c=d(a);c&&("keyup"==a.type&&y===c?y=!1:H.handleKey(c,h(a),a))}function l(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function n(a,c,b,e){function f(c){return function(){C=c;++z[a];clearTimeout(v);v=setTimeout(g,1E3)}}function h(c){k(b,c,a);"keyup"!==e&&(y=d(c));setTimeout(g,10)}for(var l=z[a]=0;l<c.length;++l){var n=l+1===c.length?h:f(e||q(c[l+1]).action);r(c[l],n,e,a,l)}}function q(a,c){var d,
b=[];var g="+"===a?["+"]:a.split("+");for(d=0;d<g.length;++d){var e=g[d];x[e]&&(e=x[e]);c&&"keypress"!=c&&u[e]&&(e=u[e],b.push("shift"));l(e)&&b.push(e)}g=e;d=c;if(!d){if(!B){B={};for(var f in w)95<f&&112>f||w.hasOwnProperty(f)&&(B[w[f]]=f)}d=B[g]?"keydown":"keypress"}"keypress"==d&&b.length&&(d="keydown");return{key:e,modifiers:b,action:d}}function r(a,d,b,g,e){F[a+":"+b]=d;a=a.replace(/\s+/g," ");var f=a.split(" ");1<f.length?n(a,f,d,b):(b=q(a,b),D[b.key]=D[b.key]||[],c(b.key,b.modifiers,{type:b.action},
g,a,e),D[b.key][g?"unshift":"push"]({callback:d,modifiers:b.modifiers,action:b.action,seq:g,level:e,combo:a}))}var w={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1",
"@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},x={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},B,D={},F={},z={},v,y=!1,A=!1,C=!1;for(e=1;20>e;++e)w[111+e]="f"+e;for(e=0;9>=e;++e)w[e+96]=e;f(b,"keypress",m);f(b,"keydown",m);f(b,"keyup",m);var H={bind:function(a,c,d){a=a instanceof Array?a:[a];for(var b=0;b<a.length;++b)r(a[b],c,d);return this},
unbind:function(a,c){return H.bind(a,function(){},c)},trigger:function(a,c){if(F[a+":"+c])F[a+":"+c]({},a);return this},reset:function(){D={};F={};return this},stopCallback:function(a,c){return-1<(" "+c.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==c.tagName||"SELECT"==c.tagName||"TEXTAREA"==c.tagName||c.isContentEditable},handleKey:function(a,d,b){var e=c(a,d,b),f;d={};var h=0,n=!1;for(f=0;f<e.length;++f)e[f].seq&&(h=Math.max(h,e[f].level));for(f=0;f<e.length;++f)e[f].seq?e[f].level==h&&(n=!0,
d[e[f].seq]=1,k(e[f].callback,b,e[f].combo,e[f].seq)):n||k(e[f].callback,b,e[f].combo);e="keypress"==b.type&&A;b.type!=C||l(a)||e||g(d);A=n&&"keydown"==b.type}};a.Mousetrap=H;"function"===typeof define&&define.amd&&define(H)})(window,document);if("undefined"==typeof net)var net={};net.brehaut||(net.brehaut={});
(function(){function a(a,c){a=a.toString();for(var d=[],b=0,g=Math.max(c-a.length,0);b<g;b++)d.push("0");d.push(a);return d.join("")}function b(a){return a.slice(0,1).toUpperCase()+a.slice(1)}function e(a){return a.replace(/^\s+|\s+$/g,"")}function f(a){return function(){var c=this.clone();a.apply(c,arguments);return c}}function d(a,c){function d(a){return function(){return a.apply(this[k](),arguments)}}function g(){}function e(){return new g}var f=t(u),h=[],k="to"+b(a),l;for(l in c)if(c.hasOwnProperty(l)){f[l]=
c[l];var n=f[l];if("_"!=l.slice(0,1))if(!(l in u)&&"function"==typeof n)u[l]=d(n);else if("function"!=typeof n){h.push(l);n="get"+b(l);var m="set"+b(l);u[n]=d(f[n]=function(a){return function(){return this[a]}}(l));u[m]=d(f[m]=function(a){return function(c){var d=this.clone();d[a]=c;return d}}(l))}}g.prototype=f;w[a]=e;f.clone=function(){for(var a=e(),c=0,d=h.length;c<d;c++){var b=h[c];a[b]=this[b]}return a};u[k]=function(){return e()};r.push(f);return f}function g(a){return u.fromObject(a)}var c=
{aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",
darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",
gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",
lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",
navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",
sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:'#9ACD32"'},h="(?:\\+|-)?\\d+",k="(?:\\+|-)?\\d*\\.\\d+",m="(?:"+h+")|(?:"+k+")";h="("+h+")";k="("+k+")";m="("+m+")";k=m+"%";var l=new RegExp(["^hsl(a?)\\(",
m,",",k,",",k,"(,(",m,"))?\\)$"].join("\\s*?")),n=new RegExp(["^rgb(a?)\\(",h,",",h,",",h,"(,(",m,"))?\\)$"].join("\\s*?")),q=new RegExp(["^rgb(a?)\\(",k,",",k,",",k,"(,(",m,"))?\\)$"].join("\\s*?")),r=[],w={};this.object||(this.object=function(a){function c(){}c.prototype=a;return new c});var t=this.object;var u={fromObject:function(a){if(!a)return t(u);for(var c=0,d=r.length;c<d;c++){var b=r[c].fromObject(a);if(b)return b}return t(u)},toString:function(){return this.toCSS()}};var x=null;d("RGB",
{red:0,green:0,blue:0,alpha:0,getLuminance:function(){return.2126*this.red+.7152*this.green+.0722*this.blue},blend:function(a,c){a=a.toRGB();c=Math.min(Math.max(c,0),1);var d=this.clone();d.red=d.red*(1-c)+a.red*c;d.green=d.green*(1-c)+a.green*c;d.blue=d.blue*(1-c)+a.blue*c;d.alpha=d.alpha*(1-c)+a.alpha*c;return d},fromObject:function(a){if(a instanceof Array)return this._fromRGBArray(a);if("string"==typeof a)return this._fromCSS(e(a));if(a.hasOwnProperty("red")&&a.hasOwnProperty("green")&&a.hasOwnProperty("blue"))return this._fromRGB(a)},
_stringParsers:[function(a){function c(c,d){var b=a.match(c);if(!b||1===!!b[1]+!!b[5])return null;var g=w.RGB();g.red=Math.min(1,Math.max(0,b[2]/d));g.green=Math.min(1,Math.max(0,b[3]/d));g.blue=Math.min(1,Math.max(0,b[4]/d));g.alpha=b[5]?Math.min(Math.max(parseFloat(b[6]),0),1):1;return g}a=e(a);var d=c(n,255);return d?d:c(q,100)},function(a){var d=a.toLowerCase();d in c&&(a=c[d]);if(a.match(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)){a=a.replace(/^#/,"");d=a.length/3;var b=Math.pow(16,d)-1,g=w.RGB();
g.red=parseInt(a.slice(0,d),16)/b;g.green=parseInt(a.slice(1*d,2*d),16)/b;g.blue=parseInt(a.slice(2*d),16)/b;g.alpha=1;return g}},function(a){if("transparent"===a.toLowerCase())return x}],_fromCSS:function(a){for(var c,d=0,b=this._stringParsers.length;d<b;d++)if(c=this._stringParsers[d](a))return c},_fromRGB:function(a){var c=w.RGB();c.red=a.red;c.green=a.green;c.blue=a.blue;c.alpha=a.hasOwnProperty("alpha")?a.alpha:1;return c},_fromRGBArray:function(a){var c=w.RGB();c.red=Math.max(0,Math.min(1,a[0]/
255));c.green=Math.max(0,Math.min(1,a[1]/255));c.blue=Math.max(0,Math.min(1,a[2]/255));c.alpha=void 0!==a[3]?Math.max(0,Math.min(1,a[3])):1;return c},toCSSHex:function(c){c=c||2;var d=Math.pow(16,c)-1;return["#",a(Math.round(this.red*d).toString(16).toUpperCase(),c),a(Math.round(this.green*d).toString(16).toUpperCase(),c),a(Math.round(this.blue*d).toString(16).toUpperCase(),c)].join("")},toCSS:function(a){return 1===this.alpha?this.toCSSHex(a):["rgba(",Math.max(0,Math.min(255,Math.round(255*this.red))),
",",Math.max(0,Math.min(255,Math.round(255*this.green))),",",Math.max(0,Math.min(255,Math.round(255*this.blue))),",",Math.max(0,Math.min(1,this.alpha)),")"].join("")},toHSV:function(){var a=w.HSV();var c=Math.min(this.red,this.green,this.blue);var d=Math.max(this.red,this.green,this.blue);a.value=d;c=d-c;0==c?a.hue=a.saturation=0:(a.saturation=c/d,a.hue=this.red==d?(this.green-this.blue)/c:this.green==d?2+(this.blue-this.red)/c:4+(this.red-this.green)/c,a.hue=(60*a.hue+360)%360);a.alpha=this.alpha;
return a},toHSL:function(){return this.toHSV().toHSL()},toRGB:function(){return this.clone()}});x=u.fromObject({red:0,blue:0,green:0,alpha:0});d("HSV",{hue:0,saturation:0,value:1,alpha:1,shiftHue:f(function(a){a=(this.hue+a)%360;0>a&&(a=(360+a)%360);this.hue=a}),devalueByAmount:f(function(a){this.value=Math.min(1,Math.max(this.value-a,0))}),devalueByRatio:f(function(a){this.value=Math.min(1,Math.max(this.value*(1-a),0))}),valueByAmount:f(function(a){this.value=Math.min(1,Math.max(this.value+a,0))}),
valueByRatio:f(function(a){this.value=Math.min(1,Math.max(this.value*(1+a),0))}),desaturateByAmount:f(function(a){this.saturation=Math.min(1,Math.max(this.saturation-a,0))}),desaturateByRatio:f(function(a){this.saturation=Math.min(1,Math.max(this.saturation*(1-a),0))}),saturateByAmount:f(function(a){this.saturation=Math.min(1,Math.max(this.saturation+a,0))}),saturateByRatio:f(function(a){this.saturation=Math.min(1,Math.max(this.saturation*(1+a),0))}),schemeFromDegrees:function(a){for(var c=[],d=0,
b=a.length;d<b;d++){var g=this.clone();g.hue=(this.hue+a[d])%360;c.push(g)}return c},complementaryScheme:function(){return this.schemeFromDegrees([0,180])},splitComplementaryScheme:function(){return this.schemeFromDegrees([0,150,320])},splitComplementaryCWScheme:function(){return this.schemeFromDegrees([0,150,300])},splitComplementaryCCWScheme:function(){return this.schemeFromDegrees([0,60,210])},triadicScheme:function(){return this.schemeFromDegrees([0,120,240])},clashScheme:function(){return this.schemeFromDegrees([0,
90,270])},tetradicScheme:function(){return this.schemeFromDegrees([0,90,180,270])},fourToneCWScheme:function(){return this.schemeFromDegrees([0,60,180,240])},fourToneCCWScheme:function(){return this.schemeFromDegrees([0,120,180,300])},fiveToneAScheme:function(){return this.schemeFromDegrees([0,115,155,205,245])},fiveToneBScheme:function(){return this.schemeFromDegrees([0,40,90,130,245])},fiveToneCScheme:function(){return this.schemeFromDegrees([0,50,90,205,320])},fiveToneDScheme:function(){return this.schemeFromDegrees([0,
40,155,270,310])},fiveToneEScheme:function(){return this.schemeFromDegrees([0,115,230,270,320])},sixToneCWScheme:function(){return this.schemeFromDegrees([0,30,120,150,240,270])},sixToneCCWScheme:function(){return this.schemeFromDegrees([0,90,120,210,240,330])},neutralScheme:function(){return this.schemeFromDegrees([0,15,30,45,60,75])},analogousScheme:function(){return this.schemeFromDegrees([0,30,60,90,120,150])},fromObject:function(a){if(a.hasOwnProperty("hue")&&a.hasOwnProperty("saturation")&&
a.hasOwnProperty("value")){var c=w.HSV();c.hue=a.hue;c.saturation=a.saturation;c.value=a.value;c.alpha=a.hasOwnProperty("alpha")?a.alpha:1;return c}return null},_normalise:function(){this.hue%=360;this.saturation=Math.min(Math.max(0,this.saturation),1);this.value=Math.min(Math.max(0,this.value));this.alpha=Math.min(1,Math.max(0,this.alpha))},toRGB:function(){this._normalise();var a=w.RGB();if(0===this.saturation)return a.red=this.value,a.green=this.value,a.blue=this.value,a.alpha=this.alpha,a;var c=
this.hue/60;var d=Math.floor(c);var b=c-d;c=this.value*(1-this.saturation);var g=this.value*(1-this.saturation*b);b=this.value*(1-this.saturation*(1-b));switch(d){case 0:a.red=this.value;a.green=b;a.blue=c;break;case 1:a.red=g;a.green=this.value;a.blue=c;break;case 2:a.red=c;a.green=this.value;a.blue=b;break;case 3:a.red=c;a.green=g;a.blue=this.value;break;case 4:a.red=b;a.green=c;a.blue=this.value;break;default:a.red=this.value,a.green=c,a.blue=g}a.alpha=this.alpha;return a},toHSL:function(){this._normalise();
var a=w.HSL();a.hue=this.hue;var c=(2-this.saturation)*this.value,d=this.saturation*this.value;c&&2-c&&(d/=1>=c?c:2-c);a.saturation=d;a.lightness=c/2;a.alpha=this.alpha;return a},toHSV:function(){return this.clone()}});d("HSL",{hue:0,saturation:0,lightness:0,alpha:1,darkenByAmount:f(function(a){this.lightness=Math.min(1,Math.max(this.lightness-a,0))}),darkenByRatio:f(function(a){this.lightness=Math.min(1,Math.max(this.lightness*(1-a),0))}),lightenByAmount:f(function(a){this.lightness=Math.min(1,Math.max(this.lightness+
a,0))}),lightenByRatio:f(function(a){this.lightness=Math.min(1,Math.max(this.lightness*(1+a),0))}),fromObject:function(a){if("string"==typeof a)return this._fromCSS(a);if(a.hasOwnProperty("hue")&&a.hasOwnProperty("saturation")&&a.hasOwnProperty("lightness"))return this._fromHSL(a)},_fromCSS:function(a){a=e(a).match(l);if(!a||1===!!a[1]+!!a[5])return null;var c=w.HSL();c.hue=(a[2]%360+360)%360;c.saturation=Math.max(0,Math.min(parseInt(a[3],10)/100,1));c.lightness=Math.max(0,Math.min(parseInt(a[4],
10)/100,1));c.alpha=a[5]?Math.max(0,Math.min(1,parseFloat(a[6]))):1;return c},_fromHSL:function(a){var c=w.HSL();c.hue=a.hue;c.saturation=a.saturation;c.lightness=a.lightness;c.alpha=a.hasOwnProperty("alpha")?a.alpha:1;return c},_normalise:function(){this.hue=(this.hue%360+360)%360;this.saturation=Math.min(Math.max(0,this.saturation),1);this.lightness=Math.min(Math.max(0,this.lightness));this.alpha=Math.min(1,Math.max(0,this.alpha))},toHSL:function(){return this.clone()},toHSV:function(){this._normalise();
var a=w.HSV();a.hue=this.hue;var c=2*this.lightness,d=this.saturation*(1>=c?c:2-c);a.value=(c+d)/2;a.saturation=2*d/(c+d)||0;a.alpha=this.alpha;return a},toRGB:function(){return this.toHSV().toRGB()}});g.isValid=function(a){var c;a=g(a);var d=0;for(c in a)a.hasOwnProperty(c)&&d++;return 0<d};net.brehaut.Color=g}).call(net.brehaut);var module;module&&(module.exports.Color=net.brehaut.Color);
var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(b,e){a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent&&a.attachEvent("on"+b,e);return function(){qq(a).detach(b,e)}},detach:function(b,e){a.removeEventListener?a.removeEventListener(b,e,!1):a.attachEvent&&a.detachEvent("on"+b,e);return this},contains:function(b){return b?a===b?!0:a.contains?a.contains(b):!!(b.compareDocumentPosition(a)&8):!1},insertBefore:function(b){b.parentNode.insertBefore(a,
b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(null==a.style)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");null!=b.opacity&&"string"!==typeof a.style.opacity&&"undefined"!==typeof a.filters&&(b.filter="alpha(opacity="+Math.round(100*b.opacity)+")");qq.extend(a.style,b);return this},hasClass:function(b){return(new RegExp("(^| )"+b+"( |$)")).test(a.className)},addClass:function(b){qq(a).hasClass(b)||(a.className+=
" "+b);return this},removeClass:function(b){a.className=a.className.replace(new RegExp("(^| )"+b+"( |$)")," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(b){var e=[];if(a.querySelectorAll)return a.querySelectorAll("."+b);var f=a.getElementsByTagName("*");qq.each(f,function(a,g){qq(g).hasClass(b)&&e.push(g)});return e},children:function(){for(var b=[],e=a.firstChild;e;)1===e.nodeType&&b.push(e),e=e.nextSibling;return b},setText:function(b){a.innerText=b;a.textContent=b;return this},
clearText:function(){return qq(a).setText("")},hasAttribute:function(b){if(a.hasAttribute)return a.hasAttribute(b)?null==/^false$/i.exec(a.getAttribute(b)):!1;b=a[b];return void 0===b?!1:null==/^false$/i.exec(b)}}};
(function(){qq.log=function(a,b){if(window.console)if(b&&"info"!==b)if(window.console[b])window.console[b](a);else window.console.log("<"+b+"> "+a);else window.console.log(a)};qq.isObject=function(a){return a&&!a.nodeType&&"[object Object]"===Object.prototype.toString.call(a)};qq.isFunction=function(a){return"function"===typeof a};qq.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)||a&&window.ArrayBuffer&&a.buffer&&a.buffer.constructor===ArrayBuffer};qq.isItemList=function(a){return"[object DataTransferItemList]"===
Object.prototype.toString.call(a)};qq.isNodeList=function(a){return"[object NodeList]"===Object.prototype.toString.call(a)||a.item&&a.namedItem};qq.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)};qq.trimStr=function(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")};qq.format=function(a){var b=Array.prototype.slice.call(arguments,1),e=a,f=e.indexOf("{}");qq.each(b,function(a,b){var c=e.substring(0,f),d=e.substring(f+2);e=c+b+d;f=e.indexOf("{}",f+
b.length);if(0>f)return!1});return e};qq.isFile=function(a){return window.File&&"[object File]"===Object.prototype.toString.call(a)};qq.isFileList=function(a){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(a)};qq.isFileOrInput=function(a){return qq.isFile(a)||qq.isInput(a)};qq.isInput=function(a,b){var e=function(a){a=a.toLowerCase();return b?"file"!==a:"file"===a};return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(a)&&a.type&&
e(a.type)||a.tagName&&"input"===a.tagName.toLowerCase()&&a.type&&e(a.type)?!0:!1};qq.isBlob=function(a){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(a))return!0};qq.isXhrUploadSupported=function(){var a=document.createElement("input");a.type="file";return void 0!==a.multiple&&"undefined"!==typeof File&&"undefined"!==typeof FormData&&"undefined"!==typeof qq.createXhrInstance().upload};qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(a){return qq.log("Neither XHR or ActiveX are supported!",
"error"),null}};qq.isFolderDropSupported=function(a){return a.items&&0<a.items.length&&a.items[0].webkitGetAsEntry};qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)};qq.sliceBlob=function(a,b,e){return(a.slice||a.mozSlice||a.webkitSlice).call(a,b,e)};qq.arrayBufferToHex=function(a){var b="";a=new Uint8Array(a);qq.each(a,function(a,f){var d=f.toString(16);
2>d.length&&(d="0"+d);b+=d});return b};qq.readBlobToHex=function(a,b,e){a=qq.sliceBlob(a,b,b+e);var f=new FileReader,d=new qq.Promise;f.onload=function(){d.success(qq.arrayBufferToHex(f.result))};f.onerror=d.failure;f.readAsArrayBuffer(a);return d};qq.extend=function(a,b,e){qq.each(b,function(b,d){e&&qq.isObject(d)?(void 0===a[b]&&(a[b]={}),qq.extend(a[b],d,!0)):a[b]=d});return a};qq.override=function(a,b){var e={},f=b(e);qq.each(f,function(d,b){void 0!==a[d]&&(e[d]=a[d]);a[d]=b});return a};qq.indexOf=
function(a,b,e){if(a.indexOf)return a.indexOf(b,e);e=e||0;var f=a.length;for(0>e&&(e+=f);e<f;e+=1)if(a.hasOwnProperty(e)&&a[e]===b)return e;return-1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")};qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")};qq.ie8=function(){return-1!==
navigator.userAgent.indexOf("MSIE 8")};qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")};qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")};qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")};qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")};qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")};qq.firefox=function(){return!qq.ie11()&&
-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor};qq.windows=function(){return"Win32"===navigator.platform};qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")};qq.androidStock=function(){return qq.android()&&0>navigator.userAgent.toLowerCase().indexOf("chrome")};qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")};qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")};
qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")};qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")};qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")};qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")};qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")};
qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()};qq.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};qq.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();qq.each=function(a,b){var e;if(a)if(window.Storage&&a.constructor===window.Storage)for(e=0;e<a.length;e++){var f=b(a.key(e),a.getItem(a.key(e)));if(!1===f)break}else if(qq.isArray(a)||qq.isItemList(a)||
qq.isNodeList(a))for(e=0;e<a.length&&(f=b(e,a[e]),!1!==f);e++);else if(qq.isString(a))for(e=0;e<a.length&&(f=b(e,a.charAt(e)),!1!==f);e++);else for(e in a)if(Object.prototype.hasOwnProperty.call(a,e)&&(f=b(e,a[e]),!1===f))break};qq.bind=function(a,b){if(qq.isFunction(a)){var e=Array.prototype.slice.call(arguments,2);return function(){var f=qq.extend([],e);arguments.length&&(f=f.concat(Array.prototype.slice.call(arguments)));return a.apply(b,f)}}throw Error("first parameter must be a function!");};
qq.obj2url=function(a,b,e){var f=[],d="&",g=function(a,d){var c=b?/\[\]$/.test(b)?b:b+"["+d+"]":d;"undefined"!==c&&"undefined"!==d&&f.push("object"===typeof a?qq.obj2url(a,c,!0):"[object Function]"===Object.prototype.toString.call(a)?encodeURIComponent(c)+"="+encodeURIComponent(a()):encodeURIComponent(c)+"="+encodeURIComponent(a))};!e&&b?(d=/\?/.test(b)?/\?$/.test(b)?"":"&":"?",f.push(b),f.push(qq.obj2url(a))):"[object Array]"===Object.prototype.toString.call(a)&&"undefined"!==typeof a?qq.each(a,
function(a,d){g(d,a)}):"undefined"!==typeof a&&null!==a&&"object"===typeof a?qq.each(a,function(a,d){g(d,a)}):f.push(encodeURIComponent(b)+"="+encodeURIComponent(a));return b?f.join(d):f.join(d).replace(/^&/,"").replace(/%20/g,"+")};qq.obj2FormData=function(a,b,e){b||(b=new FormData);qq.each(a,function(a,d){a=e?e+"["+a+"]":a;qq.isObject(d)?qq.obj2FormData(d,b,a):qq.isFunction(d)?b.append(a,d()):b.append(a,d)});return b};qq.obj2Inputs=function(a,b){var e;b||(b=document.createElement("form"));qq.obj2FormData(a,
{append:function(a,d){e=document.createElement("input");e.setAttribute("name",a);e.setAttribute("value",d);b.appendChild(e)}});return b};qq.parseJson=function(a){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(a):eval("("+a+")")};qq.getExtension=function(a){var b=a.lastIndexOf(".")+1;if(0<b)return a.substr(b,a.length-b)};qq.getFilename=function(a){return qq.isInput(a)?a.value.replace(/.*(\/|\\)/,""):qq.isFile(a)&&null!==a.fileName&&void 0!==a.fileName?a.fileName:a.name};qq.DisposeSupport=
function(){var a=[];return{dispose:function(){var b;do(b=a.shift())&&b();while(b)},attach:function(){this.addDisposer(qq(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}}})();(function(){qq.Error=function(a){this.message="[Fine Uploader "+qq.version+"] "+a};qq.Error.prototype=Error()})();qq.version="5.0.8";
qq.supportedFeatures=function(){var a;var b=!0;try{var e=document.createElement("input");e.type="file";qq(e).hide();e.disabled&&(b=!1)}catch(w){b=!1}e=(a=b&&qq.isXhrUploadSupported())&&!qq.androidStock();var f=a&&(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/);var d=a&&qq.isFileChunkingSupported();var g=a&&d&&!!window.localStorage;var c=a&&(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/);var h=
b&&(void 0!==window.postMessage||a);var k=window.XMLHttpRequest?void 0!==qq.createXhrInstance().withCredentials:!1;var m=void 0!==window.XDomainRequest;var l=window.XMLHttpRequest&&void 0!==qq.createXhrInstance().withCredentials?!0:void 0!==window.XDomainRequest;var n=void 0!==document.createElement("input").webkitdirectory;var q=a&&void 0!==window.FileReader;var r=a?!qq.androidStock()&&!qq.iosChrome():!1;return{ajaxUploading:a,blobUploading:e,canDetermineSize:a,chunking:d,deleteFileCors:l,deleteFileCorsXdr:m,
deleteFileCorsXhr:k,fileDrop:a,folderDrop:f,folderSelection:n,imagePreviews:q,imageValidation:q,itemSizeValidation:a,pause:d,progressBar:r,resume:g,scaling:q&&e,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:b,uploadCors:h,uploadCustomHeaders:a,uploadNonMultipart:a,uploadViaPaste:c}}();qq.isGenericPromise=function(a){return!!(a&&a.then&&qq.isFunction(a.then))};
qq.Promise=function(){var a,b,e=[],f=[],d=[],g=0;qq.extend(this,{then:function(c,d){0===g?(c&&e.push(c),d&&f.push(d)):-1===g?d&&d.apply(null,b):c&&c.apply(null,a);return this},done:function(c){0===g?d.push(c):c.apply(null,void 0===b?a:b);return this},success:function(){g=1;a=arguments;e.length&&qq.each(e,function(c,d){d.apply(null,a)});d.length&&qq.each(d,function(c,d){d.apply(null,a)});return this},failure:function(){g=-1;b=arguments;f.length&&qq.each(f,function(a,d){d.apply(null,b)});d.length&&
qq.each(d,function(a,d){d.apply(null,b)});return this}})};qq.BlobProxy=function(a,b){qq.extend(this,{referenceBlob:a,create:function(){return b(a)}})};
qq.UploadButton=function(a){function b(){var a=document.createElement("input");a.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,g);e.setMultiple(d.multiple,a);d.folders&&qq.supportedFeatures.folderSelection&&a.setAttribute("webkitdirectory","");d.acceptFiles&&a.setAttribute("accept",d.acceptFiles);a.setAttribute("type","file");a.setAttribute("name",d.name);qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",
opacity:0});!qq.ie7()&&qq(a).css({height:"100%"});d.element.appendChild(a);f.attach(a,"change",function(){d.onChange(a)});f.attach(a,"mouseover",function(){qq(d.element).addClass(d.hoverClass)});f.attach(a,"mouseout",function(){qq(d.element).removeClass(d.hoverClass)});f.attach(a,"focus",function(){qq(d.element).addClass(d.focusClass)});f.attach(a,"blur",function(){qq(d.element).removeClass(d.focusClass)});window.attachEvent&&a.setAttribute("tabIndex","-1");return a}var e=this,f=new qq.DisposeSupport,
d={element:null,multiple:!1,acceptFiles:null,folders:!1,name:"qqfile",onChange:function(a){},ios8BrowserCrashWorkaround:!0,hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(d,a);var g=qq.getUniqueId();qq(d.element).css({position:"relative",overflow:"hidden",direction:"ltr"});qq.extend(this,{getInput:function(){return c},getButtonId:function(){return g},setMultiple:function(a,c){var b=c||this.getInput();d.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?
b.setAttribute("multiple",""):a?b.setAttribute("multiple",""):b.removeAttribute("multiple")},setAcceptFiles:function(a){a!==d.acceptFiles&&c.setAttribute("accept",a)},reset:function(){c.parentNode&&qq(c).remove();qq(d.element).removeClass(d.focusClass);c=null;c=b()}});var c=b()};qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id";
qq.UploadData=function(a){function b(a){if(qq.isArray(a)){var c=[];qq.each(a,function(a,b){c.push(d[b])});return c}return d[a]}function e(a){if(qq.isArray(a)){var c=[];qq.each(a,function(a,b){c.push(d[g[b]])});return c}return d[g[a]]}function f(a){var b=[];a=[].concat(a);qq.each(a,function(a,g){var e=c[g];void 0!==e&&qq.each(e,function(a,c){b.push(d[c])})});return b}var d=[],g={},c={},h={},k={};qq.extend(this,{addFile:function(b){var e=b.status||qq.status.SUBMITTING,f=d.push({name:b.name,originalName:b.name,
uuid:b.uuid,size:b.size||-1,status:e})-1;b.batchId&&(d[f].batchId=b.batchId,void 0===k[b.batchId]&&(k[b.batchId]=[]),k[b.batchId].push(f));b.proxyGroupId&&(d[f].proxyGroupId=b.proxyGroupId,void 0===h[b.proxyGroupId]&&(h[b.proxyGroupId]=[]),h[b.proxyGroupId].push(f));d[f].id=f;g[b.uuid]=f;void 0===c[e]&&(c[e]=[]);c[e].push(f);a.onStatusChange(f,null,e);return f},retrieve:function(a){if(qq.isObject(a)&&d.length){if(void 0!==a.id)return b(a.id);if(void 0!==a.uuid)return e(a.uuid);if(a.status)return f(a.status)}else return qq.extend([],
d,!0)},reset:function(){d=[];g={};c={};k={}},setStatus:function(b,g){var e=d[b].status,f=qq.indexOf(c[e],b);c[e].splice(f,1);d[b].status=g;void 0===c[g]&&(c[g]=[]);c[g].push(b);a.onStatusChange(b,e,g)},uuidChanged:function(a,c){var b=d[a].uuid;d[a].uuid=c;g[c]=a;delete g[b]},updateName:function(a,c){d[a].name=c},updateSize:function(a,c){d[a].size=c},setParentId:function(a,c){d[a].parentId=c},getIdsInProxyGroup:function(a){return(a=d[a].proxyGroupId)?h[a]:[]},getIdsInBatch:function(a){return k[d[a].batchId]}})};
qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"};
(function(){qq.basePublicApi={addBlobs:function(a,b,e){if(!qq.supportedFeatures.blobUploading)throw new qq.Error("Blob uploading is not supported in this browser!");this._maybeHandleIos8SafariWorkaround();if(a){a=[].concat(a);var f=[],d=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,g=this;this._currentBatchId=d;qq.each(a,function(a,b){var c;qq.isBlob(b)&&!qq.isFileOrInput(b)?c={blob:b,name:g._options.blobs.defaultName}:qq.isObject(b)&&b.blob&&b.name?c=b:g.log("addBlobs: entry at index "+
a+" is not a Blob or a BlobData object","error");c&&g._handleNewFile(c,d,f)});this._prepareItemsForUpload(f,b,e)}else this.log("undefined or non-array parameter passed into addBlobs","error")},addFiles:function(a,b,e){this._maybeHandleIos8SafariWorkaround();var f=[],d=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,g,c;this._currentBatchId=d;if(a){qq.isFileList(a)||(a=[].concat(a));for(g=0;g<a.length;g+=1){var h=a[g];if(qq.isFileOrInput(h))if(qq.isInput(h)&&qq.supportedFeatures.ajaxUploading)for(c=
0;c<h.files.length;c++)this._handleNewFile(h.files[c],d,f);else this._handleNewFile(h,d,f);else this.log(h+" is not a File or INPUT element!  Ignoring!","warn")}this.log("Received "+f.length+" files or inputs.");this._prepareItemsForUpload(f,b,e)}},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var a=[],b=this;qq.extend(a,this._storedIds);qq.each(a,function(a,f){b.cancel(f)});this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(a){var b=
this._uploadData.retrieve({id:a});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(b.status===qq.status.PAUSED)return this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",a,this.getName(a))),this._uploadFile(a),!0;this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",a,this.getName(a)),"error");return!1},deleteFile:function(a){return this._onSubmitDelete(a)},doesExist:function(a){return this._handler.isValid(a)},drawThumbnail:function(a,
b,e,f){var d=new qq.Promise;if(this._imageGenerator){var g=this._thumbnailUrls[a];e={scale:0<e,maxSize:0<e?e:null};!f&&qq.supportedFeatures.imagePreviews&&(g=this.getFile(a));null==g?d.failure({container:b,error:"File or URL not found."}):this._imageGenerator.generate(g,b,e).then(function(a){d.success(a)},function(a,b){d.failure({container:a,error:b||"Problem generating thumbnail"})})}else d.failure({container:b,error:"Missing image generator module"});return d},getButton:function(a){return this._getButton(this._buttonIdsForFileIds[a])},
getFile:function(a){return this._handler.getFile(a)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(a){return this._uploadData.retrieve({id:a}).name},getParentId:function(a){a=this.getUploads({id:a});var b=null;a&&void 0!==a.parentId&&(b=a.parentId);return b},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._uploadData.retrieve({id:a}).size},
getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){return 0<this._options.validation.itemLimit?this._options.validation.itemLimit-this._netUploadedOrQueued:null},getUploads:function(a){return this._uploadData.retrieve(a)},getUuid:function(a){return this._uploadData.retrieve({id:a}).uuid},log:function(a,b){!this._options.debug||b&&"info"!==b?b&&"info"!==b&&qq.log("[Fine Uploader "+qq.version+"] "+a,b):qq.log("[Fine Uploader "+qq.version+"] "+a)},pauseUpload:function(a){var b=
this._uploadData.retrieve({id:a});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(0<=qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],b.status)){if(this._handler.pause(a))return this._uploadData.setStatus(a,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",a,this.getName(a)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",a,this.getName(a)),"error");return!1},reset:function(){this.log("Resetting uploader...");
this._handler.reset();this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];qq.each(this._buttons,function(a,b){b.reset()});this._paramsStore.reset();this._endpointStore.reset();this._netUploaded=this._netUploadedOrQueued=0;this._uploadData.reset();this._buttonIdsForFileIds=[];this._pasteHandler&&this._pasteHandler.reset();this._options.session.refreshOnReset&&this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=
[];this._totalProgress&&this._totalProgress.reset()},retry:function(a){return this._manualRetry(a)},scaleImage:function(a,b){return qq.Scaler.prototype.scaleImage(a,b,{log:qq.bind(this.log,this),getFile:qq.bind(this.getFile,this),uploadData:this._uploadData})},setCustomHeaders:function(a,b){this._customHeadersStore.set(a,b)},setDeleteFileCustomHeaders:function(a,b){this._deleteFileCustomHeadersStore.set(a,b)},setDeleteFileEndpoint:function(a,b){this._deleteFileEndpointStore.set(a,b)},setDeleteFileParams:function(a,
b){this._deleteFileParamsStore.set(a,b)},setEndpoint:function(a,b){this._endpointStore.set(a,b)},setName:function(a,b){this._uploadData.updateName(a,b)},setParams:function(a,b){this._paramsStore.set(a,b)},setUuid:function(a,b){return this._uploadData.uuidChanged(a,b)},uploadStoredFiles:function(){if(0===this._storedIds.length)this._itemError("noFilesError");else for(;this._storedIds.length;){var a=this._storedIds.shift();this._uploadFile(a)}}};qq.basePrivateApi={_addCannedFile:function(a){var b=this._uploadData.addFile({uuid:a.uuid,
name:a.name,size:a.size,status:qq.status.UPLOAD_SUCCESSFUL});a.deleteFileEndpoint&&this.setDeleteFileEndpoint(a.deleteFileEndpoint,b);a.deleteFileParams&&this.setDeleteFileParams(a.deleteFileParams,b);a.thumbnailUrl&&(this._thumbnailUrls[b]=a.thumbnailUrl);this._netUploaded++;this._netUploadedOrQueued++;return b},_annotateWithButtonId:function(a,b){qq.isFile(a)&&(a.qqButtonId=this._getButtonId(b))},_batchError:function(a){this._options.callbacks.onError(null,null,a,void 0)},_createDeleteHandler:function(){var a=
this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:qq.bind(a.log,a),onDelete:function(b){a._onDelete(b);a._options.callbacks.onDelete(b)},onDeleteComplete:function(b,e,f){a._onDeleteComplete(b,
e,f);a._options.callbacks.onDeleteComplete(b,e,f)}})},_createPasteHandler:function(){var a=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(a.log,a),pasteReceived:function(b){a._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(a._options.callbacks.onPasteReceived,a,b),onSuccess:qq.bind(a._handlePasteSuccess,a,b),identifier:"pasted image"})}}})},_createStore:function(a,b){var e={},f=a,d={},g=function(a){return qq.isObject(a)?qq.extend({},
a):a};return{set:function(a,d){null==d?(e={},f=g(a)):e[d]=g(a)},get:function(a){var c=null!=a&&e[a]?e[a]:g(f);b&&qq.isObject(c)&&qq.extend(c,qq.isFunction(b)?b():b);d[a]&&qq.extend(c,d[a]);return g(c)},addReadOnly:function(a,b){qq.isObject(e)&&(d[a]=d[a]||{},qq.extend(d[a],b))},remove:function(a){return delete e[a]},reset:function(){e={};d={};f=a}}},_createUploadDataTracker:function(){var a=this;return new qq.UploadData({getName:function(b){return a.getName(b)},getUuid:function(b){return a.getUuid(b)},
getSize:function(b){return a.getSize(b)},onStatusChange:function(b,e,f){a._onUploadStatusChange(b,e,f);a._options.callbacks.onStatusChange(b,e,f);a._maybeAllComplete(b,f);a._totalProgress&&setTimeout(function(){a._totalProgress.onStatusChange(b,e,f)},0)}})},_createUploadButton:function(a){var b=this,e=a.accept||this._options.validation.acceptFiles,f=a.allowedExtensions||this._options.validation.allowedExtensions,d=new qq.UploadButton({element:a.element,folders:a.folders,name:this._options.request.inputName,
multiple:qq.supportedFeatures.ajaxUploading?b._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&b._isAllowedExtension(f,".mov")?!1:void 0===a.multiple?b._options.multiple:a.multiple:!1,acceptFiles:e,onChange:function(a){b._onInputChange(a)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash});this._disposeSupport.addDisposer(function(){d.dispose()});b._buttons.push(d);return d},_createUploadHandler:function(a,
b){var e=this,f={},d={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(e.log,e),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(a,c,d,b){if(!(0>d||0>b)){if(f[a]){if(f[a].loaded!==d||f[a].total!==b)e._onProgress(a,c,d,b),e._options.callbacks.onProgress(a,
c,d,b)}else e._onProgress(a,c,d,b),e._options.callbacks.onProgress(a,c,d,b);f[a]={loaded:d,total:b}}},onComplete:function(a,c,d,b){delete f[a];var g=e.getUploads({id:a}).status;if(g!==qq.status.UPLOAD_SUCCESSFUL&&g!==qq.status.UPLOAD_FAILED)if(g=e._onComplete(a,c,d,b),g instanceof qq.Promise)g.done(function(){e._options.callbacks.onComplete(a,c,d,b)});else e._options.callbacks.onComplete(a,c,d,b)},onCancel:function(a,c,d){var b=new qq.Promise;e._handleCheckedCallback({name:"onCancel",callback:qq.bind(e._options.callbacks.onCancel,
e,a,c),onFailure:b.failure,onSuccess:function(){d.then(function(){e._onCancel(a,c)});b.success()},identifier:a});return b},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(a,c){e._onUpload(a,c);e._options.callbacks.onUpload(a,c)},onUploadChunk:function(a,c,d){e._onUploadChunk(a,d);e._options.callbacks.onUploadChunk(a,c,d)},onUploadChunkSuccess:function(a,c,d,b){e._options.callbacks.onUploadChunkSuccess.apply(e,arguments)},onResume:function(a,c,d){return e._options.callbacks.onResume(a,
c,d)},onAutoRetry:function(a,c,d,b){return e._onAutoRetry.apply(e,arguments)},onUuidChanged:function(a,c){e.log("Server requested UUID change from '"+e.getUuid(a)+"' to '"+c+"'");e.setUuid(a,c)},getName:qq.bind(e.getName,e),getUuid:qq.bind(e.getUuid,e),getSize:qq.bind(e.getSize,e),setSize:qq.bind(e._setSize,e),getDataByUuid:function(a){return e.getUploads({uuid:a})},isQueued:function(a){a=e.getUploads({id:a}).status;return a===qq.status.QUEUED||a===qq.status.SUBMITTED||a===qq.status.UPLOAD_RETRYING||
a===qq.status.PAUSED},getIdsInProxyGroup:e._uploadData.getIdsInProxyGroup,getIdsInBatch:e._uploadData.getIdsInBatch};qq.each(this._options.request,function(a,c){d[a]=c});d.customHeaders=this._customHeadersStore;a&&qq.each(a,function(a,c){d[a]=c});return new qq.UploadHandlerController(d,b)},_fileOrBlobRejected:function(a){this._netUploadedOrQueued--;this._uploadData.setStatus(a,qq.status.REJECTED)},_formatSize:function(a){var b=-1;do a/=1E3,b++;while(999<a);return Math.max(a,.1).toFixed(1)+this._options.text.sizeSymbols[b]},
_generateExtraButtonSpecs:function(){var a=this;this._extraButtonSpecs={};qq.each(this._options.extraButtons,function(b,e){var f=e.multiple,d=qq.extend({},a._options.validation,!0),g=qq.extend({},e);void 0===f&&(f=a._options.multiple);g.validation&&qq.extend(d,e.validation,!0);qq.extend(g,{multiple:f,validation:d},!0);a._initExtraButton(g)})},_getButton:function(a){var b=this._extraButtonSpecs[a];if(b)return b.element;if(a===this._defaultButtonId)return this._options.button},_getButtonId:function(a){var b;
a instanceof qq.BlobProxy&&(a=a.referenceBlob);if(a&&!qq.isBlob(a)){if(qq.isFile(a))return a.qqButtonId;if("input"===a.tagName.toLowerCase()&&"file"===a.type.toLowerCase())return a.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);a=a.getElementsByTagName("input");qq.each(a,function(a,f){if("file"===f.getAttribute("type"))return b=f,!1});if(b)return b.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,
qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(a){return(a=this._extraButtonSpecs[a])?a.validation:this._options.validation},_getValidationDescriptor:function(a){return a.file instanceof qq.BlobProxy?{name:qq.getFilename(a.file.referenceBlob),size:a.file.referenceBlob.size}:{name:this.getUploads({id:a.id}).name,size:this.getUploads({id:a.id}).size}},_getValidationDescriptors:function(a){var b=this,e=[];qq.each(a,function(a,d){e.push(b._getValidationDescriptor(d))});
return e},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var a=this._options.camera.button,b=a?this._getButtonId(a):this._defaultButtonId,e=this._options;b&&b!==this._defaultButtonId&&(e=this._extraButtonSpecs[b]);e.multiple=!1;e.validation.acceptFiles=null===e.validation.acceptFiles?"image/*;capture=camera":e.validation.acceptFiles+",image/*;capture=camera";qq.each(this._buttons,function(a,d){if(d.getButtonId()===b)return d.setMultiple(e.multiple),d.setAcceptFiles(e.acceptFiles),
!1})}},_handleCheckedCallback:function(a){var b=this,e=a.callback();if(qq.isGenericPromise(e))return this.log(a.name+" - waiting for "+a.name+" promise to be fulfilled for "+a.identifier),e.then(function(e){b.log(a.name+" promise success for "+a.identifier);a.onSuccess(e)},function(){a.onFailure?(b.log(a.name+" promise failure for "+a.identifier),a.onFailure()):b.log(a.name+" promise failure for "+a.identifier)});if(!1!==e)a.onSuccess(e);else a.onFailure?(this.log(a.name+" - return value was 'false' for "+
a.identifier+".  Invoking failure callback."),a.onFailure()):this.log(a.name+" - return value was 'false' for "+a.identifier+".  Will not proceed.");return e},_handleNewFile:function(a,b,e){var f=this,d=qq.getUniqueId(),g=-1,c=qq.getFilename(a);a=a.blob||a;var h=this._customNewFileHandler?this._customNewFileHandler:qq.bind(f._handleNewFileGeneric,f);!qq.isInput(a)&&0<=a.size&&(g=a.size);h(a,c,d,g,e,b,this._options.request.uuidName,{uploadData:f._uploadData,paramsStore:f._paramsStore,addFileToHandler:function(a,
c){f._handler.add(a,c);f._netUploadedOrQueued++;f._trackButton(a)}})},_handleNewFileGeneric:function(a,b,e,f,d,g){b=this._uploadData.addFile({uuid:e,name:b,size:f,batchId:g});this._handler.add(b,a);this._trackButton(b);this._netUploadedOrQueued++;d.push({id:b,file:a})},_handlePasteSuccess:function(a,b){var e=a.type.split("/")[1],f=b;null==f&&(f=this._options.paste.defaultName);this.addBlobs({name:f+("."+e),blob:a})},_initExtraButton:function(a){var b=this._createUploadButton({element:a.element,multiple:a.multiple,
accept:a.validation.acceptFiles,folders:a.folders,allowedExtensions:a.validation.allowedExtensions});this._extraButtonSpecs[b.getButtonId()]=a},_initFormSupportAndParams:function(){(this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)))&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,
this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return qq.DeleteFileAjaxRequester&&this._options.deleteFile.enabled?this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr||qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_isAllowedExtension:function(a,b){var e=!1;if(!a.length)return!0;qq.each(a,function(a,d){if(qq.isString(d)&&
null!=b.match(new RegExp("\\."+d+"$","i")))return e=!0,!1});return e},_itemError:function(a,b,e){function f(a,c){d=d.replace(a,c)}var d=this._options.messages[a],g=[],c=[].concat(b);a=c[0];e=this._getButtonId(e);e=this._getValidationBase(e);qq.each(e.allowedExtensions,function(a,c){qq.isString(c)&&g.push(c)});b=g.join(", ").toLowerCase();f("{file}",this._options.formatFileName(a));f("{extensions}",b);f("{sizeLimit}",this._formatSize(e.sizeLimit));f("{minSizeLimit}",this._formatSize(e.minSizeLimit));
e=d.match(/(\{\w+\})/g);null!==e&&qq.each(e,function(a,d){f(d,c[a])});this._options.callbacks.onError(null,a,d,void 0);return d},_manualRetry:function(a,b){if(this._onBeforeManualRetry(a))return this._netUploadedOrQueued++,this._uploadData.setStatus(a,qq.status.UPLOAD_RETRYING),b?b(a):this._handler.retry(a),!0},_maybeAllComplete:function(a,b){var e=this,f=this._getNotFinished();b===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(a):b===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(a);
0===f&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){e._onAllComplete(e._succeededSinceLastAllComplete,e._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var a=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(a._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari);},_maybeParseAndSendUploadError:function(a,
b,e,f){if(!e.success)if(f&&200!==f.status&&!e.error)this._options.callbacks.onError(a,b,"XHR returned response code "+f.status,f);else this._options.callbacks.onError(a,b,e.error?e.error:this._options.text.defaultResponseError,f)},_maybeProcessNextItemAfterOnValidateCallback:function(a,b,e,f,d){var g=this;if(b.length>e)if(a||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var a=g._getValidationDescriptor(b[e]),h=g._getButtonId(b[e].file);h=g._getButton(h);g._handleCheckedCallback({name:"onValidate",
callback:qq.bind(g._options.callbacks.onValidate,g,a,h),onSuccess:qq.bind(g._onValidateCallbackSuccess,g,b,e,f,d),onFailure:qq.bind(g._onValidateCallbackFailure,g,b,e,f,d),identifier:"Item '"+a.name+"', size: "+a.size})},0);else if(!a)for(;e<b.length;e++)g._fileOrBlobRejected(b[e].id)},_onAllComplete:function(a,b){this._totalProgress&&this._totalProgress.onAllComplete(a,b,this._preventRetries);this._options.callbacks.onAllComplete(qq.extend([],a),qq.extend([],b));this._succeededSinceLastAllComplete=
[];this._failedSinceLastAllComplete=[]},_onAutoRetry:function(a,b,e,f,d){var g=this;g._preventRetries[a]=e[g._options.retry.preventRetryResponseProperty];if(g._shouldAutoRetry(a,b,e))return g._maybeParseAndSendUploadError.apply(g,arguments),g._options.callbacks.onAutoRetry(a,b,g._autoRetries[a]),g._onBeforeAutoRetry(a,b),g._retryTimeouts[a]=setTimeout(function(){g.log("Retrying "+b+"...");g._uploadData.setStatus(a,qq.status.UPLOAD_RETRYING);d?d(a):g._handler.retry(a)},1E3*g._options.retry.autoAttemptDelay),
!0},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+b+"...")},_onBeforeManualRetry:function(a){var b=this._options.validation.itemLimit;if(this._preventRetries[a])return this.log("Retries are forbidden for id "+a,"warn"),!1;if(this._handler.isValid(a)){var e=this.getName(a);if(!1===this._options.callbacks.onManualRetry(a,e))return!1;if(0<b&&this._netUploadedOrQueued+1>b)return this._itemError("retryFailTooManyItems"),!1;this.log("Retrying upload for '"+
e+"' (id: "+a+")...");return!0}this.log("'"+a+"' is not a valid file ID","error");return!1},_onCancel:function(a,b){this._netUploadedOrQueued--;clearTimeout(this._retryTimeouts[a]);var e=qq.indexOf(this._storedIds,a);!this._options.autoUpload&&0<=e&&this._storedIds.splice(e,1);this._uploadData.setStatus(a,qq.status.CANCELED)},_onComplete:function(a,b,e,f){e.success?(e.thumbnailUrl&&(this._thumbnailUrls[a]=e.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(a,qq.status.UPLOAD_SUCCESSFUL)):
(this._netUploadedOrQueued--,this._uploadData.setStatus(a,qq.status.UPLOAD_FAILED),!0===e[this._options.retry.preventRetryResponseProperty]&&(this._preventRetries[a]=!0));this._maybeParseAndSendUploadError(a,b,e,f);return e.success?!0:!1},_onDelete:function(a){this._uploadData.setStatus(a,qq.status.DELETING)},_onDeleteComplete:function(a,b,e){var f=this.getName(a);if(e)if(this._uploadData.setStatus(a,qq.status.DELETE_FAILED),this.log("Delete request for '"+f+"' has failed.","error"),void 0===b.withCredentials)this._options.callbacks.onError(a,
f,"Delete request failed",b);else this._options.callbacks.onError(a,f,"Delete request failed with response code "+b.status,b);else this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(a),this._uploadData.setStatus(a,qq.status.DELETED),this.log("Delete request for '"+f+"' has succeeded.")},_onInputChange:function(a){var b;if(qq.supportedFeatures.ajaxUploading){for(b=0;b<a.files.length;b++)this._annotateWithButtonId(a.files[b],a);this.addFiles(a.files)}else 0<a.value.length&&this.addFiles(a);
qq.each(this._buttons,function(a,b){b.reset()})},_onProgress:function(a,b,e,f){this._totalProgress&&this._totalProgress.onIndividualProgress(a,e,f)},_onSubmit:function(a,b){},_onSubmitCallbackSuccess:function(a,b){this._onSubmit.apply(this,arguments);this._uploadData.setStatus(a,qq.status.SUBMITTED);this._onSubmitted.apply(this,arguments);this._options.callbacks.onSubmitted.apply(this,arguments);this._options.autoUpload?this._uploadFile(a):this._storeForLater(a)},_onSubmitDelete:function(a,b,e){var f=
this.getUuid(a),d;b&&(d=qq.bind(b,this,a,f,e));if(this._isDeletePossible())return this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,a),onSuccess:d||qq.bind(this._deleteHandler.sendDelete,this,a,f,e),identifier:a}),!0;this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn");return!1},_onSubmitted:function(a){},_onTotalProgress:function(a,
b){this._options.callbacks.onTotalProgress(a,b)},_onUploadPrep:function(a){},_onUpload:function(a,b){this._uploadData.setStatus(a,qq.status.UPLOADING)},_onUploadChunk:function(a,b){},_onUploadStatusChange:function(a,b,e){e===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[a])},_onValidateBatchCallbackFailure:function(a){var b=this;qq.each(a,function(a,f){b._fileOrBlobRejected(f.id)})},_onValidateBatchCallbackSuccess:function(a,b,e,f,d){var g=this._options.validation.itemLimit,c=this._netUploadedOrQueued;
0===g||c<=g?0<b.length?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,a[0],d),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,b,0,e,f),onFailure:qq.bind(this._onValidateCallbackFailure,this,b,0,e,f),identifier:"Item '"+b[0].file.name+"', size: "+b[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(b),a=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,c).replace(/\{itemLimit\}/g,g),this._batchError(a))},
_onValidateCallbackFailure:function(a,b,e,f){b+=1;this._fileOrBlobRejected(a[0].id,a[0].file.name);this._maybeProcessNextItemAfterOnValidateCallback(!1,a,b,e,f)},_onValidateCallbackSuccess:function(a,b,e,f){var d=this,g=b+1,c=this._getValidationDescriptor(a[b]);this._validateFileOrBlobData(a[b],c).then(function(){d._upload(a[b].id,e,f);d._maybeProcessNextItemAfterOnValidateCallback(!0,a,g,e,f)},function(){d._maybeProcessNextItemAfterOnValidateCallback(!1,a,g,e,f)})},_prepareItemsForUpload:function(a,
b,e){if(0===a.length)this._itemError("noFilesError");else{var f=this._getValidationDescriptors(a),d=this._getButtonId(a[0].file);d=this._getButton(d);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,f,d),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,f,a,b,e,d),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,a),identifier:"batch validation"})}},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,
"beforeunload",function(b){if(a.getInProgress())return b=b||window.event,b.returnValue=a._options.messages.onLeave})},_refreshSessionData:function(){var a=this,b=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(b,this._options.cors),b.log=qq.bind(this.log,this),b.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(b)),setTimeout(function(){a._session.refresh().then(function(b,f){a._options.callbacks.onSessionRequestComplete(b,
!0,f)},function(b,f){a._options.callbacks.onSessionRequestComplete(b,!1,f)})},0))},_setSize:function(a,b){this._uploadData.updateSize(a,b);this._totalProgress&&this._totalProgress.onNewSize(a)},_shouldAutoRetry:function(a,b,e){b=this._uploadData.retrieve({id:a});return!this._preventRetries[a]&&this._options.retry.enableAuto&&b.status!==qq.status.PAUSED&&(void 0===this._autoRetries[a]&&(this._autoRetries[a]=0),this._autoRetries[a]<this._options.retry.maxAutoAttempts)?(this._autoRetries[a]+=1,!0):!1},
_storeForLater:function(a){this._storedIds.push(a)},_trackButton:function(a){var b;(b=qq.supportedFeatures.ajaxUploading?this._handler.getFile(a).qqButtonId:this._getButtonId(this._handler.getInput(a)))&&(this._buttonIdsForFileIds[a]=b)},_upload:function(a,b,e){var f=this.getName(a);b&&this.setParams(b,a);e&&this.setEndpoint(e,a);this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,a,f),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,a,f),onFailure:qq.bind(this._fileOrBlobRejected,
this,a,f),identifier:a})},_uploadFile:function(a){this._handler.upload(a)||this._uploadData.setStatus(a,qq.status.QUEUED)},_validateFileOrBlobData:function(a,b){var e=this;var f=a.file instanceof qq.BlobProxy?a.file.referenceBlob:a.file;var d=b.name,g=b.size,c=this._getButtonId(a.file);c=this._getValidationBase(c);var h=new qq.Promise;h.then(function(){},function(){e._fileOrBlobRejected(a.id,d)});if(qq.isFileOrInput(f)&&!this._isAllowedExtension(c.allowedExtensions,d))return this._itemError("typeError",
d,f),h.failure();if(0===g)return this._itemError("emptyError",d,f),h.failure();if(0<g&&c.sizeLimit&&g>c.sizeLimit)return this._itemError("sizeError",d,f),h.failure();if(0<g&&g<c.minSizeLimit)return this._itemError("minSizeError",d,f),h.failure();qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(f)?(new qq.ImageValidation(f,qq.bind(e.log,e))).validate(c.image).then(h.success,function(a){e._itemError(a+"ImageError",d,f);h.failure()}):h.success();return h},_wrapCallbacks:function(){var a=
this;var b=function(b,d,g){try{return d.apply(a,g)}catch(c){d=c.message||c.toString(),a.log("Caught exception in '"+b+"' callback - "+d,"error")}};for(var e in this._options.callbacks)(function(){var f=e;var d=a._options.callbacks[f];a._options.callbacks[f]=function(){return b(f,d,arguments)}})()}}})();
(function(){qq.FineUploaderBasic=function(a){var b=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,
minHeight:0,minWidth:0}},callbacks:{onSubmit:function(a,b){},onSubmitted:function(a,b){},onComplete:function(a,b,d,g){},onAllComplete:function(a,b){},onCancel:function(a,b){},onUpload:function(a,b){},onUploadChunk:function(a,b,d){},onUploadChunkSuccess:function(a,b,d,g){},onResume:function(a,b,d){},onProgress:function(a,b,d,g){},onTotalProgress:function(a,b){},onError:function(a,b,d,g){},onAutoRetry:function(a,b,d){},onManualRetry:function(a,b){},onValidateBatch:function(a){},onValidate:function(a){},
onSubmitDelete:function(a){},onDelete:function(a){},onDeleteComplete:function(a,b,d){},onPasteReceived:function(a){},onStatusChange:function(a,b,d){},onSessionRequestComplete:function(a,b,d){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",
tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},
retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2E6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(a){void 0!==
a&&33<a.length&&(a=a.slice(0,19)+"..."+a.slice(-14));return a},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:"kB MB GB TB PB EB".split(" ")},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},
form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!0}};qq.extend(this._options,a,!0);this._buttons=[];this._extraButtonSpecs={};this._buttonIdsForFileIds=[];this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport;this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=
[];this._thumbnailUrls=[];this._netUploaded=this._netUploadedOrQueued=0;this._uploadData=this._createUploadDataTracker();this._initFormSupportAndParams();this._customHeadersStore=this._createStore(this._options.request.customHeaders);this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders);this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params);this._endpointStore=this._createStore(this._options.request.endpoint);this._deleteFileEndpointStore=
this._createStore(this._options.deleteFile.endpoint);this._handler=this._createUploadHandler();this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler();this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button}).getButtonId());this._generateExtraButtonSpecs();this._handleCameraAccess();this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error"));this._preventLeaveInProgress();
this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this));this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{};this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler));qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),
function(a){return(a=b._uploadData.retrieve({id:a}))&&a.size||0}))};qq.FineUploaderBasic.prototype=qq.basePublicApi;qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)})();
qq.AjaxRequester=function(a){function b(a){var c=!1;qq.each(c,function(a,d){if(0>qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],d))return c=!0,!1});return c}function e(a){return t.cors.expected&&void 0===a.withCredentials}function f(a,c){var d=w[a].xhr;if(!d){if(c)d=c;else if(t.cors.expected){if(window.XMLHttpRequest||window.ActiveXObject){var b=qq.createXhrInstance();void 0===b.withCredentials&&(b=new XDomainRequest)}d=b}else d=qq.createXhrInstance();w[a].xhr=d}return d}
function d(a){var c=qq.indexOf(r,a),d=t.maxConnections;delete w[a];r.splice(c,1);r.length>=d&&c<d&&(a=r[d-1],h(a))}function g(a,c){var b=f(a),g=t.method,h=!0===c;d(a);h?u(g+" request for "+a+" has failed","error"):e(b)||0<=qq.indexOf(t.successfulResponseCodes[t.method],b.status)||(h=!0,u(g+" request for "+a+" has failed - response code "+b.status,"error"));t.onComplete(a,b,h)}function c(a){var c=w[a].additionalParams,d=t.mandatedParams,b;t.paramsStore.get&&(b=t.paramsStore.get(a));c&&qq.each(c,function(a,
c){b=b||{};b[a]=c});d&&qq.each(d,function(a,c){b=b||{};b[a]=c});return b}function h(a,d){var b=f(a,d),g=t.method,h=c(a),r=w[a].payload;t.onSend(a);var B=t.endpointStore.get(a);var C=w[a].addToPath;void 0!=C&&(B+="/"+C);B=x&&h?qq.obj2url(h,B):B;e(b)?(b.onload=l(a),b.onerror=n(a)):b.onreadystatechange=k(a);m(a);b.open(g,B,!0);t.cors.expected&&t.cors.sendCredentials&&!e(b)&&(b.withCredentials=!0);q(a);u("Sending "+g+" request for "+a);r?b.send(r):x||!h?b.send():h&&t.contentType&&0<=t.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")?
b.send(qq.obj2url(h,"")):h&&t.contentType&&0<=t.contentType.toLowerCase().indexOf("application/json")?b.send(JSON.stringify(h)):b.send(h);return b}function k(a){return function(){4===f(a).readyState&&g(a)}}function m(a){var c=t.onProgress;c&&(f(a).upload.onprogress=function(d){d.lengthComputable&&c(a,d.loaded,d.total)})}function l(a){return function(){g(a)}}function n(a){return function(){g(a,!0)}}function q(a){var c=f(a),d=t.customHeaders,g=w[a].additionalHeaders||{},h=t.method,k={};e(c)||(t.acceptHeader&&
c.setRequestHeader("Accept",t.acceptHeader),!t.allowXRequestedWithAndCacheControl||t.cors.expected&&0<=qq.indexOf(["GET","POST","HEAD"],t.method)&&!b(d)||(c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Cache-Control","no-cache")),!t.contentType||"POST"!==h&&"PUT"!==h||c.setRequestHeader("Content-Type",t.contentType),qq.extend(k,qq.isFunction(d)?d(a):d),qq.extend(k,g),qq.each(k,function(a,d){c.setRequestHeader(a,d)}))}var r=[],w={},t={acceptHeader:null,validMethods:["POST"],
method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(a,c){},onSend:function(a){},onComplete:function(a,c,d){},onProgress:null};qq.extend(t,a);var u=t.log;if(0>qq.indexOf(t.validMethods,t.method))throw Error("'"+t.method+"' is not a supported method for this type of request!");
var x="GET"===t.method||"DELETE"===t.method;qq.extend(this,{initTransport:function(a){var c,d,b,g,e;return{withPath:function(a){c=a;return this},withParams:function(a){d=a;return this},withHeaders:function(a){b=a;return this},withPayload:function(a){g=a;return this},withCacheBuster:function(){e=!0;return this},send:function(f){e&&0<=qq.indexOf(["GET","DELETE"],t.method)&&(d.qqtimestamp=(new Date).getTime());w[a]={addToPath:c,additionalParams:d,additionalHeaders:b,payload:g};f=r.push(a)<=t.maxConnections?
h(a,f):void 0;return f}}},canceled:function(a){d(a)}})};
qq.UploadHandler=function(a){a=a.proxy;var b={},e=a.onCancel,f=a.getName;qq.extend(this,{add:function(a,g){b[a]=g;b[a].temp={}},cancel:function(a){var d=this,c=new qq.Promise;e(a,f(a),c).then(function(){d.isValid(a)&&(b[a].canceled=!0,d.expunge(a));c.success()})},expunge:function(a){delete b[a]},getThirdPartyFileId:function(a){return b[a].key},isValid:function(a){return void 0!==b[a]},reset:function(){b={}},_getFileState:function(a){return b[a]},_setThirdPartyFileId:function(a,g){b[a].key=g},_wasCanceled:function(a){return!!b[a].canceled}})};
qq.UploadHandlerController=function(a,b){var e=this,f=!1,d=!1,g,c={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(a,c){},onProgress:function(a,c,d,b){},onComplete:function(a,c,d,b){},onCancel:function(a,c){},onUploadPrep:function(a){},onUpload:function(a,c){},onUploadChunk:function(a,c,d){},onUploadChunkSuccess:function(a,c,d,b){},onAutoRetry:function(a,c,d,b){},onResume:function(a,c,d){},onUuidChanged:function(a,c){},getName:function(a){},setSize:function(a,
c){},isQueued:function(a){},getIdsInProxyGroup:function(a){},getIdsInBatch:function(a){}},h={done:function(a,d,b,e){var f=g._getChunkData(a,d);g._getFileState(a).attemptingResume=!1;delete g._getFileState(a).temp.chunkProgress[d];g._getFileState(a).loaded+=f.size;c.onUploadChunkSuccess(a,g._getChunkDataForCallback(f),b,e)},finalize:function(a){var d=c.getSize(a),b=c.getName(a);n("All chunks have been uploaded for "+a+" - finalizing....");g.finalizeChunks(a).then(function(e,f){n("Finalize successful for "+
a);var h=l.normalizeResponse(e,!0);c.onProgress(a,b,d,d);g._maybeDeletePersistedChunkData(a);l.cleanup(a,h,f)},function(d,g){var e=l.normalizeResponse(d,!1);n("Problem finalizing chunks for file ID "+a+" - "+e.error,"error");e.reset&&h.reset(a);c.onAutoRetry(a,b,e,g)||l.cleanup(a,e,g)})},hasMoreParts:function(a){return!!g._getFileState(a).chunking.remaining.length},nextPart:function(a){var c=g._getFileState(a).chunking.remaining.shift();c>=g._getTotalChunks(a)&&(c=null);return c},reset:function(a){n("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+
a,"error");g._maybeDeletePersistedChunkData(a);g.reevaluateChunking(a);g._getFileState(a).loaded=0},sendNext:function(a){var b=c.getSize(a),e=c.getName(a),f=h.nextPart(a),r=g._getChunkData(a,f),m=g._getFileState(a).attemptingResume,q=g._getFileState(a).chunking.inProgress||[];null==g._getFileState(a).loaded&&(g._getFileState(a).loaded=0);m&&!1===c.onResume(a,e,r)&&(h.reset(a),f=h.nextPart(a),r=g._getChunkData(a,f),m=!1);null==f&&0===q.length?h.finalize(a):(n("Sending chunked upload request for item "+
a+": bytes "+(r.start+1)+"-"+r.end+" of "+b),c.onUploadChunk(a,e,g._getChunkDataForCallback(r)),q.push(f),g._getFileState(a).chunking.inProgress=q,d&&k.open(a,f),d&&k.available()&&g._getFileState(a).chunking.remaining.length&&h.sendNext(a),g.uploadChunk(a,f,m).then(function(c,d){n("Chunked upload request succeeded for "+a+", chunk "+f);g.clearCachedChunk(a,f);var b=g._getFileState(a).chunking.inProgress||[],e=l.normalizeResponse(c,!0),k=qq.indexOf(b,f);n(qq.format("Chunk {} for file {} uploaded successfully.",
f,a));h.done(a,f,e,d);0<=k&&b.splice(k,1);g._maybePersistChunkedState(a);h.hasMoreParts(a)||0!==b.length?h.hasMoreParts(a)&&h.sendNext(a):h.finalize(a)},function(b,r){n("Chunked upload request failed for "+a+", chunk "+f);g.clearCachedChunk(a,f);var m=l.normalizeResponse(b,!1);if(m.reset)h.reset(a);else{var q=qq.indexOf(g._getFileState(a).chunking.inProgress,f);0<=q&&(g._getFileState(a).chunking.inProgress.splice(q,1),g._getFileState(a).chunking.remaining.unshift(f))}g._getFileState(a).temp.ignoreFailure||
(d&&(g._getFileState(a).temp.ignoreFailure=!0,qq.each(g._getXhrs(a),function(a,c){c.abort()}),g.moveInProgressToRemaining(a),k.free(a,!0)),c.onAutoRetry(a,e,m,r)||l.cleanup(a,m,r))}).done(function(){g.clearXhr(a,f)}))}},k={_open:[],_openChunks:{},_waiting:[],available:function(){var a=c.maxConnections,d=0,b=0;qq.each(k._openChunks,function(a,c){d++;b+=c.length});return a-(k._open.length-d+b)},free:function(a,c){var d=!c,b=qq.indexOf(k._waiting,a),e=qq.indexOf(k._open,a);delete k._openChunks[a];l.getProxyOrBlob(a)instanceof
qq.BlobProxy&&(n("Generated blob upload has ended for "+a+", disposing generated blob."),delete g._getFileState(a).file);0<=b?k._waiting.splice(b,1):d&&0<=e&&(k._open.splice(e,1),d=k._waiting.shift(),0<=d&&(k._open.push(d),l.start(d)))},getWaitingOrConnected:function(){var a=[];qq.each(k._openChunks,function(c,d){d&&d.length&&a.push(parseInt(c))});qq.each(k._open,function(c,d){k._openChunks[d]||a.push(parseInt(d))});return a=a.concat(k._waiting)},isUsingConnection:function(a){return 0<=qq.indexOf(k._open,
a)},open:function(a,c){null==c&&k._waiting.push(a);if(k.available()){if(null==c)k._waiting.pop(),k._open.push(a);else{var d=k._openChunks[a]||[];d.push(c);k._openChunks[a]=d}return!0}return!1},reset:function(){k._waiting=[];k._open=[]}},m={send:function(a,d){g._getFileState(a).loaded=0;n("Sending simple upload request for "+a);g.uploadFile(a).then(function(b,g){n("Simple upload request succeeded for "+a);var e=l.normalizeResponse(b,!0),f=c.getSize(a);c.onProgress(a,d,f,f);l.maybeNewUuid(a,e);l.cleanup(a,
e,g)},function(b,g){n("Simple upload request failed for "+a);var e=l.normalizeResponse(b,!1);c.onAutoRetry(a,d,e,g)||l.cleanup(a,e,g)})}},l={cancel:function(a){n("Cancelling "+a);c.paramsStore.remove(a);k.free(a)},cleanup:function(a,d,b){var e=c.getName(a);c.onComplete(a,e,d,b);g._getFileState(a)&&g._clearXhrs&&g._clearXhrs(a);k.free(a)},getProxyOrBlob:function(a){return g.getProxy&&g.getProxy(a)||g.getFile&&g.getFile(a)},initHandler:function(){g=new (b?qq[b]:qq.traditional)[(qq.supportedFeatures.ajaxUploading?
"Xhr":"Form")+"UploadHandler"](c,{getDataByUuid:c.getDataByUuid,getName:c.getName,getSize:c.getSize,getUuid:c.getUuid,log:n,onCancel:c.onCancel,onProgress:c.onProgress,onUuidChanged:c.onUuidChanged});g._removeExpiredChunkingRecords&&g._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(a){return c.isQueued(a)},maybeDefer:function(a,d){if(d&&!g.getFile(a)&&d instanceof qq.BlobProxy)c.onUploadPrep(a),n("Attempting to generate a blob on-demand for "+a),d.create().then(function(d){n("Generated an on-demand blob for "+
a);g.updateBlob(a,d);c.setSize(a,d.size);g.reevaluateChunking(a);l.maybeSendDeferredFiles(a)},function(d){var b={};d&&(b.error=d);n(qq.format("Failed to generate blob for ID {}.  Error message: {}.",a,d),"error");c.onComplete(a,c.getName(a),qq.extend(b,q),null);l.maybeSendDeferredFiles(a);k.free(a)});else return l.maybeSendDeferredFiles(a);return!1},maybeSendDeferredFiles:function(a){var d=c.getIdsInProxyGroup(a),b=!1;d&&d.length?(n("Maybe ready to upload proxy group file "+a),qq.each(d,function(c,
d){if(l.isDeferredEligibleForUpload(d)&&g.getFile(d))b=d===a,l.now(d);else if(l.isDeferredEligibleForUpload(d))return!1})):(b=!0,l.now(a));return b},maybeNewUuid:function(a,d){if(void 0!==d.newUuid)c.onUuidChanged(a,d.newUuid)},normalizeResponse:function(a,c){var d=a;qq.isObject(a)||(d={},qq.isString(a)&&!c&&(d.error=a));d.success=c;return d},now:function(a){var d=c.getName(a);if(!e.isValid(a))throw new qq.Error(a+" is not a valid file ID to upload!");c.onUpload(a,d);f&&g._shouldChunkThisFile(a)?
h.sendNext(a):m.send(a,d)},start:function(a){var c=l.getProxyOrBlob(a);if(c)return l.maybeDefer(a,c);l.now(a);return!0}};qq.extend(this,{add:function(a,c){g.add.apply(this,arguments)},upload:function(a){return k.open(a)?l.start(a):!1},retry:function(a){d&&(g._getFileState(a).temp.ignoreFailure=!1);return k.isUsingConnection(a)?l.start(a):e.upload(a)},cancel:function(a){var c=g.cancel(a);qq.isGenericPromise(c)?c.then(function(){l.cancel(a)}):!1!==c&&l.cancel(a)},cancelAll:function(){var a=k.getWaitingOrConnected();
if(a.length)for(var c=a.length-1;0<=c;c--)e.cancel(a[c]);k.reset()},getFile:function(a){return g.getProxy&&g.getProxy(a)?g.getProxy(a).referenceBlob:g.getFile&&g.getFile(a)},isProxied:function(a){return!(!g.getProxy||!g.getProxy(a))},getInput:function(a){if(g.getInput)return g.getInput(a)},reset:function(){n("Resetting upload handler");e.cancelAll();k.reset();g.reset()},expunge:function(a){if(e.isValid(a))return g.expunge(a)},isValid:function(a){return g.isValid(a)},getResumableFilesData:function(){return g.getResumableFilesData?
g.getResumableFilesData():[]},getThirdPartyFileId:function(a){if(e.isValid(a))return g.getThirdPartyFileId(a)},pause:function(a){return e.isResumable(a)&&g.pause&&e.isValid(a)&&g.pause(a)?(k.free(a),g.moveInProgressToRemaining(a),!0):!1},isResumable:function(a){return!!g.isResumable&&g.isResumable(a)}});qq.extend(c,a);var n=c.log;d=(f=c.chunking.enabled&&qq.supportedFeatures.chunking)&&c.chunking.concurrent.enabled;var q=function(){var a={};a[c.preventRetryParam]=!0;return a}();l.initHandler()};
qq.FormUploadHandler=function(a){function b(a,d){var b=a.id,g=b.split("_")[0],e=n(g);c[e]=d;h[g]=qq(a).attach("load",function(){f.getInput(g)&&(q("Received iframe load event for CORS upload request (iframe name "+b+")"),k[b]=setTimeout(function(){var a="No valid message received from loaded iframe for iframe name "+b;q(a,"error");d({error:a})},1E3))});r.receiveMessage(b,function(a){q("Received the following window message: '"+a+"'");b.split("_");var d=f._parseJsonResponse(a),g=d.uuid;g&&c[g]?(q("Handling response for iframe name "+
b),clearTimeout(k[b]),delete k[b],f._detachLoadEvent(b),a=c[g],delete c[g],r.stopReceivingMessages(b),a(d)):g||q("'"+a+"' does not contain a UUID - ignoring.")})}var e=a.options,f=this,d=a.proxy,g=qq.getUniqueId(),c={},h={},k={},m=e.isCors,l=e.inputName,n=d.getUuid,q=d.log,r=new qq.WindowReceiveMessage({log:q});qq.extend(this,new qq.UploadHandler(a));qq.override(this,function(a){return{add:function(c,d){a.add(c,{input:d});d.setAttribute("name",l);d.parentNode&&qq(d).remove()},expunge:function(c){delete h[c];
m&&(clearTimeout(k[c]),delete k[c],r.stopReceivingMessages(c));var d=document.getElementById(f._getIframeName(c));d&&(d.setAttribute("src","javascript:false;"),qq(d).remove());a.expunge(c)},isValid:function(c){return a.isValid(c)&&void 0!==f._getFileState(c).input}}});qq.extend(this,{getInput:function(a){return f._getFileState(a).input},_attachLoadEvent:function(a,c){var d;m?b(a,c):h[a.id]=qq(a).attach("load",function(){q("Received response for "+a.id);if(a.parentNode){try{if(a.contentDocument&&a.contentDocument.body&&
"false"==a.contentDocument.body.innerHTML)return}catch(x){q("Error when attempting to access iframe during handling of upload response ("+x.message+")","error"),d={success:!1}}c(d)}})},_createIframe:function(a){a=f._getIframeName(a);var c=qq.toElement("<iframe src='javascript:false;' name='"+a+"' />");c.setAttribute("id",a);c.style.display="none";document.body.appendChild(c);return c},_detachLoadEvent:function(a){void 0!==h[a]&&(h[a](),delete h[a])},_getIframeName:function(a){return a+"_"+g},_initFormForUpload:function(a){var c=
a.endpoint,d=a.params,b=a.paramsInBody,g=a.targetName;a=qq.toElement("<form method='"+a.method+"' enctype='multipart/form-data'></form>");var e=c;b?qq.obj2Inputs(d,a):e=qq.obj2url(d,c);a.setAttribute("action",e);a.setAttribute("target",g);a.style.display="none";document.body.appendChild(a);return a},_parseJsonResponse:function(a){var c={};try{c=qq.parseJson(a)}catch(u){q("Error when attempting to parse iframe upload response ("+u.message+")","error")}return c}})};
qq.XhrUploadHandler=function(a){function b(a){qq.each(e._getXhrs(a),function(c,d){var b=e._getAjaxRequester(a,c);d.onreadystatechange=null;d.upload.onprogress=null;d.abort();b&&b.canceled&&b.canceled(a)})}var e=this,f=a.options.namespace,d=a.proxy,g=a.options.chunking,c=a.options.resume,h=g&&a.options.chunking.enabled&&qq.supportedFeatures.chunking,k=c&&a.options.resume.enabled&&h&&qq.supportedFeatures.resume,m=d.getName,l=d.getSize,n=d.getUuid,q=d.getEndpoint,r=d.getDataByUuid,w=d.onUuidChanged,
t=d.onProgress,u=d.log;qq.extend(this,new qq.UploadHandler(a));qq.override(this,function(a){return{add:function(c,d){if(qq.isFile(d)||qq.isBlob(d))a.add(c,{file:d});else if(d instanceof qq.BlobProxy)a.add(c,{proxy:d});else throw Error("Passed obj is not a File, Blob, or proxy");e._initTempState(c);k&&e._maybePrepareForResume(c)},expunge:function(c){b(c);e._maybeDeletePersistedChunkData(c);e._clearXhrs(c);a.expunge(c)}}});qq.extend(this,{clearCachedChunk:function(a,c){delete e._getFileState(a).temp.cachedChunks[c]},
clearXhr:function(a,c){var d=e._getFileState(a).temp;d.xhrs&&delete d.xhrs[c];d.ajaxRequesters&&delete d.ajaxRequesters[c]},finalizeChunks:function(a,c){var d=e._getTotalChunks(a)-1;d=e._getXhr(a,d);return c?(new qq.Promise).success(c(d),d):(new qq.Promise).success({},d)},getFile:function(a){return e.isValid(a)&&e._getFileState(a).file},getProxy:function(a){return e.isValid(a)&&e._getFileState(a).proxy},getResumableFilesData:function(){var a=[];e._iterateResumeRecords(function(c,d){e.moveInProgressToRemaining(null,
d.chunking.inProgress,d.chunking.remaining);var b={name:d.name,remaining:d.chunking.remaining,size:d.size,uuid:d.uuid};d.key&&(b.key=d.key);a.push(b)});return a},isResumable:function(a){return!!g&&e.isValid(a)&&!e._getFileState(a).notResumable},moveInProgressToRemaining:function(a,c,d){c=c||e._getFileState(a).chunking.inProgress;var b=d||e._getFileState(a).chunking.remaining;c&&(c.reverse(),qq.each(c,function(a,c){b.unshift(c)}),c.length=0)},pause:function(a){if(e.isValid(a))return u(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",
a,m(a))),e._getFileState(a).paused=!0,b(a),!0},reevaluateChunking:function(a){if(g&&e.isValid(a)){var c=e._getFileState(a);delete c.chunking;c.chunking={};var d=e._getTotalChunks(a);if(1<d){c.chunking.enabled=!0;c.chunking.parts=d;c.chunking.remaining=[];for(var b=0;b<d;b++)c.chunking.remaining.push(b);e._initTempState(a)}else c.chunking.enabled=!1}},updateBlob:function(a,c){e.isValid(a)&&(e._getFileState(a).file=c)},_clearXhrs:function(a){var c=e._getFileState(a).temp;qq.each(c.ajaxRequesters,function(a){delete c.ajaxRequesters[a]});
qq.each(c.xhrs,function(a){delete c.xhrs[a]})},_createXhr:function(a,c){return e._registerXhr(a,c,qq.createXhrInstance())},_getAjaxRequester:function(a,c){var d=null==c?-1:c;return e._getFileState(a).temp.ajaxRequesters[d]},_getChunkData:function(a,c){var d=g.partSize,b=l(a),f=e.getFile(a),h=d*c;d=h+d>=b?b:h+d;b=e._getTotalChunks(a);var k=this._getFileState(a).temp.cachedChunks;f=k[c]||qq.sliceBlob(f,h,d);k[c]=f;return{part:c,start:h,end:d,count:b,blob:f,size:d-h}},_getChunkDataForCallback:function(a){return{partIndex:a.part,
startByte:a.start+1,endByte:a.end,totalParts:a.count}},_getLocalStorageId:function(a){var c=m(a),d=l(a),b=g.partSize;a=q(a);return qq.format("qq{}resume{}-{}-{}-{}-{}",f,"5.0",c,d,b,a)},_getMimeType:function(a){return e.getFile(a).type},_getPersistableData:function(a){return e._getFileState(a).chunking},_getTotalChunks:function(a){if(g)return a=l(a),Math.ceil(a/g.partSize)},_getXhr:function(a,c){var d=null==c?-1:c;return e._getFileState(a).temp.xhrs[d]},_getXhrs:function(a){return e._getFileState(a).temp.xhrs},
_iterateResumeRecords:function(a){k&&qq.each(localStorage,function(c,d){if(0===c.indexOf(qq.format("qq{}resume-",f))){var b=JSON.parse(d);a(c,b)}})},_initTempState:function(a){e._getFileState(a).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(a){e._getFileState(a).notResumable=!0},_maybeDeletePersistedChunkData:function(a){return k&&e.isResumable(a)&&(a=e._getLocalStorageId(a))&&localStorage.getItem(a)?(localStorage.removeItem(a),!0):!1},_maybePrepareForResume:function(a){var c=
e._getFileState(a);if(k&&void 0===c.key){var d=e._getLocalStorageId(a);if(d=localStorage.getItem(d))d=JSON.parse(d),r(d.uuid)?e._markNotResumable(a):(u(qq.format("Identified file with ID {} and name of {} as resumable.",a,m(a))),w(a,d.uuid),c.key=d.key,c.chunking=d.chunking,c.loaded=d.loaded,c.attemptingResume=!0,e.moveInProgressToRemaining(a))}},_maybePersistChunkedState:function(a){var c=e._getFileState(a);if(k&&e.isResumable(a)){var d=e._getLocalStorageId(a);a={name:m(a),size:l(a),uuid:n(a),key:c.key,
chunking:c.chunking,loaded:c.loaded,lastUpdated:Date.now()};localStorage.setItem(d,JSON.stringify(a))}},_registerProgressHandler:function(a,c,d){var b=e._getXhr(a,c),g=m(a),f={simple:function(c,d){var b=l(a);c===d?t(a,g,b,b):t(a,g,c>=b?b-1:c,b)},chunked:function(b,f){var h=e._getFileState(a).temp.chunkProgress,k=e._getFileState(a).loaded,n=l(a),m=k;h[c]=b-(f-d);qq.each(h,function(a,c){m+=c});t(a,g,m,n)}};b.upload.onprogress=function(a){if(a.lengthComputable)f[null==d?"simple":"chunked"](a.loaded,
a.total)}},_registerXhr:function(a,c,d,b){c=null==c?-1:c;a=e._getFileState(a).temp;a.xhrs=a.xhrs||{};a.ajaxRequesters=a.ajaxRequesters||{};a.xhrs[c]=d;b&&(a.ajaxRequesters[c]=b);return d},_removeExpiredChunkingRecords:function(){var a=c.recordsExpireIn;e._iterateResumeRecords(function(c,d){var b=new Date(d.lastUpdated);b.setDate(b.getDate()+a);b.getTime()<=Date.now()&&(u("Removing expired resume record with key "+c),localStorage.removeItem(c))})},_shouldChunkThisFile:function(a){var c=e._getFileState(a);
c.chunking||e.reevaluateChunking(a);return c.chunking.enabled}})};qq.WindowReceiveMessage=function(a){var b={};qq.extend({log:function(a,b){}},a);qq.extend(this,{receiveMessage:function(a,f){var d=function(a){f(a.data)};window.postMessage?b[a]=qq(window).attach("message",d):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(a){window.postMessage&&(a=b[a])&&a()}})};
(function(){qq.uiPublicApi={clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments);this._templating.clearFiles()},addExtraDropzone:function(a){this._dnd&&this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){if(this._dnd)return this._dnd.removeDropzone(a)},getItemByFileId:function(a){return this._templating.getFileContainer(a)},reset:function(){this._parent.prototype.reset.apply(this,arguments);this._templating.reset();!this._options.button&&this._templating.getButton()&&
(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId());this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop());this._filesInBatchAddedToUi=this._totalFilesInBatch=0;this._setupClickAndEditEventHandlers()},setName:function(a,b){var e=this._options.formatFileName(b);this._parent.prototype.setName.apply(this,arguments);this._templating.updateFilename(a,e)},pauseUpload:function(a){var b=this._parent.prototype.pauseUpload.apply(this,arguments);
b&&this._templating.uploadPaused(a);return b},continueUpload:function(a){var b=this._parent.prototype.continueUpload.apply(this,arguments);b&&this._templating.uploadContinued(a);return b},getId:function(a){return this._templating.getFileId(a)},getDropTarget:function(a){return this.getFile(a).qqDropTarget}};qq.uiPrivateApi={_getButton:function(a){var b=this._parent.prototype._getButton.apply(this,arguments);b||a===this._defaultButtonId&&(b=this._templating.getButton());return b},_removeFileItem:function(a){this._templating.removeFile(a)},
_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent();this._focusinEventSupported=!qq.firefox();this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var a=this,b=this._options.dragAndDrop.extraDropzones,e=this._templating,
f=e.getDropZone();f&&b.push(f);return new qq.DragAndDrop({dropZoneElements:b,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){e.showDropProcessing()},processingDroppedFilesComplete:function(d,b){e.hideDropProcessing();qq.each(d,function(a,d){d.qqDropTarget=b});d.length&&a.addFiles(d,null,null)},dropError:function(d,b){a._itemError(d,b)},dropLog:function(d,b){a.log(d,b)}}})},_bindFileButtonsClickEvent:function(){var a=
this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(b,e){a.log(b,e)},onDeleteFile:function(b){a.deleteFile(b)},onCancel:function(b){a.cancel(b)},onRetry:function(b){qq(a._templating.getFileContainer(b)).removeClass(a._classes.retryable);a._templating.hideRetry(b);a.retry(b)},onPause:function(b){a.pauseUpload(b)},onContinue:function(b){a.continueUpload(b)},onGetName:function(b){return a.getName(b)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&
!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var a=this,b=this._templating;return{templating:b,log:function(b,f){a.log(b,f)},onGetUploadStatus:function(b){return a.getUploads({id:b}).status},onGetName:function(b){return a.getName(b)},onSetName:function(b,f){a.setName(b,f)},onEditingStatusChange:function(a,f){var d=qq(b.getEditInput(a)),g=qq(b.getFileContainer(a));f?(d.addClass("qq-editing"),b.hideFilename(a),
b.hideEditIcon(a)):(d.removeClass("qq-editing"),b.showFilename(a),b.showEditIcon(a));g.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(a,b,e){this._parent.prototype._onUploadStatusChange.apply(this,arguments);this._isEditFilenameEnabled()&&this._templating.getFileContainer(a)&&e!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(a),this._templating.hideEditIcon(a))},_bindFilenameInputFocusInEvent:function(){var a=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(a)},
_bindFilenameInputFocusEvent:function(){var a=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(a)},_bindFilenameClickEvent:function(){var a=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(a)},_storeForLater:function(a){this._parent.prototype._storeForLater.apply(this,arguments);this._templating.hideSpinner(a)},_onAllComplete:function(a,b){this._parent.prototype._onAllComplete.apply(this,arguments);this._templating.resetTotalProgress()},
_onSubmit:function(a,b){var e=this.getFile(a);e&&e.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(a,{qqpath:e.qqPath});this._parent.prototype._onSubmit.apply(this,arguments);this._addToList(a,b)},_onSubmitted:function(a){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(a),this._templating.showEditIcon(a),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(a)))},_onProgress:function(a,b,e,
f){this._parent.prototype._onProgress.apply(this,arguments);this._templating.updateProgress(a,e,f);100===Math.round(e/f*100)?(this._templating.hideCancel(a),this._templating.hidePause(a),this._templating.hideProgress(a),this._templating.setStatusText(a,this._options.text.waitingForResponse),this._displayFileSize(a)):this._displayFileSize(a,e,f)},_onTotalProgress:function(a,b){this._parent.prototype._onTotalProgress.apply(this,arguments);this._templating.updateTotalProgress(a,b)},_onComplete:function(a,
b,e,f){function d(d){h&&(c.setStatusText(a),qq(h).removeClass(k._classes.retrying),c.hideProgress(a),k._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading||c.hideCancel(a),c.hideSpinner(a),d.success?k._markFileAsSuccessful(a):(qq(h).addClass(k._classes.fail),c.isRetryPossible()&&!k._preventRetries[a]&&(qq(h).addClass(k._classes.retryable),c.showRetry(a)),k._controlFailureTextDisplay(a,d)))}var g=this._parent.prototype._onComplete.apply(this,arguments),c=this._templating,h=c.getFileContainer(a),
k=this;g instanceof qq.Promise?g.done(function(a){d(a)}):d(e);return g},_markFileAsSuccessful:function(a){var b=this._templating;this._isDeletePossible()&&b.showDeleteButton(a);qq(b.getFileContainer(a)).addClass(this._classes.success);this._maybeUpdateThumbnail(a)},_onUploadPrep:function(a){this._parent.prototype._onUploadPrep.apply(this,arguments);this._templating.showSpinner(a)},_onUpload:function(a,b){var e=this._parent.prototype._onUpload.apply(this,arguments);this._templating.showSpinner(a);
return e},_onUploadChunk:function(a,b){this._parent.prototype._onUploadChunk.apply(this,arguments);0<b.partIndex&&this._handler.isResumable(a)&&this._templating.allowPause(a)},_onCancel:function(a,b){this._parent.prototype._onCancel.apply(this,arguments);this._removeFileItem(a);0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(a){this._parent.prototype._onBeforeAutoRetry.apply(this,arguments);this._showCancelLink(a);if(this._options.retry.showAutoRetryNote){var b=
this._autoRetries[a];var e=this._options.retry.maxAutoAttempts;b=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,b);b=b.replace(/\{maxAuto\}/g,e);this._templating.setStatusText(a,b);qq(this._templating.getFileContainer(a)).addClass(this._classes.retrying)}},_onBeforeManualRetry:function(a){if(this._parent.prototype._onBeforeManualRetry.apply(this,arguments))return this._templating.resetProgress(a),qq(this._templating.getFileContainer(a)).removeClass(this._classes.fail),this._templating.setStatusText(a),
this._templating.showSpinner(a),this._showCancelLink(a),!0;qq(this._templating.getFileContainer(a)).addClass(this._classes.retryable);this._templating.showRetry(a);return!1},_onSubmitDelete:function(a){var b=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,a,b)},_onSubmitDeleteSuccess:function(a,b,e){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(a,
b,e){this._parent.prototype._onDeleteComplete.apply(this,arguments);this._templating.hideSpinner(a);e?(this._templating.setStatusText(a,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(a)):this._removeFileItem(a)},_sendDeleteRequest:function(a,b,e){this._templating.hideDeleteButton(a);this._templating.showSpinner(a);this._templating.setStatusText(a,this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(a,
b,e){var f=this.getName(a);f=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,f);b=this.getUuid(a);var d=arguments,g=this;f=this._options.showConfirm(f);qq.isGenericPromise(f)?f.then(function(){g._sendDeleteRequest.apply(g,d)}):!1!==f&&g._sendDeleteRequest.apply(g,d)},_addToList:function(a,b,e){var f=0;if(!this._handler.isProxied(a)||!this._options.scaling.hideScaled){if(this._options.display.prependFiles){1<this._totalFilesInBatch&&0<this._filesInBatchAddedToUi&&(f=this._filesInBatchAddedToUi-
1);var d={index:f}}e||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(f=this.getUploads({id:a}),this._handledProxyGroup=this._handledProxyGroup||f.proxyGroupId,f.proxyGroupId===this._handledProxyGroup&&f.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null)));this._templating.addFile(a,this._options.formatFileName(b),d);e?this._thumbnailUrls[a]&&this._templating.updateThumbnail(a,
this._thumbnailUrls[a],!0):this._templating.generatePreview(a,this.getFile(a));this._filesInBatchAddedToUi+=1;(e||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(a)}},_clearList:function(){this._templating.clearFiles();this.clearStoredFiles()},_displayFileSize:function(a,b,e){var f=this.getSize(a),d=this._formatSize(f);0<=f&&(void 0!==b&&void 0!==e&&(d=this._formatProgress(b,e)),this._templating.updateSize(a,d))},_formatProgress:function(a,b){var e=
this._options.text.formatProgress;e=e.replace("{percent}",Math.round(a/b*100));var f=this._formatSize(b);return e=e.replace("{total_size}",f)},_controlFailureTextDisplay:function(a,b){var e;var f=this._options.failedUploadTextDisplay.mode;var d=this._options.failedUploadTextDisplay.maxChars;var g=this._options.failedUploadTextDisplay.responseProperty;"custom"===f?((f=b[g])?f.length>d&&(e=f.substring(0,d)+"..."):f=this._options.text.failUpload,this._templating.setStatusText(a,e||f),this._options.failedUploadTextDisplay.enableTooltip&&
this._showTooltip(a,f)):"default"===f?this._templating.setStatusText(a,this._options.text.failUpload):"none"!==f&&this.log("failedUploadTextDisplay.mode value of '"+f+"' is not valid","warn")},_showTooltip:function(a,b){this._templating.getFileContainer(a).title=b},_showCancelLink:function(a){this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading||this._templating.showCancel(a)},_itemError:function(a,b,e){var f=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(f)},
_batchError:function(a){this._parent.prototype._batchError.apply(this,arguments);this._options.showMessage(a)},_setupPastePrompt:function(){var a=this;this._options.callbacks.onPasteReceived=function(){return a._options.showPrompt(a._options.paste.namePromptMessage,a._options.paste.defaultName)}},_fileOrBlobRejected:function(a,b){--this._totalFilesInBatch;this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(a,b,e){this._totalFilesInBatch=a.length;this._filesInBatchAddedToUi=
0;this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(a){this._templating.updateThumbnail(a,this._thumbnailUrls[a])},_addCannedFile:function(a){var b=this._parent.prototype._addCannedFile.apply(this,arguments);this._addToList(b,this.getName(b),!0);this._templating.hideSpinner(b);this._templating.hideCancel(b);this._markFileAsSuccessful(b);return b},_setSize:function(a,b){this._parent.prototype._setSize.apply(this,arguments);this._templating.updateSize(a,
this._formatSize(b))}}})();
qq.FineUploader=function(a,b){this._parent=b?qq[b].FineUploaderBasic:qq.FineUploaderBasic;this._parent.apply(this,arguments);qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",
editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",
deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null}},scaling:{hideScaled:!1},showMessage:function(a){setTimeout(function(){window.alert(a)},0)},showConfirm:function(a){return window.confirm(a)},showPrompt:function(a,b){return window.prompt(a,b)}},!0);qq.extend(this._options,a,!0);this._templating=new qq.Templating({log:qq.bind(this.log,
this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text});
this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),
this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._filesInBatchAddedToUi=this._totalFilesInBatch=0)};qq.extend(qq.FineUploader.prototype,qq.basePublicApi);qq.extend(qq.FineUploader.prototype,qq.basePrivateApi);qq.extend(qq.FineUploader.prototype,qq.uiPublicApi);
qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi);
qq.Templating=function(a){function b(a){return qq(v).getByClass("qq-file-id-"+a)[0]}function e(a,c){return a&&qq(a).getByClass(c)[0]}function f(a){return null==a?e(C,u.totalProgressBarContainer)||e(C,u.totalProgressBar):e(b(a),u.progressBarContainer)||e(b(a),u.progressBar)}function d(a){return H&&e(b(a),u.thumbnail)}function g(a){a&&qq(a).addClass(t.classes.hide)}function c(a){a&&qq(a).removeClass(t.classes.hide)}function h(a,c){var d=f(a),b=null==a?u.totalProgressBar:u.progressBar;d&&!qq(d).hasClass(b)&&
(d=qq(d).getByClass(b)[0]);d&&qq(d).css({width:c+"%"})}function k(a){var d=new qq.Promise;D.then(function(b){l(b,a);a.src?d.success():(a.src=b.src,a.onload=function(){c(a);d.success()})},function(){g(a);d.success()});return d}function m(a,d){var b=x[a]||(new qq.Promise).failure(),g=new qq.Promise;B.then(function(a){b.then(function(){g.success()},function(){l(a,d);d.onload=function(){g.success()};d.src=a.src;c(d)})});return g}function l(a,c){var d=a.style.maxWidth,b=a.style.maxHeight;b&&d&&!c.style.maxWidth&&
!c.style.maxHeight&&qq(c).css({maxWidth:d,maxHeight:b})}function n(a,b){var g=d(a),e=d(b);A(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",a,b,b));x[b].then(function(){x[a].success();A(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",b,a));g.src=e.src;c(g)},function(){x[a].failure();t.placeholders.waitUntilUpdate||m(a,g)})}function q(a,b,g){var e=d(a);A("Generating new thumbnail for "+a);b.qqThumbnailId=a;return t.imageGenerator.generate(b,
e,g).then(function(){c(e);x[a].success()},function(){x[a].failure();t.placeholders.waitUntilUpdate||m(a,e)})}var r=!1,w=-1,t={log:null,templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},u={button:"qq-upload-button-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",
progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",
editNameIcon:"qq-edit-filename-icon-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},x={},B=new qq.Promise,D=new qq.Promise,F,z,v,y;qq.extend(t,a);var A=t.log;var C=t.containerEl;var H=void 0!==t.imageGenerator;var G=function(){A("Parsing template");if(null==t.templateIdOrEl)throw Error("You MUST specify either a template element or ID!");if(qq.isString(t.templateIdOrEl)){var a=document.getElementById(t.templateIdOrEl);
if(null===a)throw Error(qq.format("Cannot find template script at ID '{}'!",t.templateIdOrEl));var c=a.innerHTML}else{if(void 0===t.templateIdOrEl.innerHTML)throw Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");c=t.templateIdOrEl.innerHTML}c=qq.trimStr(c);a=document.createElement("div");a.appendChild(qq.toElement(c));t.button&&(c=qq(a).getByClass(u.button)[0])&&qq(c).remove();qq.DragAndDrop&&qq.supportedFeatures.fileDrop||(c=qq(a).getByClass(u.dropProcessing)[0])&&
qq(c).remove();(c=qq(a).getByClass(u.drop)[0])&&!qq.DragAndDrop&&(A("DnD module unavailable.","info"),qq(c).remove());c&&!qq.supportedFeatures.fileDrop&&qq(c).hasAttribute("qq-hide-dropzone")&&qq(c).css({display:"none"});c=qq(a).getByClass(u.thumbnail)[0];H?c&&(w=parseInt(c.getAttribute("qq-max-size")),w=0<w?w:null,y=qq(c).hasAttribute("qq-server-scale")):c&&qq(c).remove();H=H&&c;F=0<qq(a).getByClass(u.editFilenameInput).length;z=0<qq(a).getByClass(u.retry).length;c=qq(a).getByClass(u.list)[0];if(null==
c)throw Error("Could not find the file list container in the template!");var d=c.innerHTML;c.innerHTML="";A("Template parsing complete");return{template:qq.trimStr(a.innerHTML),fileTemplate:qq.trimStr(d)}}();(function(){var a=t.placeholders.thumbnailNotAvailable,c=t.placeholders.waitingForThumbnail,d={maxSize:w,scale:y};H&&(a?t.imageGenerator.generate(a,new Image,d).then(function(a){B.success(a)},function(){B.failure();A("Problem loading 'not available' placeholder image at "+a,"error")}):B.failure(),
c?t.imageGenerator.generate(c,new Image,d).then(function(a){D.success(a)},function(){D.failure();A("Problem loading 'waiting for thumbnail' placeholder image at "+c,"error")}):D.failure())})();qq.extend(this,{render:function(){A("Rendering template in DOM.");C.innerHTML=G.template;g(e(C,u.dropProcessing));this.hideTotalProgress();v=t.fileContainerEl||e(C,u.list);A("Template rendering complete")},renderFailure:function(a){a=qq.toElement(a);C.innerHTML="";C.appendChild(a)},reset:function(){this.render()},
clearFiles:function(){v.innerHTML=""},disableCancel:function(){r=!0},addFile:function(a,c,d){var h=qq.toElement(G.fileTemplate),k=e(h,u.file);qq(h).addClass("qq-file-id-"+a);k&&qq(k).setText(c);h.setAttribute("qq-file-id",a);d?(c=d.index,d=v,k=d.firstChild,0<c&&(k=qq(d).children()[c].nextSibling),d.insertBefore(h,k)):v.appendChild(h);g(f(a));g(e(b(a),u.size));g(e(b(a),u.deleteButton));g(e(b(a),u.retry));g(e(b(a),u.pause));g(e(b(a),u.continueButton));r&&this.hideCancel(a)},removeFile:function(a){qq(b(a)).remove()},
getFileId:function(a){if(a){for(;null==a.getAttribute("qq-file-id");)a=a.parentNode;return parseInt(a.getAttribute("qq-file-id"))}},getFileList:function(){return v},markFilenameEditable:function(a){(a=e(b(a),u.file))&&qq(a).addClass(t.classes.editable)},updateFilename:function(a,c){var d=e(b(a),u.file);d&&qq(d).setText(c)},hideFilename:function(a){g(e(b(a),u.file))},showFilename:function(a){c(e(b(a),u.file))},isFileName:function(a){return qq(a).hasClass(u.file)},getButton:function(){return t.button||
e(C,u.button)},hideDropProcessing:function(){g(e(C,u.dropProcessing))},showDropProcessing:function(){c(e(C,u.dropProcessing))},getDropZone:function(){return e(C,u.drop)},isEditFilenamePossible:function(){return F},hideRetry:function(a){g(e(b(a),u.retry))},isRetryPossible:function(){return z},showRetry:function(a){c(e(b(a),u.retry))},getFileContainer:function(a){return b(a)},showEditIcon:function(a){(a=e(b(a),u.editNameIcon))&&qq(a).addClass(t.classes.editable)},hideEditIcon:function(a){(a=e(b(a),
u.editNameIcon))&&qq(a).removeClass(t.classes.editable)},isEditIcon:function(a){return qq(a).hasClass(u.editNameIcon)},getEditInput:function(a){return e(b(a),u.editFilenameInput)},isEditInput:function(a){return qq(a).hasClass(u.editFilenameInput)},updateProgress:function(a,d,b){var e=f(a);e&&(d=Math.round(d/b*100),100===d?g(e):c(e),h(a,d))},updateTotalProgress:function(a,c){this.updateProgress(null,a,c)},hideProgress:function(a){(a=f(a))&&g(a)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(a){h(a,
0)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(a){r||(a=e(b(a),u.cancel))&&qq(a).removeClass(t.classes.hide)},hideCancel:function(a){g(e(b(a),u.cancel))},isCancel:function(a){return qq(a).hasClass(u.cancel)},allowPause:function(a){c(e(b(a),u.pause));g(e(b(a),u.continueButton))},uploadPaused:function(a){this.setStatusText(a,t.text.paused);this.allowContinueButton(a);g(e(b(a),u.spinner))},hidePause:function(a){g(e(b(a),u.pause))},isPause:function(a){return qq(a).hasClass(u.pause)},
isContinueButton:function(a){return qq(a).hasClass(u.continueButton)},allowContinueButton:function(a){c(e(b(a),u.continueButton));g(e(b(a),u.pause))},uploadContinued:function(a){this.setStatusText(a,"");this.allowPause(a);c(e(b(a),u.spinner))},showDeleteButton:function(a){c(e(b(a),u.deleteButton))},hideDeleteButton:function(a){g(e(b(a),u.deleteButton))},isDeleteButton:function(a){return qq(a).hasClass(u.deleteButton)},isRetry:function(a){return qq(a).hasClass(u.retry)},updateSize:function(a,d){var g=
e(b(a),u.size);g&&(c(g),qq(g).setText(d))},setStatusText:function(a,c){var d=e(b(a),u.statusText);d&&(null==c?qq(d).clearText():qq(d).setText(c))},hideSpinner:function(a){g(e(b(a),u.spinner))},showSpinner:function(a){c(e(b(a),u.spinner))},generatePreview:function(a,c){var b=c&&c.qqThumbnailId,g=d(a),e={maxSize:w,scale:!0,orient:!0};qq.supportedFeatures.imagePreviews?g&&k(g).done(function(){x[a]=new qq.Promise;null!=b?n(a,b):q(a,c,e)}):g&&k(g)},updateThumbnail:function(a,b,g){var e=d(a),f={maxSize:w,
scale:y};if(e){if(b)return g&&k(e),t.imageGenerator.generate(b,e,f).then(function(){c(e)},function(){m(a,e)});m(a,e)}}})};qq.traditional=qq.traditional||{};
qq.traditional.FormUploadHandler=function(a,b){function e(c,b){var e=a.paramsStore.get(c),h=a.demoMode?"GET":"POST",k=a.endpointStore.get(c),q=d(c);e[a.uuidName]=g(c);e[a.filenameParam]=q;return f._initFormForUpload({method:h,endpoint:k,params:e,paramsInBody:a.paramsInBody,targetName:b.name})}var f=this,d=b.getName,g=b.getUuid,c=b.log;this.uploadFile=function(d){var b=f.getInput(d),g=f._createIframe(d),h=new qq.Promise;var n=e(d,g);n.appendChild(b);f._attachLoadEvent(g,function(b){c("iframe loaded");
if(!b){try{var e=g.contentDocument||g.contentWindow.document,k=e.body.innerHTML;c("converting iframe's innerHTML to JSON");c("innerHTML = "+k);k&&k.match(/^<pre/i)&&(k=e.body.firstChild.firstChild.nodeValue);var l=f._parseJsonResponse(k)}catch(u){c("Error when attempting to parse form upload response ("+u.message+")","error"),l={success:!1}}b=l}f._detachLoadEvent(d);a.cors.expected||qq(g).remove();b.success?h.success(b):h.failure(b)});c("Sending upload request for "+d);n.submit();qq(n).remove();return h};
qq.extend(this,new qq.FormUploadHandler({options:{isCors:a.cors.expected,inputName:a.inputName},proxy:{onCancel:a.onCancel,getName:d,getUuid:g,log:c}}))};qq.traditional=qq.traditional||{};
qq.traditional.XhrUploadHandler=function(a,b){var e=this,f=b.getName,d=b.getSize,g=b.getUuid,c=b.log,h=a.forceMultipart||a.paramsInBody,k=new qq.traditional.AllChunksDoneAjaxRequester({cors:a.cors,endpoint:a.chunking.success.endpoint,log:c}),m=function(a,d){var b=new qq.Promise;d.onreadystatechange=function(){var g;if(4===d.readyState){c("xhr - server response received for "+a);c("responseText = "+d.responseText);var e=n(!0,d);(g=!(200!==d.status||!e.success||e.reset))?b.success(e,d):b.failure(e,
d)}};return b},l=function(c){var b=a.paramsStore.get(c),h=f(c),k=d(c);b[a.uuidName]=g(c);b[a.filenameParam]=h;b[a.totalFileSizeName]=k;b[a.chunking.paramNames.totalParts]=e._getTotalChunks(c);return b},n=function(a,d){var b={};try{c(qq.format("Received response status {} with body: {}",d.status,d.responseText)),b=qq.parseJson(d.responseText)}catch(B){a&&c("Error when attempting to parse xhr response text ("+B.message+")","error")}return b},q=function(c){var d=new qq.Promise;k.complete(c,e._createXhr(c),
l(c),a.customHeaders.get(c)).then(function(a){d.success(n(!1,a),a)},function(a){d.failure(n(!1,a),a)});return d},r=function(c,b,e,k){var l=new FormData,n=a.demoMode?"GET":"POST",m=a.endpointStore.get(k),r=f(k),q=d(k);c[a.uuidName]=g(k);c[a.filenameParam]=r;h&&(c[a.totalFileSizeName]=q);a.paramsInBody||(h||(c[a.inputName]=r),m=qq.obj2url(c,m));b.open(n,m,!0);a.cors.expected&&a.cors.sendCredentials&&(b.withCredentials=!0);return h?(a.paramsInBody&&qq.obj2FormData(c,l),l.append(a.inputName,e),l):e},
w=function(c,d){var b=a.customHeaders.get(c),g=e.getFile(c);d.setRequestHeader("Accept","application/json");d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Cache-Control","no-cache");h||(d.setRequestHeader("Content-Type","application/octet-stream"),d.setRequestHeader("X-Mime-Type",g.type));qq.each(b,function(a,c){d.setRequestHeader(a,c)})};qq.extend(this,{uploadChunk:function(c,b,g){var k=e._getChunkData(c,b),l=e._createXhr(c,b);d(c);var n=m(c,l);e._registerProgressHandler(c,
b,k.size);b=a.paramsStore.get(c);var q=d(c),t=f(c);b[a.chunking.paramNames.partIndex]=k.part;b[a.chunking.paramNames.partByteOffset]=k.start;b[a.chunking.paramNames.chunkSize]=k.size;b[a.chunking.paramNames.totalParts]=k.count;b[a.totalFileSizeName]=q;h&&(b[a.filenameParam]=t);g&&(b[a.resume.paramNames.resuming]=!0);g=r(b,l,k.blob,c);w(c,l);l.send(g);return n},uploadFile:function(c){var d=e.getFile(c);var b=e._createXhr(c);e._registerProgressHandler(c);var g=m(c,b);var f=a.paramsStore.get(c);d=r(f,
b,d,c);w(c,b);b.send(d);return g}});qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},a),proxy:qq.extend({getEndpoint:a.endpointStore.get},b)}));qq.override(this,function(c){return{finalizeChunks:function(d){return a.chunking.success.endpoint?q(d):c.finalizeChunks(d,qq.bind(n,this,!0))}}})};
qq.traditional.AllChunksDoneAjaxRequester=function(a){var b={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(a,b){}},e={};qq.extend(b,a);var f=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST"],method:"POST",successfulResponseCodes:{POST:[200,201,202]},endpointStore:{get:function(a){return b.endpoint}},allowXRequestedWithAndCacheControl:!1,cors:b.cors,log:b.log,onComplete:function(a,b,c){var d=e[a];delete e[a];c?d.failure(b):d.success(b)}}));
qq.extend(this,{complete:function(a,g,c,h){var d=new qq.Promise;b.log("Submitting All Chunks Done request for "+a);e[a]=d;f.initTransport(a).withParams(c).withHeaders(h).send(g);return d}})};
qq.PasteSupport=function(a){var b;var e={targetElement:null,callbacks:{log:function(a,d){},pasteReceived:function(a){}}};qq.extend(e,a);(function(){b=qq(e.targetElement).attach("paste",function(a){(a=a.clipboardData)&&qq.each(a.items,function(a,b){if(b.type&&0===b.type.indexOf("image/")){var c=b.getAsFile();e.callbacks.pasteReceived(c)}})})})();qq.extend(this,{reset:function(){b&&b()}})};
qq.DragAndDrop=function(a){function b(a){var c=new qq.Promise;a.isFile?a.file(function(d){var b=a.fullPath,g=b.indexOf(a.name);b=b.substr(0,g);"/"===b.charAt(0)&&(b=b.substr(1));d.qqPath=b;h.push(d);c.success()},function(d){m.callbacks.dropLog("Problem parsing '"+a.fullPath+"'.  FileError code "+d.code+".","error");c.failure()}):a.isDirectory&&e(a).then(function(a){var d=a.length;qq.each(a,function(a,g){b(g).done(function(){--d;0===d&&c.success()})});a.length||c.success()},function(d){m.callbacks.dropLog("Problem parsing '"+
a.fullPath+"'.  FileError code "+d.code+".","error");c.failure()});return c}function e(a,c,d,b){var g=b||new qq.Promise,f=c||a.createReader();f.readEntries(function(c){var b=d?d.concat(c):c;c.length?setTimeout(function(){e(a,f,b,g)},0):g.success(b)},g.failure);return g}function f(a,c){var d=[],g=new qq.Promise;m.callbacks.processingDroppedFiles();c.dropDisabled(!0);1<a.files.length&&!m.allowMultipleItems?(m.callbacks.processingDroppedFilesComplete([]),m.callbacks.dropError("tooManyFilesError",""),
c.dropDisabled(!1),g.failure()):(h=[],qq.isFolderDropSupported(a)?qq.each(a.items,function(a,c){var e=c.webkitGetAsEntry();e&&(e.isFile?h.push(c.getAsFile()):d.push(b(e).done(function(){d.pop();0===d.length&&g.success()})))}):h=a.files,0===d.length&&g.success());return g}function d(a){var d=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:"qq-hidezones",element:a,onEnter:function(c){qq(a).addClass(m.classes.dropActive);c.stopPropagation()},onLeaveNotDescendants:function(c){qq(a).removeClass(m.classes.dropActive)},
onDrop:function(a){f(a.dataTransfer,d).then(function(){var a=h,c=d,b=Array.prototype.slice.call(a);m.callbacks.dropLog("Grabbed "+a.length+" dropped files.");c.dropDisabled(!1);m.callbacks.processingDroppedFilesComplete(b,c.getElement())},function(){m.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});k.addDisposer(function(){d.dispose()});qq(a).hasAttribute("qq-hide-dropzone")&&qq(a).hide();c.push(d);return d}function g(a){var c;qq.each(a.dataTransfer.types,
function(a,d){if("Files"===d)return c=!0,!1});return c}var c=[],h=[],k=new qq.DisposeSupport;var m={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks};qq.extend(m,a,!0);(function(){var a=m.dropZoneElements,c=function(){setTimeout(function(){qq.each(a,function(a,c){qq(c).hasAttribute("qq-hide-dropzone")&&qq(c).hide();qq(c).removeClass(m.classes.dropActive)})},10)};qq.each(a,function(c,b){var e=d(b);a.length&&qq.supportedFeatures.fileDrop&&k.attach(document,
"dragenter",function(c){!e.dropDisabled()&&g(c)&&qq.each(a,function(a,c){c instanceof HTMLElement&&qq(c).css({display:"block"})})})});k.attach(document,"dragleave",function(a){a=qq.firefox()?!a.relatedTarget:qq.safari()?0>a.x||0>a.y:0===a.x&&0===a.y;a&&c()});k.attach(qq(document).children()[0],"mouseenter",function(a){c()});k.attach(document,"drop",function(a){a.preventDefault();c()});k.attach(document,"qq-hidezones",c)})();qq.extend(this,{setupExtraDropzone:function(a){m.dropZoneElements.push(a);
d(a)},removeDropzone:function(a){var c,d=m.dropZoneElements;for(c in d)if(d[c]===a)return d.splice(c,1)},dispose:function(){k.dispose();qq.each(c,function(a,c){c.dispose()})}})};qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(a,b){},dropError:function(a,b){qq.log("Drag & drop error code '"+a+" with these specifics: '"+b+"'","error")},dropLog:function(a,b){qq.log(a,b)}}};
qq.UploadDropZone=function(a){function b(){return qq.safari()||qq.firefox()&&qq.windows()}function e(a){if(!qq.supportedFeatures.fileDrop)return!1;var c=a.dataTransfer,d=qq.safari();a=qq.ie()&&qq.supportedFeatures.fileDrop?!0:"none"!==c.effectAllowed;return c&&a&&(c.files||!d&&c.types.contains&&c.types.contains("Files"))}function f(a){void 0!==a&&(c=a);return c}function d(){function a(){c=document.createEvent("Event");c.initEvent(k.HIDE_ZONES_EVENT_NAME,!0,!0)}if(window.CustomEvent)try{var c=new CustomEvent(k.HIDE_ZONES_EVENT_NAME)}catch(q){a()}else a();
document.dispatchEvent(c)}var g=new qq.DisposeSupport,c,h;var k={element:null,onEnter:function(a){},onLeave:function(a){},onLeaveNotDescendants:function(a){},onDrop:function(a){}};qq.extend(k,a);var m=k.element;(function(a){h||(b?g.attach(document,"dragover",function(a){a.preventDefault()}):g.attach(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),h=!0)})();(function(){g.attach(m,"dragover",function(a){if(e(a)){var c=qq.ie()&&qq.supportedFeatures.fileDrop?
null:a.dataTransfer.effectAllowed;a.dataTransfer.dropEffect="move"===c||"linkMove"===c?"move":"copy";a.stopPropagation();a.preventDefault()}});g.attach(m,"dragenter",function(a){if(!f()&&e(a))k.onEnter(a)});g.attach(m,"dragleave",function(a){if(e(a)){k.onLeave(a);var c=document.elementFromPoint(a.clientX,a.clientY);if(!qq(this).contains(c))k.onLeaveNotDescendants(a)}});g.attach(m,"drop",function(a){!f()&&e(a)&&(a.preventDefault(),a.stopPropagation(),k.onDrop(a),d())})})();qq.extend(this,{dropDisabled:function(a){return f(a)},
dispose:function(){g.dispose()},getElement:function(){return m}})};
qq.DeleteFileAjaxRequester=function(a){var b={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(a){return{}},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(a,d){},onDelete:function(a){},onDeleteComplete:function(a,d,b){}};qq.extend(b,a);var e=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:b.method,endpointStore:b.endpointStore,paramsStore:b.paramsStore,mandatedParams:"POST"===
b.method.toUpperCase()?{_method:"DELETE"}:{},maxConnections:b.maxConnections,customHeaders:function(a){return b.customHeaders.get(a)},demoMode:b.demoMode,log:b.log,onSend:b.onDelete,onComplete:b.onDeleteComplete,cors:b.cors}));qq.extend(this,{sendDelete:function(a,d,g){g=g||{};b.log("Submitting delete file request for "+a);"DELETE"===b.method?e.initTransport(a).withPath(d).withParams(g).send():(g[b.uuidParamName]=d,e.initTransport(a).withParams(g).send())}})};
(function(){function a(a,d,g){var c=document.createElement("canvas"),e=d.mime||"image/jpeg";b(a,c,d,g);return c.toDataURL(e,d.quality||.8)}function b(a,d,b,c){var g=a.naturalWidth,e=a.naturalHeight,f=b.width,l=b.height,n=d.getContext("2d");n.save();if(!qq.supportedFeatures.unlimitedScaledImageSize){var q=f;var r=l;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");q=5241E3<r*q?{newHeight:Math.round(Math.sqrt(r/q*5241E3)),newWidth:Math.round(Math.sqrt(q/
r*5241E3))}:void 0;q&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",f,l,q.newWidth,q.newHeight),"warn"),f=q.newWidth,l=q.newHeight)}q=f;r=l;b=b.orientation;switch(b){case 5:case 6:case 7:case 8:d.width=r;d.height=q;break;default:d.width=q,d.height=r}var w=d.getContext("2d");switch(b){case 2:w.translate(q,0);w.scale(-1,1);break;case 3:w.translate(q,r);w.rotate(Math.PI);break;case 4:w.translate(0,r);w.scale(1,-1);break;case 5:w.rotate(.5*Math.PI);
w.scale(1,-1);break;case 6:w.rotate(.5*Math.PI);w.translate(0,-r);break;case 7:w.rotate(.5*Math.PI);w.translate(q,-r);w.scale(-1,1);break;case 8:w.rotate(-.5*Math.PI),w.translate(-q,0)}if(qq.ios()){b=a.naturalWidth;1048576<b*a.naturalHeight?(q=document.createElement("canvas"),q.width=q.height=1,q=q.getContext("2d"),q.drawImage(a,-b+1,0),b=0===q.getImageData(0,0,1,1).data[3]):b=!1;b&&(g/=2,e/=2);b=document.createElement("canvas");b.width=b.height=1024;q=b.getContext("2d");if(c){c=e;r=document.createElement("canvas");
r.width=1;r.height=c;r=r.getContext("2d");r.drawImage(a,0,0);r=r.getImageData(0,0,1,c).data;w=0;for(var t=c,u=c;u>w;)0===r[4*(u-1)+3]?t=u:w=u,u=t+w>>1;c=u/c;c=0===c?1:c}else c=1;f=Math.ceil(1024*f/g);l=Math.ceil(1024*l/e/c);for(r=c=0;c<e;){for(t=w=0;w<g;)q.clearRect(0,0,1024,1024),q.drawImage(a,-w,-c),n.drawImage(b,0,0,1024,1024,t,r,f,l),w+=1024,t+=f;c+=1024;r+=l}n.restore()}else n.drawImage(a,0,0,f,l);d.qqImageRendered&&d.qqImageRendered()}function e(a,d){if(window.Blob&&a instanceof Blob){var b=
new Image,c=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!c)throw Error("No createObjectURL function found to create blob url");b.src=c.createObjectURL(a);this.blob=a;a=b}if(!a.naturalWidth&&!a.naturalHeight){var e=this;a.onload=function(){var a=e.imageLoadListeners;a&&(e.imageLoadListeners=null,setTimeout(function(){for(var c=0,d=a.length;c<d;c++)a[c]()},0))};a.onerror=d;this.imageLoadListeners=[]}this.srcImage=a}e.prototype.render=
function(e,d){if(this.imageLoadListeners){var g=this;this.imageLoadListeners.push(function(){g.render(e,d)})}else{d=d||{};var c=this.srcImage.naturalWidth,f=this.srcImage.naturalHeight,k=d.width,m=d.height,l=d.maxWidth,n=d.maxHeight,q=!this.blob||"image/jpeg"===this.blob.type;k&&!m?m=f*k/c<<0:m&&!k?k=c*m/f<<0:(k=c,m=f);l&&k>l&&(k=l,m=f*k/c<<0);n&&m>n&&(m=n,k=c*m/f<<0);c={width:k,height:m};for(var r in d)c[r]=d[r];r=e.tagName.toLowerCase();"img"===r?e.src=a(this.srcImage,c,q):"canvas"===r&&b(this.srcImage,
e,c,q);if("function"===typeof this.onrender)this.onrender(e)}};qq.MegaPixImage=e})();
qq.ImageGenerator=function(a){function b(a){return"img"===a.tagName.toLowerCase()}function e(a){return"canvas"===a.tagName.toLowerCase()}function f(a){a=a.split("/");a=(a=qq.getExtension(a[a.length-1]))&&a.toLowerCase();switch(a){case "jpeg":case "jpg":return"image/jpeg";case "png":return"image/png";case "bmp":return"image/bmp";case "gif":return"image/gif";case "tiff":case "tif":return"image/tiff"}}function d(a){var c=document.createElement("a");c.href=a;a=c.protocol;var d=c.port;c=c.hostname;return a.toLowerCase()!==
window.location.protocol.toLowerCase()||c.toLowerCase()!==window.location.hostname.toLowerCase()||d!==window.location.port&&!qq.ie()?!0:!1}function g(c,d){c.onload=function(){c.onload=null;c.onerror=null;d.success(c)};c.onerror=function(){c.onload=null;c.onerror=null;a("Problem drawing thumbnail!","error");d.failure(c,"Problem drawing thumbnail!")}}function c(a,c){a.qqImageRendered=function(){c.success(a)}}function h(d,f){var h=b(d)||e(d);b(d)?g(d,f):e(d)?c(d,f):(f.failure(d),a(qq.format("Element container of type {} is not supported!",
d.tagName),"error"));return h}function k(c,d,b){var g=new qq.Promise,e=new qq.Identify(c,a),f=b.maxSize,k=null==b.orient?!0:b.orient,l=function(){d.onerror=null;d.onload=null;a("Could not render preview, file may be too large!","error");g.failure(d,"Browser cannot render image!")};e.isPreviewable().then(function(b){var e={parse:function(){return(new qq.Promise).success()}};e=k?new qq.Exif(c,a):e;var n=new qq.MegaPixImage(c,l);h(d,g)&&e.parse().then(function(a){n.render(d,{maxWidth:f,maxHeight:f,orientation:a&&
a.Orientation,mime:b})},function(c){a(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",c));n.render(d,{maxWidth:f,maxHeight:f,mime:b})})},function(){a("Not previewable");g.failure(d,"Not previewable")});return g}function m(a,c,b,g){var e=new Image,k=new qq.Promise;h(e,k);d(a)&&(e.crossOrigin="anonymous");e.src=a;k.then(function(){h(c,b);(new qq.MegaPixImage(e)).render(c,{maxWidth:g,maxHeight:g,mime:f(a)})})}function l(a,c,d,b){h(c,d);qq(c).css({maxWidth:b+"px",maxHeight:b+
"px"});c.src=a}qq.extend(this,{generate:function(c,g,f){if(qq.isString(c)){a("Attempting to update thumbnail based on server response.");var n=f||{};f=new qq.Promise;var r=n.scale;n=r?n.maxSize:null;r&&b(g)?(r=document.createElement("canvas"),r.getContext&&r.getContext("2d")?d(c)&&void 0===(new Image).crossOrigin?l(c,g,f,n):m(c,g,f,n):l(c,g,f,n)):e(g)?m(c,g,f,n):h(g,f)&&(g.src=c);return f}a("Attempting to draw client-side image preview.");return k(c,g,f||{})}});this._testing={};this._testing.isImg=
b;this._testing.isCanvas=e;this._testing.isCrossOrigin=d;this._testing.determineMimeOfFileName=f};
qq.Exif=function(a,b){function e(a){for(var c=0,d=0;0<a.length;)c+=parseInt(a.substring(0,2),16)*Math.pow(2,d),a=a.substring(2,a.length),d+=8;return c}function f(c,d){var b=c,g=d;void 0===b&&(b=2,g=new qq.Promise);qq.readBlobToHex(a,b,4).then(function(a){var c=/^ffe([0-9])/.exec(a);c?"1"!==c[1]?(a=parseInt(a.slice(4,8),16),f(b+a+2,g)):g.success(b):g.failure("No EXIF header to be found!")});return g}function d(){var c=new qq.Promise;qq.readBlobToHex(a,0,6).then(function(a){0!==a.indexOf("ffd8")?c.failure("Not a valid JPEG!"):
f().then(function(a){c.success(a)},function(a){c.failure(a)})});return c}function g(c){var d=new qq.Promise;qq.readBlobToHex(a,c+10,2).then(function(a){d.success("4949"===a)});return d}function c(c,d){var b=new qq.Promise;qq.readBlobToHex(a,c+18,2).then(function(a){if(d)return b.success(e(a));b.success(parseInt(a,16))});return b}function h(a,c){var d=qq.extend([],k),b={};qq.each(c,function(c,g){var f=g.slice(0,4),h=a?e(f):parseInt(f,16);f=d.indexOf(h);if(0<=f){var k=m[h].name;h=m[h].bytes;h=g.slice(16,
16+2*h);b[k]=a?e(h):parseInt(h,16);d.splice(f,1)}if(0===d.length)return!1});return b}var k=[274],m={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var e=new qq.Promise,f=function(a){b(qq.format("EXIF header parse failed: '{}' ",a));e.failure(a)};d().then(function(d){b(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===a.name?"blob":a.name));g(d).then(function(g){b(qq.format("EXIF Byte order is {} endian",g?"little":"big"));c(d,g).then(function(c){b(qq.format("Found {} APP1 directory entries",
c));qq.readBlobToHex(a,d+20,12*c).then(function(a){for(var c=[],d=0;d+24<=a.length;)c.push(a.slice(d,d+24)),d+=24;a=h(g,c);b("Successfully parsed some EXIF tags");e.success(a)},f)},f)},f)},f);return e}});this._testing={};this._testing.parseLittleEndian=e};
qq.Identify=function(a,b){function e(a,d){var b=!1,c=[].concat(a);qq.each(c,function(a,c){if(0===d.indexOf(c))return b=!0,!1});return b}qq.extend(this,{isPreviewable:function(){var f=this,d=new qq.Promise,g=!1,c=void 0===a.name?"blob":a.name;b(qq.format("Attempting to determine if {} can be rendered in this browser",c));b("First pass: check type attribute of blob object.");this.isPreviewableSync()?(b("Second pass: check for magic bytes in file header."),qq.readBlobToHex(a,0,4).then(function(a){qq.each(f.PREVIEWABLE_MIME_TYPES,
function(c,b){if(e(b,a)){if("image/tiff"!==c||qq.supportedFeatures.tiffPreviews)g=!0,d.success(c);return!1}});b(qq.format("'{}' is {} able to be rendered in this browser",c,g?"":"NOT"));g||d.failure()},function(){b("Error reading file w/ name '"+c+"'.  Not able to be rendered in this browser.");d.failure()})):d.failure();return d},isPreviewableSync:function(){var e=a.type,d=0<=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),e),g=!1,c=void 0===a.name?"blob":a.name;d&&(g="image/tiff"===e?qq.supportedFeatures.tiffPreviews:
!0);!g&&b(c+" is not previewable in this browser per the blob's type attr");return g}})};qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]};
qq.ImageValidation=function(a,b){function e(a){var c=!1;qq.each(a,function(a,d){if(0<d)return c=!0,!1});return c}function f(){var d=new qq.Promise;(new qq.Identify(a,b)).isPreviewable().then(function(){var c=new Image,g=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;g?(c.onerror=function(){b("Cannot determine dimensions for image.  May be too large.","error");d.failure()},c.onload=function(){d.success({width:this.width,height:this.height})},
c.src=g.createObjectURL(a)):(b("No createObjectURL function available to generate image URL!","error"),d.failure())},d.failure);return d}function d(a,c){var d;qq.each(a,function(a,b){if(0<b){var g=/(max|min)(Width|Height)/.exec(a),e=g[2].charAt(0).toLowerCase()+g[2].slice(1);e=c[e];switch(g[1]){case "min":if(e<b)return d=a,!1;break;case "max":if(e>b)return d=a,!1}}});return d}this.validate=function(a){var c=new qq.Promise;b("Attempting to validate image.");e(a)?f().then(function(b){(b=d(a,b))?c.failure(b):
c.success()},c.success):c.success();return c}};
qq.Session=function(a){function b(a,d,b,c){var g=!1;d&&(qq.isArray(a)?d=!0:(e.log("Session response is not an array.","error"),d=void 0));d&&qq.each(a,function(a,c){if(null==c.uuid)g=!0,e.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",a),"error");else if(null==c.name)g=!0,e.log(qq.format("Session response item {} did not include a valid name - ignoring.",a),"error");else try{return e.addFileRecord(c),!0}catch(l){g=!0,e.log(l.message,"error")}return!1});c[d&&!g?"success":
"failure"](a,b)}var e={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(a){},log:function(a,d){}};qq.extend(e,a,!0);this.refresh=function(){var a=new qq.Promise,d=qq.extend({},e);(new qq.SessionAjaxRequester(qq.extend(d,{onComplete:function(d,c,e){b(d,c,e,a)}}))).queryServer();return a}};
qq.SessionAjaxRequester=function(a){var b={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(a,d,b){},log:function(a,d){}};qq.extend(b,a);var e=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return b.endpoint}},customHeaders:b.customHeaders,log:b.log,onComplete:function(a,d,g){a=null;if(null!=d.responseText)try{a=qq.parseJson(d.responseText)}catch(c){b.log("Problem parsing session response: "+
c.message,"error"),g=!0}b.onComplete(a,!g,d)},cors:b.cors}));qq.extend(this,{queryServer:function(){var a=qq.extend({},b.params);b.log("Session query request.");e.initTransport("sessionRefresh").withParams(a).withCacheBuster().send()}})};
qq.FormSupport=function(a,b,e){function f(a,c){if(a.checkValidity&&!a.checkValidity())e("Form did not pass validation checks - will not upload.","error"),c();else return!0}function d(a){var c=a.submit;qq(a).attach("submit",function(d){d=d||window.event;d.preventDefault?d.preventDefault():d.returnValue=!1;f(a,c)&&b()});a.submit=function(){f(a,c)&&b()}}var g=this,c=a.interceptSubmit,h=a.element;qq.extend(this,{newEndpoint:null,newAutoUpload:a.autoUpload,attachedToForm:!1,getFormInputsAsObject:function(){return null==
h?null:g._form2Obj(h)}});h=function(a){if(a&&(qq.isString(a)&&(a=document.getElementById(a)),a)){e("Attaching to form element.");var b=a;b.getAttribute("action")&&(g.newEndpoint=b.getAttribute("action"));c&&d(a)}return a}(h);this.attachedToForm=!!h};
qq.extend(qq.FormSupport.prototype,{_form2Obj:function(a){var b={},e=function(a){return 0<=qq.indexOf(["checkbox","radio"],a.type.toLowerCase())&&!a.checked?!0:a.disabled&&"hidden"!==a.type.toLowerCase()},f=function(a){var d=null;qq.each(qq(a).children(),function(a,b){if("option"===b.tagName.toLowerCase()&&b.selected)return d=b.value,!1});return d};qq.each(a.elements,function(a,g){var c;if(c=qq.isInput(g,!0)||"textarea"===g.tagName.toLowerCase())c=0>qq.indexOf(["button","image","reset","submit"],
g.type.toLowerCase());c&&!e(g)?b[g.name]=g.value:"select"!==g.tagName.toLowerCase()||e(g)||(c=f(g),null!==c&&(b[g.name]=c))});return b}});
qq.Scaler=function(a,b){var e=a.sendOriginal,f=a.orient,d=a.defaultType,g=a.defaultQuality/100,c=a.failureText,h=a.includeExif,k=this._getSortedSizes(a.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&0<k.length,getFileRecords:function(a,l,n){var m=this,r=[],w=n.blob?n.blob:n;(new qq.Identify(w,b)).isPreviewableSync()?(qq.each(k,function(a,e){var k=m._determineOutputType({defaultType:d,requestedType:e.type,refType:w.type});r.push({uuid:qq.getUniqueId(),name:m._getName(l,{name:e.name,type:k,
refType:w.type}),blob:new qq.BlobProxy(w,qq.bind(m._generateScaledImage,m,{maxSize:e.maxSize,orient:f,type:k,quality:g,failedText:c,includeExif:h,log:b}))})}),e&&r.push({uuid:a,name:l,blob:w})):r.push({uuid:a,name:l,blob:w});return r},handleNewFile:function(a,c,d,b,g,e,f,h){var k=[],l=null,n=h.addFileToHandler,m=h.uploadData,r=h.paramsStore,q=qq.getUniqueId();qq.each(this.getFileRecords(d,c,a),function(c,d){var f=a,h=b;d.blob instanceof qq.BlobProxy&&(f=d.blob,h=-1);h=m.addFile({uuid:d.uuid,name:d.name,
size:h,batchId:e,proxyGroupId:q});d.blob instanceof qq.BlobProxy?k.push(h):l=h;n(h,f);g.push({id:h,file:f})});null!==l&&(qq.each(k,function(a,c){var d={qqparentuuid:m.retrieve({id:l}).uuid,qqparentsize:m.retrieve({id:l}).size};d[f]=m.retrieve({id:c}).uuid;m.setParentId(c,l);r.addReadOnly(c,d)}),k.length&&function(){var a={};a[f]=m.retrieve({id:l}).uuid;r.addReadOnly(l,a)}())}})};
qq.extend(qq.Scaler.prototype,{scaleImage:function(a,b,e){if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var f=new qq.Promise,d=e.log,g=e.getFile(a),c=(e=e.uploadData.retrieve({id:a}))&&e.name,h=e&&e.uuid,k=new qq.Scaler({sendOriginal:!1,orient:b.orient,defaultType:b.type||null,defaultQuality:b.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:b.maxSize}]},d);qq.Scaler&&qq.supportedFeatures.imagePreviews&&g?qq.bind(function(){var b=
k.getFileRecords(h,c,g)[0];b&&b.blob instanceof qq.BlobProxy?b.blob.create().then(f.success,f.failure):(d(a+" is not a scalable image!","error"),f.failure())},this)():(f.failure(),d("Could not generate requested scaled image for "+a+".  Scaling is either not possible in this browser, or the file could not be located.","error"));return f},_determineOutputType:function(a){var b=a.requestedType,e=a.defaultType;a=a.refType;return e||b?b?0<=qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),
b)?"image/tiff"===b?qq.supportedFeatures.tiffPreviews?b:e:b:e:e:"image/jpeg"!==a?"image/png":a},_getName:function(a,b){var e=a.lastIndexOf("."),f=b.type||"image/png",d=b.refType,g=qq.getExtension(a),c="";b.name&&b.name.trim().length&&(c=" ("+b.name+")");0<=e?(e=a.substr(0,e),d!==f&&(g=f.split("/")[1]),e+=c+"."+g):e=a+c;return e},_getSortedSizes:function(a){a=qq.extend([],a);return a.sort(function(a,e){return a.maxSize>e.maxSize?1:a.maxSize<e.maxSize?-1:0})},_generateScaledImage:function(a,b){var e=
this,f=a.log,d=a.maxSize,g=a.orient,c=a.type,h=a.quality,k=a.failedText,m=a.includeExif&&"image/jpeg"===b.type&&"image/jpeg"===c,l=new qq.Promise,n=new qq.ImageGenerator(f),q=document.createElement("canvas");f("Attempting to generate scaled version for "+b.name);n.generate(b,q,{maxSize:d,orient:g}).then(function(){var a=q.toDataURL(c,h),d=function(){f("Success generating scaled version for "+b.name);var c=e._dataUriToBlob(a);l.success(c)};m?e._insertExifHeader(b,a,f).then(function(c){a=c;d()},function(){f("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.",
"error");d()}):d()},function(){f("Failed attempt to generate scaled version for "+b.name,"error");l.failure(k)});return l},_insertExifHeader:function(a,b,e){var f=new FileReader,d=new qq.Promise,g="";f.onload=function(){g=f.result;d.success(ExifRestorer.restore(g,b))};f.onerror=function(){e("Problem reading "+a.name+" during attempt to transfer EXIF data to scaled version.","error");d.failure()};f.readAsDataURL(a);return d},_dataUriToBlob:function(a){var b=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):
decodeURI(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];var e=new ArrayBuffer(b.length);var f=new Uint8Array(e);qq.each(b,function(a,b){f[a]=b.charCodeAt(0)});return this._createBlob(e,a)},_createBlob:function(a,b){var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return(e=e&&new e)?(e.append(a),e.getBlob(b)):new Blob([a],{type:b})}});
var ExifRestorer=function(){return{KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(a){var b="",e=0;do{var f=a[e++];var d=a[e++];var g=a[e++];var c=f>>2;f=(f&3)<<4|d>>4;var h=(d&15)<<2|g>>6;var k=g&63;isNaN(d)?h=k=64:isNaN(g)&&(k=64);b=b+this.KEY_STR.charAt(c)+this.KEY_STR.charAt(f)+this.KEY_STR.charAt(h)+this.KEY_STR.charAt(k)}while(e<a.length);return b},restore:function(a,b){if(!a.match("data:image/jpeg;base64,"))return b;var e=this.decode64(a.replace("data:image/jpeg;base64,",
""));e=this.slice2Segments(e);e=this.exifManipulation(b,e);return"data:image/jpeg;base64,"+this.encode64(e)},exifManipulation:function(a,b){var e=this.getExifArray(b);e=this.insertExif(a,e);return new Uint8Array(e)},getExifArray:function(a){for(var b,e=0;e<a.length;e++)if(b=a[e],255==b[0]&225==b[1])return b;return[]},insertExif:function(a,b){var e=a.replace("data:image/jpeg;base64,",""),f=this.decode64(e),d=f.indexOf(255,3);e=f.slice(0,d);f=f.slice(d);e=e.concat(b);return e=e.concat(f)},slice2Segments:function(a){for(var b=
0,e=[];!(255==a[b]&218==a[b+1]);){if(255==a[b]&216==a[b+1])b+=2;else{var f=b+(256*a[b+2]+a[b+3])+2;b=a.slice(b,f);e.push(b);b=f}if(b>a.length)break}return e},decode64:function(a){var b=0,e=[];if(/[^A-Za-z0-9\+\/=]/g.exec(a))throw Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var f=this.KEY_STR.indexOf(a.charAt(b++));var d=this.KEY_STR.indexOf(a.charAt(b++));var g=this.KEY_STR.indexOf(a.charAt(b++));
var c=this.KEY_STR.indexOf(a.charAt(b++));f=f<<2|d>>4;d=(d&15)<<4|g>>2;var h=(g&3)<<6|c;e.push(f);64!=g&&e.push(d);64!=c&&e.push(h)}while(b<a.length);return e}}}();
qq.TotalProgress=function(a,b){var e={},f=0,d=0,g=-1,c=-1,h=function(d,b){d===g&&b===c||a(d,b);g=d;c=b},k=function(a,c){var d=!0;qq.each(a,function(a,b){if(0<=qq.indexOf(c,b))return d=!1});return d},m=function(a){var c=b(a);0<c&&(l(a,0,c),e[a]={loaded:0,total:c})},l=function(a,c,b){var g=e[a]?e[a].loaded:0;a=e[a]?e[a].total:0;-1===c&&-1===b?(f-=g,d-=a):(c&&(f+=c-g),b&&(d+=b-a));h(f,d)};qq.extend(this,{onAllComplete:function(a,c,b){if(0===c.length||k(c,b))h(d,d),this.reset()},onStatusChange:function(a,
c,d){d===qq.status.CANCELED||d===qq.status.REJECTED?(l(a,-1,-1),delete e[a]):d===qq.status.SUBMITTING&&m(a)},onIndividualProgress:function(a,c,d){l(a,c,d);e[a]={loaded:c,total:d}},onNewSize:function(a){m(a)},reset:function(){e={};d=f=0}})};
qq.UiEventHandler=function(a,b){function e(a){f.attach(a,d.eventType,function(a){a=a||window.event;d.onHandled(a.target||a.srcElement,a)})}var f=new qq.DisposeSupport,d={eventType:"click",attachTo:null,onHandled:function(a,c){}};qq.extend(this,{addHandler:function(a){e(a)},dispose:function(){f.dispose()}});qq.extend(b,{getFileIdFromItem:function(a){return a.qqFileId},getDisposeSupport:function(){return f}});qq.extend(d,a);d.attachTo&&e(d.attachTo)};
qq.FileButtonsClickHandler=function(a){var b={templating:null,log:function(a,d){},onDeleteFile:function(a){},onCancel:function(a){},onRetry:function(a){},onPause:function(a){},onContinue:function(a){},onGetName:function(a){}},e={cancel:function(a){b.onCancel(a)},retry:function(a){b.onRetry(a)},deleteButton:function(a){b.onDeleteFile(a)},pause:function(a){b.onPause(a)},continueButton:function(a){b.onContinue(a)}};qq.extend(b,a);b.eventType="click";b.onHandled=function(a,d){qq.each(e,function(g,c){var e=
g.charAt(0).toUpperCase()+g.slice(1);if(b.templating["is"+e](a))return e=b.templating.getFileId(a),qq.preventDefault(d),b.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",b.onGetName(e),e)),c(e),!1})};b.attachTo=b.templating.getFileList();qq.extend(this,new qq.UiEventHandler(b,{}))};
qq.FilenameClickHandler=function(a){var b={},e={templating:null,log:function(a,d){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(a){},onGetName:function(a){}};qq.extend(e,a);e.eventType="click";e.onHandled=function(a,d){if(e.templating.isFileName(a)||e.templating.isEditIcon(a)){var g=e.templating.getFileId(a);e.onGetUploadStatus(g)===qq.status.SUBMITTED&&(e.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",e.onGetName(g),g)),
qq.preventDefault(d),b.handleFilenameEdit(g,a,!0))}};qq.extend(this,new qq.FilenameEditHandler(e,b))};
qq.FilenameInputFocusInHandler=function(a,b){var e={templating:null,onGetUploadStatus:function(a){},log:function(a,d){}};b||(b={});e.eventType="focusin";e.onHandled=function(a,d){if(e.templating.isEditInput(a)){var g=e.templating.getFileId(a);e.onGetUploadStatus(g)===qq.status.SUBMITTED&&(e.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",e.onGetName(g),g)),b.handleFilenameEdit(g,a))}};qq.extend(e,a);qq.extend(this,new qq.FilenameEditHandler(e,b))};
qq.FilenameInputFocusHandler=function(a){a.eventType="focus";a.attachTo=null;qq.extend(this,new qq.FilenameInputFocusInHandler(a,{}))};
qq.FilenameEditHandler=function(a,b){function e(a,d){var c=a.value;if(void 0!==c&&0<qq.trimStr(c).length){var b=g.onGetName(d);b=qq.getExtension(b);void 0!==b&&(c=c+"."+b);g.onSetName(d,c)}g.onEditingStatusChange(d,!1)}function f(a,d){b.getDisposeSupport().attach(a,"blur",function(){e(a,d)})}function d(a,d){b.getDisposeSupport().attach(a,"keyup",function(c){13===(c.keyCode||c.which)&&e(a,d)})}var g={templating:null,log:function(a,d){},onGetUploadStatus:function(a){},onGetName:function(a){},onSetName:function(a,
d){},onEditingStatusChange:function(a,d){}};qq.extend(g,a);g.attachTo=g.templating.getFileList();qq.extend(this,new qq.UiEventHandler(g,b));qq.extend(b,{handleFilenameEdit:function(a,b,e){b=g.templating.getEditInput(a);g.onEditingStatusChange(a,!0);var c=g.onGetName(a),h=c.lastIndexOf(".");0<h&&(c=c.substr(0,h));b.value=c;e&&b.focus();f(b,a);d(b,a)}})};
(function(a){function b(a){a=g(a||{});var c=e("uploaderType",void 0);var b=e("endpointType",void 0);c?(c=c.charAt(0).toUpperCase()+c.slice(1).toLowerCase(),c=b?new qq[b]["FineUploader"+c](a):new qq["FineUploader"+c](a)):c=b?new qq[b].FineUploader(a):new qq.FineUploader(a);f(c);d(a,c);return k}function e(a,c){var d=k.data("fineuploader");if(c)void 0===d&&(d={}),d[a]=c,k.data("fineuploader",d);else return void 0===d?null:d[a]}function f(a){return e("uploader",a)}function d(c,d){var b=c.callbacks={};
a.each(d._options.callbacks,function(c,d){var e=/^on(\w+)/.exec(c)[1];e=e.substring(0,1).toLowerCase()+e.substring(1);var g=k;b[c]=function(){var c=Array.prototype.slice.call(arguments),b=[];a.each(c,function(a,c){b.push(h(c))});c=d.apply(this,c);try{var f=g.triggerHandler(e,b)}catch(F){qq.log("Caught error in Fine Uploader jQuery event handler: "+F.message,"error")}return null!=c?c:f}});d._options.callbacks=b}function g(c,d){var b;var f=void 0===d?"basic"!==c.uploaderType?{element:k[0]}:{}:d;a.each(c,
function(c,d){0<=a.inArray(c,m)?e(c,d):d instanceof a?f[c]=d[0]:a.isPlainObject(d)?(f[c]={},g(d,f[c])):a.isArray(d)?(b=[],a.each(d,function(c,d){var e={};d instanceof a?a.merge(b,d):a.isPlainObject(d)?(g(d,e),b.push(e)):b.push(d)}),f[c]=b):f[c]=d});if(void 0===d)return f}function c(a){var c=[],d=Array.prototype.slice.call(arguments,1);g(d,c);c=f()[a].apply(f(),c);return h(c)}function h(c){var d=c;null==c||"object"!==typeof c||1!==c.nodeType&&9!==c.nodeType||!c.cloneNode||(d=a(c));return d}var k,m=
["uploaderType","endpointType"];a.fn.fineUploader=function(d){var e=this,g=arguments,h=[];this.each(function(l,n){k=a(n);var m;if(m=f())m=d,m="string"===a.type(m)&&!m.match(/^_/)&&void 0!==f()[m];if(m){if(h.push(c.apply(e,g)),1===e.length)return!1}else"object"!==typeof d&&d?a.error("Method "+d+" does not exist on jQuery.fineUploader"):b.apply(e,g)});return 1===h.length?h[0]:1<h.length?h:this}})(jQuery);
(function(a){function b(a){a||(a={});a.dropZoneElements=[c];a=d(a);f(a);e(new qq.DragAndDrop(a));return c}function e(a){var d=c.data("fineUploaderDnd");a?(void 0===d&&(d={}),d.dndInstance=a,c.data("fineUploaderDnd",d),a=void 0):a=void 0===d?null:d.dndInstance;return a}function f(d){var b=d.callbacks={};a.each(new qq.DragAndDrop.callbacks,function(a,d){var e=c;b[a]=function(){var c=Array.prototype.slice.call(arguments);return e.triggerHandler(a,c)}})}function d(c,b){var e;var g=void 0===b?{}:b;a.each(c,
function(c,b){b instanceof a?g[c]=b[0]:a.isPlainObject(b)?(g[c]={},d(b,g[c])):a.isArray(b)?(e=[],a.each(b,function(c,d){d instanceof a?a.merge(e,d):e.push(d)}),g[c]=e):g[c]=b});if(void 0===b)return g}function g(a){var c=[],b=Array.prototype.slice.call(arguments,1);d(b,c);return e()[a].apply(e(),c)}var c;a.fn.fineUploaderDnd=function(d){var f=this,h=arguments,l=[];this.each(function(k,m){c=a(m);var n;if(n=e())n=d,n="string"===a.type(n)&&"dispose"===n&&void 0!==e()[n];if(n){if(l.push(g.apply(f,h)),
1===f.length)return!1}else"object"!==typeof d&&d?a.error("Method "+d+" does not exist in Fine Uploader's DnD module."):b.apply(f,h)});return 1===l.length?l[0]:1<l.length?l:this}})(jQuery);
(function(a){var b=a.fn.hover,e=function(b,d,e){return this.each(function(){var c,g=function(a,d,b){c=c?window.clearTimeout(c):window.setTimeout(function(){c=void 0;d.call(a,b)},e)};a(this).on("mouseenter mouseleave",function(a){g(this,"mouseenter"===a.type?b:d,a)})})};a.fn.hover=function(){var a=Array.prototype.slice.call(arguments);return 3===a.length&&"number"===typeof a[2]?e.apply(this,a):2===a.length&&"number"===typeof a[1]?e.call(this,a[0],a[0],a[1]):b.apply(this,a)}})(window.jQuery);
var fabric=fabric||{version:"1.5.0"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom(""),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;
fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";"object"!==typeof JSON&&(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function b(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var c=h[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(a,c){var h,k=f,l=c[a];l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(a));"function"===typeof g&&(l=g.call(c,a,l));switch(typeof l){case "string":return b(l);case "number":return isFinite(l)?String(l):"null";case "boolean":case "null":return String(l);
case "object":if(!l)return"null";f+=d;var m=[];if("[object Array]"===Object.prototype.toString.apply(l)){var t=l.length;for(h=0;h<t;h+=1)m[h]=e(h,l)||"null";var u=0===m.length?"[]":f?"[\n"+f+m.join(",\n"+f)+"\n"+k+"]":"["+m.join(",")+"]";f=k;return u}if(g&&"object"===typeof g)for(t=g.length,h=0;h<t;h+=1){if("string"===typeof g[h]){var x=g[h];(u=e(x,l))&&m.push(b(x)+(f?": ":":")+u)}}else for(x in l)Object.prototype.hasOwnProperty.call(l,x)&&(u=e(x,l))&&m.push(b(x)+(f?": ":":")+u);u=0===m.length?"{}":
f?"{\n"+f+m.join(",\n"+f)+"\n"+k+"}":"{"+m.join(",")+"}";f=k;return u}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f,d,g;if("function"!==typeof JSON.stringify){var c=
/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(a,c,b){var h;d=f="";if("number"===typeof b)for(h=0;h<b;h+=1)d+=" ";else"string"===typeof b&&(d=b);if((g=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return e("",{"":a})}}if("function"!==typeof JSON.parse){var k=
/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;JSON.parse=function(a,c){function d(a,b){var e,g=a[b];if(g&&"object"===typeof g)for(e in g)if(Object.prototype.hasOwnProperty.call(g,e)){var f=d(g,e);void 0!==f?g[e]=f:delete g[e]}return c.call(a,b,g)}a=String(a);k.lastIndex=0;k.test(a)&&(a=a.replace(k,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,
"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var b=eval("("+a+")");return"function"===typeof c?d({"":b},""):b}throw new SyntaxError("JSON.parse");}}})();if("undefined"===typeof eventjs)var eventjs={};
(function(a){a.modifyEventListener=!1;a.modifySelectors=!1;a.configure=function(c){isFinite(c.modifyEventListener)&&(a.modifyEventListener=c.modifyEventListener);isFinite(c.modifySelectors)&&(a.modifySelectors=c.modifySelectors);!1===r&&a.modifyEventListener&&w();!1===t&&a.modifySelectors&&u()};a.add=function(a,c,d,b){return e(a,c,d,b,"add")};a.remove=function(a,c,d,b){return e(a,c,d,b,"remove")};a.returnFalse=function(a){return!1};a.stop=function(a){a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=
!0,a.cancelBubbleCount=0)};a.prevent=function(a){a&&(a.preventDefault?a.preventDefault():a.preventManipulation?a.preventManipulation():a.returnValue=!1)};a.cancel=function(c){a.stop(c);a.prevent(c)};a.blur=function(){var a=document.activeElement;if(a){var c=document.activeElement.nodeName;("INPUT"===c||"TEXTAREA"===c||"true"===a.contentEditable)&&a.blur&&a.blur()}};a.getEventSupport=function(a,c){"string"===typeof a&&(c=a,a=window);c="on"+c;if(c in a)return!0;a.setAttribute||(a=document.createElement("div"));
if(a.setAttribute&&a.removeAttribute){a.setAttribute(c,"");var d="function"===typeof a[c];"undefined"!==typeof a[c]&&(a[c]=null);a.removeAttribute(c);return d}};var b=function(a){if(!a||"object"!==typeof a)return a;var c=new a.constructor,d;for(d in a)c[d]=a[d]&&"object"===typeof a[d]?b(a[d]):a[d];return c},e=function(c,g,m,r,w,t){r=r||{};if("[object Object]"===String(c)){var y=c;c=y.target;delete y.target;if(y.type&&y.listener){g=y.type;delete y.type;m=y.listener;delete y.listener;for(var A in y)r[A]=
y[A]}else{for(var C in y){var x=y[C];"function"!==typeof x&&(r[C]=x)}var u={};for(A in y){C=A.split(",");x=y[A];var B={},v;for(v in r)B[v]=r[v];if("function"===typeof x)m=x;else if("function"===typeof x.listener)for(v in m=x.listener,x)"function"!==typeof x[v]&&(B[v]=x[v]);else continue;for(x=0;x<C.length;x++)u[A]=eventjs.add(c,C[x],m,B,w)}return u}}if(c&&g&&m){if("string"===typeof c&&"ready"===g)if(window.eventjs_stallOnReady)g="load",c=window;else{var z=(new Date).getTime(),D=r.timeout,F=window.setInterval(function(){(new Date).getTime()-
z>D&&window.clearInterval(F);document.querySelector(c)&&(window.clearInterval(F),setTimeout(m,1))},r.interval||1E3/60);return}if("string"===typeof c){c=document.querySelectorAll(c);if(0===c.length)return d("Missing target on listener!",arguments);1===c.length&&(c=c[0])}y={};if(0<c.length&&c!==window){A=0;for(v=c.length;A<v;A++)(C=e(c[A],g,m,b(r),w))&&(y[A]=C);return f(y)}"string"===typeof g&&(g=g.toLowerCase(),-1!==g.indexOf(" ")?g=g.split(" "):-1!==g.indexOf(",")&&(g=g.split(",")));if("string"!==
typeof g){if("number"===typeof g.length)for(A=0,v=g.length;A<v;A++)(C=e(c,g[A],m,b(r),w))&&(y[g[A]]=C);else for(A in g)(C="function"===typeof g[A]?e(c,A,g[A],b(r),w):e(c,A,g[A].listener,b(g[A]),w))&&(y[A]=C);return f(y)}0===g.indexOf("on")&&(g=g.substr(2));if("object"!==typeof c)return d("Target is not defined!",arguments);if("function"!==typeof m)return d("Listener is not a function!",arguments);A=r.useCapture||!1;y=l(c)+"."+l(m)+"."+(A?1:0);if(a.Gesture&&a.Gesture._gestureHandlers[g]){y=g+y;if("remove"===
w){if(!k[y])return;k[y].remove();delete k[y]}else if("add"===w){if(k[y])return k[y].add(),k[y];if(r.useCall&&!a.modifyEventListener){var R=m;m=function(a,d){for(var b in d)a[b]=d[b];return R.call(c,a)}}r.gesture=g;r.target=c;r.listener=m;r.fromOverwrite=t;k[y]=a.proxy[g](r)}return k[y]}var K=h(g);for(x=0;x<K.length;x++)if(g=K[x],u=g+"."+y,"remove"===w)k[u]&&(c[q](g,m,A),delete k[u]);else if("add"===w){if(k[u])break;c[n](g,m,A);k[u]={id:u,type:g,target:c,listener:m,remove:function(){for(var d=0;d<
K.length;d++)a.remove(c,K[d],m,r)}}}return k[u]}},f=function(a){return{remove:function(){for(var c in a)a[c].remove()},add:function(){for(var c in a)a[c].add()}}},d=function(a,c){"undefined"!==typeof console&&"undefined"!==typeof console.error&&console.error(a,c)},g={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]},c={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,
mousemove:1,mouseup:2};a.supports={};window.navigator.msPointerEnabled&&(a.supports.msPointer=!0);a.getEventSupport("touchstart")&&(a.supports.touch=!0);a.getEventSupport("mousedown")&&(a.supports.mouse=!0);var h=function(){return function(d){var b=document.addEventListener?"":"on",e=c[d];if(isFinite(e)){d=[];for(var f in a.supports)d.push(b+g[f][e]);return d}return[b+d]}}(),k={},m=0,l=function(a){if(a===window)return"#window";if(a===document)return"#document";a.uniqueID||(a.uniqueID="e"+m++);return a.uniqueID},
n=document.addEventListener?"addEventListener":"attachEvent",q=document.removeEventListener?"removeEventListener":"detachEvent";a.createPointerEvent=function(c,d,b){var g=d.gesture,e=d.target,f=c.changedTouches||a.proxy.getCoords(c);if(f.length){var h=f[0];d.pointers=b?[]:f;d.pageX=h.pageX;d.pageY=h.pageY;d.x=d.pageX;d.y=d.pageY}b=document.createEvent("Event");b.initEvent(g,!0,!0);b.originalEvent=c;for(var k in d)"target"!==k&&(b[k]=d[k]);c=b.type;a.Gesture&&a.Gesture._gestureHandlers[c]&&d.oldListener.call(e,
b,d,!1)};var r=!1,w=function(){if(window.HTMLElement){var c=function(c){var d=function(d){var b=d+"EventListener",g=c[b];c[b]=function(c,b,f){if(a.Gesture&&a.Gesture._gestureHandlers[c]){var k=f;"object"===typeof f?k.useCall=!0:k={useCall:!0,useCapture:f};e(this,c,b,k,d,!0)}else for(c=h(c),k=0;k<c.length;k++)g.call(this,c[k],b,f)}};d("add");d("remove")};navigator.userAgent.match(/Firefox/)?(c(HTMLDivElement.prototype),c(HTMLCanvasElement.prototype)):c(HTMLElement.prototype);c(document);c(window)}},
t=!1,u=function(){var a=NodeList.prototype;a.removeEventListener=function(a,c,d){for(var b=0,g=this.length;b<g;b++)this[b].removeEventListener(a,c,d)};a.addEventListener=function(a,c,d){for(var b=0,g=this.length;b<g;b++)this[b].addEventListener(a,c,d)}};return a})(eventjs);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.pointerSetup=function(a,d){a.target=a.target||window;a.doc=a.target.ownerDocument||a.target;a.minFingers=a.minFingers||a.fingers||1;a.maxFingers=a.maxFingers||a.fingers||Infinity;a.position=a.position||"relative";delete a.fingers;d=d||{};d.enabled=!0;d.gesture=a.gesture;d.target=a.target;d.env=a.env;eventjs.modifyEventListener&&a.fromOverwrite&&(a.oldListener=a.listener,a.listener=eventjs.createPointerEvent);var b=0,c=0===d.gesture.indexOf("pointer")&&eventjs.modifyEventListener?
"pointer":"mouse";a.oldListener&&(d.oldListener=a.oldListener);d.listener=a.listener;d.proxy=function(c){d.defaultListener=a.listener;a.listener=c;c(a.event,d)};d.add=function(){!0!==d.enabled&&(a.onPointerDown&&eventjs.add(a.target,c+"down",a.onPointerDown),a.onPointerMove&&eventjs.add(a.doc,c+"move",a.onPointerMove),a.onPointerUp&&eventjs.add(a.doc,c+"up",a.onPointerUp),d.enabled=!0)};d.remove=function(){!1!==d.enabled&&(a.onPointerDown&&eventjs.remove(a.target,c+"down",a.onPointerDown),a.onPointerMove&&
eventjs.remove(a.doc,c+"move",a.onPointerMove),a.onPointerUp&&eventjs.remove(a.doc,c+"up",a.onPointerUp),d.reset(),d.enabled=!1)};d.pause=function(d){!a.onPointerMove||d&&!d.move||eventjs.remove(a.doc,c+"move",a.onPointerMove);!a.onPointerUp||d&&!d.up||eventjs.remove(a.doc,c+"up",a.onPointerUp);b=a.fingers;a.fingers=0};d.resume=function(d){!a.onPointerMove||d&&!d.move||eventjs.add(a.doc,c+"move",a.onPointerMove);!a.onPointerUp||d&&!d.up||eventjs.add(a.doc,c+"up",a.onPointerUp);a.fingers=b};d.reset=
function(){a.tracker={};a.fingers=0};return d};var b=eventjs.supports;eventjs.isMouse=!!b.mouse;eventjs.isMSPointer=!!b.touch;eventjs.isTouch=!!b.msPointer;a.pointerStart=function(b,d,g){var c=(b.type||"mousedown").toUpperCase();0===c.indexOf("MOUSE")?(eventjs.isMouse=!0,eventjs.isTouch=!1,eventjs.isMSPointer=!1):0===c.indexOf("TOUCH")?(eventjs.isMouse=!1,eventjs.isTouch=!0,eventjs.isMSPointer=!1):0===c.indexOf("MSPOINTER")&&(eventjs.isMouse=!1,eventjs.isTouch=!1,eventjs.isMSPointer=!0);var e=function(a,
c){var d=g.bbox,b=f[c]={};switch(g.position){case "absolute":b.offsetX=0;b.offsetY=0;break;case "differenceFromLast":b.offsetX=a.pageX;b.offsetY=a.pageY;break;case "difference":b.offsetX=a.pageX;b.offsetY=a.pageY;break;case "move":b.offsetX=a.pageX-d.x1;b.offsetY=a.pageY-d.y1;break;default:b.offsetX=d.x1-d.scrollLeft,b.offsetY=d.y1-d.scrollTop}d=a.pageX-b.offsetX;var e=a.pageY-b.offsetY;b.rotation=0;b.scale=1;b.startTime=b.moveTime=(new Date).getTime();b.move={x:d,y:e};b.start={x:d,y:e};g.fingers++};
g.event=b;d.defaultListener&&(g.listener=d.defaultListener,delete d.defaultListener);c=!g.fingers;var f=g.tracker;b=b.changedTouches||a.getCoords(b);for(var m=b.length,l=0;l<m;l++){var n=b[l],q=n.identifier||Infinity;if(g.fingers){if(g.fingers>=g.maxFingers){var r=[];for(q in g.tracker)r.push(q);d.identifier=r.join(",");return c}var w=0;for(r in f){if(f[r].up){delete f[r];e(n,q);g.cancel=!0;break}w++}if(f[q])continue}else f=g.tracker={},d.bbox=g.bbox=a.getBoundingBox(g.target),g.fingers=0,g.cancel=
!1;e(n,q)}r=[];for(q in g.tracker)r.push(q);d.identifier=r.join(",");return c};a.pointerEnd=function(a,d,b,c){var g=a.touches||[],e=g.length;a={};for(var f=0;f<e;f++){var l=g[f].identifier;a[l||Infinity]=!0}for(l in b.tracker)g=b.tracker[l],a[l]||g.up||(c&&c({pageX:g.pageX,pageY:g.pageY,changedTouches:[{pageX:g.pageX,pageY:g.pageY,identifier:"Infinity"===l?Infinity:l}]},"up"),g.up=!0,b.fingers--);if(0!==b.fingers)return!1;c=[];b.gestureFingers=0;for(l in b.tracker)b.gestureFingers++,c.push(l);d.identifier=
c.join(",");return!0};a.getCoords=function(b){a.getCoords="undefined"!==typeof b.pageX?function(a){return Array({type:"mouse",x:a.pageX,y:a.pageY,pageX:a.pageX,pageY:a.pageY,identifier:a.pointerId||Infinity})}:function(a){var d=document.documentElement;a=a||window.event;return Array({type:"mouse",x:a.clientX+d.scrollLeft,y:a.clientY+d.scrollTop,pageX:a.clientX+d.scrollLeft,pageY:a.clientY+d.scrollTop,identifier:Infinity})};return a.getCoords(b)};a.getCoord=function(b){if("ontouchstart"in window){var d=
0,g=0;a.getCoord=function(a){return(a=a.changedTouches)&&a.length?{x:d=a[0].pageX,y:g=a[0].pageY}:{x:d,y:g}}}else a.getCoord="undefined"!==typeof b.pageX&&"undefined"!==typeof b.pageY?function(a){return{x:a.pageX,y:a.pageY}}:function(a){var c=document.documentElement;a=a||window.event;return{x:a.clientX+c.scrollLeft,y:a.clientY+c.scrollTop}};return a.getCoord(b)};var e=function(a,d){var b=parseFloat(a.getPropertyValue(d),10);return isFinite(b)?b:0};a.getBoundingBox=function(a){if(a===window||a===
document)a=document.body;var d={},b=a.getBoundingClientRect();d.width=b.width;d.height=b.height;d.x1=b.left;d.y1=b.top;d.scaleX=b.width/a.offsetWidth||1;d.scaleY=b.height/a.offsetHeight||1;d.scrollLeft=0;d.scrollTop=0;b=window.getComputedStyle(a);if("border-box"===b.getPropertyValue("box-sizing")===!1){var c=e(b,"border-left-width"),f=e(b,"border-right-width"),k=e(b,"border-bottom-width"),m=e(b,"border-top-width");d.border=[c,f,m,k];d.x1+=c;d.y1+=m;d.width-=f+c;d.height-=k+m}d.x2=d.x1+d.width;d.y2=
d.y1+d.height;b=b.getPropertyValue("position");for(a="fixed"===b?a:a.parentNode;null!==a&&a!==document.body&&void 0!==a.scrollTop;){b=window.getComputedStyle(a);b=b.getPropertyValue("position");if("absolute"!==b)if("fixed"===b){d.scrollTop-=a.parentNode.scrollTop;d.scrollLeft-=a.parentNode.scrollLeft;break}else d.scrollLeft+=a.scrollLeft,d.scrollTop+=a.scrollTop;a=a.parentNode}d.scrollBodyLeft=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;
d.scrollBodyTop=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;d.scrollLeft-=d.scrollBodyLeft;d.scrollTop-=d.scrollBodyTop;return d};(function(){var b=navigator.userAgent.toLowerCase(),d=-1!==b.indexOf("macintosh");var e=d&&-1!==b.indexOf("khtml")?{91:!0,93:!0}:d&&-1!==b.indexOf("firefox")?{224:!0}:{17:!0};(a.metaTrackerReset=function(){eventjs.fnKey=a.fnKey=!1;eventjs.metaKey=a.metaKey=!1;eventjs.escKey=a.escKey=!1;eventjs.ctrlKey=
a.ctrlKey=!1;eventjs.shiftKey=a.shiftKey=!1;eventjs.altKey=a.altKey=!1})();a.metaTracker=function(c){var d="keydown"===c.type;27===c.keyCode&&(eventjs.escKey=a.escKey=d);e[c.keyCode]&&(eventjs.metaKey=a.metaKey=d);eventjs.ctrlKey=a.ctrlKey=c.ctrlKey;eventjs.shiftKey=a.shiftKey=c.shiftKey;eventjs.altKey=a.altKey=c.altKey}})();return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});
eventjs.MutationObserver=function(){var a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,b=!a&&function(){var a=document.createElement("p"),b=!1,d=function(){b=!0};if(a.addEventListener)a.addEventListener("DOMAttrModified",d,!1);else if(a.attachEvent)a.attachEvent("onDOMAttrModified",d);else return!1;a.setAttribute("id","target");return b}();return function(e,f){a?(new a(function(a){a.forEach(function(a){f.call(a.target,a.attributeName)})})).observe(e,{subtree:!1,
attributes:!0}):b?eventjs.add(e,"DOMAttrModified",function(a){f.call(e,a.attrName)}):"onpropertychange"in document.body&&eventjs.add(e,"propertychange",function(a){f.call(e,window.event.propertyName)})}}();"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.click=function(b){b.gesture=b.gesture||"click";b.maxFingers=b.maxFingers||b.fingers||1;b.onPointerDown=function(f){a.pointerStart(f,e,b)&&eventjs.add(b.target,"mouseup",b.onPointerUp)};b.onPointerUp=function(f){if(a.pointerEnd(f,e,b)){eventjs.remove(b.target,"mouseup",b.onPointerUp);var d=(f.changedTouches||a.getCoords(f))[0],g=b.bbox,c=a.getBoundingBox(b.target),h=d.pageY-c.scrollBodyTop;d=d.pageX-c.scrollBodyLeft;if(d>g.x1&&h>g.y1&&d<g.x2&&h<g.y2&&g.scrollTop===c.scrollTop){for(var k in b.tracker)break;
g=b.tracker[k];e.x=g.start.x;e.y=g.start.y;b.listener(f,e)}}};var e=a.pointerSetup(b);e.state="click";eventjs.add(b.target,"mousedown",b.onPointerDown);return e};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.click=a.click;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.dbltap=a.dblclick=function(b){b.gesture=b.gesture||"dbltap";b.maxFingers=b.maxFingers||b.fingers||1;var e,f,d,g,c;b.onPointerDown=function(k){var m=k.changedTouches||a.getCoords(k);e&&!f?(c=m[0],f=(new Date).getTime()-e):(g=m[0],e=(new Date).getTime(),f=0,clearTimeout(d),d=setTimeout(function(){e=0},700));a.pointerStart(k,h,b)&&(eventjs.add(b.target,"mousemove",b.onPointerMove).listener(k),eventjs.add(b.target,"mouseup",b.onPointerUp))};b.onPointerMove=function(h){e&&!f&&
(c=(h.changedTouches||a.getCoords(h))[0]);h=b.bbox;var k=c.pageX-h.x1,l=c.pageY-h.y1;0<k&&k<h.width&&0<l&&l<h.height&&25>=Math.abs(c.pageX-g.pageX)&&25>=Math.abs(c.pageY-g.pageY)||(eventjs.remove(b.target,"mousemove",b.onPointerMove),clearTimeout(d),e=f=0)};b.onPointerUp=function(c){a.pointerEnd(c,h,b)&&(eventjs.remove(b.target,"mousemove",b.onPointerMove),eventjs.remove(b.target,"mouseup",b.onPointerUp));if(e&&f){if(700>=f){h.state=b.gesture;for(var g in b.tracker)break;g=b.tracker[g];h.x=g.start.x;
h.y=g.start.y;b.listener(c,h)}clearTimeout(d);e=f=0}};var h=a.pointerSetup(b);h.state="dblclick";eventjs.add(b.target,"mousedown",b.onPointerDown);return h};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.dbltap=a.dbltap;eventjs.Gesture._gestureHandlers.dblclick=a.dblclick;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.dragElement=function(b,e){a.drag({event:e,target:b,position:"move",listener:function(a,d){b.style.left=d.x+"px";b.style.top=d.y+"px";eventjs.prevent(a)}})};a.drag=function(b){b.gesture="drag";b.onPointerDown=function(f){a.pointerStart(f,e,b)&&!b.monitor&&(eventjs.add(b.doc,"mousemove",b.onPointerMove),eventjs.add(b.doc,"mouseup",b.onPointerUp));b.onPointerMove(f,"down")};b.onPointerMove=function(f,d){if(!b.tracker)return b.onPointerDown(f);for(var g=f.changedTouches||a.getCoords(f),
c=g.length,h=0;h<c;h++){var k=g[h],m=k.identifier||Infinity,l=b.tracker[m];l&&(l.pageX=k.pageX,l.pageY=k.pageY,e.state=d||"move",e.identifier=m,e.start=l.start,e.fingers=b.fingers,"differenceFromLast"===b.position?(e.x=l.pageX-l.offsetX,e.y=l.pageY-l.offsetY,l.offsetX=l.pageX,l.offsetY=l.pageY):(e.x=l.pageX-l.offsetX,e.y=l.pageY-l.offsetY),b.listener(f,e))}};b.onPointerUp=function(f){a.pointerEnd(f,e,b,b.onPointerMove)&&!b.monitor&&(eventjs.remove(b.doc,"mousemove",b.onPointerMove),eventjs.remove(b.doc,
"mouseup",b.onPointerUp))};var e=a.pointerSetup(b);if(b.event)b.onPointerDown(b.event);else eventjs.add(b.target,"mousedown",b.onPointerDown),b.monitor&&(eventjs.add(b.doc,"mousemove",b.onPointerMove),eventjs.add(b.doc,"mouseup",b.onPointerUp));return e};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.drag=a.drag;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});
"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){var b=Math.PI/180,e=function(a,d){var b=0,c=0,e=0,f;for(f in d){var m=d[f];m.up||(b+=m.move.x,c+=m.move.y,e++)}a.x=b/e;a.y=c/e;return a};a.gesture=function(f){f.gesture=f.gesture||"gesture";f.minFingers=f.minFingers||f.fingers||2;f.onPointerDown=function(b){var c=f.fingers;a.pointerStart(b,d,f)&&(eventjs.add(f.doc,"mousemove",f.onPointerMove),eventjs.add(f.doc,"mouseup",f.onPointerUp));if(f.fingers===f.minFingers&&c!==f.fingers){d.fingers=f.minFingers;d.scale=1;d.rotation=
0;d.state="start";c="";for(var g in f.tracker)c+=g;d.identifier=parseInt(c);e(d,f.tracker);f.listener(b,d)}};f.onPointerMove=function(g,c){for(var h=f.bbox,k=f.tracker,m=g.changedTouches||a.getCoords(g),l=m.length,n=0;n<l;n++){var q=m[n],r=q.identifier||Infinity,w=k[r];w&&(w.move.x=q.pageX-h.x1,w.move.y=q.pageY-h.y1)}if(!(f.fingers<f.minFingers)){m=[];l=h=0;e(d,k);for(r in k)if(q=k[r],!q.up){n=q.start;if(!n.distance){w=n.x-d.x;var t=n.y-d.y;n.distance=Math.sqrt(w*w+t*t);n.angle=Math.atan2(w,t)/b}w=
q.move.x-d.x;t=q.move.y-d.y;h+=Math.sqrt(w*w+t*t)/n.distance;n=(n.angle-Math.atan2(w,t)/b+360)%360-180;q.DEG2=q.DEG1;q.DEG1=0<n?n:-n;"undefined"!==typeof q.DEG2&&(q.rotation=0<n?q.rotation+(q.DEG1-q.DEG2):q.rotation-(q.DEG1-q.DEG2),l+=q.rotation);m.push(q.move)}d.touches=m;d.fingers=f.fingers;d.scale=h/f.fingers;d.rotation=l/f.fingers;d.state="change";f.listener(g,d)}};f.onPointerUp=function(b){var c=f.fingers;a.pointerEnd(b,d,f)&&(eventjs.remove(f.doc,"mousemove",f.onPointerMove),eventjs.remove(f.doc,
"mouseup",f.onPointerUp));c===f.minFingers&&f.fingers<f.minFingers&&(d.fingers=f.fingers,d.state="end",f.listener(b,d))};var d=a.pointerSetup(f);eventjs.add(f.target,"mousedown",f.onPointerDown);return d};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.gesture=a.gesture;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.pointerdown=a.pointermove=a.pointerup=function(b){b.gesture=b.gesture||"pointer";if(!b.target.isPointerEmitter){var e=!0;b.onPointerDown=function(a){e=!1;f.gesture="pointerdown";b.listener(a,f)};b.onPointerMove=function(a){f.gesture="pointermove";b.listener(a,f,e)};b.onPointerUp=function(a){e=!0;f.gesture="pointerup";b.listener(a,f,!0)};var f=a.pointerSetup(b);eventjs.add(b.target,"mousedown",b.onPointerDown);eventjs.add(b.target,"mousemove",b.onPointerMove);eventjs.add(b.doc,
"mouseup",b.onPointerUp);b.target.isPointerEmitter=!0;return f}};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.pointerdown=a.pointerdown;eventjs.Gesture._gestureHandlers.pointermove=a.pointermove;eventjs.Gesture._gestureHandlers.pointerup=a.pointerup;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.shake=function(a){var b={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:a.target,listener:a.listener,remove:function(){window.removeEventListener("devicemotion",c,!1)}},f=(new Date).getTime(),d={x:0,y:0,z:0},g={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},c=function(c){var e=c.accelerationIncludingGravity;d.x=.8*d.x+(1-.8)*e.x;d.y=.8*d.y+(1-.8)*e.y;d.z=.8*d.z+(1-.8)*e.z;b.accelerationIncludingGravity=d;b.acceleration.x=e.x-
d.x;b.acceleration.y=e.y-d.y;b.acceleration.z=e.z-d.z;if("devicemotion"===a.gesture)a.listener(c,b);else{e=(new Date).getTime();for(var h=0;3>h;h++){var l="xyz"[h],n=b.acceleration[l];l=g[l];var q=Math.abs(n);!(1E3>e-f)&&4<q&&(n=e*n/q,q=Math.abs(n+l.value),l.value&&200>q?(l.value=n,l.count++,3===l.count&&(a.listener(c,b),f=e,l.value=0,l.count=0)):(l.value=n,l.count=1))}}};if(window.addEventListener)return window.addEventListener("devicemotion",c,!1),b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=
eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.shake=a.shake;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){var b=Math.PI/180;a.swipe=function(e){e.snap=e.snap||90;e.threshold=e.threshold||1;e.gesture=e.gesture||"swipe";e.onPointerDown=function(d){a.pointerStart(d,f,e)&&(eventjs.add(e.doc,"mousemove",e.onPointerMove).listener(d),eventjs.add(e.doc,"mouseup",e.onPointerUp))};e.onPointerMove=function(d){d=d.changedTouches||a.getCoords(d);for(var b=d.length,c=0;c<b;c++){var f=d[c],k=e.tracker[f.identifier||Infinity];k&&(k.move.x=f.pageX,k.move.y=f.pageY,k.moveTime=(new Date).getTime())}};
e.onPointerUp=function(d){if(a.pointerEnd(d,f,e)){eventjs.remove(e.doc,"mousemove",e.onPointerMove);eventjs.remove(e.doc,"mouseup",e.onPointerUp);var g={x:0,y:0},c=0,h=0,k=0;for(t in e.tracker){var m=e.tracker[t];var l=m.move.x-m.start.x;var n=m.move.y-m.start.y;c+=m.move.x;h+=m.move.y;g.x+=m.start.x;g.y+=m.start.y;k++;var q=Math.sqrt(l*l+n*n);m=m.moveTime-m.startTime;l=Math.atan2(l,n)/b+180;q=m?q/m:0;if("undefined"===typeof r){var r=l;var w=q}else if(20>=Math.abs(l-r))r=(r+l)/2,w=(w+q)/2;else return}var t=
e.gestureFingers;e.minFingers<=t&&e.maxFingers>=t&&w>e.threshold&&(g.x/=k,g.y/=k,f.start=g,f.x=c/k,f.y=h/k,f.angle=-(((r/e.snap+.5>>0)*e.snap||360)-360),f.velocity=w,f.fingers=t,f.state="swipe",e.listener(d,f))}};var f=a.pointerSetup(e);eventjs.add(e.target,"mousedown",e.onPointerDown);return f};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.swipe=a.swipe;return a}(eventjs.proxy);
"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.longpress=function(b){b.gesture="longpress";return a.tap(b)};a.tap=function(b){b.delay=b.delay||500;b.timeout=b.timeout||250;b.driftDeviance=b.driftDeviance||10;b.gesture=b.gesture||"tap";var e,f;b.onPointerDown=function(g){a.pointerStart(g,d,b)&&(e=(new Date).getTime(),eventjs.add(b.doc,"mousemove",b.onPointerMove).listener(g),eventjs.add(b.doc,"mouseup",b.onPointerUp),"longpress"===b.gesture&&(f=setTimeout(function(){if(!(g.cancelBubble&&1<++g.cancelBubbleCount)){var a=
0,e;for(e in b.tracker){var f=b.tracker[e];if(!0===f.end||b.cancel)return;a++}b.minFingers<=a&&b.maxFingers>=a&&(d.state="start",d.fingers=a,d.x=f.start.x,d.y=f.start.y,b.listener(g,d))}},b.delay)))};b.onPointerMove=function(d){var c=b.bbox;d=d.changedTouches||a.getCoords(d);for(var e=d.length,g=0;g<e;g++){var f=d[g],l=b.tracker[f.identifier||Infinity];if(l){var n=f.pageX-c.x1;f=f.pageY-c.y1;var q=n-l.start.x;l=f-l.start.y;l=Math.sqrt(q*q+l*l);if(!(0<n&&n<c.width&&0<f&&f<c.height&&l<=b.driftDeviance)){eventjs.remove(b.doc,
"mousemove",b.onPointerMove);b.cancel=!0;break}}}};b.onPointerUp=function(g){if(a.pointerEnd(g,d,b)&&(clearTimeout(f),eventjs.remove(b.doc,"mousemove",b.onPointerMove),eventjs.remove(b.doc,"mouseup",b.onPointerUp),!(g.cancelBubble&&1<++g.cancelBubbleCount)))if("longpress"===b.gesture)"start"===d.state&&(d.state="end",b.listener(g,d));else if(!(b.cancel||(new Date).getTime()-e>b.timeout)){var c=b.gestureFingers;b.minFingers<=c&&b.maxFingers>=c&&(d.state="tap",d.fingers=b.gestureFingers,b.listener(g,
d))}};var d=a.pointerSetup(b);eventjs.add(b.target,"mousedown",b.onPointerDown);return d};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.tap=a.tap;eventjs.Gesture._gestureHandlers.longpress=a.longpress;return a}(eventjs.proxy);"undefined"===typeof eventjs&&(eventjs={});"undefined"===typeof eventjs.proxy&&(eventjs.proxy={});
eventjs.proxy=function(a){a.wheelPreventElasticBounce=function(a){a&&("string"===typeof a&&(a=document.querySelector(a)),eventjs.add(a,"wheel",function(a,b){b.preventElasticBounce();eventjs.stop(a)}))};a.wheel=function(a){var b,f=a.timeout||150,d=0,g={gesture:"wheel",state:"start",wheelDelta:0,target:a.target,listener:a.listener,preventElasticBounce:function(a){var c=this.target,d=c.scrollTop;d+c.offsetHeight===c.scrollHeight&&0>=this.wheelDelta?eventjs.cancel(a):0===d&&0<=this.wheelDelta&&eventjs.cancel(a);
eventjs.stop(a)},add:function(){a.target[h](m,c,!1)},remove:function(){a.target[k](m,c,!1)}},c=function(c){c=c||window.event;g.state=d++?"change":"start";g.wheelDelta=c.detail?-20*c.detail:c.wheelDelta;a.listener(c,g);clearTimeout(b);b=setTimeout(function(){d=0;g.state="end";g.wheelDelta=0;a.listener(c,g)},f)},h=document.addEventListener?"addEventListener":"attachEvent",k=document.removeEventListener?"removeEventListener":"detachEvent",m=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";
a.target[h](m,c,!1);return g};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.wheel=a.wheel;return a}(eventjs.proxy);if("undefined"===typeof Event)var Event={};"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(a){a.orientation=function(a){var b={gesture:"orientationchange",previous:null,current:window.orientation,target:a.target,listener:a.listener,remove:function(){window.removeEventListener("orientationchange",f,!1)}},f=function(d){b.previous=b.current;b.current=window.orientation;null!==b.previous&&b.previous!=b.current&&a.listener(d,b)};window.DeviceOrientationEvent&&window.addEventListener("orientationchange",f,!1);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=a.orientation;return a}(Event.proxy);
(function(){function a(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function b(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function e(d,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var c in d)a.call(this,c,d[c]);else a.call(this,d,b);return this}}function f(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;d<e;d++)c[d].call(this,b||{});return this}}}fabric.Observable={observe:b,stopObserving:e,fire:f,on:b,off:e,trigger:f}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;a<b;a++)this._onObjectAdded(arguments[a]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(a,b,e){var f=this.getObjects();e?f[b]=a:f.splice(b,0,a);this._onObjectAdded(a);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var a=this.getObjects(),b,e=0,f=arguments.length;e<f;e++)b=a.indexOf(arguments[e]),-1!==b&&(a.splice(b,1),this._onObjectRemoved(arguments[e]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(a,b){for(var e=this.getObjects(),f=e.length;f--;)a.call(b,e[f],f,e);return this},getObjects:function(a){return"undefined"===typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return-1<this.getObjects().indexOf(a)},complexity:function(){return this.getObjects().reduce(function(a,
b){return a+=b.complexity?b.complexity():0},0)}};
(function(a){var b=Math.sqrt,e=Math.atan2,f=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(a,b,c){var d=Math.sin(c);c=Math.cos(c);a.subtractEquals(b);return(new fabric.Point(a.x*c-a.y*d,a.x*d+a.y*c)).addEquals(b)},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*
a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){a.slice();var d=1/(a[0]*a[3]-a[1]*a[2]);d=[d*a[3],-d*a[1],-d*a[2],d*a[0],0,0];a=fabric.util.transformPoint({x:a[4],y:a[5]},d);d[4]=-a.x;d[5]=-a.y;return d},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(c[0]){case "mm":return d*fabric.DPI/25.4;case "cm":return d*
fabric.DPI/2.54;case "in":return d*fabric.DPI;case "pt":return d*fabric.DPI/72;case "pc":return d*fabric.DPI/72*12;case "em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(d){if(!d)return fabric;d=d.split(".");for(var b=d.length,c=a||fabric.window,e=0;e<b;++e)c=c[d[e]];return c},loadImage:function(a,b,c,e){if(a){var d=fabric.util.createImage();
d.onload=function(){b&&b.call(c,d);d=d.onload=d.onerror=null};d.onerror=function(){fabric.log("Error loading "+d.src);b&&b.call(c,null,!0);d=d.onload=d.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof e&&(d.crossOrigin=e);d.src=a}else b&&b.call(c,a)},enlivenObjects:function(a,b,c,e){function d(){++f===h&&b&&b(g)}a=a||[];var g=[],f=0,h=a.length;h?a.forEach(function(a,b){if(a&&a.type){var f=fabric.util.getKlass(a.type,c);f.async?f.fromObject(a,function(c,f){f||(g[b]=c,e&&e(a,g[b]));d()}):(g[b]=
f.fromObject(a),e&&e(a,g[b]),d())}else d()}):b&&b(g)},groupSVGElements:function(a,b,c){a=new fabric.PathGroup(a,b);"undefined"!==typeof c&&a.setSourcePath(c);return a},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;d<e;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,g,c,f,k,m){f-=g;var d=k-c;k=b(f*f+d*d);f=e(d,f);d=m.length;var h=0,q=!0;a.save();a.translate(g,c);a.moveTo(0,0);a.rotate(f);for(g=0;k>g;)g+=m[h++%d],
g>k&&(g=k),a[q?"lineTo":"moveTo"](g,0),q=!q;a.restore()},createCanvasElement:function(a){a||(a=fabric.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var d=a.stateProperties.length;d--;){var c=a.stateProperties[d],b=c.charAt(0).toUpperCase()+c.slice(1),
e="set"+b;b="get"+b;a[b]||(a[b]=new Function('return this.get("'+c+'")'));a[e]||(a[e]=new Function("value",'return this.set("'+c+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,
b,c,e){0<e&&(b=b>e?b-e:0,c=c>e?c-e:0);var d=!0;a=a.getImageData(b,c,2*e||1,2*e||1);b=3;for(c=a.data.length;b<c&&(d=0>=a.data[b],!1!==d);b+=4);return d}}})("undefined"!==typeof exports?exports:this);
(function(){function a(a,c,g,f,q,r,w){var k=h.call(arguments);if(d[k])return d[k];var l=Math.PI,n=w*l/180,m=Math.sin(n);n=Math.cos(n);var D=0,F=0;g=Math.abs(g);f=Math.abs(f);var z=-n*a*.5-m*c*.5,v=-n*c*.5+m*a*.5,y=g*g,A=f*f,C=v*v,H=z*z,G=y*A-y*C-A*H,P=0;0>G?(y=Math.sqrt(1-G/(y*A)),g*=y,f*=y):P=(q===r?-1:1)*Math.sqrt(G/(y*C+A*H));C=P*g*v/f;H=-P*f*z/g;P=n*C-m*H+.5*a;y=m*C+n*H+.5*c;A=e(1,0,(z-C)/g,(v-H)/f);v=e((z-C)/g,(v-H)/f,(-z-C)/g,(-v-H)/f);0===r&&0<v?v-=2*l:1===r&&0>v&&(v+=2*l);l=Math.ceil(Math.abs(v/
l*2));z=[];v/=l;C=8/3*Math.sin(v/4)*Math.sin(v/4)/Math.sin(v/2);H=A+v;for(G=0;G<l;G++)z[G]=b(A,H,n,m,g,f,P,y,C,D,F),D=z[G][4],F=z[G][5],A=H,H+=v;return d[k]=z}function b(a,c,d,b,e,f,w,t,u,x,B){var k=h.call(arguments);if(g[k])return g[k];var l=Math.cos(a),n=Math.sin(a),m=Math.cos(c),r=Math.sin(c),q=d*e*m-b*f*r+w,C=b*e*m+d*f*r+t;g[k]=[x+u*(-d*e*n-b*f*l),B+u*(-b*e*n+d*f*l),q+u*(d*e*r+b*f*m),C+u*(b*e*r-d*f*m),q,C];return g[k]}function e(a,c,d,b){a=Math.atan2(c,a);d=Math.atan2(b,d);return d>=a?d-a:2*Math.PI-
(a-d)}function f(a,d,b,e,g,f,w,t){var k=h.call(arguments);if(c[k])return c[k];var l=Math.sqrt,n=Math.min,m=Math.max,r=Math.abs,q=[],v=[[],[]];var y=6*a-12*b+6*g;var A=-3*a+9*b-9*g+3*w;var C=3*b-3*a;for(var H=0;2>H;++H)if(0<H&&(y=6*d-12*e+6*f,A=-3*d+9*e-9*f+3*t,C=3*e-3*d),1E-12>r(A)){if(!(1E-12>r(y))){var G=-C/y;0<G&&1>G&&q.push(G)}}else if(G=y*y-4*C*A,!(0>G)){var P=l(G);G=(-y+P)/(2*A);0<G&&1>G&&q.push(G);G=(-y-P)/(2*A);0<G&&1>G&&q.push(G)}for(r=l=q.length;l--;)G=q[l],y=1-G,A=y*y*y*a+3*y*y*G*b+3*y*
G*G*g+G*G*G*w,v[0][l]=A,A=y*y*y*d+3*y*y*G*e+3*y*G*G*f+G*G*G*t,v[1][l]=A;v[0][r]=a;v[1][r]=d;v[0][r+1]=w;v[1][r+1]=t;n=[{x:n.apply(null,v[0]),y:n.apply(null,v[1])},{x:m.apply(null,v[0]),y:m.apply(null,v[1])}];return c[k]=n}var d={},g={},c={},h=Array.prototype.join;fabric.util.drawArc=function(c,d,b,e){var g=[[],[],[],[]];e=a(e[5]-d,e[6]-b,e[0],e[1],e[3],e[4],e[2]);for(var f=0,h=e.length;f<h;f++)g[f][0]=e[f][0]+d,g[f][1]=e[f][1]+b,g[f][2]=e[f][2]+d,g[f][3]=e[f][3]+b,g[f][4]=e[f][4]+d,g[f][5]=e[f][5]+
b,c.bezierCurveTo.apply(c,g[f])};fabric.util.getBoundsOfArc=function(c,d,b,e,g,h,w,t,u){var k=0,l=0,n=[];b=a(t-c,u-d,b,e,h,w,g);e=[[],[]];g=0;for(h=b.length;g<h;g++)k=f(k,l,b[g][0],b[g][1],b[g][2],b[g][3],b[g][4],b[g][5]),e[0].x=k[0].x+c,e[0].y=k[0].y+d,e[1].x=k[1].x+c,e[1].y=k[1].y+d,n.push(e[0]),n.push(e[1]),k=b[g][4],l=b[g][5];return n};fabric.util.getBoundsOfCurve=f})();
(function(){function a(a,b,d){if(a&&0!==a.length){var e=a.length-1,c=b?a[e][b]:a[e];if(b)for(;e--;)d(a[e][b],c)&&(c=a[e][b]);else for(;e--;)d(a[e],c)&&(c=a[e]);return c}}var b=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),d=b.length>>>0;if(0===d)return-1;var e=0;0<arguments.length&&(e=Number(arguments[1]),e!==e?e=0:0!==e&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY&&(e=(0<e||-1)*
Math.floor(Math.abs(e))));if(e>=d)return-1;for(e=0<=e?e:Math.max(d-Math.abs(e),0);e<d;e++)if(e in b&&b[e]===a)return e;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var d=0,e=this.length>>>0;d<e;d++)d in this&&a.call(b,this[d],d,this)});Array.prototype.map||(Array.prototype.map=function(a,b){for(var d=[],e=0,c=this.length>>>0;e<c;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d});Array.prototype.every||(Array.prototype.every=function(a,b){for(var d=0,e=this.length>>>
0;d<e;d++)if(d in this&&!a.call(b,this[d],d,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,b){for(var d=0,e=this.length>>>0;d<e;d++)if(d in this&&a.call(b,this[d],d,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var d=[],e,c=0,f=this.length>>>0;c<f;c++)c in this&&(e=this[c],a.call(b,e,c,this)&&d.push(e));return d});Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=this.length>>>0,d=0;if(1<arguments.length)var e=
arguments[1];else{do{if(d in this){e=this[d++];break}if(++d>=b)throw new TypeError;}while(1)}for(;d<b;d++)d in this&&(e=a.call(null,e,this[d],d,this));return e});fabric.util.array={invoke:function(a,f){for(var d=b.call(arguments,2),e=[],c=0,h=a.length;c<h;c++)e[c]=d.length?a[c][f].apply(a[c],d):a[c][f].call(a[c]);return e},min:function(b,f){return a(b,f,function(a,b){return a<b})},max:function(b,f){return a(b,f,function(a,b){return a>=b})}}})();
(function(){function a(a,e){for(var b in e)a[b]=e[b];return a}fabric.util.object={extend:a,clone:function(b){return a({},b)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(a,e){return e?e.toUpperCase():""})},capitalize:function(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())},escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var a=Array.prototype.slice,b=Function.prototype.apply,e=function(){};Function.prototype.bind||(Function.prototype.bind=function(f){var d=this,g=a.call(arguments,1);var c=g.length?function(){return b.call(d,this instanceof e?this:f,g.concat(a.call(arguments)))}:function(){return b.call(d,this instanceof e?this:f,arguments)};e.prototype=this.prototype;c.prototype=new e;return c})})();
(function(){function a(){}function b(a){var c=this.constructor.superclass.prototype[a];return 1<arguments.length?c.apply(this,e.call(arguments,1)):c.call(this)}var e=Array.prototype.slice,f=function(){},d=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,e){for(var c in b)c in a.prototype&&"function"===typeof a.prototype[c]&&-1<(b[c]+"").indexOf("callSuper")?a.prototype[c]=function(a){return function(){var c=this.constructor.superclass;this.constructor.superclass=
e;var d=b[a].apply(this,arguments);this.constructor.superclass=c;if("initialize"!==a)return d}}(c):a.prototype[c]=b[c],d&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=function(){function c(){this.initialize.apply(this,arguments)}var d=null,k=e.call(arguments,0);"function"===typeof k[0]&&(d=k.shift());c.superclass=d;c.subclasses=[];d&&(a.prototype=d.prototype,c.prototype=new a,
d.subclasses.push(c));for(var m=0,l=k.length;m<l;m++)g(c,k[m],d);c.prototype.initialize||(c.prototype.initialize=f);c.prototype.constructor=c;c.prototype.callSuper=b;return c}})();
(function(){function a(a){var c=Array.prototype.slice.call(arguments,1),d,b=c.length;for(d=0;d<b;d++){var e=typeof a[c[d]];if(!/^(?:function|object|unknown)$/.test(e))return!1}return!0}function b(a,c){return function(b){c.call(d(a),b||fabric.window.event)}}function e(a,c){return function(d){if(l[a]&&l[a][c])for(var b=l[a][c],e=0,g=b.length;e<g;e++)b[e].call(this,d||fabric.window.event)}}function f(a,c,d){var b="touchend"===a.type?"changedTouches":"touches";return a[b]&&a[b][0]?a[b][0][c]-(a[b][0][c]-
a[b][0][d])||a[d]:a[d]}var d,g,c=function(){var a=0;return function(c){return c.__uniqueID||(c.__uniqueID="uniqueID__"+a++)}}();(function(){var a={};d=function(c){return a[c]};g=function(c,d){a[c]=d}})();var h=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),k=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),m={},l={};h?(h=function(a,c,d){a.addEventListener(c,
d,!1)},k=function(a,c,d){a.removeEventListener(c,d,!1)}):k?(h=function(a,d,e){var f=c(a);g(f,a);m[f]||(m[f]={});m[f][d]||(m[f][d]=[]);e={handler:e,wrappedHandler:b(f,e)};m[f][d].push(e);a.attachEvent("on"+d,e.wrappedHandler)},k=function(a,d,b){var e=c(a),g;if(m[e]&&m[e][d])for(var f=0,h=m[e][d].length;f<h;f++)(g=m[e][d][f])&&g.handler===b&&(a.detachEvent("on"+d,g.wrappedHandler),m[e][d][f]=null)}):(h=function(a,d,b){var g=c(a);l[g]||(l[g]={});if(!l[g][d]){l[g][d]=[];var f=a["on"+d];f&&l[g][d].push(f);
a["on"+d]=e(g,d)}l[g][d].push(b)},k=function(a,d,b){a=c(a);if(l[a]&&l[a][d]){d=l[a][d];a=0;for(var e=d.length;a<e;a++)d[a]===b&&d.splice(a,1)}});fabric.util.addListener=h;fabric.util.removeListener=k;var n=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},q=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(n=function(a){return f(a,"pageX","clientX")},q=function(a){return f(a,"pageY","clientY")});fabric.util.getPointer=function(a,c){a||(a=fabric.window.event);
var d=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null),c);return{x:n(a)+d.left,y:q(a)+d.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var a=fabric.document.createElement("div"),b="string"===typeof a.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};"string"===typeof a.style.opacity?f=function(a,b){a.style.opacity=b;return a}:b&&(f=function(a,b){var c=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1);e.test(c.filter)?c.filter=c.filter.replace(e,.9999<=b?"":"alpha(opacity="+100*b+")"):c.filter+=" alpha(opacity="+100*b+")";return a});fabric.util.setStyle=function(a,b){var c=a.style;
if(!c)return a;if("string"===typeof b)return a.style.cssText+=";"+b,-1<b.indexOf("opacity")?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)"opacity"===d?f(a,b[d]):c["float"===d||"cssFloat"===d?"undefined"===typeof c.styleFloat?"cssFloat":"styleFloat":d]=b[d];return a}})();
(function(){function a(a,c){var d=fabric.document.createElement(a),b;for(b in c)"class"===b?d.className=c[b]:"for"===b?d.htmlFor=c[b]:d.setAttribute(b,c[b]);return d}var b=Array.prototype.slice,e=function(a){return b.call(a,0)};try{var f=e(fabric.document.childNodes)instanceof Array}catch(g){}f||(e=function(a){for(var c=Array(a.length),d=a.length;d--;)c[d]=a[d];return c});var d=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,c){var d=fabric.document.defaultView.getComputedStyle(a,
null);return d?d[c]:void 0}:function(a,c){var d=a.style[c];!d&&a.currentStyle&&(d=a.currentStyle[c]);return d};(function(){var a=fabric.document.documentElement.style,c="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);c?a.style[c]="none":"string"===typeof a.unselectable&&
(a.unselectable="on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=null);c?a.style[c]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,c){var d=fabric.document.getElementsByTagName("head")[0],b=fabric.document.createElement("script"),e=!0;b.onload=b.onreadystatechange=function(a){!e||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||
(e=!1,c(a||fabric.window.event),b=b.onload=b.onreadystatechange=null)};b.src=a;d.appendChild(b)}})();fabric.util.getById=function(a){return"string"===typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=e;fabric.util.makeElement=a;fabric.util.addClass=function(a,c){a&&-1===(" "+a.className+" ").indexOf(" "+c+" ")&&(a.className+=(a.className?" ":"")+c)};fabric.util.wrapElement=function(d,c,b){"string"===typeof c&&(c=a(c,b));d.parentNode&&d.parentNode.replaceChild(c,d);c.appendChild(d);
return c};fabric.util.getScrollLeftTop=function(a,c){var d,b,e=0,g=0,f=fabric.document.documentElement,q=fabric.document.body||{scrollLeft:0,scrollTop:0};for(b=a;a&&a.parentNode&&!d;)a=a.parentNode,1===a.nodeType&&"fixed"===fabric.util.getElementStyle(a,"position")&&(d=a),1===a.nodeType&&b!==c&&"absolute"===fabric.util.getElementStyle(a,"position")?g=e=0:a===fabric.document?(e=q.scrollLeft||f.scrollLeft||0,g=q.scrollTop||f.scrollTop||0):(e+=a.scrollLeft||0,g+=a.scrollTop||0);return{left:e,top:g}};
fabric.util.getElementOffset=function(a){var c=a&&a.ownerDocument;var b={left:0,top:0},e={left:0,top:0},g={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!c)return{left:0,top:0};for(var f in g)e[g[f]]+=parseInt(d(a,f),10)||0;c=c.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(b=a.getBoundingClientRect());a=fabric.util.getScrollLeftTop(a,null);return{left:b.left+a.left-(c.clientLeft||0)+e.left,top:b.top+a.top-(c.clientTop||0)+e.top}};fabric.util.getElementStyle=
d})();
(function(){function a(a,d){return a+(/\?/.test(a)?"&":"?")+d}function b(){}var e=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],d=a.length;d--;)try{if(a[d]())return a[d]}catch(g){}}();fabric.util.request=function(f,d){d||(d={});var g=d.method?d.method.toUpperCase():"GET",c=d.onComplete||function(){},h=e();h.onreadystatechange=function(){4===
h.readyState&&(c(h),h.onreadystatechange=b)};if("GET"===g){var k=null;"string"===typeof d.parameters&&(f=a(f,d.parameters))}h.open(g,f,!0);"POST"!==g&&"PUT"!==g||h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");h.send(k);return h}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(a){"undefined"!==typeof console[a]&&"function"===typeof console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})});
(function(a){function b(a){return a in B?B[a]:a}function e(a,c,d,b){var e="[object Array]"===Object.prototype.toString.call(c),g;"fill"!==a&&"stroke"!==a||"none"!==c?"strokeDashArray"===a?c=c.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?c=d&&d.transformMatrix?x(d.transformMatrix,n.parseTransformAttribute(c)):n.parseTransformAttribute(c):"visible"===a?(c="none"===c||"hidden"===c?!1:!0,d&&!1===d.visible&&(c=!1)):"originX"===a?c="start"===c?"left":"end"===
c?"right":"center":g=e?c.map(u):u(c,b):c="";return!e&&isNaN(g)?c:g}function f(a){for(var c in D)if(a[c]&&"undefined"!==typeof a[D[c]]&&0!==a[c].indexOf("url(")){var d=new n.Color(a[c]);a[c]=d.setAlpha(t(d.getAlpha()*a[D[c]],2)).toRgba()}return a}function d(a,c){var d,g;a.replace(/;$/,"").split(";").forEach(function(a){a=a.split(":");d=b(a[0].trim().toLowerCase());g=e(d,a[1].trim());c[d]=g})}function g(a,d){var b={},e;for(e in n.cssRules[d]){var g,f=a,h=e.split(" "),k=!0;if((g=c(f,h.pop()))&&h.length){k=
void 0;for(var l=h,m=!0;f.parentNode&&1===f.parentNode.nodeType&&l.length;)m&&(k=l.pop()),f=f.parentNode,m=c(f,k);k=0===l.length}if(g&&k&&0===h.length)for(var r in n.cssRules[d][e])b[r]=n.cssRules[d][e][r]}return b}function c(a,c){var d=a.nodeName,b=a.getAttribute("class"),e=a.getAttribute("id");d=new RegExp("^"+d,"i");c=c.replace(d,"");e&&c.length&&(d=new RegExp("#"+e+"(?![a-zA-Z\\-]+)","i"),c=c.replace(d,""));if(b&&c.length)for(b=b.split(" "),e=b.length;e--;)d=new RegExp("\\."+b[e]+"(?![a-zA-Z\\-]+)",
"i"),c=c.replace(d,"");return 0===c.length}function h(a){for(var c=a.getElementsByTagName("use");c.length;){var d=c[0],b=d.getAttribute("xlink:href").substr(1),e=d.getAttribute("x")||0,g=d.getAttribute("y")||0;b=a.getElementById(b).cloneNode(!0);e=(b.getAttribute("transform")||"")+" translate("+e+", "+g+")";g=0;for(var f=d.attributes,h=f.length;g<h;g++){var k=f.item(g);"x"!==k.nodeName&&"y"!==k.nodeName&&"xlink:href"!==k.nodeName&&("transform"===k.nodeName?e=k.nodeValue+" "+e:b.setAttribute(k.nodeName,
k.nodeValue))}b.setAttribute("transform",e);b.setAttribute("instantiated_by_use","1");b.removeAttribute("id");d.parentNode.replaceChild(b,d)}}function k(a,c,d){var b=a.getAttribute("viewBox"),e=1,g=1;if(b&&(b=b.match(F))){var f=-parseFloat(b[1]);var h=-parseFloat(b[2]);var k=parseFloat(b[3]);b=parseFloat(b[4]);c&&c!==k&&(e=c/k);d&&d!==b&&(g=d/b);g=e=e>g?g:e;if(1!==e||1!==g||0!==f||0!==h){c=" matrix("+e+" 0 0 "+g+" "+f*e+" "+h*g+") ";if("svg"===a.tagName){for(d=a.ownerDocument.createElement("g");null!=
a.firstChild;)d.appendChild(a.firstChild);a.appendChild(d)}else d=a,c=d.getAttribute("transform")+c;d.setAttribute("transform",c)}}}function m(a){var c=a.objects;a=a.options;c=c.map(function(a){return n[r(a.type)].fromObject(a)});return{objects:c,options:a}}function l(a,c,d){c[d]&&c[d].toSVG&&a.push('<pattern x="0" y="0" id="',d,'Pattern" ','width="',c[d].source.width,'" height="',c[d].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',c[d].source.width,'" height="',
c[d].source.height,'" xlink:href="',c[d].source.src,'"></image></pattern>')}var n=a.fabric||(a.fabric={}),q=n.util.object.extend,r=n.util.string.capitalize,w=n.util.object.clone,t=n.util.toFixed,u=n.util.parseUnit,x=n.util.multiplyTransformMatrices,B={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",
"stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},D={stroke:"strokeOpacity",fill:"fillOpacity"};n.cssRules={};n.gradientDefs={};n.parseTransformAttribute=function(){function a(a,c){var d=c[0];a[0]=Math.cos(d);a[1]=Math.sin(d);a[2]=-Math.sin(d);a[3]=Math.cos(d)}function c(a,c){var d=2===
c.length?c[1]:c[0];a[0]=c[0];a[3]=d}function d(a,c){a[4]=c[0];2===c.length&&(a[5]=c[1])}var b=[1,0,0,1,0,0],e=n.reNum,g="(?:"+("(?:(matrix)\\s*\\(\\s*("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+
e+")(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+e+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+e+")\\s*\\))")+")",f=new RegExp("^\\s*(?:"+("(?:"+g+"(?:(?:\\s+,?\\s*|,\\s*)"+g+")*)")+"?)\\s*$"),h=new RegExp(g,"g");return function(e){var k=b.concat(),l=[];if(!e||e&&!f.test(e))return k;e.replace(h,function(e){var f=(new RegExp(g)).exec(e).filter(function(a){return""!==a&&null!=a});e=f[1];f=f.slice(2).map(parseFloat);switch(e){case "translate":d(k,f);break;case "rotate":f[0]=n.util.degreesToRadians(f[0]);
a(k,f);break;case "scale":c(k,f);break;case "skewX":k[2]=Math.tan(n.util.degreesToRadians(f[0]));break;case "skewY":k[1]=Math.tan(n.util.degreesToRadians(f[0]));break;case "matrix":k=f}l.push(k.concat());k=b.concat()});for(e=l[0];1<l.length;)l.shift(),e=n.util.multiplyTransformMatrices(e,l[0]);return e}}();var F=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");n.parseSVGDocument=function(){var a=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,
c=/^(symbol|image|marker|pattern|view)$/;return function(d,b,e){if(d){h(d);var g=new Date,f=n.Object.__uid++,l,m,r=!1;d.getAttribute("width")&&"100%"!==d.getAttribute("width")&&(l=u(d.getAttribute("width")));d.getAttribute("height")&&"100%"!==d.getAttribute("height")&&(m=u(d.getAttribute("height")));if(!l||!m){var q=d.getAttribute("viewBox");q&&(q=q.match(F))?(l=parseFloat(q[3]),m=parseFloat(q[4])):r=!0}k(d,l,m);q=n.util.toArray(d.getElementsByTagName("*"));if(0===q.length&&n.isLikelyNode){q=d.selectNodes('//*[name(.)!="svg"]');
for(var y=[],A=0,t=q.length;A<t;A++)y[A]=q[A];q=y}q=q.filter(function(d){c.test(d.tagName)&&k(d,0,0);var b;if(b=a.test(d.tagName)){a:{for(b=/^(?:pattern|defs|symbol)$/;d&&(d=d.parentNode);)if(b.test(d.nodeName)&&!d.getAttribute("instantiated_by_use")){d=!0;break a}d=!1}b=!d}return b});if(!q||q&&!q.length)b&&b([],{});else{var v={width:l,height:m,svgUid:f,toBeParsed:r};n.gradientDefs[f]=n.getGradientDefs(d);n.cssRules[f]=n.getCSSRules(d);n.parseElements(q,function(a){n.documentParsingTime=new Date-
g;b&&b(a,v)},w(v),e)}}}}();var z={has:function(a,c){c(!1)},get:function(){},set:function(){}},v=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");q(n,{parseFontDeclaration:function(a,c){var d=a.match(v);if(d){var b=d[1],e=d[3],g=d[4],f=d[5];d=d[6];b&&(c.fontStyle=b);e&&(c.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e));g&&(c.fontSize=u(g));d&&(c.fontFamily=
d);f&&(c.lineHeight="normal"===f?1:f)}},getGradientDefs:function(a){var c=a.getElementsByTagName("linearGradient"),d=a.getElementsByTagName("radialGradient"),b,e=0,g=[];a={};var f={};g.length=c.length+d.length;for(b=c.length;b--;)g[e++]=c[b];for(b=d.length;b--;)g[e++]=d[b];for(;e--;){c=g[e];d=c.getAttribute("xlink:href");var h=c.getAttribute("id");d&&(f[h]=d.substr(1));a[h]=c}for(h in f)for(e=a[f[h]].cloneNode(!0),c=a[h];e.firstChild;)c.appendChild(e.firstChild);return a},parseAttributes:function(a,
c,d){if(a){var h,k={};"undefined"===typeof d&&(d=a.getAttribute("svgUid"));a.parentNode&&/^symbol|[g|a]$/i.test(a.parentNode.nodeName)&&(k=n.parseAttributes(a.parentNode,c,d));var l=k&&k.fontSize||a.getAttribute("font-size")||n.Text.DEFAULT_SVG_FONT_SIZE;c=c.reduce(function(c,d){if(h=a.getAttribute(d))d=b(d),h=e(d,h,k,l),c[d]=h;return c},{});c=q(c,q(g(a,d),n.parseStyleAttribute(a)));c.font&&n.parseFontDeclaration(c.font,c);return f(q(k,c))}},parseElements:function(a,c,d,b){(new n.ElementsParser(a,
c,d,b)).parse()},parseStyleAttribute:function(a){var c={};a=a.getAttribute("style");if(!a)return c;if("string"===typeof a)d(a,c);else{var g;for(g in a)if("undefined"!==typeof a[g]){var f=b(g.toLowerCase());var h=e(f,a[g]);c[f]=h}}return c},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim();a=a.split(/\s+/);var c=[],d;var b=0;for(d=a.length;b<d;b+=2)c.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return c},getCSSRules:function(a){a=a.getElementsByTagName("style");for(var c=
{},d,g=0,f=a.length;g<f;g++)d=a[g].textContent,d=d.replace(/\/\*[\s\S]*?\*\//g,""),""!==d.trim()&&(d=d.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var d={},g=a[2].trim().replace(/;$/,"").split(/\s*;\s*/),f=0,h=g.length;f<h;f++){var k=g[f].split(/\s*:\s*/),l=b(k[0]);k=e(l,k[1],k[0]);d[l]=k}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();""!==a&&(c[a]=n.util.object.clone(d))})}));return c},loadSVGFromURL:function(a,
c,d){function b(b){var e=b.responseXML;e&&!e.documentElement&&n.window.ActiveXObject&&b.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(b.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e&&e.documentElement&&n.parseSVGDocument(e.documentElement,function(d,b){z.set(a,{objects:n.util.array.invoke(d,"toObject"),options:b});c(d,b)},d)}a=a.replace(/^\n\s*/,"").trim();z.has(a,function(d){d?z.get(a,function(a){a=m(a);c(a.objects,a.options)}):new n.util.request(a,
{method:"get",onComplete:b})})},loadSVGFromString:function(a,c,d){a=a.trim();var b;if("undefined"!==typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(b=e.parseFromString(a,"text/xml"))}else n.window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));n.parseSVGDocument(b.documentElement,function(a,d){c(a,d)},d)},createSVGFontFacesMarkup:function(a){for(var c="",d=0,b=a.length;d<b;d++)"text"===a[d].type&&
a[d].path&&(c+=["@font-face {font-family: ",a[d].fontFamily,"; src: url('",a[d].path,"')}"].join(""));c&&(c=['<style type="text/css"><![CDATA[',c,"]]\x3e</style>"].join(""));return c},createSVGRefElementsMarkup:function(a){var c=[];l(c,a,"backgroundColor");l(c,a,"overlayColor");return c.join("")}})})("undefined"!==typeof exports?exports:this);fabric.ElementsParser=function(a,b,e,f){this.elements=a;this.callback=b;this.options=e;this.reviver=f;this.svgUid=e&&e.svgUid||0};
fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var a=0,b=this.elements.length;a<b;a++)this.elements[a].setAttribute("svgUid",this.svgUid),function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)}(this,a)};
fabric.ElementsParser.prototype.createObject=function(a,b){var e=fabric[fabric.util.string.capitalize(a.tagName)];if(e&&e.fromElement)try{this._createObject(e,a,b)}catch(f){fabric.log(f)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(a,b,e){a.async?a.fromElement(b,this.createCallback(e,b),this.options):(a=a.fromElement(b,this.options),this.resolveGradient(a,"fill"),this.resolveGradient(a,"stroke"),this.reviver&&this.reviver(b,a),this.instances[e]=a,this.checkIfDone())};
fabric.ElementsParser.prototype.createCallback=function(a,b){var e=this;return function(f){e.resolveGradient(f,"fill");e.resolveGradient(f,"stroke");e.reviver&&e.reviver(b,f);e.instances[a]=f;e.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(a,b){var e=a.get(b);/^url\(/.test(e)&&(e=e.slice(5,e.length-1),fabric.gradientDefs[this.svgUid][e]&&a.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][e],a)))};
fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances))};
(function(a){function b(a,b){this.x=a;this.y=b}a=a.fabric||(a.fabric={});a.Point?a.warn("fabric.Point is already defined"):(a.Point=b,b.prototype={constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},
scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>
a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,f){return new b(this.x+(a.x-this.x)*f,this.y+(a.y-this.y)*f)},distanceFrom:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},midPointFrom:function(a){return new b(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},
setXY:function(a,b){this.x=a;this.y=b},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var b=this.x,d=this.y;this.x=a.x;this.y=a.y;a.x=b;a.y=d}})})("undefined"!==typeof exports?exports:this);
(function(a){function b(a){this.status=a;this.points=[]}var e=a.fabric||(a.fabric={});e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=b,e.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},e.Intersection.intersectLineLine=function(a,d,g,c){var f=(c.x-g.x)*(a.y-g.y)-(c.y-g.y)*(a.x-g.x);var k=(d.x-a.x)*(a.y-g.y)-(d.y-a.y)*(a.x-g.x);g=(c.y-g.y)*(d.x-a.x)-(c.x-g.x)*(d.y-a.y);0!==g?(f/=g,k/=g,
0<=f&&1>=f&&0<=k&&1>=k?(k=new b("Intersection"),k.points.push(new e.Point(a.x+f*(d.x-a.x),a.y+f*(d.y-a.y)))):k=new b):k=0===f||0===k?new b("Coincident"):new b("Parallel");return k},e.Intersection.intersectLinePolygon=function(a,d,e){for(var c=new b,g=e.length,f=0;f<g;f++){var m=b.intersectLineLine(a,d,e[f],e[(f+1)%g]);c.appendPoints(m.points)}0<c.points.length&&(c.status="Intersection");return c},e.Intersection.intersectPolygonPolygon=function(a,d){for(var e=new b,c=a.length,f=0;f<c;f++){var k=b.intersectLinePolygon(a[f],
a[(f+1)%c],d);e.appendPoints(k.points)}0<e.points.length&&(e.status="Intersection");return e},e.Intersection.intersectPolygonRectangle=function(a,d,g){var c=d.min(g),f=d.max(g);g=new e.Point(f.x,c.y);var k=new e.Point(c.x,f.y);d=b.intersectLinePolygon(c,g,a);g=b.intersectLinePolygon(g,f,a);f=b.intersectLinePolygon(f,k,a);a=b.intersectLinePolygon(k,c,a);c=new b;c.appendPoints(d.points);c.appendPoints(g.points);c.appendPoints(f.points);c.appendPoints(a.points);0<c.points.length&&(c.status="Intersection");
return c})})("undefined"!==typeof exports?exports:this);
(function(a){function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function e(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var f=a.fabric||(a.fabric={});f.Color?f.warn("fabric.Color is already defined."):(f.Color=b,f.Color.prototype={_tryParsingColor:function(a){var d;a in b.colorNameMap&&(a=b.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((d=b.sourceFromHex(a))||(d=b.sourceFromRgb(a)),d||(d=b.sourceFromHsl(a)),d&&this.setSource(d))},
_rgbToHsl:function(a,b,c){a/=255;b/=255;c/=255;var d=f.util.array.max([a,b,c]);var e=f.util.array.min([a,b,c]);var g=(d+e)/2;if(d===e)var l=e=0;else{var n=d-e;e=.5<g?n/(2-d-e):n/(d+e);switch(d){case a:l=(b-c)/n+(b<c?6:0);break;case b:l=(c-a)/n+2;break;case c:l=(a-b)/n+4}l/=6}return[Math.round(360*l),Math.round(100*e),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=
this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource();a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource();var b=a[0].toString(16);b=1===b.length?"0"+b:b;var c=a[1].toString(16);c=1===c.length?"0"+c:c;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+
c.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var d=this.getSource();d[3]=a;this.setSource(d);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var d=this.getSource(),c=(.3*d[0]+.59*d[1]+.11*d[2]).toFixed(0);d=d[3];c=Number(c)<Number(a||127)?0:255;this.setSource([c,c,c,d]);return this},overlayWith:function(a){a instanceof
b||(a=new b(a));var d=[],c=this.getAlpha(),e=this.getSource();a=a.getSource();for(var f=0;3>f;f++)d.push(Math.round(.5*e[f]+.5*a[f]));d[3]=c;this.setSource(d);return this}},f.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,f.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}%)\s*,\s*(\d{1,3}%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,f.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,f.Color.colorNameMap={aqua:"#00FFFF",
black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},f.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},f.Color.sourceFromRgb=function(a){if(a=a.match(b.reRGBa)){var d=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),c=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?
255:1),e=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(d,10),parseInt(c,10),parseInt(e,10),a[4]?parseFloat(a[4]):1]}},f.Color.fromRgba=b.fromRgb,f.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},f.Color.sourceFromHsl=function(a){if(a=a.match(b.reHSLa)){var d=(parseFloat(a[1])%360+360)%360/360,c=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===c)f=c=d=f;else{var k=.5>=f?f*(c+1):f+c-f*c,m=2*f-k;f=e(m,k,
d+1/3);c=e(m,k,d);d=e(m,k,d-1/3)}return[Math.round(255*f),Math.round(255*c),Math.round(255*d),a[4]?parseFloat(a[4]):1]}},f.Color.fromHsla=b.fromHsl,f.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},f.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var d=a.slice(a.indexOf("#")+1),c=3===d.length;a=c?d.charAt(0)+d.charAt(0):d.substring(0,2);var e=c?d.charAt(1)+d.charAt(1):d.substring(2,4);d=c?d.charAt(2)+d.charAt(2):d.substring(4,6);return[parseInt(a,16),parseInt(e,16),parseInt(d,
16),1]}},f.Color.fromSource=function(a){var d=new b;d.setSource(a);return d})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.toFixed;b.Shadow?b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"===typeof a&&(a=this._parseShadow(a));for(var d in a)this[d]=a[d];this.id=b.Object.__uid++},_parseShadow:function(a){a=a.trim();var d=b.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),
offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var d="SourceAlpha",b=40,c=40;!a||a.fill!==this.color&&a.stroke!==this.color||(d="SourceGraphic");a.width&&a.height&&(b=100*e(Math.abs(this.offsetX/a.getWidth()),2)+20,c=100*e(Math.abs(this.offsetY/a.getHeight()),2)+20);return'<filter id="SVGID_'+this.id+'" y="-'+c+'%" height="'+(100+2*c)+'%" x="-'+b+'%" width="'+
(100+2*b)+'%" >\n\t<feGaussianBlur in="'+d+'" stdDeviation="'+e(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n\t<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,
blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var a={},d=b.Shadow.prototype;this.color!==d.color&&(a.color=this.color);this.blur!==d.blur&&(a.blur=this.blur);this.offsetX!==d.offsetX&&(a.offsetX=this.offsetX);this.offsetY!==d.offsetY&&(a.offsetY=this.offsetY);return a}}),b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var a=fabric.util.object.extend,b=fabric.util.getElementOffset,e=fabric.util.removeFromArray,f=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,
clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,
this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=b(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",
a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,e){"string"===typeof b?fabric.util.loadImage(b,function(d){this[a]=new fabric.Image(d,e);c&&c()},this,e&&e.crossOrigin):(e&&b.setOptions(e),
this[a]=b,c&&c());return this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var d=this;fabric.util.loadImage(b.source,function(e){d[a]=new fabric.Pattern({source:e,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");a.style||(a.style={});if(!a)throw f;this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);if("undefined"===
typeof a.getContext)throw f;},_initOptions:function(a){for(var d in a)this[d]=a[d];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=
fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,
b){b=b||{};for(var c in a){var d=a[c];b.cssOnly||(this._setBackstoreDimension(c,a[c]),d+="px");b.backstoreOnly||this._setCssDimension(c,d)}b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&
(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var d=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var c=this._objects.length;a<c;a++)this._objects[a].setCoords();d&&d.setCoords();return this},zoomToPoint:function(a,b){var c=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=
b;var d=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-d.x;this.viewportTransform[5]+=c.y-d.y;this.renderAll();c=0;for(d=this._objects.length;c<d;c++)this._objects[c].setCoords();return this},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var d=this._objects.length;a<d;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-
this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var c=this.viewportTransform;a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this._shouldRenderObject(b)&&b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&
a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&
this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var b=this[!0===a&&this.interactive?"contextTop":"contextContainer"],c=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,
b);this._renderBackground(b);this._renderObjects(b,c);this._renderActiveGroup(b,c);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var c;if(!b||this.preserveObjectStacking){var d=0;for(c=this._objects.length;d<c;++d)this._draw(a,this._objects[d])}else for(d=0,c=this._objects.length;d<c;++d)this._objects[d]&&!b.contains(this._objects[d])&&this._draw(a,this._objects[d])},
_renderActiveGroup:function(a,b){if(b){var c=[];this.forEachObject(function(a){b.contains(a)&&c.push(a)});b._set("objects",c);this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=
this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var b=this.getCenter();this._centerObject(a,new fabric.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");
return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,e){var c={objects:this._toObjects(b,e)};a(c,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,c,e);return c},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){if(!this.includeDefaultValues){var d=
a.includeDefaultValues;a.includeDefaultValues=!1}var e=this._realizeGroupTransformOnObject(a);b=a[b](c);this.includeDefaultValues||(a.includeDefaultValues=d);this._unwindGroupTransformOnObject(a,e);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");if(a.group&&a.group===this.getActiveGroup()){var c={};b.forEach(function(b){c[b]=a[b]});this.getActiveGroup().realizeTransform(a);return c}return null},_unwindGroupTransformOnObject:function(a,
b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];this._setSVGPreamble(c,
a);this._setSVGHeader(c,a);this._setSVGBgOverlayColor(c,"backgroundColor");this._setSVGBgOverlayImage(c,"backgroundImage");this._setSVGObjects(c,b);this._setSVGBgOverlayColor(c,"overlayColor");this._setSVGBgOverlayImage(c,"overlayImage");c.push("</svg>");return c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},
_setSVGHeader:function(a,b){if(b.viewBox){var c=b.viewBox.width;var d=b.viewBox.height}else if(c=this.width,d=this.height,!this.svgViewportTransformation){var e=this.viewportTransform;c/=e[0];d/=e[3]}a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+
" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){for(var c=0,d=this.getObjects(),e=d.length;c<e;c++){var f=d[c],g=this._realizeGroupTransformOnObject(f);a.push(f.toSVG(b));this._unwindGroupTransformOnObject(f,g)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},
_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},
sendToBack:function(a){e(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){e(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var c=this._objects.indexOf(a);0!==c&&(c=this._findNewLowerIndex(a,c,b),e(this._objects,a),this._objects.splice(c,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,c){if(c)for(c=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||
a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b-1;return c},bringForward:function(a,b){var c=this._objects.indexOf(a);c!==this._objects.length-1&&(c=this._findNewUpperIndex(a,c,b),e(this._objects,a),this._objects.splice(c,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,b,c){if(c)for(c=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||
this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b+1;return c},moveTo:function(a,b){e(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});a(fabric.StaticCanvas.prototype,fabric.Observable);a(fabric.StaticCanvas.prototype,fabric.Collection);a(fabric.StaticCanvas.prototype,
fabric.DataURLExporter);a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case "getImageData":return"undefined"!==typeof c.getImageData;case "setLineDash":return"undefined"!==typeof c.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(h){}return!1;
default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
(function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,f=Math.atan2,d=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var c=
this._currentTransform;c.target.set({scaleX:c.original.scaleX,scaleY:c.original.scaleY,left:c.original.left,top:c.original.top});this._shouldCenterTransform(a,c.target)?"rotate"===c.action?this._setOriginToCenter(c.target):("center"!==c.originX&&(c.mouseXSign="right"===c.originX?-1:1),"center"!==c.originY&&(c.mouseYSign="bottom"===c.originY?-1:1),c.originX="center",c.originY="center"):(c.originX=c.original.originX,c.originY=c.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,
!0),d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c=this.getActiveGroup(),d=b.x,e=b.y;c&&"group"!==a.type&&c.contains(a)&&(c=new fabric.Point(c.left,c.top),c=fabric.util.transformPoint(c,this.viewportTransform,!0),d-=c.x,e-=c.y);return{x:d,y:e}},isTargetTransparent:function(a,b,d){var c=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=c;a.transparentCorners=e;
a=fabric.util.isTransparent(this.contextCache,b,d,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c=this._currentTransform,d;"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?d=this.centeredScaling||b.centeredScaling:"rotate"===c.action&&
(d=this.centeredRotation||b.centeredRotation);return d?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};if("ml"===b||"tl"===b||"bl"===b)c.x="right";else if("mr"===b||"tr"===b||"br"===b)c.x="left";if("tl"===b||"mt"===b||"tr"===b)c.y="bottom";else if("bl"===b||"mb"===b||"br"===b)c.y="top";return c},_getActionFromCorner:function(a,b){var c="drag";b&&(c="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale");return c},_setupCurrentTransform:function(a,
d){if(d){var c=this.getPointer(a),e=d._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(d,e);e=this._getOriginFromCorner(d,e);this._currentTransform={target:d,action:f,scaleX:d.scaleX,scaleY:d.scaleY,offsetX:c.x-d.left,offsetY:c.y-d.top,originX:e.x,originY:e.y,ex:c.x,ey:c.y,left:d.left,top:d.top,theta:b(d.angle),width:d.width*d.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:d.left,top:d.top,scaleX:d.scaleX,scaleY:d.scaleY,originX:e.x,originY:e.y};this._resetCurrentTransform(a)}},
_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,d){var c=this._currentTransform,e=c.target,f=e.get("lockScalingX"),g=e.get("lockScalingY"),h=e.get("lockScalingFlip");if(!f||!g){var k=e.translateToOriginPoint(e.getCenterPoint(),c.originX,c.originY);a=e.toLocalPoint(new fabric.Point(a,b),c.originX,c.originY);this._setLocalMouse(a,
c);this._setObjectScale(a,c,f,g,d,h);e.setPositionByOrigin(k,c.originX,c.originY)}},_setObjectScale:function(a,b,d,e,f,g){var c=b.target,h=!1,k=!1,l=c.stroke?c.strokeWidth:0;b.newScaleX=a.x/(c.width+l/2);b.newScaleY=a.y/(c.height+l/2);g&&0>=b.newScaleX&&b.newScaleX<c.scaleX&&(h=!0);g&&0>=b.newScaleY&&b.newScaleY<c.scaleY&&(k=!0);"equally"!==f||d||e?f?"x"!==f||c.get("lockUniScaling")?"y"!==f||c.get("lockUniScaling")||k||e||c.set("scaleY",b.newScaleY):h||d||c.set("scaleX",b.newScaleX):(h||d||c.set("scaleX",
b.newScaleX),k||e||c.set("scaleY",b.newScaleY)):h||k||this._scaleObjectEqually(a,c,b);h||k||this._flipObject(b,f)},_scaleObjectEqually:function(a,b,d){a=a.y+a.x;var c=b.stroke?b.strokeWidth:0;c=(b.height+c/2)*d.original.scaleY+(b.width+c/2)*d.original.scaleX;d.newScaleX=d.original.scaleX*a/c;d.newScaleY=d.original.scaleY*a/c;b.set("scaleX",d.newScaleX);b.set("scaleY",d.newScaleY)},_flipObject:function(a,b){0>a.newScaleX&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX=
"left"));0>a.newScaleY&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x=2*a.x*b.mouseXSign,0>a.x&&(b.mouseXSign=-b.mouseXSign));"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y=2*a.y*b.mouseYSign,0>a.y&&(b.mouseYSign=-b.mouseYSign));d(a.x)>c.padding?a.x=0>a.x?a.x+c.padding:a.x-c.padding:a.x=0;d(a.y)>c.padding?a.y=0>a.y?a.y+c.padding:a.y-c.padding:a.y=0},
_rotateObject:function(a,b){var c=this._currentTransform;if(!c.target.get("lockRotation")){var d=f(c.ey-c.top,c.ex-c.left),g=f(b-c.top,a-c.left);d=e(g-d+c.theta);0>d&&(d=360+d);c.target.angle=d%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,e=b.left,f=b.top,g=d(e),n=d(f);a.fillStyle=this.selectionColor;a.fillRect(b.ex-(0<e?0:-e),b.ey-(0<f?0:-f),
g,n);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(e=b.ex+.5-(0<e?0:g),b=b.ey+.5-(0<f?0:n),a.beginPath(),fabric.util.drawDashedLine(a,e,b,e+g,b,this.selectionDashArray),fabric.util.drawDashedLine(a,e,b+n-1,e+g,b+n-1,this.selectionDashArray),fabric.util.drawDashedLine(a,e,b,e,b+n,this.selectionDashArray),fabric.util.drawDashedLine(a,e+g-1,b,e+g-1,b+n,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(b.ex+.5-(0<e?0:g),b.ey+
.5-(0<f?0:n),g,n)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();
if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},
_checkTarget:function(a,b,d){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,d.x,d.y)))return!0},_searchPossibleTargets:function(a){for(var c,b=this.getPointer(a,!0),d=this._objects.length;d--;)if(!this._objects[d].group&&this._checkTarget(a,this._objects[d],b)){this.relatedTarget=this._objects[d];c=this._objects[d];break}return c},getPointer:function(c,b,d){var e,f;d||(d=this.upperCanvasEl);c=a(c,d);var g=
d.getBoundingClientRect(),h=g.width||0,k=g.height||0;h&&k||("top"in g&&"bottom"in g&&(k=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(h=Math.abs(g.right-g.left)));this.calcOffset();c.x-=this._offset.left;c.y-=this._offset.top;b||(c=fabric.util.transformPoint(c,fabric.util.invertTransform(this.viewportTransform)));0===h||0===k?(e=1,f=1):(e=d.width/h,f=d.height/k);return{x:c.x*e,y:c.y*f}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=
this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},
_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var c=this.getWidth()||a.width,b=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:c+"px",height:b+"px",left:0,top:0});a.width=c;a.height=b;fabric.util.makeElementUnselectable(a)},
_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,b){this._setActiveObject(a);this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});return this},getActiveObject:function(){return this._activeObject},
_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},
_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,d=a.length;b<d;b++)a[b].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var c=this.getActiveGroup()||this.getActiveObject();c&&this.fire("before:selection:cleared",
{target:c,e:a});this.deactivateAll();c&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var c=this.getActiveGroup();c?this._drawGroupControls(a,c):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var c=0,b=this._objects.length;c<b;++c)this._objects[c]&&this._objects[c].active&&(this._objects[c]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[c])}});for(var g in fabric.StaticCanvas)"prototype"!==
g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,e=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();b(fabric.window,"resize",this._onResize);b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);
this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){e(fabric.window,"resize",this._onResize);e(this.upperCanvasEl,"mousedown",
this._onMouseDown);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"mousewheel",this._onMouseWheel);e(this.upperCanvasEl,"touchstart",this._onMouseDown);e(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,
"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&
this.__onLongPress(a,b)},_onMouseDown:function(a){this.__onMouseDown(a);b(fabric.document,"touchend",this._onMouseUp);b(fabric.document,"touchmove",this._onMouseMove);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===a.type?e(this.upperCanvasEl,"mousedown",this._onMouseDown):(b(fabric.document,"mouseup",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){this.__onMouseUp(a);e(fabric.document,
"mouseup",this._onMouseUp);e(fabric.document,"touchend",this._onMouseUp);e(fabric.document,"mousemove",this._onMouseMove);e(fabric.document,"touchmove",this._onMouseMove);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===a.type){var d=this;setTimeout(function(){b(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},
_shouldRender:function(a,b){var d=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==d)||!a&&d||!a&&!d&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{if(this._currentTransform){this._finalizeCurrentTransform();var b=this._currentTransform.target}else b=this.findTarget(a,!0);var e=this._shouldRender(b,
this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);e&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var d=this;setTimeout(function(){d._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),
a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,
this.contextTop);var b=fabric.util.invertTransform(this.viewportTransform);b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(b);this.fire("mouse:down",{e:a});b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=fabric.util.invertTransform(this.viewportTransform);b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor);
this.fire("mouse:move",{e:a});b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in a?1===a.which:1===a.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);
else if(!this._currentTransform){var b=this.findTarget(a),e=this.getPointer(a,!0);this._previousPointer=e;var c=this._shouldRender(b,e),f=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,e):f&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&!f&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));c&&this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();
if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,e){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:e.x,ey:e.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!("undefined"!==
typeof a.touches&&1<a.touches.length)){var b=this._groupSelector;if(b){var e=this.getPointer(a,!0);b.left=e.x-b.ex;b.top=e.y-b.ey;this.renderTop()}else if(this._currentTransform)this._transformObject(a);else{var c=this.findTarget(a);!c||c&&!c.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,c)}this.fire("mouse:move",{target:c,e:a});c&&c.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),e=this._currentTransform;e.reset=!1;e.target.isMoving=!0;this._beforeScaleTransform(a,
e);this._performTransformAction(a,e,b);this.renderAll()},_performTransformAction:function(a,b,e){var c=e.x;e=e.y;var d=b.target,f=b.action;"rotate"===f?(this._rotateObject(c,e),this._fire("rotating",d,a)):"scale"===f?(this._onScale(a,b,c,e),this._fire("scaling",d,a)):"scaleX"===f?(this._scaleObject(c,e,"x"),this._fire("scaling",d,a)):"scaleY"===f?(this._scaleObject(c,e,"y"),this._fire("scaling",d,a)):(this._translateObject(c,e),this._fire("moving",d,a),this.setCursor(this.moveCursor))},_fire:function(a,
b,e){this.fire("object:"+a,{target:b,e:e});b.fire(a,{e:e})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var d=this._shouldCenterTransform(a,b.target);if(d&&("center"!==b.originX||"center"!==b.originY)||!d&&"center"===b.originX&&"center"===b.originY)this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,b,e,c){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(a,
b.target),b.currentAction="scaleEqually",this._scaleObject(e,c,"equally")):(b.currentAction="scale",this._scaleObject(e,c))},_setCursorFromEvent:function(a,b){if(b&&b.selectable){var d=this.getActiveGroup();(d=b._findTargetCorner&&(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(d,b):this.setCursor(b.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(b,d){if(b in a)this.setCursor(this._getRotatedCornerCursor(b,
d));else if("mtr"===b&&d.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(b,d){var e=Math.round(d.getAngle()%360/45);0>e&&(e+=8);e+=a[b];return this.cursorMap[e%8]}})})();
(function(){var a=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var d=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||d&&d!==b)&&this.selection},_handleGrouping:function(a,b){if(b===this.getActiveGroup()&&(b=this.findTarget(a,!0),!b||b.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(b,a):this._createActiveGroup(b,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,b){var d=this.getActiveGroup();
if(d.contains(a)){if(d.removeWithUpdate(a),this._resetObjectTransform(d),a.set("active",!1),1===d.size()){this.discardActiveGroup(b);this.setActiveObject(d.item(0));return}}else d.addWithUpdate(a),this._resetObjectTransform(d);this.fire("selection:created",{target:d,e:b});d.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var d=this._createGroup(a);d.addWithUpdate();this.setActiveGroup(d);this._activeObject=null;this.fire("selection:created",{target:d,
e:b})}a.set("active",!0)},_createGroup:function(a){var b=this.getObjects();a=b.indexOf(this._activeObject)<b.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(a,{canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):1<b.length&&(b=new fabric.Group(b.reverse(),{canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,a),b.saveCoords(),this.fire("selection:created",{target:b}),this.renderAll())},_collectObjects:function(){var e=
[];var f=this._groupSelector.ex;var d=this._groupSelector.ey,g=f+this._groupSelector.left,c=d+this._groupSelector.top,h=new fabric.Point(a(f,g),a(d,c)),k=new fabric.Point(b(f,g),b(d,c));d=f===g&&d===c;for(g=this._objects.length;g--&&!((f=this._objects[g])&&f.selectable&&f.visible&&(f.intersectsWithRect(h,k)||f.isContainedWithinRect(h,k)||f.containsPoint(h)||f.containsPoint(k))&&(f.set("active",!0),e.push(f),d)););return e},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);
if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",e=a.quality||1,f=a.multiplier||1;a={left:a.left,top:a.top,width:a.width,height:a.height};return 1!==f?this.__toDataURLWithMultiplier(b,e,a,f):this.__toDataURL(b,e,a)},__toDataURL:function(a,b,e){this.renderAll(!0);var f=this.upperCanvasEl||this.lowerCanvasEl;e=this.__getCroppedCanvas(f,e);"jpg"===a&&(a="jpeg");a=fabric.StaticCanvas.supports("toDataURLWithQuality")?(e||f).toDataURL("image/"+
a,b):(e||f).toDataURL("image/"+a);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return a},__getCroppedCanvas:function(a,b){if("left"in b||"top"in b||"width"in b||"height"in b){var e=fabric.util.createCanvasElement();var f=e.getContext("2d");e.width=b.width||this.width;e.height=b.height||this.height;f.drawImage(a,-b.left||0,-b.top||0)}return e},__toDataURLWithMultiplier:function(a,b,e,f){var d=this.getWidth(),g=this.getHeight(),c=d*f,h=g*f,k=this.getActiveObject(),m=this.getActiveGroup(),
l=this.contextTop||this.contextContainer;1<f&&this.setWidth(c).setHeight(h);l.scale(f,f);e.left&&(e.left*=f);e.top&&(e.top*=f);e.width?e.width*=f:1>f&&(e.width=c);e.height?e.height*=f:1>f&&(e.height=h);m?this._tempRemoveBordersControlsFromGroup(m):k&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);a=this.__toDataURL(a,b,e);this.width=d;this.height=g;l.scale(1/f,1/f);this.setWidth(d).setHeight(g);m?this._restoreBordersControlsOnGroup(m):k&&this.setActiveObject&&this.setActiveObject(k);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return a},toDataURLWithMultiplier:function(a,b,e){return this.toDataURL({format:a,multiplier:b,quality:e})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=!0;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;
a.borderColor=a.origBorderColor;a.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,e){return this.loadFromJSON(a,b,e)},loadFromJSON:function(a,b,e){if(a){var f="string"===typeof a?JSON.parse(a):a;this.clear();var d=this;this._enlivenObjects(f.objects,function(){d._setBgOverlay(f,b)},e);return this}},_setBgOverlay:function(a,b){var e=this,f={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(a.backgroundImage||a.overlayImage||a.background||a.overlay){var d=function(){f.backgroundImage&&
f.overlayImage&&f.backgroundColor&&f.overlayColor&&(e.renderAll(),b&&b())};this.__setBgOverlay("backgroundImage",a.backgroundImage,f,d);this.__setBgOverlay("overlayImage",a.overlayImage,f,d);this.__setBgOverlay("backgroundColor",a.background,f,d);this.__setBgOverlay("overlayColor",a.overlay,f,d);d()}else b&&b()},__setBgOverlay:function(a,b,e,f){var d=this;if(b)if("backgroundImage"===a||"overlayImage"===a)fabric.Image.fromObject(b,function(b){d[a]=b;e[a]=!0;f&&f()});else this["set"+fabric.util.string.capitalize(a,
!0)](b,function(){e[a]=!0;f&&f()});else e[a]=!0},_enlivenObjects:function(a,b,e){var f=this;if(a&&0!==a.length){var d=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){f.insertAt(a,b,!0)});f.renderOnAddRemove=d;b&&b()},null,e)}else b&&b()},_toDataURL:function(a,b){this.clone(function(e){b(e.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,e){this.clone(function(f){e(f.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var e=JSON.stringify(this.toJSON(b));
this.cloneWithoutData(function(b){b.loadFromJSON(e,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth();b.height=this.getHeight();var e=new fabric.Canvas(b);e.clipTo=this.clipTo;this.backgroundImage?(e.setBackgroundImage(this.backgroundImage.src,function(){e.renderAll();a&&a(e)}),e.backgroundImageOpacity=this.backgroundImageOpacity,e.backgroundImageStretch=this.backgroundImageStretch):a&&a(e)}});
(function(){var a=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(a,b){if(!this.isDrawingMode&&a.touches&&2===a.touches.length&&"gesture"===b.gesture){var d=this.findTarget(a);"undefined"!==typeof d&&(this.__gesturesParams={e:a,self:b,target:d},this.__gesturesRenderer());this.fire("touch:gesture",{target:d,e:a,self:b})}},__gesturesParams:null,__gesturesRenderer:function(){if(null!==this.__gesturesParams&&
null!==this._currentTransform){var a=this.__gesturesParams.self,b=this._currentTransform;b.action="scale";b.originX=b.originY="center";this._setOriginToCenter(b.target);this._scaleObjectBy(a.scale);0!==a.rotation&&(b.action="rotate",this._rotateObjectByAngle(a.rotation));this.renderAll();b.action="drag"}},__onDrag:function(a,b){this.fire("touch:drag",{e:a,self:b})},__onOrientationChange:function(a,b){this.fire("touch:orientation",{e:a,self:b})},__onShake:function(a,b){this.fire("touch:shake",{e:a,
self:b})},__onLongPress:function(a,b){this.fire("touch:longpress",{e:a,self:b})},_scaleObjectBy:function(a,b){var d=this._currentTransform,e=d.target,c=e.get("lockScalingX"),f=e.get("lockScalingY");if(!c||!f){e._scaling=!0;var k=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY);b||(d.newScaleX=d.scaleX*a,d.newScaleY=d.scaleY*a,c||e.set("scaleX",d.scaleX*a),f||e.set("scaleY",d.scaleY*a));e.setPositionByOrigin(k,d.originX,d.originY)}},_rotateObjectByAngle:function(e){var f=this._currentTransform;
f.target.get("lockRotation")||(f.target.angle=b(a(e)+f.theta))}})})();
(function(a){var b=a.fabric||(a.fabric={});a=b.util.object.extend;var e=b.util.toFixed,f=b.util.string.capitalize,d=b.util.degreesToRadians,g=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,
lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof
b.Gradient||this.set("fill",new b.Gradient(a.fill))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof b.Pattern||this.set("fill",new b.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof b.Pattern||this.set("stroke",new b.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=b.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);
this._initPattern(a);this._initClipping(a)},transform:function(a,b){var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y);a.rotate(d(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS;c={type:this.type,originX:this.originX,originY:this.originY,left:e(this.left,c),top:e(this.top,c),width:e(this.width,c),height:e(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,
stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:e(this.strokeMiterLimit,c),scaleX:e(this.scaleX,c),scaleY:e(this.scaleY,c),angle:e(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&
String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(c=this._removeDefaultValues(c));b.util.populateWithProperties(this,c,a);return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype;c.stateProperties.forEach(function(b){a[b]===c[b]&&delete a[b]});return a},toString:function(){return"#<fabric."+f(this.type)+">"},
get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){"object"===typeof a?this._setObject(a):"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(a,d){if("scaleX"===a||"scaleY"===a)d=this._constrainScale(d);"scaleX"===a&&0>d?(this.flipX=!this.flipX,d*=-1):"scaleY"===a&&0>d?(this.flipY=!this.flipY,d*=-1):"width"===a||"height"===a?this.minScaleLimit=e(Math.min(.1,1/Math.max(this.width,this.height)),
2):"shadow"!==a||!d||d instanceof b.Shadow||(d=new b.Shadow(d));this[a]=d;return this},toggle:function(a){var b=this.get(a);"boolean"===typeof b&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,d){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),d||this.transform(a),this._setStrokeStyles(a),
this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&b.util.clipContext(this,a),this._render(a,d),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,
a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(a,e){if(this.active&&!e){var c=this.getViewportTransform();a.save();if(this.group){var f=b.util.transformPoint(this.group.getCenterPoint(),c);a.translate(f.x,f.y);a.rotate(d(this.group.angle))}f=b.util.transformPoint(this.getCenterPoint(),c,null!=this.group);this.group&&
(f.x*=this.group.scaleX,f.y*=this.group.scaleY);a.translate(f.x,f.y);a.rotate(d(this.angle));this.drawBorders(a);this.drawControls(a);a.restore()}},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas.viewportTransform[0]||1,c=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(b+c)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*c*this.scaleY}},_removeShadow:function(a){this.shadow&&
(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(a.save(),this.strokeDashArray?
(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(a,d){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(d),
a):new b.Object(this.toObject(d))},cloneAsImage:function(a){var c=this.toDataURL();b.util.loadImage(c,function(c){a&&a(new b.Image(c))});return this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width;c.height=d.height;b.util.wrapElement(c,"div");d=new b.StaticCanvas(c);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(d.backgroundColor="#fff");var e={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);
this.setPositionByOrigin(new b.Point(c.width/2,c.height/2),"center","center");c=this.canvas;d.add(this);a=d.toDataURL(a);this.set(e).setCoords();this.canvas=c;d.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,d){d||(d={});var c={colorStops:[]};c.type=d.type||(d.r1||d.r2?"radial":"linear");c.coords={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2};if(d.r1||d.r2)c.coords.r1=d.r1,c.coords.r2=d.r2;for(var e in d.colorStops){var f=
new b.Color(d.colorStops[e]);c.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,b.Gradient.forObject(this,c))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();
return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=
a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(a){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(a.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,a(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(b,e,f){var d=b.x,g=b.y,c=this.stroke?this.strokeWidth:0;"left"===e?d=b.x+(this.getWidth()+c*this.scaleX)/2:"right"===e&&(d=b.x-(this.getWidth()+c*this.scaleX)/2);"top"===f?g=b.y+(this.getHeight()+c*this.scaleY)/2:"bottom"===f&&(g=b.y-(this.getHeight()+c*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(d,g),b,a(this.angle))},translateToOriginPoint:function(b,
e,f){var d=b.x,g=b.y,c=this.stroke?this.strokeWidth:0;"left"===e?d=b.x-(this.getWidth()+c*this.scaleX)/2:"right"===e&&(d=b.x+(this.getWidth()+c*this.scaleX)/2);"top"===f?g=b.y-(this.getHeight()+c*this.scaleY)/2:"bottom"===f&&(g=b.y+(this.getHeight()+c*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(d,g),b,a(this.angle))},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,
e){var b=this.getCenterPoint();return this.translateToOriginPoint(b,a,e)},toLocalPoint:function(b,e,f){var d=this.getCenterPoint(),g=this.stroke?this.strokeWidth:0;e&&f?(e="left"===e?d.x-(this.getWidth()+g*this.scaleX)/2:"right"===e?d.x+(this.getWidth()+g*this.scaleX)/2:d.x,f="top"===f?d.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===f?d.y+(this.getHeight()+g*this.scaleY)/2:d.y):(e=this.left,f=this.top);return fabric.util.rotatePoint(new fabric.Point(b.x,b.y),d,-a(this.angle)).subtractEquals(new fabric.Point(e,
f))},setPositionByOrigin:function(a,e,f){a=this.translateToCenterPoint(a,e,f);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(b){var e=a(this.angle),f=this.getWidth()/2,d=Math.cos(e)*f;f*=Math.sin(e);var g=this.getWidth(),c=Math.cos(e)*g;e=Math.sin(e)*g;"center"===this.originX&&"left"===b||"right"===this.originX&&"center"===b?(this.left-=d,this.top-=f):"left"===this.originX&&"center"===b||"center"===this.originX&&"right"===
b?(this.left+=d,this.top+=f):"left"===this.originX&&"right"===b?(this.left+=c,this.top+=e):"right"===this.originX&&"left"===b&&(this.left-=c,this.top-=e);this.setCoords();this.originX=b},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();
(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,e){var b=this.oCoords,d=new fabric.Point(b.tl.x,b.tl.y),g=new fabric.Point(b.tr.x,b.tr.y),c=new fabric.Point(b.bl.x,b.bl.y);b=new fabric.Point(b.br.x,b.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([d,g,b,c],a,e).status},intersectsWithObject:function(a){function b(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,
a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var f=b(this.oCoords);a=b(a.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([f.tl,f.tr,f.br,f.bl],[a.tl,a.tr,a.br,a.bl]).status},isContainedWithinObject:function(a){var b=a.getBoundingRect();a=new fabric.Point(b.left,b.top);b=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(a,b)},isContainedWithinRect:function(a,e){var b=this.getBoundingRect();return b.left>=
a.x&&b.left+b.width<=e.x&&b.top>=a.y&&b.top+b.height<=e.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,b);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,e){var b=0,d;for(d in e){var g=e[d];if(!(g.o.y<a.y&&g.d.y<a.y||g.o.y>=a.y&&g.d.y>=a.y)){if(g.o.x===g.d.x&&g.o.x>=a.x)var c=g.o.x;else{c=(g.d.y-g.o.y)/(g.d.x-g.o.x);
var h=a.y-0*a.x;g=g.o.y-c*g.o.x;c=-(h-g)/(0-c)}c>=a.x&&(b+=1);if(2===b)break}}return b},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],e=fabric.util.array.min(a);a=fabric.util.array.max(a);a=Math.abs(e-a);var f=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],
d=fabric.util.array.min(f);f=fabric.util.array.max(f);return{left:e,top:d,width:a,height:Math.abs(d-f)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1);this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var b=
this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var b=a(this.angle),e=this.getViewportTransform(),f=this._calculateCurrentDimensions(!1),d=f.x,g=f.y;0>d&&(d=Math.abs(d));f=Math.sqrt(Math.pow(d/2,2)+Math.pow(g/2,2));var c=Math.atan(isFinite(g/d)?g/d:0),h=Math.cos(c+b)*f;c=Math.sin(c+b)*f;f=Math.sin(b);b=Math.cos(b);var k=this.getCenterPoint();
g=new fabric.Point(d,g);k=new fabric.Point(k.x-h,k.y-c);c=new fabric.Point(k.x+g.x*b,k.y+g.x*f);d=fabric.util.transformPoint(new fabric.Point(k.x-g.y*f,k.y+g.y*b),e);h=fabric.util.transformPoint(new fabric.Point(c.x-g.y*f,c.y+g.y*b),e);g=fabric.util.transformPoint(k,e);e=fabric.util.transformPoint(c,e);c=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2);k=new fabric.Point((e.x+g.x)/2,(e.y+g.y)/2);var m=new fabric.Point((h.x+e.x)/2,(h.y+e.y)/2),l=new fabric.Point((h.x+d.x)/2,(h.y+d.y)/2);f=new fabric.Point(k.x+
f*this.rotatingPointOffset,k.y-b*this.rotatingPointOffset);this.oCoords={tl:g,tr:e,br:h,bl:d,ml:c,mt:k,mr:m,mb:l,mtr:f};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(a){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a);return this},bringForward:function(a){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a);return this},moveTo:function(a){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var a=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",b=this.fillRule,e=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",f=this.strokeWidth?this.strokeWidth:"0",d=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",e,"; stroke-width: ",f,"; stroke-dasharray: ",d,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",
this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",a,"; fill-rule: ",b,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var a=fabric.util.toFixed,b=this.getAngle(),e=!this.canvas||this.canvas.svgViewportTransformation?
this.getViewportTransform():[1,0,0,1,0,0],f=fabric.util.transformPoint(this.getCenterPoint(),e),d=fabric.Object.NUM_FRACTION_DIGITS;f="path-group"===this.type?"":"translate("+a(f.x,d)+" "+a(f.y,d)+")";b=0!==b?" rotate("+a(b,d)+")":"";a=1===this.scaleX&&1===this.scaleY&&1===e[0]&&1===e[3]?"":" scale("+a(this.scaleX*e[0],d)+" "+a(this.scaleY*e[3],d)+")";d="path-group"===this.type?this.width*e[0]:0;e="path-group"===this.type?this.height*e[3]:0;return[f,b,a,this.flipX?" matrix(-1 0 0 1 "+d+" 0) ":"",
this.flipY?" matrix(1 0 0 -1 0 "+e+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var a=[];this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1));this.shadow&&a.push(this.shadow.toSVG(this));return a}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);a&&a.stateProperties&&a.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var b=a.x;a=a.y;var f;for(f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)){var d=this._getImageLines(this.oCoords[f].corner);d=this._findCrossPoints({x:b,y:a},d);if(0!==d&&1===d%2)return this.__corner=
f}return!1},_setCornerCoords:function(){var b=this.oCoords,e=a(45-this.angle),f=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,d=f*Math.cos(e);e=f*Math.sin(e);var g;for(g in b){f=b[g].x;var c=b[g].y;b[g].corner={tl:{x:f-e,y:c-d},tr:{x:f+d,y:c-e},bl:{x:f-d,y:c+e},br:{x:f+e,y:c+d}}}},_calculateCurrentDimensions:function(a){var b=this.getViewportTransform(),f=this.strokeWidth,d=this.width,g=this.height,c="round"===this.strokeLineCap||"square"===this.strokeLineCap,h="line"===this.type&&0===this.width,k="line"===
this.type&&0===this.height,m=h||k;h?d=f:k&&(g=f);if(c&&k||!m)d+=0>d?-f:f;if(c&&h||!m)g+=0>g?-f:f;d=d*this.scaleX+2*this.padding;g=g*this.scaleY+2*this.padding;return a?fabric.util.transformPoint(new fabric.Point(d,g),b,!0):{x:d,y:g}},drawBorders:function(a){if(!this.hasBorders)return this;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;a.lineWidth=1/this.borderScaleFactor;var b=this._calculateCurrentDimensions(!0),f=b.x;b=b.y;this.group&&(f*=this.group.scaleX,
b*=this.group.scaleY);a.strokeRect(~~-(f/2)-.5,~~-(b/2)-.5,~~f+1,~~b+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(f=-b/2,a.beginPath(),a.moveTo(0,f),a.lineTo(0,f-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var b=this._calculateCurrentDimensions(!0),f=b.x;b=b.y;var d=-(f/2),g=-(b/2),c=this.cornerSize/2,h=this.transparentCorners?"strokeRect":"fillRect";
a.save();a.lineWidth=1;a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,h,d-c,g-c);this._drawControl("tr",a,h,d+f-c,g-c);this._drawControl("bl",a,h,d-c,g+b-c);this._drawControl("br",a,h,d+f-c,g+b-c);this.get("lockUniScaling")||(this._drawControl("mt",a,h,d+f/2-c,g-c),this._drawControl("mb",a,h,d+f/2-c,g+b-c),this._drawControl("mr",a,h,d+f-c,g+b/2-c),this._drawControl("ml",a,h,d-c,g+b/2-c));this.hasRotatingPoint&&this._drawControl("mtr",
a,h,d+f/2-c,g-this.rotatingPointOffset-c);a.restore();return this},_drawControl:function(a,e,f,d,g){this.isControlVisible(a)&&(a=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(d,g,a,a),e[f](d,g,a,a))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,e){this._getControlsVisibility()[a]=e;return this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},
_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
(function(a){function b(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,w=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case w:return Math.max(this.get(d),this.get(e))}}}var e=a.fabric||(a.fabric={}),f=e.util.object.extend,d={x1:1,x2:1,y1:1,y2:1},g=e.StaticCanvas.supports("setLineDash");e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){this.callSuper("_set",a,b);"undefined"!==typeof d[a]&&
this._setWidthHeight();return this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();if(b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&g)c=this.calcLinePoints(),a.moveTo(c.x1,
c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();e.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return f(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*this.width*
.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),e.Line.ATTRIBUTE_NAMES=
e.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),e.Line.fromElement=function(a,b){var c=e.parseAttributes(a,e.Line.ATTRIBUTE_NAMES);return new e.Line([c.x1||0,c.y1||0,c.x2||0,c.y2||0],f(c,b))},e.Line.fromObject=function(a){return new e.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=Math.PI,f=b.util.object.extend;b.Circle?b.warn("fabric.Circle is already defined."):(b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*e,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return f(this.callSuper("toObject",
a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0,f=(this.endAngle-this.startAngle)%(2*e);0===f?(this.group&&"path-group"===this.group.type&&(c=this.left+this.radius,d=this.top+this.radius),b.push("<circle ",'cx="'+c+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):b.push('<path d="M '+Math.cos(this.startAngle)*
this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(f>e?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),b.Circle.fromElement=function(a,e){e||(e={});var c=b.parseAttributes(a,b.Circle.ATTRIBUTE_NAMES);if(!("radius"in c&&0<=c.radius))throw Error("value of `r` attribute is required and can not be negative");
c.left=c.left||0;c.top=c.top||0;c=new b.Circle(f(c,e));c.left-=c.radius;c.top-=c.radius;return c},b.Circle.fromObject=function(a){return new b.Circle(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Triangle?b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,d=this.height/2;a.beginPath();a.moveTo(-b,d);a.lineTo(0,-d);a.lineTo(b,d);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var e=this.width/2,d=
this.height/2;a.beginPath();b.util.drawDashedLine(a,-e,d,0,-d,this.strokeDashArray);b.util.drawDashedLine(a,0,-d,e,d,this.strokeDashArray);b.util.drawDashedLine(a,e,d,-e,d,this.strokeDashArray);a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),d=this.width/2,e=this.height/2;d=[-d+" "+e,"0 "+-e,d+" "+e].join();b.push("<polygon ",'points="',d,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
b.Triangle.fromObject=function(a){return new b.Triangle(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=2*Math.PI,f=b.util.object.extend;b.Ellipse?b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*
this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return f(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry);b.push("<ellipse ",'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');
return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,e,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),b.Ellipse.fromElement=function(a,e){e||(e={});var c=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);c.left=c.left||0;c.top=c.top||0;c=new b.Ellipse(f(c,
e));c.top-=c.ry;c.left-=c.rx;return c},b.Ellipse.fromObject=function(a){return new b.Ellipse(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Rect?console.warn("fabric.Rect is already defined"):(a=b.Object.prototype.stateProperties.concat(),a.push("rx","ry","x","y"),b.Rect=b.util.createClass(b.Object,{stateProperties:a,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&
1===this.height)a.fillRect(0,0,1,1);else{var d=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,f=this.height,m=b?this.left:-this.width/2,l=b?this.top:-this.height/2,n=0!==d||0!==c;a.beginPath();a.moveTo(m+d,l);a.lineTo(m+e-d,l);n&&a.bezierCurveTo(m+e-.4477152502*d,l,m+e,l+.4477152502*c,m+e,l+c);a.lineTo(m+e,l+f-c);n&&a.bezierCurveTo(m+e,l+f-.4477152502*c,m+e-.4477152502*d,l+f,m+e-d,l+f);a.lineTo(m+d,l+f);n&&a.bezierCurveTo(m+.4477152502*d,l+f,m,l+
f-.4477152502*c,m,l+f-c);a.lineTo(m,l+c);n&&a.bezierCurveTo(m,l+.4477152502*c,m+.4477152502*d,l,m+d,l);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(a){var d=-this.width/2,e=-this.height/2,c=this.width,f=this.height;a.beginPath();b.util.drawDashedLine(a,d,e,d+c,e,this.strokeDashArray);b.util.drawDashedLine(a,d+c,e,d+c,e+f,this.strokeDashArray);b.util.drawDashedLine(a,d+c,e+f,d,e+f,this.strokeDashArray);b.util.drawDashedLine(a,d,e+f,d,e,this.strokeDashArray);
a.closePath()},toObject:function(a){a=e(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),e=this.left,c=this.top;this.group&&"path-group"===this.group.type||(e=-this.width/2,c=-this.height/2);b.push("<rect ",'x="',e,'" y="',c,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d){if(!a)return null;d=d||{};var f=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=new b.Rect(e(d?b.util.object.clone(d):{},f));f.visible=0<f.width&&0<f.height;return f},b.Rect.fromObject=function(a){return new b.Rect(a)})})("undefined"!==
typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Polyline?b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(a,f){return b.Polygon.prototype.initialize.call(this,a,f)},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return b.Polygon.prototype._applyPointOffset.call(this)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,a)},toSVG:function(a){return b.Polygon.prototype.toSVG.call(this,
a)},_render:function(a){b.Polygon.prototype.commonRender.call(this,a)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){a.beginPath();for(var e=0,d=this.points.length;e<d;e++){var g=this.points[e];var c=this.points[e+1]||g;b.util.drawDashedLine(a,g.x,g.y,c.x,c.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,f){if(!a)return null;f||(f={});var d=b.parsePointsAttribute(a.getAttribute("points")),
e=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(d,b.util.object.extend(e,f))},b.Polyline.fromObject=function(a){return new b.Polyline(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend,f=b.util.array.min,d=b.util.array.max,g=b.util.toFixed;b.Polygon?b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",b);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in b||(this.left=this.minX)},_calcDimensions:function(){var a=this.points,b=f(a,"x"),e=f(a,"y"),g=d(a,
"x");a=d(a,"y");this.width=g-b||0;this.height=a-e||0;this.minX=b||0;this.minY=e||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return e(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;d<e;d++)b.push(g(this.points[d].x,2),",",g(this.points[d].y,2)," ");c.push("<",this.type," ",'points="',b.join(""),
'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a){var b=this.points.length;if(!b||isNaN(this.points[b-1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=
null);a.moveTo(this.points[0].x,this.points[0].y);for(var c=0;c<b;c++){var d=this.points[c];a.lineTo(d.x,d.y)}return!0},_renderDashedStroke:function(a){b.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var c=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);return new b.Polygon(c,
e(f,d))},b.Polygon.fromObject=function(a){return new b.Polygon(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.array.min,f=b.util.array.max,d=b.util.object.extend,g=Object.prototype.toString,c=b.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},k={m:"l",M:"L"};b.Path?b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");var c="[object Array]"===g.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||
(this.path=this._parsePath()),this._setPositionDimensions(),b.sourcePath&&this.setSourcePath(b.sourcePath)},_setPositionDimensions:function(){var a=this._parseDimensions();this.minX=a.left;this.minY=a.top;this.width=a.width;this.height=a.height;a.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0;a.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;this.top=this.top||a.top;this.left=this.left||a.left;this.pathOffset=this.pathOffset||{x:this.minX+
this.width/2,y:this.minY+this.height/2}},_render:function(a){var b=null,d=0,e=0,f=0,g=0,h=0,k=0,m=-this.pathOffset.x,B=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(B=m=0);a.beginPath();for(var D=0,F=this.path.length;D<F;++D){var z=this.path[D];switch(z[0]){case "l":f+=z[1];g+=z[2];a.lineTo(f+m,g+B);break;case "L":f=z[1];g=z[2];a.lineTo(f+m,g+B);break;case "h":f+=z[1];a.lineTo(f+m,g+B);break;case "H":f=z[1];a.lineTo(f+m,g+B);break;case "v":g+=z[1];a.lineTo(f+m,g+B);break;case "V":g=
z[1];a.lineTo(f+m,g+B);break;case "m":f+=z[1];g+=z[2];d=f;e=g;a.moveTo(f+m,g+B);break;case "M":f=z[1];g=z[2];d=f;e=g;a.moveTo(f+m,g+B);break;case "c":var v=f+z[5];var y=g+z[6];h=f+z[3];k=g+z[4];a.bezierCurveTo(f+z[1]+m,g+z[2]+B,h+m,k+B,v+m,y+B);f=v;g=y;break;case "C":f=z[5];g=z[6];h=z[3];k=z[4];a.bezierCurveTo(z[1]+m,z[2]+B,h+m,k+B,f+m,g+B);break;case "s":v=f+z[3];y=g+z[4];null===b[0].match(/[CcSs]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.bezierCurveTo(h+m,k+B,f+z[1]+m,g+z[2]+B,v+m,y+B);h=f+z[1];k=g+z[2];
f=v;g=y;break;case "S":v=z[3];y=z[4];null===b[0].match(/[CcSs]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.bezierCurveTo(h+m,k+B,z[1]+m,z[2]+B,v+m,y+B);f=v;g=y;h=z[1];k=z[2];break;case "q":v=f+z[3];y=g+z[4];h=f+z[1];k=g+z[2];a.quadraticCurveTo(h+m,k+B,v+m,y+B);f=v;g=y;break;case "Q":v=z[3];y=z[4];a.quadraticCurveTo(z[1]+m,z[2]+B,v+m,y+B);f=v;g=y;h=z[1];k=z[2];break;case "t":v=f+z[1];y=g+z[2];null===b[0].match(/[QqTt]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.quadraticCurveTo(h+m,k+B,v+m,y+B);f=v;g=y;break;case "T":v=z[1];
y=z[2];null===b[0].match(/[QqTt]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.quadraticCurveTo(h+m,k+B,v+m,y+B);f=v;g=y;break;case "a":c(a,f+m,g+B,[z[1],z[2],z[3],z[4],z[5],z[6]+f+m,z[7]+g+B]);f+=z[6];g+=z[7];break;case "A":c(a,f+m,g+B,[z[1],z[2],z[3],z[4],z[5],z[6]+m,z[7]+B]);f=z[6];g=z[7];break;case "z":case "Z":f=d,g=e,a.closePath()}b=z}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=
d(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));b=b.join(" ");this.group&&
"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,f,g=0,u=this.path.length;g<u;g++){c=this.path[g];f=c.slice(1).trim();
for(b.length=0;d=e.exec(f);)b.push(d[0]);c=[c.charAt(0)];f=0;for(var x=b.length;f<x;f++)d=parseFloat(b[f]),isNaN(d)||c.push(d);d=c[0];f=h[d.toLowerCase()];x=k[d]||d;if(c.length-1>f)for(var B=1,D=c.length;B<D;B+=f)a.push([d].concat(c.slice(B,B+f))),d=x;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],c=[],d,g=null,h=0,k=0,t=0,u=0,x=0,B=0,D,F,z,v=0,y=this.path.length;v<y;++v){d=this.path[v];switch(d[0]){case "l":t+=d[1];u+=d[2];z=[];break;case "L":t=d[1];u=d[2];z=[];break;case "h":t+=
d[1];z=[];break;case "H":t=d[1];z=[];break;case "v":u+=d[1];z=[];break;case "V":u=d[1];z=[];break;case "m":t+=d[1];u+=d[2];h=t;k=u;z=[];break;case "M":t=d[1];u=d[2];h=t;k=u;z=[];break;case "c":D=t+d[5];F=u+d[6];x=t+d[3];B=u+d[4];z=b.util.getBoundsOfCurve(t,u,t+d[1],u+d[2],x,B,D,F);t=D;u=F;break;case "C":t=d[5];u=d[6];x=d[3];B=d[4];z=b.util.getBoundsOfCurve(t,u,d[1],d[2],x,B,t,u);break;case "s":D=t+d[3];F=u+d[4];null===g[0].match(/[CcSs]/)?(x=t,B=u):(x=2*t-x,B=2*u-B);z=b.util.getBoundsOfCurve(t,u,
x,B,t+d[1],u+d[2],D,F);x=t+d[1];B=u+d[2];t=D;u=F;break;case "S":D=d[3];F=d[4];null===g[0].match(/[CcSs]/)?(x=t,B=u):(x=2*t-x,B=2*u-B);z=b.util.getBoundsOfCurve(t,u,x,B,d[1],d[2],D,F);t=D;u=F;x=d[1];B=d[2];break;case "q":D=t+d[3];F=u+d[4];x=t+d[1];B=u+d[2];z=b.util.getBoundsOfCurve(t,u,x,B,x,B,D,F);t=D;u=F;break;case "Q":x=d[1];B=d[2];z=b.util.getBoundsOfCurve(t,u,x,B,x,B,d[3],d[4]);t=d[3];u=d[4];break;case "t":D=t+d[1];F=u+d[2];null===g[0].match(/[QqTt]/)?(x=t,B=u):(x=2*t-x,B=2*u-B);z=b.util.getBoundsOfCurve(t,
u,x,B,x,B,D,F);t=D;u=F;break;case "T":D=d[1];F=d[2];null===g[0].match(/[QqTt]/)?(x=t,B=u):(x=2*t-x,B=2*u-B);z=b.util.getBoundsOfCurve(t,u,x,B,x,B,D,F);t=D;u=F;break;case "a":z=b.util.getBoundsOfArc(t,u,d[1],d[2],d[3],d[4],d[5],d[6]+t,d[7]+u);t+=d[6];u+=d[7];break;case "A":z=b.util.getBoundsOfArc(t,u,d[1],d[2],d[3],d[4],d[5],d[6],d[7]);t=d[6];u=d[7];break;case "z":case "Z":t=h,u=k}g=d;z.forEach(function(b){a.push(b.x);c.push(b.y)});a.push(t);c.push(u)}d=e(a);g=e(c);h=f(a);k=f(c);return{left:d,top:g,
width:h-d,height:k-g}}}),b.Path.fromObject=function(a,c){"string"===typeof a.path?b.loadSVGFromURL(a.path,function(d){d=d[0];var e=a.path;delete a.path;b.util.object.extend(d,a);d.setSourcePath(e);c(d)}):c(new b.Path(a.path,a))},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,c,e){a=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);c&&c(new b.Path(a.d,d(a,e)))},b.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend,f=b.util.array.invoke,d=b.Object.prototype.toObject;b.PathGroup?b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed);this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},
parseDimensionsFromPaths:function(a){for(var c,d,e=[],f=[],g,n=this.transformMatrix,q=this.paths.length;q--;)for(c=this.paths[q],d=c.height+c.strokeWidth,g=c.width+c.strokeWidth,c=[{x:c.left,y:c.top},{x:c.left+g,y:c.top},{x:c.left,y:c.top+d},{x:c.left+g,y:c.top+d}],g=0;g<c.length;g++)d=c[g],n&&(d=b.util.transformPoint(d,n,!1)),e.push(d.x),f.push(d.y);a.width=Math.max.apply(null,e);a.height=Math.max.apply(null,f)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,
this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&b.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var c=0,d=this.paths.length;c<d;++c)this.paths[c].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){a=e(d.call(this,a),{paths:f(this.getObjects(),"toObject",a)});this.sourcePath&&
(a.sourcePath=this.sourcePath);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){var b=this.getObjects(),d=this.getPointByOrigin("left","top");d="translate("+d.x+" "+d.y+")";d=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n"];for(var e=0,f=b.length;e<f;e++)d.push(b[e].toSVG(a));d.push("</g>\n");return a?a(d.join("")):d.join("")},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){"string"===typeof a.paths?b.loadSVGFromURL(a.paths,function(d){var e=a.paths;
delete a.paths;d=b.util.groupSVGElements(d,a,e);c(d)}):b.util.enlivenObjects(a.paths,function(d){delete a.paths;c(new b.PathGroup(d,a))})},b.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend,f=b.util.array.min,d=b.util.array.max,g=b.util.array.invoke;if(!b.Group){var c={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;this.originalState={};this.callSuper("initialize");b.originX&&(this.originX=
b.originX);b.originY&&(this.originY=b.originY);this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",b);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop(),d=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-d.x,top:c-d.y});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+
this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),a.group=this);this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=
this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties)for(var c=this._objects.length;c--;)this._objects[c].set(a,b);this.callSuper("_set",a,b)},toObject:function(a){return e(this.callSuper("toObject",a),{objects:g(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();
this.clipTo&&b.util.clipContext(this,a);this.transform(a);for(var c=0,d=this._objects.length;c<d;c++)this._renderObject(this._objects[c],a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,
this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&
(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},
_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==
this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],c=[],d,e,f=["tr","br","bl","tl"],g=0,h=this._objects.length;g<h;++g){d=this._objects[g];d.setCoords();for(var t=0;t<f.length;t++)e=f[t],b.push(d.oCoords[e].x),c.push(d.oCoords[e].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(a,c,e){var g=b.util.invertTransform(this.getViewportTransform()),h=b.util.transformPoint(new b.Point(f(a),
f(c)),g);a=b.util.transformPoint(new b.Point(d(a),d(c)),g);a={width:a.x-h.x||0,height:a.y-h.y||0};e||(a.left=h.x||0,a.top=h.y||0,"center"===this.originX&&(a.left+=a.width/2),"right"===this.originX&&(a.left+=a.width),"center"===this.originY&&(a.top+=a.height/2),"bottom"===this.originY&&(a.top+=a.height));return a},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):
b.join("")},get:function(a){if(a in c){if(this[a])return this[a];for(var b=0,d=this._objects.length;b<d;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects;c&&c(new b.Group(d,a))})};b.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(a){var b=fabric.util.object.extend;a.fabric||(a.fabric={});a.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,b){b||(b={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",b);this._initElement(a,b);this._initConfig(b);b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},
setElement:function(a,b,d){this._originalElement=this._element=a;this._initConfig(d);0!==this.filters.length?this.applyFilters(b):b&&b();return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var b=
-this.width/2,d=-this.height/2,e=this.width,c=this.height;a.save();this._setStrokeStyles(a);a.beginPath();fabric.util.drawDashedLine(a,b,d,b+e,d,this.strokeDashArray);fabric.util.drawDashedLine(a,b+e,d,b+e,d+c,this.strokeDashArray);fabric.util.drawDashedLine(a,b+e,d+c,b,d+c,this.strokeDashArray);fabric.util.drawDashedLine(a,b,d+c,b,d,this.strokeDashArray);a.closePath();a.restore()},toObject:function(a){return b(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,
filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(a){var b=[],d=-this.width/2,e=-this.height/2,c="none";this.group&&"path-group"===this.group.type&&(d=this.left,e=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(c="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',
this.getSvgSrc(),'" x="',d,'" y="',e,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',c,'"',"></image>\n");if(this.stroke||this.strokeDashArray)c=this.fill,this.fill=null,b.push("<rect ",'x="',d,'" y="',e,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=c;b.push("</g>\n");return a?a(b.join("")):b.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},
setSrc:function(a,b,d){fabric.util.loadImage(a,function(a){return this.setElement(a,b,d)},this,d&&d.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a,b,d,g){b=b||this.filters;if(d=d||this._originalElement){var c=d,e=fabric.util.createCanvasElement(),f=fabric.util.createImage(),m=this;e.width=c.width;e.height=c.height;e.getContext("2d").drawImage(c,0,0,c.width,c.height);
if(0===b.length)return this._element=d,a&&a(),e;b.forEach(function(a){a&&a.applyTo(e,a.scaleX||m.scaleX,a.scaleY||m.scaleY);!g&&a&&"Resize"===a.type&&(m.width*=a.scaleX,m.height*=a.scaleY)});f.width=e.width;f.height=e.height;fabric.isLikelyNode?(f.src=e.toBuffer(void 0,fabric.Image.pngCompression),m._element=f,!g&&(m._filteredEl=f),a&&a()):(f.onload=function(){m._element=f;!g&&(m._filteredEl=f);a&&a();f.onload=e=c=null},f.src=e.toDataURL("image/png"));return e}},_render:function(a,b){var d=this._findMargins();
var e=b?this.left:-this.width/2;var c=b?this.top:-this.height/2;"slice"===this.meetOrSlice&&(a.beginPath(),a.rect(e,c,this.width,this.height),a.clip());if(!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;var f=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)}else f=this._element;f&&a.drawImage(f,e+d.marginX,c+d.marginY,d.width,d.height);this._renderStroke(a)},_needsResize:function(){return this.scaleX!==
this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a=this.width,b=this.height,d=0,g=0;if("none"!==this.alignX||"none"!==this.alignY)a=[this.width/this._element.width,this.height/this._element.height],b="meet"===this.meetOrSlice?Math.min.apply(null,a):Math.max.apply(null,a),a=this._element.width*b,b*=this._element.height,"Mid"===this.alignX&&(d=(this.width-a)/2),"Max"===this.alignX&&(d=this.width-a),"Mid"===this.alignY&&(g=(this.height-b)/2),"Max"===this.alignY&&(g=this.height-
b);return{width:a,height:b,marginX:d,marginY:g}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a.filters&&a.filters.length?fabric.util.enlivenObjects(a.filters,
function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(d){fabric.Image.prototype._initFilters.call(a,a,function(e){a.filters=
e||[];e=new fabric.Image(d,a);b&&b(e)})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,b,d){fabric.util.loadImage(a,function(a){b&&b(new fabric.Image(a,d))},null,d&&d.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(a,f,d){a=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);var e="xMidYMid",c="meet",h;a.preserveAspectRatio&&(h=a.preserveAspectRatio.split(" "));h&&h.length&&
(c=h.pop(),"meet"!==c&&"slice"!==c?(e=c,c="meet"):h.length&&(e=h.pop()));h="none"!==e?e.slice(1,4):"none";e="none"!==e?e.slice(5,8):"none";a.alignX=h;a.alignY=e;a.meetOrSlice=c;fabric.Image.fromURL(a["xlink:href"],f,b(d?fabric.util.object.clone(d):{},a))},fabric.Image.async=!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?exports:this);fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var e=a.data,c=this.brightness,f=0,k=e.length;f<k;f+=4)e[f]+=c,e[f+1]+=c,e[f+2]+=c;b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{brightness:this.brightness})}});
b.Image.filters.Brightness.fromObject=function(a){return new b.Image.filters.Brightness(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=b.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){var b=this.matrix,e=a.getContext("2d"),c=e.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(b.length));
var f=Math.floor(a/2),k=c.data,m=c.width;c=c.height;for(var l=this._createImageData(m,c),n=l.data,q=this.opaque?1:0,r=0;r<c;r++)for(var w=0;w<m;w++){for(var t=r,u=w,x=4*(r*m+w),B=0,D=0,F=0,z=0,v=0;v<a;v++)for(var y=0;y<a;y++){var A=t+v-f,C=u+y-f;0>A||A>c||0>C||C>m||(A=4*(A*m+C),C=b[v*a+y],B+=k[A]*C,D+=k[A+1]*C,F+=k[A+2]*C,z+=k[A+3]*C)}n[x]=B;n[x+1]=D;n[x+2]=F;n[x+3]=z+q*(255-z)}e.putImageData(l,0,0)},toObject:function(){return e(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});
b.Image.filters.Convolute.fromObject=function(a){return new b.Image.filters.Convolute(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var e=a.data,c=this.threshold,f=e.length,k=0,m=e.length;k<m;k+=4)e[k+3]=c+255*(f-k)/f;b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{threshold:this.threshold})}});
b.Image.filters.GradientTransparency.fromObject=function(a){return new b.Image.filters.GradientTransparency(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var d=a.data,e=a.width*a.height*4,c=0,h;c<e;)h=(d[c]+d[c+1]+d[c+2])/3,d[c]=h,d[c+1]=h,d[c+2]=h,c+=4;b.putImageData(a,0,0)}});b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var d=a.data,e=d.length,c;for(c=0;c<e;c+=4)d[c]=255-d[c],d[c+1]=255-d[c+1],d[c+2]=255-d[c+2];b.putImageData(a,0,0)}});b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(a){if(this.mask){var d=a.getContext("2d");a=d.getImageData(0,0,a.width,a.height);var e=a.data,c=this.mask.getElement(),f=b.util.createCanvasElement(),k=this.channel,m=a.width*a.height*4;f.width=c.width;f.height=c.height;f.getContext("2d").drawImage(c,
0,0,c.width,c.height);f=f.getContext("2d").getImageData(0,0,c.width,c.height).data;for(c=0;c<m;c+=4)e[c+3]=f[c+k];d.putImageData(a,0,0)}},toObject:function(){return e(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});b.Image.filters.Mask.fromObject=function(a,d){b.util.loadImage(a.mask.src,function(e){a.mask=new b.Image(e,a.mask);d&&d(new b.Image.filters.Mask(a))})};b.Image.filters.Mask.async=!0})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var e=a.data,c=this.noise,f,k=0,m=e.length;k<m;k+=4)f=(.5-Math.random())*c,e[k]+=f,e[k+1]+=f,e[k+2]+=f;b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{noise:this.noise})}});b.Image.filters.Noise.fromObject=
function(a){return new b.Image.filters.Noise(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var e=a.data,c=a.height,f=a.width,k,m;for(k=0;k<c;k+=this.blocksize)for(m=0;m<f;m+=this.blocksize){var l=4*k*f+4*m;var n=e[l];var q=e[l+1];var r=e[l+2];var w=e[l+3];for(var t=k,u=k+this.blocksize;t<u;t++)for(var x=
m,B=m+this.blocksize;x<B;x++)l=4*t*f+4*x,e[l]=n,e[l+1]=q,e[l+2]=r,e[l+3]=w}b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{blocksize:this.blocksize})}});b.Image.filters.Pixelate.fromObject=function(a){return new b.Image.filters.Pixelate(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var e=a.data,c=this.distance,f=255-this.threshold,k=Math.abs,m,l,n,q=0,r=e.length;q<r;q+=4)m=e[q],l=e[q+1],n=e[q+2],m>f&&l>f&&n>f&&k(m-l)<c&&k(m-n)<c&&k(l-n)<c&&
(e[q+3]=1);b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});b.Image.filters.RemoveWhite.fromObject=function(a){return new b.Image.filters.RemoveWhite(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var d=a.data,e=d.length,c;for(c=0;c<e;c+=4){var h=.3*d[c]+.59*d[c+1]+.11*d[c+2];d[c]=h+100;d[c+1]=h+50;d[c+2]=h+255}b.putImageData(a,0,0)}});b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var d=a.data,e=d.length,c;for(c=0;c<e;c+=4){var h=d[c];var k=d[c+1];var m=d[c+2];d[c]=(.393*h+.769*k+.189*m)/1.351;d[c+1]=(.349*h+.686*k+.168*m)/1.203;d[c+2]=(.272*h+.534*k+.131*m)/2.14}b.putImageData(a,0,0)}});b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2}})("undefined"!==
typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{};this.color=a.color||"#000000";this.opacity="undefined"!==typeof a.opacity?a.opacity:(new b.Color(this.color)).getAlpha()},applyTo:function(a){var d=a.getContext("2d");a=d.getImageData(0,0,a.width,a.height);var e=a.data,c=e.length;var f=(new b.Color(this.color)).getSource();var k=f[0]*this.opacity;var m=f[1]*this.opacity;var l=
f[2]*this.opacity;var n=1-this.opacity;for(f=0;f<c;f+=4){var q=e[f];var r=e[f+1];var w=e[f+2];e[f]=k+q*n;e[f+1]=m+r*n;e[f+2]=l+w*n}d.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});b.Image.filters.Tint.fromObject=function(a){return new b.Image.filters.Tint(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend;b.Image.filters.Multiply=b.util.createClass(b.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(a){var d=a.getContext("2d");a=d.getImageData(0,0,a.width,a.height);var e=a.data,c=e.length,f;var k=(new b.Color(this.color)).getSource();for(f=0;f<c;f+=4)e[f]*=k[0]/255,e[f+1]*=k[1]/255,e[f+2]*=k[2]/255;d.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),
{color:this.color})}});b.Image.filters.Multiply.fromObject=function(a){return new b.Image.filters.Multiply(a)}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric;b.Image.filters.Blend=b.util.createClass({type:"Blend",initialize:function(a){a=a||{};this.color=a.color||"#000";this.image=a.image||!1;this.mode=a.mode||"multiply";this.alpha=a.alpha||1},applyTo:function(a){var e=a.getContext("2d");a=e.getImageData(0,0,a.width,a.height);var d=a.data,g=!1;if(this.image){g=!0;var c=b.util.createCanvasElement();c.width=this.image.width;c.height=this.image.height;c=new b.StaticCanvas(c);c.add(this.image);c=c.getContext("2d").getImageData(0,
0,c.width,c.height).data}else{c=(new b.Color(this.color)).getSource();var h=c[0]*this.alpha;var k=c[1]*this.alpha;var m=c[2]*this.alpha}for(var l=0,n=d.length;l<n;l+=4){var q=d[l];var r=d[l+1];var w=d[l+2];g&&(h=c[l]*this.alpha,k=c[l+1]*this.alpha,m=c[l+2]*this.alpha);switch(this.mode){case "multiply":d[l]=q*h/255;d[l+1]=r*k/255;d[l+2]=w*m/255;break;case "screen":d[l]=1-(1-q)*(1-h);d[l+1]=1-(1-r)*(1-k);d[l+2]=1-(1-w)*(1-m);break;case "add":d[l]=Math.min(255,q+h);d[l+1]=Math.min(255,r+k);d[l+2]=Math.min(255,
w+m);break;case "diff":case "difference":d[l]=Math.abs(q-h);d[l+1]=Math.abs(r-k);d[l+2]=Math.abs(w-m);break;case "subtract":q-=h;r-=k;w-=m;d[l]=0>q?0:q;d[l+1]=0>r?0:r;d[l+2]=0>w?0:w;break;case "darken":d[l]=Math.min(q,h);d[l+1]=Math.min(r,k);d[l+2]=Math.min(w,m);break;case "lighten":d[l]=Math.max(q,h),d[l+1]=Math.max(r,k),d[l+2]=Math.max(w,m)}}e.putImageData(a,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});b.Image.filters.Blend.fromObject=function(a){return new b.Image.filters.Blend(a)}})("undefined"!==
typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=Math.pow,f=Math.floor,d=Math.sqrt,g=Math.abs,c=Math.max,h=Math.round,k=Math.sin,m=Math.ceil;b.Image.filters.Resize=b.util.createClass(b.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var d=a.width,e=a.height;b=h(d*b);c=h(e*c);var f;"sliceHack"===this.resizeType&&(f=this.sliceByTwo(a,d,e,b,c));"hermite"===this.resizeType&&(f=this.hermiteFastResize(a,
d,e,b,c));"bilinear"===this.resizeType&&(f=this.bilinearFiltering(a,d,e,b,c));"lanczos"===this.resizeType&&(f=this.lanczosResize(a,d,e,b,c));a.width=b;a.height=c;a.getContext("2d").putImageData(f,0,0)},sliceByTwo:function(a,d,e,g,h){var k=a.getContext("2d"),l=.5,n=.5,m=1,r=1,q=!1,w=!1,v=d,y=e,A=b.util.createCanvasElement(),C=A.getContext("2d");g=f(g);h=f(h);A.width=c(g,d);A.height=c(h,e);g>d&&(l=2,m=-1);h>e&&(n=2,r=-1);var H=k.getImageData(0,0,d,e);a.width=c(g,d);a.height=c(h,e);for(k.putImageData(H,
0,0);!q||!w;)d=v,e=y,g*m<f(v*l*m)?v=f(v*l):(v=g,q=!0),h*r<f(y*n*r)?y=f(y*n):(y=h,w=!0),H=k.getImageData(0,0,d,e),C.putImageData(H,0,0),k.clearRect(0,0,v,y),k.drawImage(A,0,0,d,e,0,0,v,y);return k.getImageData(0,0,g,h)},lanczosResize:function(a,b,c,h,w){var l,n,r;function q(a){var k,m,t,B,u,x;n=(a+.5)*A;l=f(n);for(k=0;k<w;k++){r=(k+.5)*C;S=f(r);var D=x=u=B=t=0;for(m=l-P;m<=l+P;m++)if(!(0>m||m>=b)){var E=f(1E3*g(m-n));O[E]||(O[E]={});for(var L=S-M;L<=S+M;L++)if(!(0>L||L>=c)){var U=f(1E3*g(L-r));O[E][U]||
(O[E][U]=y(d(e(E*H,2)+e(U*G,2))/1E3));U=O[E][U];if(0<U){var J=4*(L*b+m);t+=U;B+=U*z[J];u+=U*z[J+1];x+=U*z[J+2];D+=U*z[J+3]}}}J=4*(k*h+a);v[J]=B/t;v[J+1]=u/t;v[J+2]=x/t;v[J+3]=D/t}return++a<h?q(a):F}a=a.getContext("2d");var D=a.getImageData(0,0,b,c),F=a.getImageData(0,0,h,w),z=D.data,v=F.data,y=function(a){return function(b){if(b>a)return 0;b*=Math.PI;if(1E-16>g(b))return 1;var c=b/a;return k(b)*k(c)/b/c}}(this.lanczosLobes),A=this.rcpScaleX,C=this.rcpScaleY,H=2/this.rcpScaleX,G=2/this.rcpScaleY,P=
m(A*this.lanczosLobes/2),M=m(C*this.lanczosLobes/2),O={};var S=l=r=n=void 0;return q(0)},bilinearFiltering:function(a,b,c,d,e){var g,h=0,k=this.rcpScaleX,l=this.rcpScaleY;var n=a.getContext("2d");a=4*(b-1);c=n.getImageData(0,0,b,c).data;var m=n.getImageData(0,0,d,e),r=m.data;for(n=0;n<e;n++)for(g=0;g<d;g++){var q=f(k*g);var y=f(l*n);var A=k*g-q;var w=l*n-y;y=4*(y*b+q);for(q=0;4>q;q++){var H=c[y+q];var G=c[y+4+q];var P=c[y+a+q];var M=c[y+a+4+q];H=H*(1-A)*(1-w)+G*A*(1-w)+P*w*(1-A)+M*A*w;r[h++]=H}}return m},
hermiteFastResize:function(a,b,c,e,h){var k=this.rcpScaleX,l=this.rcpScaleY,n=m(k/2),r=m(l/2);a=a.getContext("2d");c=a.getImageData(0,0,b,c).data;a=a.getImageData(0,0,e,h);for(var q=a.data,w=0;w<h;w++)for(var z=0;z<e;z++){for(var v=4*(z+w*e),y,A=0,C=0,H=0,G=0,P=0,M=0,O=(w+.5)*l,S=f(w*l);S<(w+1)*l;S++){var L=g(O-(S+.5))/r,R=(z+.5)*k;L*=L;for(var K=f(z*k);K<(z+1)*k;K++){var T=g(R-(K+.5))/n;y=d(L+T*T);1<y&&-1>y||(y=2*y*y*y-3*y*y+1,0<y&&(T=4*(K+S*b),M+=y*c[T+3],C+=y,255>c[T+3]&&(y=y*c[T+3]/250),H+=y*
c[T],G+=y*c[T+1],P+=y*c[T+2],A+=y))}}q[v]=H/A;q[v+1]=G/A;q[v+2]=P/A;q[v+3]=M/C}return a},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});b.Image.filters.Resize.fromObject=function(){return new b.Image.filters.Resize}})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),e=b.util.object.extend,f=b.util.object.clone,d=b.util.toFixed,g=b.StaticCanvas.supports("setLineDash");b.Text?b.warn("fabric.Text is already defined"):(a=b.Object.prototype.stateProperties.concat(),a.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,
strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:a,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(a){if(!this.__skipDimension){a||(a=b.util.createCanvasElement().getContext("2d"),
this._setTextStyles(a));this._textLines=this.text.split(this._reNewline);this._clearCache();var c=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(a);this.textAlign=c;this.height=this._getTextHeight(a)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&b.util.clipContext(this,a);this._renderTextBackground(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&
a.restore()},_renderText:function(a){a.save();this._translateForTextAlign(a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a);this._renderTextStroke(a);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&a.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=
this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;c<d;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,d,e,f){b[a](d,e,f)},_renderTextLine:function(a,b,d,e,f,g){f-=this.fontSize*this._fontSizeFraction;if("justify"!==this.textAlign)this._renderChars(a,b,d,e,f,g);else{var c=this._getLineWidth(b,g),
h=this.width;if(h>=c){c=d.split(/\s+/);d=this._getWidthOfWords(b,d,g);h=(h-d)/(c.length-1);for(var k=d=0,l=c.length;k<l;k++)this._renderChars(a,b,c[k],e+d,f,g),d+=b.measureText(c[k]).width+h}else this._renderChars(a,b,d,e,f,g)}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck){for(var b=0,c=0,d=this._textLines.length;c<
d;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+f,c);b+=e}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var b=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));
a.beginPath();for(var c=0,d=this._textLines.length;c<d;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+f,c);b+=e}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),
a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a){var b=0,c=this._getHeightOfLine();if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var d=0,e=this._textLines.length;d<e;d++){if(""!==this._textLines[d]){var f=this._getLineWidth(a,d),g=this._getLineLeftOffset(f);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+b,f,this.fontSize*this._fontSizeMult)}b+=
c}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var a=!1,b;for(b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];this.__lineWidths[b]=a.measureText(this._textLines[b]).width;
return this.__lineWidths[b]},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var d=0,e,f;var g=0;for(e=this._textLines.length;g<e;g++){var r=this._getLineWidth(a,g),w=this._getLineLeftOffset(r),t=this._getHeightOfLine(a,g);var u=0;for(f=c.length;u<f;u++)a.fillRect(this._getLeftOffset()+
w,d+(this._fontSizeMult-1+c[u])*this.fontSize-b,r,this.fontSize/15);d+=t}}}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&
a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},toObject:function(a){a=e(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);
return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx);c=this._getSVGTextAndBg(c.textTop,c.textLeft);this._wrapSVGTextAndBg(b,c);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:this.group&&"path-group"===this.group.type?-this.top:0,lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],d=[],e=
0;this._setSVGBg(d);for(var f=0,g=this._textLines.length;f<g;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,e,f,g,l){f=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-l+f-this.height/2;e.push('<tspan x="',d(g+this._getLineLeftOffset(this.__lineWidths[a]),4),'" ','y="',d(f,4),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(this._textLines[a]),
"</tspan>")},_setSVGTextLineBg:function(a,b,e,f,g){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',d(e+this._getLineLeftOffset(this.__lineWidths[b]),4),'" y="',d(g-this.height/2,4),'" width="',d(this.__lineWidths[b],4),'" height="',d(this._getHeightOfLine(this.ctx,b)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',d(-this.width/2,4),'" y="',d(-this.height/2,4),'" width="',
d(this.width,4),'" height="',d(this.height,4),'"></rect>\n')},_getFillAttributes:function(a){var c=a&&"string"===typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,d){if(!a)return null;var c=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);d=b.util.object.extend(d?b.util.object.clone(d):{},c);d.top=d.top||0;d.left=d.left||0;"dx"in c&&(d.left+=c.dx);"dy"in c&&(d.top+=c.dy);"fontSize"in d||(d.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE);d.originX||(d.originX="left");c=a.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");c=new b.Text(c,d);var e=0;"left"===c.originX&&(e=c.getWidth()/2);"right"===c.originX&&
(e=-c.getWidth()/2);c.set({left:c.getLeft()+e,top:c.getTop()-c.getHeight()/2+c.fontSize*(.18+c._fontSizeFraction)});return c},b.Text.fromObject=function(a){return new b.Text(a.text,f(a))},b.util.createAccessors(b.Text))})("undefined"!==typeof exports?exports:this);
(function(){function a(a,b,c){var e=f.parse(a);e.port||(e.port=0===e.protocol.indexOf("https:")?443:80);a=(0===e.protocol.indexOf("https:")?g:d).request({hostname:e.hostname,port:e.port,path:e.path,method:"GET"},function(a){var d="";b&&a.setEncoding(b);a.on("end",function(){c(d)});a.on("data",function(b){200===a.statusCode&&(d+=b)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+e.hostname+":"+e.port):fabric.log(a.message)});a.end()}function b(a,
b){require("fs").readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"===typeof document||"undefined"===typeof window){var e=require("xmldom").DOMParser,f=require("url"),d=require("http"),g=require("https"),c=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(c,d,e){function f(a){g.src=new Buffer(a,"binary");g._src=c;d&&d.call(e,g)}var g=new h;c&&(c instanceof Buffer||0===c.indexOf("data"))?(g.src=g._src=c,d&&d.call(e,g)):c&&0!==c.indexOf("http")?b(c,f):
c?a(c,"binary",f):d&&d.call(e,c)};fabric.loadSVGFromURL=function(c,d,e){c=c.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==c.indexOf("http")?b(c,function(a){fabric.loadSVGFromString(a.toString(),d,e)}):a(c,"",function(a){fabric.loadSVGFromString(a,d,e)})};fabric.loadSVGFromString=function(a,b,c){a=(new e).parseFromString(a);fabric.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},c)};fabric.util.getScript=function(b,c){a(b,"",function(a){eval(a);c&&c()})};fabric.Image.fromObject=function(a,
b){fabric.util.loadImage(a.src,function(c){var d=new fabric.Image(c);d._initConfig(a);d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};fabric.createCanvasForNode=function(a,b,d,e){e=e||d;var f=fabric.document.createElement("canvas");a=new c(a||600,b||600,e);f.style={};f.width=a.width;f.height=a.height;d=new (fabric.Canvas||fabric.StaticCanvas)(f,d);d.contextContainer=a.getContext("2d");d.nodeCanvas=a;d.Font=c.Font;return d};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};
fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var k=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a,b){k.call(this,a,b);this.nodeCanvas.width=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var m=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a,b){m.call(this,a,b);this.nodeCanvas.height=a;return this};fabric.Canvas&&
(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();
var ciptaAPI=function(){var a={};a.domain=CIPTA.APIURL+"/";a.action_upload_image=a.domain+"v1/image/upload";a.action_render_image=a.domain+"v1/image/render";a.action_list_fonts=a.domain+"v1/font/list";a.action_get_font=a.domain+"v1/font/get";a.action_preview_font=a.domain+"v1/font/preview";a.action_render_text=a.domain+"v1/text/render";a.action_list_cliparts=a.domain+"v1/clipart/list";a.action_get_clipart=a.domain+"v1/clipart/get";a.action_render_clipart=a.domain+"v1/clipart/render";a.action_preview_clipart=
a.domain+"v1/clipart/preview";a.action_list_attrmockup=a.domain+"v1/product/attrmockup";a.action_list_items=a.domain+"v1/product/items";a.action_submit_custom=a.domain+"v1/custom/submit";a.action_edit_custom=a.domain+"v1/custom/edit";a.action_detail_custom=a.domain+"v1/custom/detail";a.action_load_custom=a.domain+"v1/custom/load";a.action_design_add=a.domain+"v1/design/";a.action_design_edit=a.domain+"v1/design/";a.action_design_list=a.domain+"v1/design/list";a.action_product_subtypes=a.domain+"v1/product/subtypes";
a.action_mockup_custom=a.domain+"v1/mock/custom";a.buildRequestURI=function(b,e,f){return a["action_"+b]?(b=a["action_"+b],f&&(b=b+"/"+f),e&&(b=b+"?"+$.map(e,function(a,b){return b+"="+encodeURIComponent(a)}).join("&")),b):null};a.requestGET=function(a,e,f){if(e&&1==e)$.ajax({type:"GET",url:a,async:!0,xhrFields:{withCredentials:!0}}).done(function(a){f&&f(a.result)}).fail(function(){throw"Server Error, Unable to retrieve "+a+", Please Try Again Later.";});else{e=$.ajax({type:"GET",url:a,async:!1}).responseText;
e=JSON.parse(e);if(e._meta&&e._meta.status&&"SUCCESS"==e._meta.status)return e.result;throw"Server Error, Unable to retrieve "+a+", Please Try Again Later.";}};a.postData=function(a,e,f,d,g,c){a={type:"POST",cache:!1,url:a,async:e,xhrFields:{withCredentials:!0}};1==c?(a.contentType="application/json",a.dataType="json",a.data=JSON.stringify(f)):a.data=f;$.ajax(a).done(function(a){d&&d(a.result)}).fail(function(a){(msg=a.responseJSON)&&msg.result?g&&g(msg.result):g&&g()})};a.patchData=function(a,e,
f,d,g,c){a={type:"PATCH",cache:!1,url:a,async:e,xhrFields:{withCredentials:!0}};1==c?(a.contentType="application/json",a.dataType="json",a.data=JSON.stringify(f)):a.data=f;$.ajax(a).done(function(a){d&&d(a.result)}).fail(function(a){(msg=a.responseJSON)&&msg.result?g&&g(msg.result):g&&g()})};a.rt4=function(a){for(var b=[],f=0;f<a.length;f++){var d=a.charCodeAt(f);b[f]=33<=d&&126>=d?String.fromCharCode(33+(d+14)%94):String.fromCharCode(d)}return b.join("")};a.packdt=function(b){return a.rt4(Base64.encode(a.rt4(JSON.stringify(b))))};
a.unpackdt=function(b){return a.rt4(Base64.decode(a.rt4(b)))};a.submitCustomDesign=function(b,e,f,d,g,c,h,k,m,l){h="undefined"!==typeof h?h:!1;f={design:d,title:f,product_attr_id:g,print_methods:c};!l||_.isUndefined(l)||_.isEmpty(l)||l.is_save_design&&1==l.is_save_design&&(f.is_save_design=1);l=window.location.href;if((d=l.match(/design=([0-9a-zA-Z]+)/))&&d[1]){g=1;var n=d[1]}else g=0;CIPTA.is_cipta_design&&CIPTA.design_hash?f.cipta_design_hash=CIPTA.design_hash:CIPTA.design_hash_original?f.cipta_design_hash=
CIPTA.design_hash_original:g?f.cipta_design_hash=n:(d=l.match(/custom=([0-9a-zA-Z]+)/))&&d[1]&&(f.cipta_custom_hash_original=d[1]);"edit"==b?(l=a.action_edit_custom,f.hash=e):l=a.action_submit_custom;f=a.packdt(f);$.ajax({contentType:"application/json",dataType:"json",type:"POST",cache:!1,url:l,async:h,xhrFields:{withCredentials:!0},data:JSON.stringify({_pckdata:f})}).done(function(a){k&&k(a.result)}).fail(function(a,b){a&&a.responseJSON&&a.responseJSON.result&&a.responseJSON.result.userMessage?m&&
m(a.responseJSON.result.userMessage):m&&m()})};return a},ciptaRequest=ciptaAPI(),ciptaFont=function(a){var b={id:a.id,name:a.name,description:a.description,fonts:a.fonts,type:a.type,tags:a.tags,getPreviewImage:function(a){a=a||"regular";return b.fonts[a]?b.fonts[a].preview?b.fonts[a].preview:ciptaRequest.buildRequestURI("preview_font",{id:b.id,style:a}):null},getFontStyles:function(){return _.keys(b.fonts)}};return b},ciptaFontList=function(){var a={},b={},e={retrieveFontList:function(e,d){var f=
{};e&&(f.tags=e);f=ciptaRequest.buildRequestURI("list_fonts",f);ciptaRequest.requestGET(f,!0,function(c){a[e]=[];$.each(c,function(c,d){a[e].push(ciptaFont({id:d.id,name:d.name,description:d.description,type:d.type,fonts:d.fonts,tags:d.tags}));b[d.id]=ciptaFont({id:d.id,name:d.name,description:d.description,type:d.type,fonts:d.fonts,tags:d.tags})});d&&d()})},getFontList:function(b,d){a[b]&&0<a[b].length?d&&d(a[b]):e.retrieveFontList(b,function(){d&&d(a[b])});return null},getFontbyID:function(a,d){if(b[a])return d&&
d(b[a]),b[a];if(!d)return null;var e=ciptaRequest.buildRequestURI("get_font",{id:a});ciptaRequest.requestGET(e,!0,function(c){b[c.id]=ciptaFont({id:c.id,name:c.name,description:c.description,type:c.type,fonts:c.fonts,tags:c.tags});d&&d(b[a])});return null}};return e},ciptaClipart=function(a){var b={id:a.id,name:a.name,filename:a.filename,preview_small:a.preview_small,preview_med:a.preview_med,tags:a.tags,info:a.info,iscolorable:a.iscolorable,usage:a.usage,type:a.type,getPreviewImage:function(a){return"medium"==
(a||"small")?b.preview_med?b.preview_med:a=ciptaRequest.buildRequestURI("preview_clipart",{id:b.id,size:"medium"}):b.preview_small?b.preview_small:a=ciptaRequest.buildRequestURI("preview_clipart",{id:b.id,size:"small"})}};return b},ciptaClipartList=function(a){var b={},e={},f={retrieveClipartList:function(d,f,c){var g={};d&&(g.tags=d);a&&(g.usage=a);c&&(g.sort=c);c=ciptaRequest.buildRequestURI("list_cliparts",g);ciptaRequest.requestGET(c,!0,function(a){b[d]=[];$.each(a,function(a,c){b[d].push(ciptaClipart({id:c.id,
name:c.name,filename:c.filename,preview_small:c.preview_small,preview_med:c.preview_med,tags:c.tags,info:c.info,iscolorable:c.iscolorable,usage:c.usage,type:c.type}));e[c.id]=ciptaClipart({id:c.id,name:c.name,filename:c.filename,preview_small:c.preview_small,preview_med:c.preview_med,tags:c.tags,info:c.info,iscolorable:c.iscolorable,usage:c.usage,type:c.type});if("string"==typeof e[c.id].info&&""!=e[c.id].info)try{e[c.id].info=JSON.parse(e[c.id].info)}catch(n){console.log(n.message)}});f&&f()})},
getClipartList:function(a,e,c){b[a]&&0<b[a].length?e&&e(b[a]):f.retrieveClipartList(a,function(){e&&e(b[a])},c);return null},getClipartbyID:function(a,b){if(e[a])return b&&b(e[a]),e[a];if(!b)return null;var c=ciptaRequest.buildRequestURI("get_clipart",{id:a});ciptaRequest.requestGET(c,!0,function(c){e[c.id]=ciptaClipart({id:c.id,name:c.name,filename:c.filename,preview_small:c.preview_small,preview_med:c.preview_med,tags:c.tags,info:c.info,iscolorable:c.iscolorable,usage:c.usage,type:c.type});"string"==
typeof e[c.id].info&&""!=e[c.id].info&&(e[c.id].info=JSON.parse(e[c.id].info));b&&b(e[a])});return null}};return f},ciptaProductAttrList=function(a){var b="undefied"!==typeof a?a:ciptaRequest,e=[],f=[],d=[],g=[],c=[],h=[],k=[],m={retrieveProducts:function(a,n){n&&"subtype"==n||(n="item");var l="item"==n?b.buildRequestURI("list_attrmockup",null,a):b.buildRequestURI("list_attrmockup",{type:"subtype"},a);if(l=b.requestGET(l,!1))e=l.editor_mockups,f=l.attr_detail,d=l.product_attr_fields,g=l.product_attr_tree,
c=l.print_methods,h=l.display_options,k=l.product_details},getProductType:function(){if(k&&k.product_type_name)return k.product_type_name},getSelectableAttribute:function(){var a=m.getProductType();if("tees"==a)return"attr_tees_color_id";if("casing"==a)return"attr_casings_material_id";if("slate"==a)return"attr_slate_size_id";if("drinkware"==a)return"attr_mugs_style_id";if("flair"==a)return"attr_flairs_style_id";if("stationery"==a)return"attr_stationeries_style_id";if("home"==a)return"attr_homes_style_id";
if("bags"==a)return"attr_bags_color_id";if("electronic"==a)return"attr_electronics_color_id"},getAttributeName:function(a){return d&&d.fields&&d.fields[a]?d.fields[a]:null},getAttrFields:function(){return d?d:null},getAttrTree:function(){if("undefined"!=typeof g)return g},getDisplayOptions:function(){return h?h:null},getProduct:function(a){return"undefined"!=typeof e[a]?e[a]:null},getProductAttrDetail:function(a){return"undefined"!=typeof f[a]?f[a]:null},getDefaultProduct:function(){var a=Object.keys(e);
a=a[0];return"undefined"!=typeof e[a]?e[a]:null},getProductAttrTreeRoot:function(){if("undefined"!=typeof g)return Object.keys(g)},getProductAttrTreeSecond:function(a){if("undefined"!=typeof g&&"undefined"!=typeof g[a])return Object.keys(g[a])},getDefaultProductIDByAttrID:function(a){if("undefined"!=typeof g[a]){for(a=g[a];"object"==typeof a;)a=a[Object.keys(a)[0]];return a}return null},getDefaultProductAttrID:function(){if(!_.isUndefined(g)){for(var a=g[_.first(_.keys(g))];"object"==typeof a;)a=
a[Object.keys(a)[0]];return a}return null},getProductAttrTreeID:function(a){for(var b=g,c=0;c<d.fields.length;c++){if(_.isUndefined(a[d.fields[c]])||_.isUndefined(b[a[d.fields[c]]]))return null;b=b[a[d.fields[c]]]}return _.isObject(b)?null:b},getMockups:function(a){return"undefined"!=typeof e[a]&&"undefined"!=typeof e[a].product_mockups?e[a].product_mockups:null},getPrice:function(a){return"undefined"!=typeof e[a]&&"undefined"!=typeof e[a].attr_info&&"undefined"!=typeof e[a].attr_info.price?e[a].attr_info.price:
null},getPrice2:function(a){return"undefined"!=typeof e[a]&&"undefined"!=typeof e[a].attr_info&&"undefined"!=typeof e[a].attr_info.price_2?e[a].attr_info.price_2:null},getStock:function(a){return"undefined"!=typeof e[a]&&"undefined"!=typeof e[a].attr_info&&"undefined"!=typeof e[a].attr_info.stock_available?e[a].attr_info.stock_available:null},getPrintMethods:function(a){return"undefined"!=typeof e[a]&&"undefined"!=typeof e[a].print_methods?e[a].print_methods:null},getPrintMethodInfo:function(a){return _.isEmpty(c[a])?
null:c[a]},getDefaultPrintMethod:function(a){a=m.getPrintMethods(a);if(!_.isEmpty(a))if(1<a.length){for(var b,c=0,d=0;d<a.length;d++)if(p=a[d],b=m.getPrintMethodInfo(p),!_.isEmpty(b)&&!_.isNaN(b.is_default)&&1==b.is_default){c=p;break}if(0<c)return c}else if(1==a.length)return a[0];return null},getDefaultPrintMethodForType:function(){var a=m.getProductType();if("tees"==a)return 1;if("casing"==a||"slate"==a||"drinkware"==a||"flair"==a||"home"==a||"bags"==a)return 3;if("electronic"==a)return 5},computeStockTree:function(a){if(_.isObject(a)){var b=
Object.keys(a),c={available:!1,children:{}},d=!1;_.forEach(b,function(b){var e=m.computeStockTree(a[b]);_.isObject(e)?(c.children[b]=e,e.available&&(d=!0)):(c.children[b]=e)&&(d=!0)});c.available=d;return c}return m.getStock(a)}};return m},ciptaProductItemList=function(){var a=[],b=[],e=ciptaRequest;return{retrieveProductItems:function(f){var d={};if(_.isArray(f)){var g=0;_.forEach(f,function(a){d["subtypes["+g+"]"]=a;g+=1})}else d.subtypes=f;f=e.buildRequestURI("list_items",d,null);$.ajax({type:"GET",
url:f,async:!1}).done(function(c){if(c._meta&&c._meta.status&&"SUCCESS"==c._meta.status)a=c.result,b=[],_.forEach(a,function(a){b[a.id]=a});else throw"Server Error, Unable to retrieve list of products. Please Try Again Later!";}).fail(function(a){throw"System Error: Cannot Retrieve Product List. Please Try Again Later!";})},getProductDetail:function(a){return b[a]},getProductItems:function(){return a},getGridList:function(b){var d=[];a&&0<a.length&&_.forEach(a,function(a){if(_.isUndefined(b)||_.isNull(b)||
b==a.product_subtype_id){var c=_.isUndefined(a.images)||_.isUndefined(a.images[0])?"/assets/img/imgnotfound.jpg":a.images[0].ObjectURL;d.push({id:a.id,img:c,label:a.public_name,description:a.description,sort_order:a.sort_order})}});return d}}},ciptaProductSubtypeList=function(){var a=[],b=ciptaRequest;return{retrieveProductSubtypes:function(e){var f={};if(_.isArray(e)){var d=0;_.forEach(e,function(a){f["types["+d+"]"]=a;d+=1})}else f.types=e;e=b.buildRequestURI("product_subtypes",f,null);$.ajax({type:"GET",
url:e,async:!1}).done(function(b){if(b._meta&&b._meta.status&&"SUCCESS"==b._meta.status)a=b.result;else throw"Server Error, Unable to retrieve list of product subtypes. Please Try Again Later!";}).fail(function(a){throw"System Error: Cannot Retrieve Product Subtypes. Please Try Again Later!";})},getProductSubtypes:function(){return a},getGridList:function(){var b=[];a&&0<a.length&&_.forEach(a,function(a){var d=_.isUndefined(a.images)||_.isUndefined(a.images[0])?"/assets/img/imgnotfound.jpg":a.images[0].ObjectURL;
b.push({id:a.id,img:d,label:a.public_name})});return b}}},ciptaProductDesigns=function(){var a={},b=null,e=0,f=0,d=0,g=null,c=null,h=null,k=null,m=null;a.setDesign=function(b,c,h,k){g=b;f=1==c?1:0;e=1==h?1:0;d=1==k?1:0;return a};a.setProductTypeID=function(b){c=b;return a};a.setProductItemID=function(b){h=b;return a};a.setProductAttrID=function(b){k=b;return a};a.setCiptaStoreID=function(b){m=b;return a};a.addEditDesign=function(a,n,q,r){b="__Desain__ "+_.random(1,1E6,0);if(!g||0>=g.length)return r?
r("Desain tidak boleh kosong!"):$.notifier("Desain tidak boleh kosong!"),!1;if(!c||0>=c)return r?r("Invalid product_type_id !"):$.notifier("Invalid product_type_id !"),!1;if(!h||0>=h)return r?r("Invalid product_item_id !"):$.notifier("Invalid product_item_id !"),!1;if(!k||0>=k)return r?r("Invalid product_attr_id !"):$.notifier("Invalid product_attr_id !"),!1;if(!m||0>=m)return r?r("Invalid cipta_store_id !"):$.notifier("Invalid cipta_store_id !"),!1;g=JSON.stringify(g);"edit"==a?(a={hash:CIPTA.hash,
is_template:e,is_custom:f,is_placeholder:d,design:g,product_item_id:h,product_attr_id:k},ciptaRequest.patchData(ciptaRequest.action_design_edit+CIPTA.hash,!0,a,n,q,!0)):(a={is_template:e,is_custom:f,is_placeholder:d,design:g,product_type_id:c,product_item_id:h,product_attr_id:k,cipta_store_id:m,title:b,permission:0},ciptaRequest.postData(ciptaRequest.action_design_add,!0,a,n,q));return!0};return a},ciptaProductInfoModel=function(){var a=null,b={},e=1,f=null,d=0;return{setProductItemID:function(b){b&&
(a=b)},setProductAttrID:function(a,c){a&&c&&(b[a]=c)},unsetProductAttrID:function(a){a&&b[a]&&delete b[a]},setAmount:function(a){0<a&&a<=MAX_CART_ITEMS&&(e=a)},getProductItemID:function(){return a},getProductAttrID:function(a){return _.isUndefined(b[a])?null:b[a]},getProductAttrs:function(){return b},getAmount:function(){return e},setPrintMethod:function(a){f=a},getPrintMethod:function(){return f},setNsurfaces:function(a){d=a},getNsurfaces:function(){return d},getAllInfo:function(){var d={};d.product_item_id=
a;d.product_attrs=b;d.amount=e;d.price=0;d.print_method=f;d.product_attr_id=ciptaProductAttr.getProductAttrTreeID(b);return d}}},ciptaFonts=ciptaFontList(),ciptaCliparts=ciptaClipartList(ASSET_CLIPART+","+ASSET_CLIPART_PNG+","+ASSET_SILHOUETTE+","+ASSET_SILHOUETTE_OUTLINE+","+ASSET_DESIGN_ELEMENTS),ciptaOverlay=ciptaClipartList(ASSET_TEXTURE+","+ASSET_BACKGROUND+","+ASSET_BACKGROUND_GRADIENT+","+ASSET_TEXTURE_OVERLAY),ciptaFrameMask=ciptaClipartList(ASSET_FRAME_MASK+","+ASSET_SILHOUETTE),ciptaFilter=
ciptaClipartList(ASSET_FILTER),ciptaProductAttr=ciptaProductAttrList(ciptaRequest),ciptaProductItem=ciptaProductItemList(),ciptaProductSubtype=ciptaProductSubtypeList(),ciptaDesign=ciptaProductDesigns(),ciptaProductInfo=ciptaProductInfoModel();"undefined"!==typeof module&&(module.exports={ciptaAPINode:function(){return ciptaAPI()},ciptaProductAttrListNode:function(){return ciptaProductAttrList(ciptaAPI())}});
var ciptaText=function(a){var b={attr:{text:"",font_id:null,style:"regular",font_cat:"popular",color:"#000",size:175,stroke:{width:0,color:"#000"},shadow:{type:0,color:"#000"},shape:{type:0,amount:0},overlay:{category:0,id:null,type:99},template:{},others:{}},preview:{id:null,img:null}};a&&$.extend(!0,b.attr,a);b.initialize=function(a,f){a&&(b.attr=_.cloneDeep(a));f&&(b.preview=_.cloneDeep(f))};b.clone=function(){var a=ciptaText();a.initialize(b.attr,b.preview);return a};b.getText=function(){return b.attr.text};
b.setText=function(a){b.attr.text=a};b.getFontID=function(){return b.attr.font_id};b.setFontID=function(a){b.attr.font_id=a};b.getFontStyle=function(){return b.attr.style};b.setFontStyle=function(a){b.attr.style=a};b.getFontCategory=function(){return b.attr.font_cat};b.setFontCategory=function(a){b.attr.font_cat=a};b.getColor=function(){return b.attr.color};b.setColor=function(a){b.attr.color=a};b.getSize=function(){return b.attr.size};b.setSize=function(a){b.attr.size=a};b.getOthers=function(a){return b.attr.others[a]};
b.setOthers=function(a,f){b.attr.others[a]=f};b.unsetOthers=function(a){b.attr.others[a]&&delete b.attr.others[a]};b.getStroke=function(a){return b.attr.stroke[a]};b.setStroke=function(a,f){b.attr.stroke[a]=f};b.getShadow=function(a){return b.attr.shadow[a]};b.setShadow=function(a,f){b.attr.shadow[a]=f};b.getShape=function(a){return b.attr.shape[a]};b.setShape=function(a,f){b.attr.shape[a]=f};b.getOverlay=function(a){return b.attr.overlay[a]};b.setOverlay=function(a,f){b.attr.overlay[a]=f};b.getTemplate=
function(a){return b.attr.template[a]};b.setTemplate=function(a,f){b.attr.template[a]=f};b.getPreview=function(){return b.preview};b.getAttr=function(){return b.attr};b.createPreview=function(a){if(!b.attr.text||!b.attr.text.match(/\S/))throw"Silahkan Masukkan Teks";if(null==b.attr.font_id)throw"Silahkan Pilih Jenis Font";ciptaFonts.getFontbyID(b.attr.font_id,function(e){b.attr.style||(b.attr.style="regular");if(!e.fonts[b.attr.style].filename)throw"Silahkan Pilih Jenis Font";var d=3<=b.attr.text.length?
250/b.attr.text.length*2.3:250/b.attr.text.length*1.4;d=Math.round(d);100>d&&(d=100);var f={text:b.attr.text,font:e.fonts[b.attr.style].filename,color:b.attr.color,size:d,trformat:CIPTA.trformat};b.attr.others.arc&&(f.arc=b.attr.others.arc);b.attr.stroke.width&&0<b.attr.stroke.width&&(f.outline=b.attr.stroke.width,b.attr.stroke.color&&(f.outlinecolor=b.attr.stroke.color));b.attr.others.kerning&&0<b.attr.others.kerning&&(f.kerning=b.attr.others.kerning);if(b.attr.shadow.type&&0<b.attr.shadow.type){if(1==
b.attr.shadow.type)var c="soft",h=135;else 2==b.attr.shadow.type?(c="soft",h=315):20==b.attr.shadow.type?(c="hard",h=135):21==b.attr.shadow.type&&(c="hard",h=315);c&&(f.shadow=c,f.shadowdir=h,b.attr.shadow.color&&(f.shadowcolor=b.attr.shadow.color))}if(b.attr.shape.type&&0<b.attr.shape.type&&b.attr.shape.amount&&0<b.attr.shape.amount&&100>=b.attr.shape.amount){if(1==b.attr.shape.type)var k="arch",m=b.attr.shape.amount;else 2==b.attr.shape.type?(k="arch",m=-b.attr.shape.amount):3==b.attr.shape.type?
(k="arc",m=1.8*b.attr.shape.amount):4==b.attr.shape.type&&(k="arc",m=1.8*-b.attr.shape.amount);k&&(f[k]=m)}if("casing"==ciptaProductAttr.getProductType()||"slate"==ciptaProductAttr.getProductType()||"drinkware"==ciptaProductAttr.getProductType())f.size*=2;b.attr.overlay.id&&0<=b.attr.overlay.id?ciptaOverlay.getClipartbyID(b.attr.overlay.id,function(c){c&&c.filename&&""!=c.filename&&(f.overlay=c.filename,b.attr.overlay.type&&0<=b.attr.overlay.type&&100>=b.attr.overlay.type&&(f.overlaytype=b.attr.overlay.type));
request_uri=ciptaRequest.buildRequestURI("render_text",f);b.preview.img=request_uri;a&&a(b)}):(request_uri=ciptaRequest.buildRequestURI("render_text",f),b.preview.img=request_uri,a&&a(b))});return b};return b},ciptaImage=function(a){var b={attr:{filename:"",uploadname:"",type:"user",width:null,height:null,overlay:{category:0,id:null,type:0,opacity:1},filter:{category:1,id:null,filtername:null},mask:{category:0,id:null},crop:[],clipart:{},template:{},others:{}},preview:{thumb_img:null}};a&&$.extend(!0,
b.attr,a);b.initialize=function(a,f){a&&(b.attr=_.cloneDeep(a));f&&(b.preview=_.cloneDeep(f))};b.clone=function(){var a=ciptaImage();a.initialize(b.attr,b.preview);return a};b.getFilename=function(){return b.attr.filename};b.setFilename=function(a){b.attr.filename=a};b.getUploadname=function(){return b.attr.uploadname};b.setUploadname=function(a){b.attr.uploadname=a};b.getFileFormat=function(){if(b.attr.filename)return b.attr.filename.substr(b.attr.filename.lastIndexOf(".")+1)};b.getType=function(){return b.attr.type};
b.setType=function(a){b.attr.type=a};b.getOthers=function(a){return b.attr.others[a]?b.attr.others[a]:null};b.setOthers=function(a,f){b.attr.others[a]=f};b.getOverlay=function(a){return b.attr.overlay[a]};b.setOverlay=function(a,f){b.attr.overlay[a]=f};b.getMask=function(a){return b.attr.mask[a]};b.setMask=function(a,f){b.attr.mask[a]=f};b.getFilter=function(a){return b.attr.filter[a]};b.setFilter=function(a,f){b.attr.filter[a]=f};b.getMaskURL=function(){if(b.attr.mask.id&&0<=b.attr.mask.id){var a=
{clipfile:ciptaFrameMask.getClipartbyID(b.attr.mask.id).filename};return ciptaRequest.buildRequestURI("render_clipart",a)}return null};b.fitMaskToImage=function(){if(b.attr.mask.id&&0<=b.attr.mask.id){var a=ciptaFrameMask.getClipartbyID(b.attr.mask.id);if((a.usage==ASSET_SILHOUETTE||a.info&&"crop"==a.info.maskmode)&&0<a.info.width&&0<a.info.height){if(a.info.width/a.info.height>b.attr.width/b.attr.height){var f=0;var d=1;var g=b.attr.width/a.info.width*a.info.height/b.attr.height;var c=(1-g)/2;if(0>
c||1<c)c=0;if(0>g||1<g)g=1}else{c=0;g=1;d=b.attr.height/a.info.height*a.info.width/b.attr.width;f=(1-d)/2;if(0>f||1<f)f=0;if(0>d||1<d)d=1}b.attr.crop=[f,c,d,g]}else b.attr.crop=[0,0,1,1]}};b.setCrop=function(a){a&&4==a.length&&(b.attr.crop=a)};b.getCrop=function(){return b.attr.crop};b.resetCrop=function(){b.attr.crop=[]};b.getTemplate=function(a){return b.attr.template[a]};b.setTemplate=function(a,f){b.attr.template[a]=f};b.getClipart=function(a){return b.attr.clipart[a]};b.setClipart=function(a,
f){b.attr.clipart[a]=f};b.getPreview=function(){return b.preview};b.setPreview=function(a){b.preview.thumb_img=a};b.setWidth=function(a){b.attr.width=a};b.getWidth=function(){return b.attr.width};b.setHeight=function(a){b.attr.height=a};b.getHeight=function(){return b.attr.height};b.getClipartPreviewURL=function(){if("clipart"==b.attr.type&&""!=b.attr.filename){var a={clipfile:b.attr.filename,trformat:CIPTA.trformat};if(b.attr.clipart.colors&&0<b.attr.clipart.colors.length){var f=!1;if(b.attr.clipart.orig_colors)for(var d=
0;d<b.attr.clipart.colors.length;d++){if(!b.attr.clipart.orig_colors[d]||b.attr.clipart.orig_colors[d]!=b.attr.clipart.colors[d]){f=!0;break}}else f=!0;if(f)for(d=0;d<b.attr.clipart.colors.length;d++)a["c["+d+"]"]=b.attr.clipart.colors[d]}b.attr.overlay.id&&0<=b.attr.overlay.id&&(f=ciptaOverlay.getClipartbyID(b.attr.overlay.id))&&f.filename&&""!=f.filename&&(a.overlay=f.filename,b.attr.overlay.type&&0<=b.attr.overlay.type&&100>=b.attr.overlay.type&&(a.overlaytype=b.attr.overlay.type),b.attr.overlay.opacity&&
0<=b.attr.overlay.opacity&&100>=b.attr.overlay.opacity&&(a.overlayopacity=b.attr.overlay.opacity));if("casing"==ciptaProductAttr.getProductType()||"slate"==ciptaProductAttr.getProductType()||"drinkware"==ciptaProductAttr.getProductType())a.sz="medium";return ciptaRequest.buildRequestURI("render_clipart",a)}throw"Undefined Clipart Filename!";};b.getImagePreviewURL=function(a){if("user"==b.attr.type&&""!=b.attr.filename){var e={imgfile:b.attr.filename,trformat:CIPTA.trformat};if(b.attr.overlay.id&&
0<=b.attr.overlay.id){var d=ciptaOverlay.getClipartbyID(b.attr.overlay.id);d&&d.filename&&""!=d.filename&&(e.overlay=d.filename,b.attr.overlay.type&&0<=b.attr.overlay.type&&100>=b.attr.overlay.type&&(e.overlaytype=b.attr.overlay.type),b.attr.overlay.opacity&&0<=b.attr.overlay.opacity&&100>=b.attr.overlay.opacity&&(e.overlayopacity=b.attr.overlay.opacity))}b.attr.mask.id&&0<=b.attr.mask.id&&(!a||1!=a)&&(d=ciptaFrameMask.getClipartbyID(b.attr.mask.id))&&d.filename&&""!=d.filename&&(e.mask=d.filename,
d.usage==ASSET_SILHOUETTE&&(e.masktype="silhouette"));b.attr.filter&&null!=b.attr.filter.filtername&&""!=b.attr.filter.filtername&&"none"!=b.attr.filter.filtername&&(e.effect=b.attr.filter.filtername);if(b.attr.crop&&4==b.attr.crop.length&&(!a||1!=a))for(d=0;d<b.attr.crop.length;d++)e["crop["+d+"]"]=b.attr.crop[d];if(b.attr.others.iscolorable&&b.attr.others.colors&&0<b.attr.others.colors.length){a=!1;if(b.attr.others.orig_colors)for(d=0;d<b.attr.others.colors.length;d++){if(!b.attr.others.orig_colors[d]||
b.attr.others.orig_colors[d]!=b.attr.others.colors[d]){a=!0;break}}else a=!0;if(a)for(d=0;d<b.attr.others.colors.length;d++)e["c["+d+"]"]=b.attr.others.colors[d]}if("casing"==ciptaProductAttr.getProductType()||"slate"==ciptaProductAttr.getProductType()||"drinkware"==ciptaProductAttr.getProductType())e.sz="medium";return ciptaRequest.buildRequestURI("render_image",e)}throw"Undefined Image Filename!";};return b},ciptaFontWidget=function(a,b){var e={type:"fontselector",callback:null,current_tags:null,
create:function(f){$('<select id="'+a+'" style="width:100%;"></select>').appendTo("#"+b);e.callback=f;$("#"+a).select2({placeholder:"Pilih Font...",minimumResultsForSearch:-1,formatResult:function(b){return b&&0<b.id?'<div style="height:25px; margin-top:5px; margin-bottom:5px;"><img id="'+a+"_"+b.id+'_select2" src="'+ciptaFonts.getFontbyID(b.id).getPreviewImage("regular")+'" style="height:25px;"></div>':""},formatSelection:function(b){return b&&0<b.id?'<div style="height:20px; margin-top:1px; margin-bottom:5px;"><img id="'+
a+"_"+b.id+'_select2" src="'+ciptaFonts.getFontbyID(b.id).getPreviewImage("regular")+'" style="height:20px;"></div>':""}}).on("change",function(a){0<a.val&&e.callback&&e.callback(a.val)})},fillOptions:function(b,d,g){if(b!=e.current_tags){var c=!1;$("#"+a).empty();ciptaFonts.getFontList(b,function(f){$("#"+a).append("<option></option>");$.each(f,function(b,e){$("#"+a).append($("<option></option>").attr("value",e.id).text(e.name));d==e.id&&(c=!0)});"first"==d&&f[0].id?$("#"+a).select2("val",f[0].id):
1==c?$("#"+a).select2("val",d):$("#"+a).select2("val",-1);e.current_tags=b;g&&g()})}},getSelected:function(){return $("#"+a).val()},setSelected:function(b){$("#"+a).select2("val",b);return e},disable:function(){$("#"+a).prop("disabled",!0)},enable:function(){$("#"+a).prop("disabled",!1)}};return e},ciptaClipartWidget=function(a,b,e,f){var d=null,g={type:"clipartselector"},c=null;g.callback=null;g.callback2=null;g.current_tags=null;g.showname=!1;g.fillClipartList=function(h,k,m){if(h!=g.current_tags){"number"!=
typeof f&&(f=5);var l=f-3;4<l&&(l=4);var n=f-2;6<n&&(n=6);var q='<ul class="small-block-grid-'+l+" medium-block-grid-"+n+" large-block-grid-"+f+'" style="margin-top:20px;" id="'+a+'"> </ul>';$("#"+b).empty();$("#"+b).html('<div style="margin-top:20px;"><img src="/assets/img/icons/loader-horiz1.gif"> &nbsp; loading</div>');c=e&&"overlay"==e?ciptaOverlay:e&&"mask"==e?ciptaFrameMask:e&&"filter"==e?ciptaFilter:ciptaCliparts;c.getClipartList(h,function(e){$("#"+b).empty();$("#"+b).html(q);var f;$.each(e,
function(b,d){f=c.getClipartbyID(d.id);g.showname&&1==g.showname?$("#"+a).append('<li style="padding-top:10px;" class="clipart_box"><img class="th clipart_thumb '+a+'_clip" id="'+a+"_"+d.id+'" data-id="'+d.id+'" src="'+f.getPreviewImage("small")+'" width="125"><br/>'+f.name+"</li>"):$("#"+a).append('<li style="padding-top:10px;" class="clipart_box"><img class="th clipart_thumb '+a+'_clip" id="'+a+"_"+d.id+'" data-id="'+d.id+'" src="'+f.getPreviewImage("small")+'" width="125"></li>')});$("."+a+"_clip").unbind("click").click(function(){null!=
$(this).data("id")&&($("."+a+"_clip").removeClass("selected-clipart"),$(this).addClass("selected-clipart"),d=$(this).data("id"),g.callback2&&g.callback2(d))});$("."+a+"_clip").unbind("dblclick").dblclick(function(){g.callback&&g.callback(d)});g.current_tags=h;d=null;0>=e.length&&$("#"+b).html('<br/><br/><span class="large-text">Hasil tidak ditemukan, silahkan coba gunakan kata kunci yang lain.</span>');k&&k()},m)}else k&&k()};g.create=function(a,b,c,d,e){g.callback=b;g.callback2=c;g.showname=d;try{g.fillClipartList(a,
function(){e&&e()},"rating")}catch(q){e&&e()}return g};g.getSelected=function(){return d};g.setSelected=function(c){c&&""!=c&&$("#"+a+"_"+c).length?c!=d&&null!=$("#"+a+"_"+c).data("id")&&($("."+a+"_clip").removeClass("selected-clipart"),$("#"+a+"_"+c).addClass("selected-clipart"),d=c,$("#"+b).scrollTop($("#"+a+"_"+c).position().top)):g.resetSelected()};g.scrollToSelected=function(){if(d&&""!=d&&$("#"+a+"_"+d).length){var c=$("#"+b).height(),e=$("#"+a+"_"+d).position().top;(0>=e||e+$("#"+a+"_"+d).height()>
c)&&$("#"+b).scrollTop(e-20)}};g.resetSelected=function(){$("."+a+"_clip").removeClass("selected-clipart");d=null};return g},ciptaInputWidget=function(a,b,e,f){var d={type:"inputbox",create:function(){var g="";e&&0<e&&(g=' maxlength="'+e+'"');f&&""!=f&&(g+=" "+f);$('<input type="text" value="" id="'+a+'"'+g+"/>").appendTo("#"+b);return d},getInput:function(){return $("#"+a).val()},setInput:function(b){$("#"+a).val(b);return d},onChange:function(b,c){0<c?$("#"+a).change(_.debounce(function(){b&&b($("#"+
a).val())},c)):$("#"+a).change(function(){b&&b($("#"+a).val())})},onInput:function(b,c,d){if(0<c)d=0<d?{maxwait:d}:{},$("#"+a).on("input propertychange paste",_.debounce(function(){b&&b($("#"+a).val())},c,d));else $("#"+a).on("input propertychange paste",function(){b&&b($("#"+a).val())})}};return d},ciptaDropDownWidget=function(a,b,e,f){var d={type:"dropdown",create:function(g){var c="";c='<select id="'+a+'" style="width:100%;"></select>';$(c).appendTo("#"+b);var h="";$.each(e,function(a,b){h=f&&
f==a?h+'<option value="'+a+'" selected="selected">'+b+"</option>":h+'<option value="'+a+'">'+b+"</option>"});$("#"+a).empty();$("#"+a).html(h);$("#"+a).change(function(){$.isFunction(g)&&g($(this).val())});return d},getSelected:function(){return $("#"+a).val()},setSelected:function(b){$("#"+a).val(b);return d},disable:function(){$("#"+a).prop("disabled",!0)},enable:function(){$("#"+a).prop("disabled",!1)}};return d},ciptaFancyDropDownWidget=function(a,b,e,f,d,g){var c={type:"fancydropdown",create:function(c){var h=
null;$('<select id="'+a+'"></select>').appendTo("#"+b);d&&d.placeholder&&$("#"+a).append($("<option></option>"));d&&d.order&&_.isArray(d.order)&&!_.isEmpty(d.order)&&_.size(d.order)==_.size(e)?h=d.order:(h=[],_.each(e,function(a,b){h.push(b)}));_.isArray(e)?_.each(h,function(b){d&&d["default"]&&d["default"]==e[b].key?$("#"+a).append($("<option selected></option>").attr("value",e[b].key).text(e[b].label)):$("#"+a).append($("<option></option>").attr("value",e[b].key).text(e[b].label))}):_.each(h,function(b){d&&
d["default"]&&d["default"]==b?$("#"+a).append($("<option selected></option>").attr("value",b).text(e[b])):$("#"+a).append($("<option></option>").attr("value",b).text(e[b]))});var m=f?{formatResult:function(a){return f[a.id]?f[a.id]:e[a.id]?e[a.id]:""},formatSelection:function(a){return g&&g[a.id]?g[a.id]:f[a.id]?f[a.id]:e[a.id]?e[a.id]:""}}:{};d&&0==d.searchbox&&(m.minimumResultsForSearch=-1);d&&d.placeholder&&(m.placeholder=d.placeholder);d&&d.allowClear&&(m.allowClear=d.allowClear);m.width=d&&d.width?
d.width:"resolve";$("#"+a).select2(m).on("change",function(a){$.isFunction(c)&&c(a.val)})},getSelected:function(){return $("#"+a).val()},setSelected:function(b){$("#"+a).select2("val",b);return c},disable:function(){$("#"+a).prop("disabled",!0)},enable:function(){$("#"+a).prop("disabled",!1)}};return c},ciptaCheckboxWidget=function(a,b,e){var f={type:"checkbox"},d='<div class="switch small radius">\n   <input id="'+a+'" type="checkbox">\n   <label for="'+a+'"></label>\n</div>\n';f.create=function(g){$(d).appendTo("#"+
b);e&&1==e&&f.setChecked(!0);$("#"+a).change(function(){g&&g(f.isChecked())});return f};f.isChecked=function(){return $("#"+a).is(":checked")};f.setChecked=function(b){1==b||1==b?$("#"+a).prop("checked",!0):$("#"+a).prop("checked",!1);return f};f.disable=function(){$("#"+a).prop("disabled",!0)};f.enable=function(){$("#"+a).prop("disabled",!1)};f.hide=function(){$("#"+b).hide()};f.show=function(){$("#"+b).show()};return f},ciptaColorPickerWidget=function(a,b,e){var f="#000000";return{type:"colorpicker",
create:function(d,g,c){$('<input type="text" id="'+a+'"/>').appendTo("#"+b);var h=e&&1==e.showAlpha?!0:!1,k={showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,togglePaletteMoreText:"warna lain >",togglePaletteLessText:"< tutup",preferredFormat:"hex",cancelText:"batal",chooseText:"pilih warna",showInput:!0,showInitial:!0,showAlpha:h,palette:["#000 #444 #666 #999 #ccc #eee #f3f3f3 #fff".split(" "),"#f00 #f90 #ff0 #00C800 #00B9B9 #00f #90f #C300C3".split(" "),"#f4cccc #fce5cd #fff2cc #d9ead3 #d0e0e3 #cfe2f3 #d9d2e9 #ead1dc".split(" "),
"#ea9999 #f9cb9c #ffe599 #b6d7a8 #a2c4c9 #9fc5e8 #b4a7d6 #d5a6bd".split(" "),"#e06666 #f6b26b #ffd966 #93c47d #76a5af #6fa8dc #8e7cc3 #c27ba0".split(" "),"#c00 #e69138 #f1c232 #6aa84f #45818e #3d85c6 #674ea7 #a64d79".split(" "),"#900 #b45f06 #bf9000 #38761d #134f5c #0b5394 #351c75 #741b47".split(" "),"#600 #783f04 #7f6000 #274e13 #0c343d #073763 #20124d #4c1130".split(" ")],change:function(a){f=a?0==a._a&&c?null:1==h?a.toRgbString():a.toHexString():null;$.isFunction(d)&&d(f)}};if(g)f=k.color=g;else if(_.isUndefined(c)||
!c)k.color=f;c&&(k.allowEmpty=!0,k.palette.push(["rgba(255, 255, 255, 0)"]));$("#"+a).spectrum(k)},destroy:function(){$("#"+a).spectrum("destroy");$("#"+a).remove()},getColor:function(){return f},setColor:function(b){f=b;$("#"+a).spectrum("set",f)},disable:function(){$("#"+a).spectrum("disable")},enable:function(){$("#"+a).spectrum("enable")}}},ciptaUploadWidget=function(a,b){var e={type:"fileupload",create:function(f,d){$('<div id="'+a+'"></div>').appendTo("#"+b);$("#"+a).fineUploader({debug:!1,
multiple:!1,template:"qq-simple-thumbnails-template",thumbnails:{placeholders:{waitingPath:"/assets/img/fineuploader/waiting-generic.png",notAvailablePath:"/assets/img/fineuploader/not_available-generic.png"}},request:{endpoint:ciptaRequest.buildRequestURI("upload_image"),params:{size:400}},validation:{allowedExtensions:FILE_UPLOAD_ALLOWED_EXTS,sizeLimit:FILE_MAX_UPLOAD_SIZE},cors:{expected:!0,sendCredentials:!0}}).on("complete",function(a,b,d,e){f&&f(e)}).on("error",function(a,b,d,e){sweetAlert("Tidak dapat mengupload gambar!",
e+"<br/>Silahkan coba lagi atau hubungi Customer Support kami.","error");f&&f(null)}).on("upload",function(a,b){d&&d()});return e},cancelUpload:function(){$("#"+a).fineUploader("cancelAll")}};return e},ciptaButtonWidget=function(a,b){var e={type:"button"},f=!1;e.create=function(d,g,c,h,k,m,l){h||(h="");k=!1===k?"button":"button tiny";k=m&&""!=m?k+" "+m:k+" cipta-button-lightgray-noborder";d="";l&&""!=l||(l="");$('<a class="'+k+'"'+d+' id="'+a+'" '+l+'><i class="'+g+'"> </i>'+h+"</a>").appendTo("#"+
b);c&&$.isFunction(c)&&$("#"+a).unbind("click").click(function(){if(f)return!1;c()});return e};e.triggerClick=function(){$("#"+a).trigger("click")};e.disable=function(){f=!0;$("#"+a).addClass("disabled")};e.enable=function(){f=!1;$("#"+a).removeClass("disabled")};return e},ciptaRangeSliderWidget=function(a,b,e,f,d){var g={type:"rangeslider"},c=d||0,h='<div class="row">\n  <div class="large-9 small-9 medium-9 columns sliders" id="'+a+'">\n  </div>\n  <div class="large-3 small-3 medium-3 columns">\n      <label id="'+
a+'_label" class="panel-label" style="font-weight: bold; display:block;"></label>\n  </div>\n</div>';g.create=function(d){$(h).appendTo("#"+b);$("#"+a).noUiSlider({start:[c],step:1,animate:!1,range:{min:[e],max:[f]}});var k=function(){c!=$("#"+a).val()&&(c=Math.round($("#"+a).val()),$("#"+a+"_label").html(c),d&&d(c))};$("#"+a).on({slide:k,set:k,change:k});return g};g.getValue=function(){return Math.round($("#"+a).val())};g.setValue=function(b){b=Math.round(b);b!=g.getValue()&&b>=e&&b<=f&&($("#"+a).val(b),
c=b);return g};return g},ciptaKnobWidget=function(a,b){var e={type:"knob",create:function(f,d,g,c,h){$('<input id="'+a+'" data-width="70" data-height="70" data-cursor=true data-bgColor="#eeeeee" data-fgColor="#777777" data-thickness=".5" value="'+g+'" data-step="'+c+'" data-min="'+f+'" data-max="'+d+'">\n').appendTo("#"+b);$("#"+a).knob({change:function(a){$.isFunction(h)&&h(a)},release:function(a){$.isFunction(h)&&h(a)}});return e},getValue:function(){return $("#"+a).val()},setValue:function(b){$("#"+
a).val(b).trigger("change")}};return e},ciptaColorSelector=function(a,b){var e={type:"selector-color"},f=null;e.create=function(d,g,c,h){var k='<span class="panel-label">Pilih Warna:&nbsp;</span>\n<span id="'+a+'_public_name" class="medium-text"></span><br/>\n<div id="'+a+'"></div>\n';$(k).appendTo("#"+b);$.each(g,function(b,c){if("undefined"!=typeof d[c]){var e=JSON.parse(d[c].info);$(e.images&&e.images[0]&&e.images[0].ObjectURL?'<div id="'+a+"_"+c+'" class="cipta-color-button" style=" background-repeat: no-repeat; background-position: center; background-image:url(\''+
e.images[0].ObjectURL+'\');" title="'+d[c].public_name+'"></div>':'<div id="'+a+"_"+c+'" class="cipta-color-button" style="background-color:#'+d[c].hex+';" title="'+d[c].public_name+'"></div>').appendTo("#"+a);$("#"+a+"_"+c).unbind("click").click(function(){null!=f&&($("#"+a+"_"+f).removeClass("selected"),$("#"+a+"_"+f).html(""));$("#"+a+"_"+c).addClass("selected");$("#"+a+"_"+c).html('<img src="/assets/img/checked.png">');f=c;$("#"+a+"_public_name").html(d[c].public_name);$.isFunction(h)&&h(f)})}});
f=g[c];$("#"+a+"_"+f).addClass("selected");$("#"+a+"_"+f).html('<img src="/assets/img/checked.png">');$("#"+a+"_public_name").html(d[f].public_name);k=g;return e};e.set_selected_color=function(b){null!=f&&($("#"+a+"_"+f).removeClass("selected"),$("#"+a+"_"+f).html(""));f=b;$("#"+a+"_"+f).addClass("selected");$("#"+a+"_"+f).html('<img src="/assets/img/checked.png">')};e.get_selected_color=function(){return f};return e},ciptaColorMultiSelector=function(a,b,e){var f={type:"multiselector-color"},d={};
f.create=function(g,c,h,k){var m='<span class="panel-label">Pilih Warna:&nbsp;(bisa lebih dari satu)</span>\n<span id="'+a+'_public_name"></span><br/>\n<div class="row">\n  <div class="medium-12 large-12 small-12 columns" id="'+a+'"></div><br/>\n</div>\n<div class="row" style="margin-top:10px; margin-bottom:5px;">\n  <div class="medium-12 large-12 small-12 columns" id="'+a+'_buttons"></div>\n</div>\n';$(m).appendTo("#"+b);$.each(c,function(b,c){if("undefined"!=typeof g[c]){var e=JSON.parse(g[c].info);
$(e.images&&e.images[0]&&e.images[0].ObjectURL?'<div id="'+a+"_"+c+'" class="cipta-color-button" style=" background-repeat: no-repeat; background-position: center; background-image:url(\''+e.images[0].ObjectURL+'\');" title="'+g[c].public_name+'"></div>':'<div id="'+a+"_"+c+'" class="cipta-color-button" style="background-color:#'+g[c].hex+';" title="'+g[c].public_name+'"></div>').appendTo("#"+a);$("#"+a+"_"+c).unbind("click").click(function(){d[c]?($("#"+a+"_"+c).html(""),d[c]=!1):($("#"+a+"_"+c).html('<img src="/assets/img/checked.png">'),
d[c]=!0);h&&h(c,f.getSelectedColors())});$("#"+a+"_"+c).hover(function(){k&&k(c)},300)}});e&&($('<a href="#" class="button tiny cipta-button-lightgray smaller" id="'+a+'_selectall">Semua Warna</a>\n<a href="#" class="button tiny cipta-button-lightgray smaller" id="'+a+'_selectbright">Warna Terang</a>\n<a href="#" class="button tiny cipta-button-lightgray smaller" id="'+a+'_selectdark">Warna Gelap</a>\n<a href="#" class="button tiny cipta-button-lightgray smaller" id="'+a+'_reset">Reset</a>\n').appendTo("#"+
a+"_buttons"),$("#"+a+"_selectall").unbind("click").click(function(){d={};var b=0;$.each(c,function(c,e){$("#"+a+"_"+e).html('<img src="/assets/img/checked.png">');d[e]=!0;b=e});h&&h(b,f.getSelectedColors())}),$("#"+a+"_selectbright").unbind("click").click(function(){d={};var b=null,e=net.brehaut.Color,k;$.each(c,function(c,f){k=e("#"+g[f].hex);.5<=k.getLightness()?($("#"+a+"_"+f).html('<img src="/assets/img/checked.png">'),d[f]=!0,b=f):($("#"+a+"_"+f).html(""),d[f]=!1)});null!=b&&h&&h(b,f.getSelectedColors())}),
$("#"+a+"_selectdark").unbind("click").click(function(){d={};var b=null,e=net.brehaut.Color,k;$.each(c,function(c,f){k=e("#"+g[f].hex);.5>k.getLightness()?($("#"+a+"_"+f).html('<img src="/assets/img/checked.png">'),d[f]=!0,b=f):($("#"+a+"_"+f).html(""),d[f]=!1)});null!=b&&h&&h(b,f.getSelectedColors())}),$("#"+a+"_reset").unbind("click").click(function(){d={};var b=0;$.each(c,function(c,d){$("#"+a+"_"+d).html("");b=d});h&&h(b,f.getSelectedColors())}));d={};m=c;return f};f.addSelectedColor=function(b){$("#"+
a+"_"+b).html('<img src="/assets/img/checked.png">');d[b]=!0};f.getSelectedColors=function(){return _.filter(_.keys(d),function(a){return d[a]})};f.setSelectedColors=function(b){d={};_.forEach(b,function(b){$("#"+a+"_"+b).html('<img src="/assets/img/checked.png">');d[b]=!0})};return f},ciptaButtonSelector=function(a,b){var e={type:"selector-button"},f=null;e.create=function(d,g,c,h){$('<div id="'+a+'"></div>\n').appendTo("#"+b);$.each(g,function(b,c){"undefined"!=typeof d[c]&&($('<div id="'+a+"_"+
c+'" class="cipta-selector-button">'+d[c].public_name+"</div>").appendTo("#"+a),$("#"+a+"_"+c).unbind("click").click(function(){null!=f&&$("#"+a+"_"+f).removeClass("selected");$("#"+a+"_"+c).addClass("selected");f=c;h&&h(f)}))});f=g[c];$("#"+a+"_"+f).addClass("selected");return e};e.setSelectedAttr=function(b){null!=f&&$("#"+a+"_"+f).removeClass("selected");f=b;$("#"+a+"_"+f).addClass("selected")};e.getSelectedAttr=function(){return f};e.hide=function(){$("#"+b).hide()};e.show=function(){$("#"+b).show()};
return e},ciptaGridBoxWidget=function(a,b,e){var f=null,d=!1,g={},c={type:"gridbox",create:function(h,k,m,l){var n="";n=e&&e.itemgrid&&"number"!=typeof e.itemgrid?5:e.itemgrid;var q=e&&e.imgwidth&&"number"!=typeof e.imgwidth?125:e.imgwidth;e&&1==e.multiselect&&(d=!0);n='<ul class="small-block-grid-'+n+'" style="margin-top:20px;" id="'+a+'"> </ul>';$(n).appendTo("#"+b);_.forEach(h,function(b){k&&1==k?$("#"+a).append('<li class="gridlist_box"><img class="th gridlist_thumb '+a+'_grid" id="'+a+"_"+b.id+
'" data-id="'+b.id+'" src="'+b.img+'" width="'+q+'"><div id="'+a+"_"+b.id+'_selected"></div><br/>'+b.label+"</li>"):$("#"+a).append('<li class="gridlist_box"><img class="th gridlist_thumb '+a+'_grid" id="'+a+"_"+b.id+'" data-id="'+b.id+'" src="'+b.img+'" width="'+q+'"><div id="'+a+"_"+b.id+'_selected"></div></li>');$("#"+a+"_"+b.id+"_selected").hide()});$("."+a+"_grid").unbind("click").click(function(){null!=$(this).data("id")&&(d?(g[$(this).data("id")]?($(this).removeClass("selected-gridlist"),$(this).parent().removeClass("gridlist_box_selected"),
g[$(this).data("id")]=!1):($(this).addClass("selected-gridlist"),$(this).parent().addClass("gridlist_box_selected"),g[$(this).data("id")]=!0),m&&m($(this).data("id"))):($("."+a+"_grid").removeClass("selected-gridlist"),$("."+a+"_grid").parent().removeClass("gridlist_box_selected"),$(this).addClass("selected-gridlist"),$(this).parent().addClass("gridlist_box_selected"),f=$(this).data("id"),m&&m(f)))});$("."+a+"_grid").unbind("dblclick").dblclick(function(){l&&l(f)});return c},clearAll:function(){$("#"+
b).html("")},getSelected:function(){return f},getSelections:function(){return d?_.filter(_.keys(g),function(a){return g[a]}):[]},setSelected:function(e){d||(e&&""!=e&&$("#"+a+"_"+e).length?e!=f&&null!=$("#"+a+"_"+e).data("id")&&($("."+a+"_grid").removeClass("selected-gridlist"),$("."+a+"_grid").parent().removeClass("gridlist_box_selected"),$("#"+a+"_"+e).addClass("selected-gridlist"),$("#"+a+"_"+e).parent().addClass("gridlist_box_selected"),f=e,$("#"+b).scrollTop($("#"+a+"_"+e).position().top)):c.resetSelected())},
scrollToSelected:function(){if(!d&&f&&""!=f&&$("#"+a+"_"+f).length){var c=$("#"+b).height(),e=$("#"+a+"_"+f).position().top;(0>=e||e+$("#"+a+"_"+f).height()>c)&&$("#"+b).scrollTop(e-20)}},resetSelected:function(){$("."+a+"_grid").removeClass("selected-grid");d?g={}:f=null},markItem:function(b){$("#"+a+"_"+b+"_selected").addClass("marked-gridlist");$("#"+a+"_"+b+"_selected").show()},unmarkItem:function(b){$("#"+a+"_"+b+"_selected").removeClass("marked-gridlist");$("#"+a+"_"+b+"_selected").hide()}};
return c},ciptaMockupSelector=function(a,b){var e={type:"selector-mockup"},f=null,d=function(b){if(1>=b.length)return"";var c="";$.each(b,function(b,d){c+='    <div class="editor-thumb-image" id="'+a+"_"+b+'">\n        <img src="'+d.thumb[0].ObjectURL+'">\n        <div class="editor-thumb-text">'+d.public_name+"</div>\n    </div>\n"});return c};e.create=function(g,c){var h=d(g);$(h).appendTo("#"+b);if(1<g.length){var k=1;$.each(g,function(b,d){1==k&&($("#"+a+"_"+b).addClass("editor-thumb-image-selected"),
f=b);k++;$("#"+a+"_"+b).unbind("click").click(function(){f!=b&&($("#"+a+"_"+f).removeClass("editor-thumb-image-selected"),$("#"+a+"_"+b).addClass("editor-thumb-image-selected"),f=b,$.isFunction(c)&&c(f))})})}else f=0;return e};e.get_selected_mockup=function(){return f};e.set_selected_mockup=function(b){$("#"+a+"_"+f).removeClass("editor-thumb-image-selected");$("#"+a+"_"+b).addClass("editor-thumb-image-selected");f=b};return e},ciptaToggleButtonWidget=function(a,b){var e={type:"togglebutton"},f=!1,
d=!1;e.create=function(g,c,h,k,m,l){h||(h="");l&&""!=l||(l="");$('<a class="'+(!1===k?"button cipta-button-lightgray-noborder":"button tiny cipta-button-lightgray-noborder")+'" id="'+a+'" '+l+">"+g+" </i>"+h+"</a>").appendTo("#"+b);c&&$.isFunction(c)&&$("#"+a).unbind("click").click(function(){if(f)return!1;d?(d=!1,$("#"+a).removeClass("cipta-button-mediumgray-noborder"),$("#"+a).addClass("cipta-button-lightgray-noborder")):(d=!0,$("#"+a).removeClass("cipta-button-lightgray-noborder"),$("#"+a).addClass("cipta-button-mediumgray-noborder"));
c(d)});return e};e.toggleOn=function(){d||(d=!0,$("#"+a).removeClass("cipta-button-lightgray-noborder"),$("#"+a).addClass("cipta-button-mediumgray-noborder"))};e.toggleOff=function(){d&&(d=!1,$("#"+a).removeClass("cipta-button-mediumgray-noborder"),$("#"+a).addClass("cipta-button-lightgray-noborder"))};e.disable=function(){f=!0;$("#"+a).addClass("disabled")};e.enable=function(){f=!1;$("#"+a).removeClass("disabled")};return e},ciptaFontStylesWidget=function(a,b){var e={type:"fontstyles",callback:null,
is_created:!1,selected:"regular",buttons:{},create:function(a){e.is_created=!0;e.callback=a},fillStyles:function(f){$("#"+b).empty();if(0<f){var d=ciptaFonts.getFontbyID(f);null!=d&&(e.buttons={},f=d.getFontStyles(),1<f.length&&$("#"+b).html('<span class="panel-label">Variasi Font:<br/></span>'),_.forEach(f,function(f){f=f.toLowerCase();"regular"!=f&&(e.buttons[f]=ciptaToggleButtonWidget(a+"_"+f,b),e.buttons[f].create('<img src="'+d.getPreviewImage(f)+'" style="height:18px; padding-left:4px; padding-right:4px;">',
function(a){e.selected==f?e.reset():e.setSelected(f);e.callback&&e.callback(e.selected)},null,!0))}),e.selected="regular")}},getSelected:function(){return e.selected},setSelected:function(a){a=a.toLowerCase();e.buttons[a]?(_.forEach(e.buttons,function(a){a.toggleOff()}),e.buttons[a].toggleOn(),e.selected=a):"regular"==a&&(_.forEach(e.buttons,function(a){a.toggleOff()}),e.selected=a);return e},reset:function(){e.selected&&(e.buttons[e.selected].toggleOff(),e.selected="regular")},clear:function(){$("#"+
b).empty()},show:function(){$("#"+b).show()},hide:function(){$("#"+b).hide()}};return e},ciptaTextPanel=function(a,b,e,f){var d='<div class="row">\n   <div class="large-12 columns">\n        <label class="panel-label" id="'+a+'_widget_1">Teks:<br/>\n        </label>\n   </div>\n</div>\n<div class="row">\n   <div class="large-3 columns">\n        <label class="panel-label" id="'+a+'_widget_4">Kategori Font:<br/>\n        </label><br/>\n   </div>\n   <div class="large-6 columns">\n        <div id="'+
a+'_widget_2">\n           <div class="panel-label" id="'+a+'_widget_2_label">Font:\n           </div>\n        </div>\n   </div>\n   <div class="large-3 columns">\n       <label class="panel-label" id="'+a+'_widget_3">Warna:<br/>\n        </label>\n   </div>\n</div>\n<div class="row" style="margin-top:10px;">\n   <div class="large-3 medium-4 small-4 large-offset-6 medium-offset-4 small-offset-4 columns">\n                <a href="#" id="'+a+'_button_2" class="button expand tiny cipta-button-lightgray close-reveal-modal" style="position:relative; top:0px; left:0px; line-height:normal">Batal</a>\n   </div>\n   <div class="large-3 medium-4 small-4 columns">\n           <a href="#" class="button expand cipta-button-darkblue tiny" id="'+
a+'_button_1">Tambah Teks</a>\n   </div>\n</div>\n',g=[],c={},h=function(){g[1].enable();g[3].enable();$("#"+a+"_widget_2_label").html("Font:")},k=function(){$("#"+a+"_widget_2_label").html('<div>Font:&nbsp;&nbsp; <img src="/assets/img/icons/loader-horiz1.gif"> &nbsp; loading</div>');g[1].disable();g[3].disable()};c.create=function(){$(d).appendTo("#"+b);g.push(ciptaInputWidget(a+"_text_1",a+"_widget_1",100));g[0].create();g.push(ciptaFontWidget(a+"_font_1",a+"_widget_2"));g[1].create();g[1].fillOptions("popular",
"first",function(){h()});g.push(ciptaColorPickerWidget(a+"_color_1",a+"_widget_3"));g[2].create();g.push(ciptaFancyDropDownWidget(a+"_font_cat_1",a+"_widget_4",{popular:"Populer",brush:"Brush",decorative:"Decorative",grunge:"Grunge",film:"Film",funny:"Funny",games:"Games",gothic:"Gothic",handwriting:"Handwriting",foreign:"Internasional",modern:"Modern",poster:"Poster",retro:"Retro",round:"Rounded",scary:"Seram",sansserif:"Sans Serif",serif:"Serif",slabserif:"Slab Serif",script:"Script",stencil:"Stencil",
sport:"Sports",techno:"Techno",typewriter:"Typewriter",western:"Western"},null,{searchbox:!1,"default":"popular"}));g[3].create(function(a){k();g[1].fillOptions(a,null,function(){h()})});$("#"+a+"_button_1").click(function(){c.addText();$.isFunction(f)&&f()});$("#"+a+"_text_1").keydown(function(a){13==a.keyCode&&(c.addText(),f&&f())});k();return c};c.addText=function(){var a=g[0].getInput(),b=g[1].getSelected(),d=g[2].getColor(),f=g[3].getSelected();if(!e)throw"Error: Invalid Canvas Object";a=ciptaText({font_id:b,
text:a,color:d,font_cat:f});CIPTA.editor_type==EDITOR_DESIGN&&(a.setTemplate("iscustom",!0),a.setTemplate("islocked",!1),a.setTemplate("istemplate",!1),a.setTemplate("qtext",!0),a.setTemplate("qcolor",!0));a.createPreview(function(a){e.addText(a);c.resetText()});return c};c.resetText=function(){g[0].setInput("");return c};c.focusText=function(){$("#"+a+"_text_1").focus()};c.enableAll=function(){h()};return c},ciptaTextEditPanel=function(a,b,e){var f='<dl class="tabs" data-tab>\n  <dd class="active"><a href="#'+
a+'_tab1_content" id="'+a+'_tab1">\x3c!--i class="icon-pencil2 fs0"> </i--\x3e <span class="hide-for-large-up panel-tab-label">Edit</span><span class="show-for-large-up panel-tab-label">Edit Teks</span></a></dd>\n  <dd><a href="#'+a+'_tab2_content" id="'+a+'_tab2"><span class="hide-for-large-up panel-tab-label">\x3c!--i class="icon-magic-wand fs1"> </i--\x3eEffect</span><span class="show-for-large-up panel-tab-label">Special Effects</span></a></dd>\n  <dd><a href="#'+a+'_tab3_content" id="'+a+'_tab3"><span class="hide-for-large-up panel-tab-label">\x3c!--i class="icon-magic-wand fs1"> </i--\x3eOverlay</span><span class="show-for-large-up panel-tab-label">Overlay</span></a></dd>\n';
CIPTA.editor_type==EDITOR_DESIGN&&(f+='  <dd id="'+a+'_tab4_dd"><a href="#'+a+'_tab4_content" id="'+a+'_tab4"><i class="icon-edit fs0"> </i> Customable ?</a></dd>\n');f+='</dl>            \n<div class="tabs-content">\n  <div class="content active" id="'+a+'_tab1_content">\n   <div class="row">\n       <div class="large-10 medium-12 small-10 columns">\n           <label class="panel-label">Teks:</label>\n       </div>\n   </div>\n   <div class="row">\n       <div class="large-10 medium-12 small-10 columns">\n           <label id="'+
a+'_widget_text">\n           </label>\n       </div>\n       <div class="large-2 medium-12 small-2 columns">\n           <a href="#" style="top:-5px;" class="button expand cipta-button-lightgray-noborder tiny" id="'+a+'_button_update">Update</a>\n       </div>\n   </div>\n   <div class="row" style="margin-top:10px;">\n       <div class="large-5 small-5 medium-6 columns">\n           <label class="panel-label" id="'+a+'_widget_font_category">Kategori Font:<br/>\n           </label>\n       </div>\n       <div class="large-7 small-7 medium-6 columns" id="'+
a+'_widget_font">\n           <div class="panel-label" id="'+a+'_widget_font_label">Font:\n           </div>\n       </div>\n   </div>\n   <div class="row" style="margin-top:10px;">\n       <div class="large-5 small-5 medium-6 columns">\n           <label class="panel-label" id="'+a+'_widget_color">Warna:<br/>\n           </label>\n       </div>\n       <div class="large-7 small-7 medium-6 columns">\n           <div class="panel-label" id="'+a+'_widget_font_style">           </div>\n       </div>\n   </div>\n   <div class="row" style="margin-top:25px;">\n       <div class="large-6 medium-12 small-6 columns" id="'+
a+'_widget_size">\n           <label class="panel-label">Ukuran & Posisi: </label>       </div>\n       <div class="large-3 medium-6 small-3 columns" id="'+a+'_widget_layers">\n           <label class="panel-label">Susunan: </label>       </div>\n       <div class="large-3 medium-6 small-3 columns" style="margin-top:18px;" id="'+a+'_widget_delete">\n       </div>\n   </div>\n   <div class="row" style="margin-top:10px;">\n       <div class="large-6 medium-12 small-12 columns" style="display:block; margin-top:15px;" id="'+
a+'_widget_pos">\n       </div>\n       <div class="large-6 medium-12 small-12 columns" style="display:block; margin-top:15px;">\n           <label class="panel-label">Putar Teks: </label>\n           <div id="'+a+'_widget_rotation" class="text-left"></div>\n       </div>\n       \x3c!--div class="large-3 medium-6 small-6 columns" style="display:block; margin-top:15px;">\n           <label class="panel-label">Transparansi:</label>\n           <div style="margin-left:20px; margin-top:20px; margin-bottom:10px;" id="'+
a+'_widget_transparency"></div>\n       </div--\x3e\n   </div>\n  </div>\n  <div class="content" id="'+a+'_tab2_content">\n           <div class="row"">\n               <div class="large-7 medium-8 small-9 columns">\n                   <label class="panel-label" id="'+a+'_widget_outline">Garis Luar:<br/>\n                   </label><br/>\n               </div>\n               <div class="large-3 medium-4 small-3 end columns">\n                   <label class="panel-label" id="'+a+'_widget_outline_color">Warna:<br/>\n                   </label>\n               </div>\n           </div>\n           <div class="row">\n               <div class="large-7 medium-8 small-9 columns">\n                   <label class="panel-label" id="'+
a+'_widget_shadow">Bayangan:<br/>\n                   </label><br/>\n               </div>\n               <div class="large-3 medium-4 small-3 end columns">\n                   <label class="panel-label" id="'+a+'_widget_shadow_color">Warna:<br/>\n                   </label>\n               </div>\n           </div>\n           <div class="row">\n               <div class="large-7 medium-8 small-9 columns">\n                   <label class="panel-label" id="'+a+'_widget_shape">Bentuk Teks:<br/>\n                   </label><br/>\n               </div>\n               <div class="large-2 medium-4 small-2 end columns">\n                   <label class="panel-label" id="'+
a+'_widget_shape_amount">Lengkungan:<br/>\n                   </label><br/>\n               </div>\n           </div>\n           <div class="row">\n               <div class="large-8 medium-8 small-12 columns">\n                   <label class="panel-label">Spasi Antar Huruf:</label>\n               </div>\n           </div>\n           <div class="row">\n               <div class="large-2 medium-4 small-3 columns" id="'+a+'_widget_kerning">\n               </div>\n           </div>\n  </div>        \n  <div class="content" id="'+
a+'_tab3_content">\n           <div class="row">\n               <div class="large-6 medium-5 columns panel-label" id="'+a+'_widget_overlay_category">\n                   <label class="panel-label">Kategori Overlay: </label>\n               </div>\n               <div class="large-4 medium-7 columns panel-label text-right" id="'+a+'_widget_overlay_reset">\n               </div>\n           </div>\n           <div class="row" id="'+a+'_widget_overlay_frame">\n               <div class="large-12  medium-12 small-12 columns" id="'+
a+'_widget_overlay" style="height: 300px; margin-top:10px; overflow-y:auto;">\n               </div>\n           </div>\n           <div class="row" style="margin-top:10px;">\n               <div class="large-4 medium-6 small-5 columns">\n                   <label class="panel-label">Jenis Overlay: </label>\n                   <div class="panel-label" id="'+a+'_widget_overlay_type">\n                   </div>\n               </div>\n           </div>\n  </div>        \n';CIPTA.editor_type==EDITOR_DESIGN&&
(f+='  <div class="content" id="'+a+'_tab4_content">\n   <div class="row" style="margin-top:10px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+a+'_widget_iscustom">\n           <label class="panel-label">Apakah teks ini bisa di-edit oleh pengguna ? </label>\n       </div>\n   </div>\n   <div id="'+a+'_custom_options" style="margin-left:30px;">\n    <div class="row" style="margin-top:10px;">\n       <div class="large-8 medium-8 small-8 columns">\n           <label class="panel-label">Perataan Teks (Text Alignment):\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Opsi ini mengatur bagaimana posisi teks yang baru terhadap posisi teks semula<br/><br/><strong>rata kiri</strong>: posisi teks baru akan diratakan dengan posisi paling kiri dari teks semula<br/><br/> <strong>rata tengah</strong>: posisi teks baru akan diratakan dengan posisi paling tengah dari teks semula<br/><br/> <strong>rata kanan</strong>: posisi teks baru akan diratakan dengan posisi paling kanan dari teks semula"><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n    </div>\n    <div class="row">\n       <div class="large-4 medium-6 small-6 columns end" id="'+
a+'_widget_customalign">\n       </div>\n    </div>\n    <div class="row" style="margin-top:20px;">\n       <div class="large-8 medium-8 small-8 columns">\n           <label class="panel-label">Penyesuaian Teks (Text Fitting):\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Opsi ini mengatur ukuran teks yang baru terhadap ukuran teks semula<br/><br/><strong>default</strong>: lebar dan tinggi akan disesuaikan secara otomatis<br/><br/><strong>fit Width</strong>: lebar sama dengan teks semula<br/><br/><strong>fit height</strong>: tinggi sama dengan teks semula<br/><br/><strong>fit Both</strong>: lebar dan tinggi sama dengan teks semula"><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n    </div>\n    <div class="row">\n       <div class="large-4 medium-6 small-6 columns end" id="'+
a+'_widget_replacemode">\n       </div>\n    </div>\n',CIPTA.is_template_editing&&(f+='   <div class="row" style="margin-top:30px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+a+'_widget_istemplate">\n           <label class="panel-label">Jadikan teks ini sebagai TEMPLATE:\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Aktifkan opsi ini jika ingin menjadikan teks sebagai template yang dapat diedit secara langsung di halaman detail produk. <br/><br/>Silahkan lihat halaman tutorial untuk mempelajari lebih lanjut tentang Template."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n   </div>\n   <div id="'+
a+'_template_options" style="margin-left:40px;">\n    <div class="row" style="margin-top:15px;">\n       <div class="large-3 medium-4 small-5 columns" id="'+a+'_widget_qtext">\n           <label class="panel-label">Edit Teks\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Tampilkan edit box untuk mengganti teks secara langsung di halaman detail produk"><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n       <div class="large-3 medium-4 small-5 columns end" id="'+
a+'_widget_qcolor">\n           <label class="panel-label">Edit Warna\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Tampilkan opsi untuk mengganti warna teks secara langsung di halaman detail produk"><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n    </div>\n   </div>\n'),f+='   </div>\n   <div class="row" style="margin-top:40px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+
a+'_widget_islocked">\n           <label class="panel-label"><i class="icon-lock fs0"></i>&nbsp; Kunci posisi dan ukuran teks ini: \n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Teks yang <strong>dikunci</strong> tidak dapat diganti posisi atau ukurannya oleh pengguna."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n   </div>\n',1==CIPTA.is_template_placeholder_enabled&&(f+='   <div class="row" style="margin-top:40px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+
a+'_widget_isplaceholder">\n           <label class="panel-label">Jadikan sebagai Placeholder: \n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Teks yang akan dijadikan sebagai placeholder (otomatis dihapus pada saat editor dibuka)."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n   </div>\n'),f+="  </div>\n");f+="</div>        \n";var d=!1,g=[],c=null,h={},k={0:"none",1:"popular,populer",2:"gradient,gradien",
3:"geometric",4:"galaxy",5:"metallic",6:"watercolor",7:"texture,tekstur",8:"photo,foto"},m={1:"Populer",2:"Gradient",3:"Geometric",4:"Galaxy",5:"Metallic",6:"Watercolor",7:"Texture",8:"Photo"};h.disableOverlay=function(){$("#"+a+"_widget_overlay").scrollTop(0);$("#"+a+"_widget_overlay_frame").block({message:null,overlayCSS:{backgroundColor:"#F8F8F8",opacity:.8,cursor:"not-allowed"},fadeIn:0,fadeOut:0});g.overlaytype.disable()};h.enableOverlay=function(){$("#"+a+"_widget_overlay_frame").unblock();
g.overlaytype.enable()};var l=function(){g.font.enable();g.fontcat.enable();$("#"+a+"_widget_font_label").html("Font:")};h.create=function(){$(f).appendTo("#"+b);g.text=ciptaInputWidget(a+"_text_1",a+"_widget_text",100);g.text.create();g.font=ciptaFontWidget(a+"_font_1",a+"_widget_font");g.font.create(function(a){g.fontstyles.fillStyles(a);h.editText()});g.font.fillOptions("popular",null,function(){c&&c.meta.content&&g.font.setSelected(c.meta.content.getFontID())});g.fontcat=ciptaFancyDropDownWidget(a+
"_font_cat_1",a+"_widget_font_category",{popular:"Populer",brush:"Brush",decorative:"Decorative",grunge:"Grunge",film:"Film",funny:"Funny",games:"Games",gothic:"Gothic",handwriting:"Handwriting",foreign:"Internasional",modern:"Modern",poster:"Poster",retro:"Retro",round:"Rounded",scary:"Seram",sansserif:"Sans Serif",serif:"Serif",slabserif:"Slab Serif",script:"Script",stencil:"Stencil",sport:"Sports",techno:"Techno",typewriter:"Typewriter",western:"Western"},null,{searchbox:!1,"default":"popular"});
g.fontcat.create(function(b){$("#"+a+"_widget_font_label").html('<div>Font:&nbsp; <img src="/assets/img/icons/loader-horiz1.gif" style="width:30%"></div>');g.font.disable();g.fontcat.disable();c&&c.meta.content?g.font.fillOptions(b,c.meta.content.getFontID(),function(){l();0>=g.font.getSelected()?g.fontstyles.clear():g.font.getSelected()!=c.meta.content.getFontID()&&g.fontstyles.fillStyles(g.font.getSelected())}):(g.font.fillOptions(b,null,function(){l()}),g.fontstyles.clear())});g.fontstyles=ciptaFontStylesWidget(a+
"_fs",a+"_widget_font_style");g.fontstyles.create(function(a){h.editText()});c&&c.meta.content&&g.fontstyles.fillStyles(c.meta.content.getFontID());g.color=ciptaColorPickerWidget(a+"_color_1",a+"_widget_color");g.color.create(function(a){h.editText(!0)});var n={0:"No Outline",1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},q={};_.forEach(_.slice(_.keys(n),1,n.length),function(a){q[a]='<div style="height:25px;"><img src="/assets/img/editor/outline'+a+'.png" style="height:25px;"></div>'});g.outline=ciptaFancyDropDownWidget(a+
"_outline_1",a+"_widget_outline",n,q,{searchbox:!1});g.outline.create(function(a){0==a?g.outline_color.disable():g.outline_color.enable();h.editText(!0)});g.outline_color=ciptaColorPickerWidget(a+"_outline_color_1",a+"_widget_outline_color");g.outline_color.create(function(a){h.editText(!0)});n={0:"No Shadow",1:"Soft Shadow 1",2:"Soft Shadow 2",20:"Hard Shadow 1",21:"Hard Shadow 2"};var r={},w={};_.forEach(_.slice(_.keys(n),1,n.length),function(a){r[a]='<div style="height:60px;"><img src="/assets/img/editor/shadow'+
a+'.png" style="height:60px;"></div>';w[a]='<div style="height:30px;"><img src="/assets/img/editor/shadow'+a+'.png" style="height:30px;"></div>'});g.shadow=ciptaFancyDropDownWidget(a+"_shadow_1",a+"_widget_shadow",n,r,{searchbox:!1},w);g.shadow.create(function(a){0==a?g.shadow_color.disable():g.shadow_color.enable();h.editText(!0)});g.shadow_color=ciptaColorPickerWidget(a+"_shadow_color_1",a+"_widget_shadow_color");g.shadow_color.create(function(a){h.editText(!0)});n={0:"Normal Shape",1:"Arched Up",
2:"Arched Down",3:"Round Up",4:"Round Down"};var t=[],u=[];_.forEach(_.keys(n),function(a){t[a]='<div style="height:60px;"><img src="/assets/img/editor/shape'+a+'.png" style="height:60px;"></div>';u[a]='<div style="height:30px;"><img src="/assets/img/editor/shape'+a+'.png" style="height:30px;"></div>'});g.shape=ciptaFancyDropDownWidget(a+"_shape_1",a+"_widget_shape",n,t,{searchbox:!1},u);g.shape.create(function(a){0==a?g.shape_amount.disable():g.shape_amount.enable();(0>=g.shape_amount.getSelected()||
100<g.shape_amount.getSelected())&&g.shape_amount.setSelected(30);h.editText()});g.shape_amount=ciptaFancyDropDownWidget(a+"_shape_amount_1",a+"_widget_shape_amount",{5:5,10:10,20:20,30:30,40:40,50:50,60:60,70:70,80:80,90:90,100:100},null,{searchbox:!1,"default":30});g.shape_amount.create(function(a){h.editText()});g.kerning=ciptaFancyDropDownWidget(a+"_kerning_amount",a+"_widget_kerning",{0:0,5:5,10:10,15:15,20:20,25:25,30:30,35:35,40:40,45:45,50:50,55:55,60:60,65:65,70:70,75:75,80:80,85:85,90:90,
95:95,100:100},null,{searchbox:!1,"default":0});g.kerning.create(function(a){h.editText()});g.transparency=ciptaRangeSliderWidget(a+"_transparency",a+"_widget_transparency",0,90);g.transparency.create(function(a){e.setOpacity(1-a/100)});g.zoomout=ciptaButtonWidget(a+"_scale_out",a+"_widget_size");g.zoomout.create("Perkecil","icon-zoom-out fs1",function(){e&&e.scaleOut()});g.zoomin=ciptaButtonWidget(a+"_scale_in",a+"_widget_size");g.zoomin.create("Perbesar","icon-zoom-in fs1",function(){e&&e.scaleIn()});
g.flipvert=ciptaButtonWidget(a+"_flipvertical",a+"_widget_size");g.flipvert.create("Balik Vertikal","icon-flip-vert fs1",function(){e&&e.flipVertical()});g.fliphorz=ciptaButtonWidget(a+"_fliphorizontal",a+"_widget_size");g.fliphorz.create("Balik Horisontal","icon-flip-horz fs1",function(){e&&e.flipHorizontal()});g.rotation=ciptaKnobWidget(a+"_rotate",a+"_widget_rotation");g.rotation.create(0,360,0,1,function(a){e&&e.rotate(a)});g.lfront=ciptaButtonWidget(a+"_bringtofront",a+"_widget_layers");g.lfront.create("Bring To Front",
"icon-bringtofront fs1",function(){e&&e.bringForward()});g.lback=ciptaButtonWidget(a+"_sendtoback",a+"_widget_layers");g.lback.create("Send To Back","icon-sendtoback fs1",function(){e&&e.sendBackward()});g.left=ciptaButtonWidget(a+"_movetoleft",a+"_widget_pos");g.left.create("Move to Left","icon-arrow-left2 fs1",function(){e&&e.moveLeft()});g.right=ciptaButtonWidget(a+"_movetoright",a+"_widget_pos");g.right.create("Move to Right","icon-arrow-right2 fs1",function(){e&&e.moveRight()});g.up=ciptaButtonWidget(a+
"_moveupward",a+"_widget_pos");g.up.create("Move Upward","icon-arrow-up2 fs1",function(){e&&e.moveUp()});g.down=ciptaButtonWidget(a+"_movedownward",a+"_widget_pos");g.down.create("Move Downward","icon-arrow-down2 fs1",function(){e&&e.moveDown()});g.acenter=ciptaButtonWidget(a+"_aligncenter",a+"_widget_pos");g.acenter.create("Bawa ke Tengah","icon-align-center fs1",function(){e&&e.alignCenter()});g["delete"]=ciptaButtonWidget(a+"_delete",a+"_widget_delete");g["delete"].create(null,"icon-trash fs1 red-icon",
function(){e&&e.deleteObject()},"Hapus",!0);g.overlaycat=ciptaFancyDropDownWidget(a+"_overlay_cat",a+"_widget_overlay_category",m,null,{searchbox:!1,"default":0});g.overlaycat.create(function(a){0==a?null!=g.overlay.getSelected()&&(g.overlay.resetSelected(),c.meta.content.setOverlay("category",a),c.meta.content.setOverlay("id",null),h.editText(!0)):(h.enableOverlay(),g.overlay.fillClipartList(k[a],null,"rating"))});g.overlaytype=ciptaFancyDropDownWidget(a+"_overlaytype",a+"_widget_overlay_type",{1:"Overlay",
2:"Soft Light",3:"Hard Light",8:"Multiply",9:"Darken",13:"Screen",10:"Color Burn",22:"Hue",24:"Colorize",99:"Fill"},null,{searchbox:!1,"default":99});g.overlaytype.create(function(a){0<g.overlaycat.getSelected()&&h.editText(!0)});g.overlay=ciptaClipartWidget(a+"_overlay",a+"_widget_overlay","overlay",6);g.overlay.create("popular",function(a){h.editText(!0)},function(a){h.editText(!0)});g.overlayreset=ciptaButtonWidget(a+"_overlayreset_button",a+"_widget_overlay_reset");g.overlayreset.create(null,
"icon-rotate-left fs1",function(){g.overlay.resetSelected();c.meta.content.setOverlay("category",0);c.meta.content.setOverlay("id",null);h.editText(!0)},"Remove Overlay",!0);var x=function(){var a=g.text.getInput();a&&a.match(/\S/)?a!=c.meta.content.getText()&&h.editText():g.text.setInput(c.meta.content.getText())};$("#"+a+"_button_update").click(function(){x()});$("#"+a+"_text_1").keydown(function(a){13==a.keyCode&&x()});$("#"+a+"_tab1_content").on("toggled",function(a,b){c&&c.panel&&(c.panel.tab=
1)});$("#"+a+"_tab2_content").on("toggled",function(a,b){c&&c.panel&&(c.panel.tab=2)});$("#"+a+"_tab3_content").on("toggled",function(a,b){0>=g.overlaycat.getSelected()?h.disableOverlay():(h.enableOverlay(),g.overlay.scrollToSelected());c&&c.panel&&(c.panel.tab=3)});$("#"+a+"_tab4_content").on("toggled",function(a,b){c&&c.panel&&(c.panel.tab=4)});CIPTA.editor_type==EDITOR_DESIGN&&(g.template_iscustom=ciptaCheckboxWidget(a+"_template_iscustom",a+"_widget_iscustom",!0),g.template_iscustom.create(function(b){c.meta.content.setTemplate("iscustom",
b);b?$("#"+a+"_custom_options").show():$("#"+a+"_custom_options").hide()}),CIPTA.is_template_editing&&(g.template_istemplate=ciptaCheckboxWidget(a+"_template_istemplate",a+"_widget_istemplate",!1),g.template_istemplate.create(function(b){c.meta.content.setTemplate("istemplate",b);b?($("#"+a+"_template_options").show(),g.template_qtext.isChecked()||g.template_qcolor.isChecked()||(c.meta.content.setTemplate("qtext",!0),g.template_qtext.setChecked(!0))):$("#"+a+"_template_options").hide()}),g.template_qtext=
ciptaCheckboxWidget(a+"_template_qtext",a+"_widget_qtext"),g.template_qtext.create(function(b){c.meta.content.setTemplate("qtext",b);g.template_qtext.isChecked()||g.template_qcolor.isChecked()||($("#"+a+"_template_options").hide(),g.template_istemplate.setChecked(!1),c.meta.content.setTemplate("istemplate",!1))}),g.template_qcolor=ciptaCheckboxWidget(a+"_template_qcolor",a+"_widget_qcolor"),g.template_qcolor.create(function(b){c.meta.content.setTemplate("qcolor",b);g.template_qtext.isChecked()||g.template_qcolor.isChecked()||
($("#"+a+"_template_options").hide(),g.template_istemplate.setChecked(!1),c.meta.content.setTemplate("istemplate",!1))})),g.template_customalign=ciptaFancyDropDownWidget(a+"_template_customalign",a+"_widget_customalign",{left:"rata kiri",center:"rata tengah",right:"rata kanan"},null,{searchbox:!1,"default":"center"}),g.template_customalign.create(function(a){c.meta.content.setTemplate("customalign",a)}),g.template_replacemode=ciptaFancyDropDownWidget(a+"_template_replacemode",a+"_widget_replacemode",
{"default":"default",fitwidth:"fit Width",fitheight:"fit Height",fitboth:"fit Both"},null,{searchbox:!1,"default":"default"}),g.template_replacemode.create(function(a){c.meta.content.setTemplate("replacemode",a)}),g.template_islocked=ciptaCheckboxWidget(a+"_template_islocked",a+"_widget_islocked",!1),g.template_islocked.create(function(a){c.meta.content.setTemplate("islocked",a);e&&(a?e.lockObject():e.unlockObject())}),1==CIPTA.is_template_placeholder_enabled&&(g.template_isplaceholder=ciptaCheckboxWidget(a+
"_template_isplaceholder",a+"_widget_isplaceholder",!1),g.template_isplaceholder.create(function(a){c.meta.content.setTemplate("isplaceholder",a)})));d=!0;return h};h.initTemplateOptions=function(b){g.template_iscustom.setChecked(b.getTemplate("iscustom"));g.template_iscustom.isChecked()?$("#"+a+"_custom_options").show():$("#"+a+"_custom_options").hide();CIPTA.is_template_editing&&(g.template_qtext.setChecked(b.getTemplate("qtext")),g.template_qcolor.setChecked(b.getTemplate("qcolor")),g.template_istemplate.setChecked(b.getTemplate("istemplate")),
g.template_istemplate.isChecked()?($("#"+a+"_template_options").show(),g.template_qtext.isChecked()||g.template_qcolor.isChecked()||(c.meta.content.setTemplate("qtext",!0),g.template_qtext.setChecked(!0))):$("#"+a+"_template_options").hide());b.getTemplate("customalign")?g.template_customalign.setSelected(b.getTemplate("customalign")):g.template_customalign.setSelected("center");b.getTemplate("replacemode")?g.template_replacemode.setSelected(b.getTemplate("replacemode")):g.template_replacemode.setSelected("default");
g.template_islocked.setChecked(b.getTemplate("islocked"));1==CIPTA.is_template_placeholder_enabled&&g.template_isplaceholder.setChecked(b.getTemplate("isplaceholder"))};h.initText=function(b){if(d){var e=b.meta.content;g.text.setInput(e.getText());var f=e.getFontCategory();f||(f="popular");g.fontcat.getSelected()!=f&&(g.fontcat.setSelected(f),g.font.fillOptions(f,e.getFontID()));g.font.setSelected(e.getFontID());0<e.getFontID()?(g.fontstyles.fillStyles(e.getFontID()),g.fontstyles.setSelected(e.getFontStyle())):
g.fontstyles.clear();g.color.setColor(e.getColor());g.rotation.setValue(b.getAngle());g.outline.setSelected(e.getStroke("width"));g.outline_color.setColor(e.getStroke("color"));0==e.getStroke("width")?g.outline_color.disable():g.outline_color.enable();g.shadow.setSelected(e.getShadow("type"));g.shadow_color.setColor(e.getShadow("color"));0==e.getShadow("type")?g.shadow_color.disable():g.shadow_color.enable();g.shape.setSelected(e.getShape("type"));g.shape_amount.setSelected(e.getShape("amount"));
0==e.getShape("type")?g.shape_amount.disable():g.shape_amount.enable();(f=e.getOthers("kerning"))&&0<f?g.kerning.setSelected(f):g.kerning.setSelected(0);0>=e.getOverlay("category")?(g.overlay.resetSelected(),g.overlaycat.setSelected(e.getOverlay("category")),g.overlaytype.setSelected(e.getOverlay("type")),1!=g.overlaycat.getSelected()&&(g.overlay.fillClipartList(k[1],null,"rating"),g.overlaycat.setSelected(1))):(e.getOverlay("category")!=g.overlaycat.getSelected()&&(g.overlay.fillClipartList(k[e.getOverlay("category")],
null,"rating"),g.overlaycat.setSelected(e.getOverlay("category"))),g.overlay.setSelected(e.getOverlay("id")),g.overlaytype.setSelected(e.getOverlay("type")));h.enableOverlay();f=100*(1-b.getOpacity());0>f?f=0:90<f&&(f=90);g.transparency.setValue(f);CIPTA.editor_type==EDITOR_DESIGN&&h.initTemplateOptions(e);c=b;b.panel&&b.panel.tab&&1<=b.panel.tab&&4>=b.panel.tab?$("#"+a+"_tab"+b.panel.tab).click():$("#"+a+"_tab1").click()}return h};h.editText=function(a){if(d){var b=g.text.getInput(),f=g.font.getSelected(),
k=g.fontcat.getSelected(),l=g.color.getColor(),n=g.outline.getSelected(),m=g.outline_color.getColor(),B=g.shadow.getSelected(),D=g.shadow_color.getColor(),F=g.shape.getSelected(),z=g.shape_amount.getSelected(),v=g.overlay.getSelected(),y=g.overlaycat.getSelected(),A=g.overlaytype.getSelected(),C=g.kerning.getSelected(),H=g.fontstyles.getSelected();if(!e||!c)throw"Error: Invalid Canvas Object";c.meta.content.setText(b);0<f&&(c.meta.content.setFontID(f),c.meta.content.setFontCategory(k));c.meta.content.setFontStyle(H);
c.meta.content.setColor(l);c.meta.content.setStroke("width",n);c.meta.content.setStroke("color",m);c.meta.content.setShadow("type",B);c.meta.content.setShadow("color",D);c.meta.content.setShape("type",F);c.meta.content.setShape("amount",z);0<C?c.meta.content.setOthers("kerning",C):c.meta.content.unsetOthers("kerning");0<y?(c.meta.content.setOverlay("id",v),c.meta.content.setOverlay("category",y),c.meta.content.setOverlay("type",A)):(c.meta.content.setOverlay("id",null),c.meta.content.setOverlay("category",
0));c.meta.content.createPreview(function(b){a&&1==a?e.editText(b,null,null,"fit"):e.editText(b)})}return h};h.show=function(){e&&(e.isCustom()?$("#"+a+"_tab4_dd").show():($("#"+a+"_tab4_dd").hide(),4==c.panel.tab&&$("#"+a+"_tab1").click()));l();$("#"+b).show();return h};h.hide=function(){$("#"+b).hide();return h};h.updateRotation=function(a){g.rotation.setValue(a)};h.block=function(){$("#"+b).block({message:null,overlayCSS:{backgroundColor:"#CCC",opacity:.05,cursor:"wait"}})};h.unblock=function(){$("#"+
b).unblock()};return h},ciptaImagePanel=function(a,b,e,f){var d='<div class="row">\n   <div class="large-12 columns" id="'+a+'_widget_1">\n   </div>\n</div>\n',g=[],c=!1,h={create:function(){$(d).appendTo("#"+b);g.push(ciptaUploadWidget(a+"_upload_1",a+"_widget_1"));g[0].create(function(a){a&&h.addImage(a);c=!1;f&&f()},function(){c=!0});return h},addImage:function(a){if(!e)throw"Error: Invalid Canvas Object";if(!a._meta||"SUCCESS"!=a._meta.status)throw"Server Error: Please try again later";var b=
ciptaImage({});b.setFilename(a.result.details.filename);b.setUploadname(a.result.details.orig_filename);b.setWidth(a.result.width);b.setHeight(a.result.height);b.setType("user");b.setOverlay("type",1);b.setFilter("category",1);a.result.filetype&&b.setOthers("filetype",a.result.filetype);a.result.iscolorable&&(b.setOthers("iscolorable",!0),b.setOthers("colors",_.cloneDeep(a.result.colors)),b.setOthers("orig_colors",_.cloneDeep(a.result.colors)));CIPTA.editor_type==EDITOR_DESIGN&&(b.setTemplate("iscustom",
!0),b.setTemplate("islocked",!1),b.setTemplate("istemplate",!1),b.setTemplate("qimage",!0),b.setTemplate("qcrop",!0),a.result.iscolorable&&b.setTemplate("qimgcolor",!0));b.setPreview(b.getImagePreviewURL());e.addImage(b);return h},init:function(){c=!1},isUploading:function(){return c},cancelUpload:function(){c&&g[0].cancelUpload()}};return h},ciptaImageReplacePanel=function(a,b,e,f){var d='<div class="row">\n   <div class="large-12 columns" id="'+a+'_widget_1">\n   </div>\n</div>\n',g=[],c=!1,h={create:function(){$(d).appendTo("#"+
b);g.push(ciptaUploadWidget(a+"_upload_1",a+"_widget_1"));g[0].create(function(a){c=!1;f&&f(a)},function(){c=!0});return h},init:function(){c=!1},isUploading:function(){return c},cancelUpload:function(){c&&g[0].cancelUpload()}};return h},ciptaImageEditPanel=function(a,b,e){var f='<div id="'+a+'_crop"></div>\n<div id="'+a+'_modal_replace" class="reveal-modal medium" data-reveal data-options="close_on_background_click:false">\n   <h2>Ganti Gambar</h2>\n     Format gambar yang dapat diproses antara lain adalah: <strong>.jpg</strong> dan <strong>.png</strong><br/><br/>\n     <span class="medium-text">Mohon jangan mengupload gambar yang berbau SARA, kekerasan, atau pornografi. \n     Sebelum dicetak, setiap desain akan melalui proses moderasi terlebih dahulu dan pihak Ciptaloka.com \n     berhak untuk menolak desain yang kami anggap melanggar aturan tersebut.<br/><br/>\n     Silahkan pilih gambar yang akan di upload :</span>\n   <a class="close-reveal-modal">&#215;</a>\n   <div id="'+
a+'_modal_upload"> </div>\n</div>\n<dl class="tabs" data-tab>\n  <dd id="'+a+'_dtab1" class="active"><a href="#'+a+'_tab1_content" id="'+a+'_tab1">\x3c!--i class="icon-pencil2 fs0"> </i--\x3e <span class="hide-for-large-up panel-tab-label">Edit</span><span class="show-for-large-up panel-tab-label">Edit Gambar</span></a></dd>\n  <dd id="'+a+'_dtab2"><a href="#'+a+'_tab2_content" id="'+a+'_tab2"><span class="panel-tab-label">\x3c!--i class="icon-cog fs0"> </i--\x3e Overlay</span></a></dd>\n  <dd id="'+
a+'_dtab4"><a href="#'+a+'_tab4_content" id="'+a+'_tab4"><span class="panel-tab-label">\x3c!--i class="icon-cog fs0"> </i--\x3e Mask</span></a></dd>\n  <dd id="'+a+'_dtab3"><a href="#'+a+'_tab3_content" id="'+a+'_tab3"><span class="panel-tab-label">\x3c!--i class="icon-cog fs0"> </i--\x3e Filter</span></a></dd>\n';CIPTA.editor_type==EDITOR_DESIGN&&(f+='  <dd id="'+a+'_dtab5"><a href="#'+a+'_tab5_content" id="'+a+'_tab5"><i class="icon-edit fs0"> </i> Customable ?</a></dd>\n');f+='</dl>            \n<div class="tabs-content">\n   <div class="content active" id="'+
a+'_tab1_content">\n       <div class="row" style="margin-top:10px;">\n           <div class="large-12 medium-12 small-12 columns" id="'+a+'_widget_crop_replace">\n           </div>\n       </div>\n       <div class="row" style="margin-top:20px;">\n           <div class="large-6 medium-12 small-6 columns" id="'+a+'_widget_size">\n               <label class="panel-label">Ukuran & Posisi: </label>           </div>\n           <div class="large-3 medium-6 small-3 columns" id="'+a+'_widget_layer">\n               <label class="panel-label">Susunan: </label>           </div>\n           <div class="large-3 medium-6 small-3 columns" style="margin-top:18px;" id="'+
a+'_widget_delete">\n           </div>\n       </div>\n       <div class="row" style="margin-top:25px;">\n           <div class="large-6 medium-12 small-12 columns" style="display:block; margin-top:15px;" id="'+a+'_widget_pos">\n           </div>\n           <div class="large-6 medium-12 small-12 columns" style="display:block; margin-top:15px;">\n               <label class="panel-label">Putar Gambar: </label>\n               <div id="'+a+'_widget_rotation" class="text-left"></div>\n           </div>\n           \x3c!--div class="large-3 medium-6 small-6 columns" style="display:block; margin-top:15px;">\n               <label class="panel-label" style="margin-left:-20px;">Transparansi:</label>\n               <div style="margin-left:0px; margin-top:20px; margin-bottom:10px;" id="'+
a+'_widget_transparency"></div>\n           </div--\x3e\n       </div>\n       <div class="row" style="margin-top:5px;">\n           <div class="large-12 columns" id="'+a+'_widget_clipcolor">\n           </div>\n       </div>\n       <div class="row" style="margin-top:20px;">\n           \x3c!--div class="large-5 columns" id="'+a+'_widget_replace_image">\n               <a href="#" class="button widget-button has-tip button-tip expand" style="margin:3px; padding:13px; font-size: 13px;" data-reveal-id="'+
a+'_modal_replace"><i class="icon-loop2 fs0"></i> &nbsp; Ganti Gambar</a>\n           </div--\x3e\n           <div class="large-3 end columns" id="'+a+'_widget_4">\n               <div class="row">\n                   <div class="large-12 columns text-left" id="'+a+'_widget_6">\n                   </div>\n               </div>\n           </div>\n       </div>\n   </div>\n   <div class="content" id="'+a+'_tab2_content">\n           <div class="row">\n               <div class="large-6 medium-5 small-6 columns panel-label" id="'+
a+'_widget_overlay_category">\n                   <label class="panel-label">Kategori Overlay: </label>\n               </div>\n               <div class="large-4 medium-7 small-6 columns panel-label text-right" id="'+a+'_widget_overlay_reset">\n               </div>\n           </div>\n           <div class="row" id="'+a+'_widget_10_frame">\n               <div class="large-12 columns" id="'+a+'_widget_10" style="height:300px; margin-top:10px; overflow-y:auto;">\n               </div>\n           </div>\n           <div class="row" style="margin-top:20px;">\n               <div class="large-4 medium-6 small-4 columns">\n                   <label class="panel-label">Jenis Overlay: </label>\n                   <div class="panel-label" id="'+
a+'_widget_11">\n                   </div>\n               </div>\n               \x3c!--div class="large-6 columns">\n                   <label class="panel-label">Transparansi: </label>\n                   <div class="panel-label" id="'+a+'_widget_12">\n                   </div>\n               </div--\x3e\n           </div>\n   </div>        \n   <div class="content" id="'+a+'_tab3_content">\n           <div class="row">\n               <div class="large-12 columns">\n                   <label class="panel-label">Kategori Filter: </label>\n               </div>\n               <div class="large-12 columns panel-label" id="'+
a+'_widget_filter_category">\n               </div>\n           </div>\n           <div class="row">\n               <div class="large-12 columns" id="'+a+'_widget_filter" style="height: 350px; overflow-y: auto;">\n               </div>\n           </div>\n   </div>        \n   <div class="content" id="'+a+'_tab4_content">\n           <div class="row">\n               <div class="large-6 medium-5 small-6 columns panel-label" id="'+a+'_widget_mask_category">\n                   <label class="panel-label">Kategori Mask: </label>\n               </div>\n               <div class="large-6 medium-7 small-6 columns text-right" id="'+
a+'_widget_mask_crop">\n               </div>\n           </div>\n           <div class="row" id="'+a+'_widget_mask_frame">\n               <div class="large-12 columns" id="'+a+'_widget_mask" style="height: 350px; overflow-y: auto;">\n                   <label class="panel-label">Jenis Mask: </label>\n               </div>\n           </div>\n   </div>        \n';CIPTA.editor_type==EDITOR_DESIGN&&(f+='  <div class="content" id="'+a+'_tab5_content">\n   <div class="row" style="margin-top:10px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+
a+'_widget_iscustom">\n           <label class="panel-label">Apakah gambar ini bisa di-edit oleh pengguna ? </label>\n       </div>\n   </div>\n   <div id="'+a+'_custom_options" style="margin-left:30px;">\n    <div class="row" style="margin-top:20px;">\n       <div class="large-8 medium-8 small-8 columns">\n           <label class="panel-label">Penyesuaian Ukuran Gambar (Fit Image) :\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Opsi ini mengatur ukuran gambar yang baru terhadap ukuran gambar semula<br/><br/><strong>crop</strong>: potong gambar baru sesuai dengan proporsi gambar semula<br/><br/><strong>fit Width</strong>: lebar gambar baru sama dengan lebar gambar semula<br/><br/><strong>fit height</strong>: tinggi gambar baru sama dengan tinggi gambar semula<br/><br/><strong>fit Both</strong>: lebar dan tinggi gambar baru sama dengan gambar semula"><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n    </div>\n    <div class="row">\n       <div class="large-3 medium-4 small-8 columns end" id="'+
a+'_widget_replacemode">\n       </div>\n    </div>\n',CIPTA.is_template_editing&&(f+='   <div class="row" style="margin-top:30px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+a+'_widget_istemplate">\n           <label class="panel-label">Jadikan gambar ini sebagai TEMPLATE:\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Aktifkan opsi ini jika ingin menjadikan gambar sebagai template yang dapat diedit secara langsung di halaman detail produk. <br/><br/>Silahkan lihat halaman tutorial untuk mempelajari lebih lanjut tentang Template."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n   </div>\n   <div id="'+
a+'_template_options" style="margin-left:40px;">\n    <div class="row" id="'+a+'_template_image" style="margin-top:15px;">\n       <div class="large-3 medium-3 small-4 columns" id="'+a+'_widget_qimage">\n           <label class="panel-label">Ganti Gambar</label>\n       </div>\n       <div class="large-3 medium-3 small-4 columns" id="'+a+'_widget_qcrop">\n           <label class="panel-label">Crop Gambar</label>\n       </div>\n       <div class="large-3 medium-3 small-4 columns end" id="'+a+'_widget_qimgcolor">\n           <label class="panel-label">Edit Warna</label>\n       </div>\n    </div>\n    <div class="row" id="'+
a+'_template_clipart" style="margin-top:15px;">\n       <div class="large-3 medium-3 small-4 columns" id="'+a+'_widget_qclipcolor">\n           <label class="panel-label">Edit Warna\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Aktifkan opsi ini jika ingin menampilkan pilihan untuk mengganti warna clipart di halaman detail produk. <br/><br/>Silahkan lihat halaman tutorial untuk mempelajari lebih lanjut tentang Template."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n       <div class="large-3 medium-3 small-4 columns" id="'+
a+'_widget_qclipart">\n           <label class="panel-label">Ganti Clipart\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Aktifkan opsi ini jika ingin menampilkan pilihan untuk mengganti gambar clipart di halaman detail produk. <br/><br/>Silahkan lihat halaman tutorial untuk mempelajari lebih lanjut tentang Template."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n       <div class="large-5 medium-5 small-4 columns end" id="'+
a+'_widget_qclipquery">\n           <label class="panel-label">Search Query Clipart\n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Search query yang digunakan untuk menampilkan clipart ketika pengguna memilih untuk mengganti clipart <br/><br/>Silahkan lihat halaman tutorial untuk mempelajari lebih lanjut tentang Template."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n    </div>\n   </div>\n'),
f+='   </div>\n   <div class="row" style="margin-top:40px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+a+'_widget_islocked">\n           <label class="panel-label"><i class="icon-lock fs0"></i>&nbsp; Kunci posisi dan ukuran gambar ini: \n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Gambar yang <strong>dikunci</strong> tidak dapat diganti posisi atau ukurannya oleh pengguna."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n   </div>\n',
1==CIPTA.is_template_placeholder_enabled&&(f+='   <div class="row" style="margin-top:40px;">\n       <div class="large-10 medium-10 small-10 columns" id="'+a+'_widget_isplaceholder">\n           <label class="panel-label">Jadikan sebagai Placeholder: \n               <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Gambar yang akan dijadikan sebagai placeholder (otomatis dihapus pada saat editor dibuka)."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n           </label>\n       </div>\n   </div>\n'),
f+="  </div>\n");f+="</div>        \n";var d={},g=!1,c=[],h=[],k=null,m={0:"none",1:"popular,populer",2:"gradient,gradien",3:"geometric",4:"galaxy",5:"metallic",6:"watercolor",7:"texture,tekstur",8:"photo,foto"},l={1:"Populer",2:"Gradient",3:"Geometric",4:"Galaxy",5:"Metallic",6:"Watercolor",7:"Texture",8:"Photo"},n={1:"Populer",2:"Vintage Filters",3:"Black & White",4:"Art Filters"},q={1:"popular,populer",2:"vintage,instagram",3:"black&white,blackwhite",4:"art,arts,special"},r={1:"Populer",2:"Persegi",
3:"Bundar",4:"Grunge",5:"Film",6:"Bentuk & Simbol",7:"Kertas"},w={0:"none",1:"populer,popular",2:"rectangle",3:"circular",4:"grunge",5:"film",6:"bentuk,simbol,shape,symbol",7:"paper"},t=null,u=null;return d={disableOverlay:function(){$("#"+a+"_widget_10").scrollTop(0);$("#"+a+"_widget_10_frame").block({message:null,overlayCSS:{backgroundColor:"#F8F8F8",opacity:.8,cursor:"not-allowed"},fadeIn:0,fadeOut:0});c.overlaytype.disable()},enableOverlay:function(){$("#"+a+"_widget_10_frame").unblock();c.overlaytype.enable()},
disableMask:function(){$("#"+a+"_widget_mask").scrollTop(0);$("#"+a+"_widget_mask_frame").block({message:null,overlayCSS:{backgroundColor:"#F8F8F8",opacity:.8,cursor:"not-allowed"},fadeIn:0,fadeOut:0})},enableMask:function(){$("#"+a+"_widget_mask_frame").unblock()},create:function(){$(f).appendTo("#"+b);u=ciptaImageCropPanel(a+"_cropimage",a+"_crop",function(a){k.meta.content.setCrop(a);d.editImage()});u.create();c.scaleout=ciptaButtonWidget(a+"_scale_out",a+"_widget_size");c.scaleout.create("Perkecil",
"icon-zoom-out fs1",function(){e&&e.scaleOut()});c.scalein=ciptaButtonWidget(a+"_scale_in",a+"_widget_size");c.scalein.create("Perbesar","icon-zoom-in fs1",function(){e&&e.scaleIn()});c.replace=ciptaButtonWidget(a+"_replace_button",a+"_widget_crop_replace");c.replace.create(null,"icon-loop2 fs1",function(){},"Ganti Gambar",!0,null,'data-reveal-id="'+a+'_modal_replace"');c.crop=ciptaButtonWidget(a+"_crop_button",a+"_widget_crop_replace");c.crop.create(null,"icon-crop fs1",function(){var a=k.meta.content.getMaskURL(),
b=k.meta.content.getCrop();u.initImage(k,a,b,!1)},"Crop Gambar",!0,null,'data-reveal-id="'+u.getModalID()+'"');c.flipvert=ciptaButtonWidget(a+"_flipvertical",a+"_widget_size");c.flipvert.create("Balik Vertikal","icon-flip-vert fs1",function(){e&&e.flipVertical()});c.fliphorz=ciptaButtonWidget(a+"_fliphorizontal",a+"_widget_size");c.fliphorz.create("Balik Horisontal","icon-flip-horz fs1",function(){e&&e.flipHorizontal()});c.rotate=ciptaKnobWidget(a+"_rotate",a+"_widget_rotation");c.rotate.create(0,
360,0,1,function(a){e&&e.rotate(a)});c.tofront=ciptaButtonWidget(a+"_bringtofront",a+"_widget_layer");c.tofront.create("Bring To Front","icon-bringtofront fs1",function(){e&&e.bringForward()});c.toback=ciptaButtonWidget(a+"_sendtoback",a+"_widget_layer");c.toback.create("Send To Back","icon-sendtoback fs1",function(){e&&e.sendBackward()});c["delete"]=ciptaButtonWidget(a+"_delete",a+"_widget_delete");c["delete"].create(null,"icon-trash fs1 red-icon",function(){e&&e.deleteObject()},"Hapus",!0);c.transparency=
ciptaRangeSliderWidget(a+"_transparency",a+"_widget_transparency",0,90);c.transparency.create(function(a){e.setOpacity(1-a/100)});c.left=ciptaButtonWidget(a+"_movetoleft",a+"_widget_pos");c.left.create("Move to Left","icon-arrow-left2 fs1",function(){e&&e.moveLeft()});c.right=ciptaButtonWidget(a+"_movetoright",a+"_widget_pos");c.right.create("Move to Right","icon-arrow-right2 fs1",function(){e&&e.moveRight()});c.up=ciptaButtonWidget(a+"_moveupward",a+"_widget_pos");c.up.create("Move Upward","icon-arrow-up2 fs1",
function(){e&&e.moveUp()});c.down=ciptaButtonWidget(a+"_movedownward",a+"_widget_pos");c.down.create("Move Downward","icon-arrow-down2 fs1",function(){e&&e.moveDown()});c.aligncenter=ciptaButtonWidget(a+"_aligncenter",a+"_widget_pos");c.aligncenter.create("Bawa ke Tengah","icon-align-center fs1",function(){e&&e.alignCenter()});c.overlay=ciptaClipartWidget(a+"_overlay",a+"_widget_10","overlay",6);c.overlay.create("popular",function(a){d.editImage("fit")},function(a){d.editImage("fit")});c.overlaytype=
ciptaFancyDropDownWidget(a+"_overlaytype",a+"_widget_11",{1:"Overlay",2:"Soft Light",3:"Hard Light",8:"Multiply",9:"Darken",13:"Screen",10:"Color Burn",22:"Hue",24:"Colorize",99:"Fill"},null,{searchbox:!1});c.overlaytype.create(function(a){0<c.overlaycat.getSelected()&&d.editImage("fit")});c.overlayopacity=ciptaDropDownWidget(a+"_overlayopacity",a+"_widget_12",{0:0,10:10,20:20,30:30,40:40,50:50,60:60,70:70,80:80,90:90,100:100});c.overlayopacity.create(function(a){0<c.overlaycat.getSelected()&&d.editImage("fit")});
c.overlaycat=ciptaFancyDropDownWidget(a+"_overlay_cat",a+"_widget_overlay_category",l,null,{searchbox:!1,"default":0});c.overlaycat.create(function(a){0==a?null!=c.overlay.getSelected()&&(c.overlay.resetSelected(),k.meta.content.setOverlay("category",a),k.meta.content.setOverlay("id",null),d.editImage("fit")):(d.enableOverlay(),c.overlay.fillClipartList(m[a],null,"rating"))});c.overlayreset=ciptaButtonWidget(a+"_overlayreset_button",a+"_widget_overlay_reset");c.overlayreset.create(null,"icon-rotate-left fs1",
function(){c.overlay.resetSelected();k.meta.content.setOverlay("category",0);k.meta.content.setOverlay("id",null);d.editImage("fit")},"Remove Overlay",!0,"smaller  cipta-button-lightgray");c.mask=ciptaClipartWidget(a+"_masks",a+"_widget_mask","mask",6);c.mask.create("popular",function(a){d.editImage()},function(a){d.editImage()});c.maskcat=ciptaFancyDropDownWidget(a+"_mask_cat",a+"_widget_mask_category",r,null,{searchbox:!1,"default":1});c.maskcat.create(function(a){0==a?null!=c.mask.getSelected()&&
(c.mask.resetSelected(),k.meta.content.setMask("category",a),k.meta.content.setMask("id",null),d.editImage()):(d.enableMask(),c.mask.fillClipartList(w[a],null,"rating"))});c.maskcrop=ciptaButtonWidget(a+"_maskcrop_button",a+"_widget_mask_crop");c.maskcrop.create(null,"icon-crop fs1",function(){c.crop.triggerClick()},'<span class="show-for-large-up">Crop</span>',!0,"smaller cipta-button-lightgray",'data-reveal-id="'+u.getModalID()+'"');c.maskreset=ciptaButtonWidget(a+"_maskreset_button",a+"_widget_mask_crop");
c.maskreset.create(null,"icon-rotate-left fs1",function(){c.mask.resetSelected();k.meta.content.setMask("category",0);k.meta.content.setMask("id",null);d.editImage()},'<span class="show-for-large-up">Reset Mask</span><span class="hide-for-large-up">Reset</span>',!0,"smaller  cipta-button-lightgray");c.filter=ciptaClipartWidget(a+"_filters",a+"_widget_filter","filter",6);c.filter.create("popular",function(a){d.editImage("fit")},function(a){d.editImage("fit")},!0);c.filtercat=ciptaFancyDropDownWidget(a+
"_filter_cat",a+"_widget_filter_category",n,null,{searchbox:!1,"default":1});c.filtercat.create(function(a){c.filter.fillClipartList(q[a],null,"rating")});$("#"+a+"_tab1_content").on("toggled",function(a,b){k&&k.panel&&(k.panel.tab=1)});$("#"+a+"_tab2_content").on("toggled",function(a,b){0>=c.overlaycat.getSelected()?d.disableOverlay():(d.enableOverlay(),c.overlay.scrollToSelected());k&&k.panel&&(k.panel.tab=2)});$("#"+a+"_tab3_content").on("toggled",function(a,b){k&&k.panel&&(k.panel.tab=3)});$("#"+
a+"_tab4_content").on("toggled",function(a,b){0>=c.maskcat.getSelected()?d.disableMask():(d.enableMask(),c.mask.scrollToSelected());k&&k.panel&&(k.panel.tab=4)});$("#"+a+"_tab5_content").on("toggled",function(a,b){k&&k.panel&&(k.panel.tab=5)});t=ciptaImageReplacePanel(a+"_replaceimage",a+"_modal_replace",e,function(b){d.replaceImage(b);$("#"+a+"_modal_replace").foundation("reveal","close")});t.create();CIPTA.editor_type==EDITOR_DESIGN&&(c.template_iscustom=ciptaCheckboxWidget(a+"_template_iscustom",
a+"_widget_iscustom",!0),c.template_iscustom.create(function(b){k.meta.content.setTemplate("iscustom",b);b?$("#"+a+"_custom_options").show():$("#"+a+"_custom_options").hide()}),CIPTA.is_template_editing&&(c.template_istemplate=ciptaCheckboxWidget(a+"_template_istemplate",a+"_widget_istemplate",!1),c.template_istemplate.create(function(b){k.meta.content.setTemplate("istemplate",b);b?($("#"+a+"_template_options").show(),"clipart"==k.meta.content.getType()?c.template_qclipart.isChecked()||c.template_qclipcolor.isChecked()||
(k.meta.content.setTemplate("qclipart",!0),c.template_qclipart.setChecked(!0),$("#"+a+"_widget_qclipquery").show()):c.template_qimage.isChecked()||c.template_qimgcolor.isChecked()||(k.meta.content.setTemplate("qimage",!0),c.template_qimage.setChecked(!0))):$("#"+a+"_template_options").hide()}),c.template_qimage=ciptaCheckboxWidget(a+"_template_qimage",a+"_widget_qimage",!0),c.template_qimage.create(function(b){k.meta.content.setTemplate("qimage",b);c.template_qimage.isChecked()||c.template_qimgcolor.isChecked()||
($("#"+a+"_template_options").hide(),c.template_istemplate.setChecked(!1),k.meta.content.setTemplate("istemplate",!1))}),c.template_qcrop=ciptaCheckboxWidget(a+"_template_qcrop",a+"_widget_qcrop",!0),c.template_qcrop.create(function(a){k.meta.content.setTemplate("qcrop",a)}),c.template_qimgcolor=ciptaCheckboxWidget(a+"_template_qimgcolor",a+"_widget_qimgcolor",!0),c.template_qimgcolor.create(function(b){k.meta.content.setTemplate("qimgcolor",b);c.template_qimage.isChecked()||c.template_qimgcolor.isChecked()||
($("#"+a+"_template_options").hide(),c.template_istemplate.setChecked(!1),k.meta.content.setTemplate("istemplate",!1))}),c.template_qclipart=ciptaCheckboxWidget(a+"_template_qclipart",a+"_widget_qclipart",!0),c.template_qclipart.create(function(b){k.meta.content.setTemplate("qclipart",b);b?$("#"+a+"_widget_qclipquery").show():$("#"+a+"_widget_qclipquery").hide();c.template_qclipart.isChecked()||c.template_qclipcolor.isChecked()||($("#"+a+"_template_options").hide(),c.template_istemplate.setChecked(!1),
k.meta.content.setTemplate("istemplate",!1))}),c.template_qclipcolor=ciptaCheckboxWidget(a+"_template_qclipcolor",a+"_widget_qclipcolor",!0),c.template_qclipcolor.create(function(b){k.meta.content.setTemplate("qclipcolor",b);c.template_qclipart.isChecked()||c.template_qclipcolor.isChecked()||($("#"+a+"_template_options").hide(),c.template_istemplate.setChecked(!1),k.meta.content.setTemplate("istemplate",!1))}),c.template_qclipquery=ciptaInputWidget(a+"_template_qclipquery",a+"_widget_qclipquery",
100),c.template_qclipquery.create(),c.template_qclipquery.onChange(function(a){_.isEmpty(_.trim(a))||k.meta.content.setTemplate("qclipquery",_.trim(a))})),c.template_replacemode=ciptaFancyDropDownWidget(a+"_template_replacemode",a+"_widget_replacemode",{crop:"crop",fitwidth:"fit Width",fitheight:"fit Height",fitboth:"fit Both"},null,{searchbox:!1,"default":"crop"}),c.template_replacemode.create(function(a){k.meta.content.setTemplate("replacemode",a)}),c.template_islocked=ciptaCheckboxWidget(a+"_template_islocked",
a+"_widget_islocked",!1),c.template_islocked.create(function(a){k.meta.content.setTemplate("islocked",a);e&&(a?e.lockObject():e.unlockObject())}),1==CIPTA.is_template_placeholder_enabled&&(c.template_isplaceholder=ciptaCheckboxWidget(a+"_template_isplaceholder",a+"_widget_isplaceholder",!1),c.template_isplaceholder.create(function(a){k.meta.content.setTemplate("isplaceholder",a)})));g=!0;return d},initTemplateOptions:function(b){c.template_iscustom.enable();c.template_iscustom.setChecked(b.getTemplate("iscustom"));
c.template_iscustom.isChecked()?$("#"+a+"_custom_options").show():$("#"+a+"_custom_options").hide();if("clipart"==b.getType()){if(CIPTA.is_template_editing){$("#"+a+"_template_clipart").show();$("#"+a+"_template_image").hide();c.template_qclipart.setChecked(b.getTemplate("qclipart"));if(b.getTemplate("qclipart")){$("#"+a+"_widget_qclipquery").show();var d=b.getTemplate("qclipquery");_.isEmpty(_.trim(d))?c.template_qclipquery.setInput(""):c.template_qclipquery.setInput(b.getTemplate("qclipquery"))}else $("#"+
a+"_widget_qclipquery").hide();1==b.getClipart("iscolorable")?(c.template_qclipcolor.setChecked(b.getTemplate("qclipcolor")),c.template_qclipcolor.enable()):(c.template_qclipcolor.setChecked(!1),c.template_qclipcolor.disable());c.template_istemplate.setChecked(b.getTemplate("istemplate"));c.template_istemplate.isChecked()?($("#"+a+"_template_options").show(),c.template_qclipart.isChecked()||c.template_qclipcolor.isChecked()||(k.meta.content.setTemplate("qclipart",!0),c.template_qclipart.setChecked(!0))):
$("#"+a+"_template_options").hide()}c.template_replacemode.enable()}else"vector"==b.getOthers("filetype")?CIPTA.is_template_editing&&($("#"+a+"_template_clipart").hide(),$("#"+a+"_template_image").show(),c.template_qimage.show(),c.template_qcrop.show(),c.template_qimgcolor.hide(),c.template_qimage.setChecked(b.getTemplate("qimage")),c.template_qcrop.setChecked(b.getTemplate("qcrop")),1==b.getOthers("iscolorable")?(c.template_qimgcolor.setChecked(b.getTemplate("qimgcolor")),c.template_qimgcolor.enable(),
c.template_qimgcolor.show()):(c.template_qimgcolor.setChecked(!1),c.template_qimgcolor.disable()),c.template_istemplate.setChecked(b.getTemplate("istemplate")),c.template_istemplate.isChecked()?($("#"+a+"_template_options").show(),c.template_qimage.isChecked()||c.template_qimgcolor.isChecked()||(k.meta.content.setTemplate("qimage",!0),c.template_qimage.setChecked(!0))):$("#"+a+"_template_options").hide()):(CIPTA.is_template_editing&&($("#"+a+"_template_clipart").hide(),$("#"+a+"_template_image").show(),
c.template_qimage.show(),c.template_qcrop.show(),c.template_qimgcolor.hide(),c.template_qimage.setChecked(b.getTemplate("qimage")),c.template_qcrop.setChecked(b.getTemplate("qcrop")),c.template_qimgcolor.setChecked(!1),c.template_istemplate.setChecked(b.getTemplate("istemplate")),c.template_istemplate.isChecked()?($("#"+a+"_template_options").show(),c.template_qimage.isChecked()||(k.meta.content.setTemplate("qimage",!0),c.template_qimage.setChecked(!0))):$("#"+a+"_template_options").hide()),c.template_replacemode.enable());
b.getTemplate("replacemode")?c.template_replacemode.setSelected(b.getTemplate("replacemode")):c.template_replacemode.setSelected("crop");c.template_islocked.setChecked(b.getTemplate("islocked"));1==CIPTA.is_template_placeholder_enabled&&c.template_isplaceholder.setChecked(b.getTemplate("isplaceholder"))},initImage:function(b){if(g){var f=b.meta.content;c.rotate.setValue(b.getAngle());var l=100*(1-b.getOpacity());0>l?l=0:90<l&&(l=90);c.transparency.setValue(l);0>=f.getOverlay("category")?(c.overlay.resetSelected(),
c.overlaycat.setSelected(f.getOverlay("category")),c.overlaytype.setSelected(f.getOverlay("type")),c.overlayopacity.setSelected(f.getOverlay("opacity")),1!=c.overlaycat.getSelected()&&(c.overlay.fillClipartList(m[1],null,"rating"),c.overlaycat.setSelected(1))):(f.getOverlay("category")!=c.overlaycat.getSelected()&&(c.overlay.fillClipartList(m[f.getOverlay("category")],null,"rating"),c.overlaycat.setSelected(f.getOverlay("category"))),c.overlay.setSelected(f.getOverlay("id")),c.overlaytype.setSelected(f.getOverlay("type")),
c.overlayopacity.setSelected(f.getOverlay("opacity")));d.enableOverlay();f.getFilter("category")&&f.getFilter("category")!=c.filtercat.getSelected()&&(c.filter.fillClipartList(q[f.getFilter("category")],null,"rating"),c.filtercat.setSelected(f.getFilter("category")));0<f.getFilter("id")?c.filter.setSelected(f.getFilter("id")):c.filter.resetSelected();0>=f.getMask("category")?(c.mask.resetSelected(),c.maskcat.setSelected(f.getMask("category")),1!=c.maskcat.getSelected()&&(c.mask.fillClipartList(w[1],
null,"rating"),c.maskcat.setSelected(1))):(f.getMask("category")&&f.getMask("category")!=c.maskcat.getSelected()&&(c.mask.fillClipartList(w[f.getMask("category")],null,"rating"),c.maskcat.setSelected(f.getMask("category"))),0<f.getMask("id")&&c.mask.setSelected(f.getMask("id")),d.enableMask());"clipart"==f.getType()?(1==f.getClipart("iscolorable")?(h&&!_.isEmpty(h)&&(_.forEach(h,function(a){a.destroy()}),h=[]),$("#"+a+"_widget_clipcolor").empty(),$("#"+a+"_widget_clipcolor").html('<label class="panel-label">Ganti Warna: </label>'),
$.each(f.getClipart("colors"),function(b,c){h.push(ciptaColorPickerWidget(a+"_color_"+b,a+"_widget_clipcolor"));h[b].create(function(a){f.getClipart("colors")[b]=a;f.setPreview(f.getClipartPreviewURL());e.editImage(f,null,null,"fit")});h[b].setColor(c)})):(h&&!_.isEmpty(h)&&(_.forEach(h,function(a){a.destroy()}),h=[]),$("#"+a+"_widget_clipcolor").empty()),f.getClipart("usage")==ASSET_CLIPART||f.getClipart("usage")==ASSET_SILHOUETTE||f.getClipart("usage")==ASSET_SILHOUETTE_OUTLINE||f.getClipart("usage")==
ASSET_DESIGN_ELEMENTS||f.getClipart("usage")==ASSET_CLIPART_PNG?($("#"+a+"_dtab3").hide(),$("#"+a+"_dtab4").hide()):($("#"+a+"_dtab3").show(),$("#"+a+"_dtab4").show()),c.replace.disable(),c.crop.disable()):"vector"==f.getOthers("filetype")&&1==f.getOthers("iscolorable")?(h&&!_.isEmpty(h)&&(_.forEach(h,function(a){a.destroy()}),h=[]),$("#"+a+"_widget_clipcolor").empty(),$("#"+a+"_widget_clipcolor").html('<label class="panel-label">Ganti Warna: </label>'),$.each(f.getOthers("colors"),function(b,c){h.push(ciptaColorPickerWidget(a+
"_color_"+b,a+"_widget_clipcolor"));h[b].create(function(a){f.getOthers("colors")[b]=a;f.setPreview(f.getImagePreviewURL());e.editImage(f,null,null,"fit")});h[b].setColor(c)}),$("#"+a+"_dtab3").hide(),$("#"+a+"_dtab4").hide()):(h&&!_.isEmpty(h)&&(_.forEach(h,function(a){a.destroy()}),h=[]),$("#"+a+"_widget_clipcolor").empty(),"vector"==f.getOthers("filetype")?($("#"+a+"_dtab3").hide(),$("#"+a+"_dtab4").hide()):($("#"+a+"_dtab3").show(),$("#"+a+"_dtab4").show()),c.replace.enable(),c.crop.enable());
CIPTA.editor_type==EDITOR_DESIGN&&d.initTemplateOptions(f);k=b;k.panel&&k.panel.tab&&1<=k.panel.tab&&5>=k.panel.tab?$("#"+a+"_tab"+k.panel.tab).click():$("#"+a+"_tab1").click()}return d},editImage:function(a,b){if(g){var f=k.meta.content;if(!e||!k)throw"Error: Invalid Canvas Object";0<c.overlaycat.getSelected()?(f.setOverlay("id",c.overlay.getSelected()),f.setOverlay("category",c.overlaycat.getSelected()),f.setOverlay("type",c.overlaytype.getSelected()),f.setOverlay("opacity",c.overlayopacity.getSelected())):
(f.setOverlay("id",null),f.setOverlay("category",0));if(0<c.maskcat.getSelected()){var h=f.getMask("id");f.setMask("id",c.mask.getSelected());f.setMask("category",c.maskcat.getSelected());h!=f.getMask("id")&&f.fitMaskToImage()}else f.setMask("id",null),f.setMask("category",0);0<c.filter.getSelected()&&(f.setFilter("id",c.filter.getSelected()),f.setFilter("category",c.filtercat.getSelected()),(h=ciptaFilter.getClipartbyID(c.filter.getSelected()))&&h.info&&h.info.filter&&f.setFilter("filtername",h.info.filter));
"clipart"==f.getType()?f.setPreview(f.getClipartPreviewURL()):f.setPreview(f.getImagePreviewURL());a&&""!=a?e.editImage(f,null,b,a):e.editImage(f,null,b)}return d},replaceImage:function(a){if(!e)throw"Error: Invalid Canvas Object";if(!a._meta||"SUCCESS"!=a._meta.status)throw"Server Error: Please try again later";if(k){var b=k.meta.content.clone();k.meta.content=b;b.setFilename(a.result.details.filename);b.setWidth(a.result.width);b.setHeight(a.result.height);a.result.filetype&&b.setOthers("filetype",
a.result.filetype);a.result.iscolorable?(b.setOthers("iscolorable",!0),b.setOthers("colors",_.cloneDeep(a.result.colors)),b.setOthers("orig_colors",_.cloneDeep(a.result.colors)),CIPTA.editor_type==EDITOR_DESIGN&&(b.setTemplate("qimgcolor",!0),b.setTemplate("qcrop",!1),b.setTemplate("qimage",!1))):1==b.getOthers("iscolorable")&&(b.setOthers("iscolorable",!1),b.setOthers("colors",[]),b.setOthers("orig_colors",[]),CIPTA.editor_type==EDITOR_DESIGN&&b.setTemplate("qimgcolor",!1));b.setPreview(b.getImagePreviewURL());
d.editImage(null,function(){d.initImage(k)})}return d},isReplacing:function(){return t.isUploading()},cancelReplacing:function(){t.cancelUpload()},show:function(){e&&(e.isCustom()?$("#"+a+"_dtab5").show():($("#"+a+"_dtab5").hide(),5==k.panel.tab&&$("#"+a+"_tab1").click()));$("#"+b).show();return d},hide:function(){$("#"+b).hide();return d},updateRotation:function(a){c.rotate.setValue(a)},block:function(){$("#"+b).block({message:null,overlayCSS:{backgroundColor:"#CCC",opacity:.05,cursor:"wait"}})},
unblock:function(){$("#"+b).unblock()}}},ciptaImageCropPanel=function(a,b,e){var f='<div id="'+a+'_modal_crop" class="reveal-modal xlarge text-center" data-reveal data-options="close_on_background_click:true" style="top:10px;">\n   <h3>Crop Gambar</h3>\n   <a class="close-reveal-modal">&#215;</a>\n   <div id="'+a+'_crop_area" style="border: 1px dashed #CCC; margin: 0 auto;">\n   </div>\n   <div class="row" style="margin-top:20px;">\n      <div class="large-3 medium-4 small-4 large-offset-6 medium-offset-4 small-offset-4 columns">\n         <a id="'+
a+'_modal_crop_cancel" href="#" class="button tiny cipta-button-lightgray expand">Batal</a>\n      </div>\n      <div class="large-3 medium-4 small-4 columns">\n         <a id="'+a+'_modal_crop_affirm" href="#" class="button tiny cipta-button-darkblue expand">Crop Gambar</a>\n      </div>\n   </div>\n</div>\n',d='       <canvas id="'+a+'_canvas">\n           Error: Canvas is not supported. Please Upgrade Your Browser.\n       </canvas>\n',g={},c=!1,h=null,k=null,m=null,l=null,n=!0,q=0,r=0,w=0,t=0,
u=0,x=500,B=350,D=0,F=0;g={getModalID:function(){return a+"_modal_crop"},limitMovement:function(a){a.target.selectable&&(0>a.target.left&&(a.target.left=0),0>a.target.top&&(a.target.top=0),a.target.left+a.target.getWidth()>h.getWidth()&&(a.target.left=h.getWidth()-a.target.getWidth()-1),a.target.top+a.target.getHeight()>h.getHeight()&&(a.target.top=h.getHeight()-a.target.getHeight()-1),a.target.setCoords(),l&&(l.left=a.target.left,l.top=a.target.top,l.setScaleX(a.target.scaleX),l.setScaleY(a.target.scaleY),
l.setCoords()),h.calcOffset(),h.renderAll())},limitScaling:function(a){a.target.selectable&&(0>a.target.left&&(a.target.set({scaleX:(x+D)/a.target.width}),a.target.left=0,n&&a.target.set({scaleY:1/q*(x+D)/a.target.height})),0>a.target.top&&(a.target.set({scaleY:(B+F)/a.target.height}),a.target.top=0,n&&a.target.set({scaleX:q*(B+F)/a.target.width})),a.target.left+a.target.scaleX*a.target.width>h.getWidth()&&(a.target.set({scaleX:(h.getWidth()-a.target.left-2)/a.target.width}),n&&a.target.set({scaleY:1/
q*(h.getWidth()-a.target.left-2)/a.target.height})),a.target.top+a.target.scaleY*a.target.height>h.getHeight()&&(a.target.set({scaleY:(h.getHeight()-a.target.top-2)/a.target.height}),n&&a.target.set({scaleX:q*(h.getHeight()-a.target.top-2)/a.target.width})),a.target.setCoords(),l&&(l.left=a.target.left,l.top=a.target.top,l.setScaleX(a.target.scaleX),l.setScaleY(a.target.scaleY),l.setCoords()),h.calcOffset(),h.renderAll())},afterModified:function(a){g.limitScaling(a);x=a.target.getWidth();B=a.target.getHeight();
D=a.target.left;F=a.target.top}};var z=fabric.util.createClass(fabric.Rect,{_render:function(a){var b=(this.flipX?-1:1)/this.scaleX,c=(this.flipY?-1:1)/this.scaleY;a.scale(b,c);a.fillStyle="rgba(0, 0, 0, 0.7)";this._renderOverlay(a);void 0!==a.setLineDash?a.setLineDash([7,7]):void 0!==a.mozDash&&(a.mozDash=[7,7]);a.strokeStyle="rgba(0, 0, 0, 0.1)";this._renderBorders(a);this._renderGrid(a);a.lineDashOffset=7;a.strokeStyle="rgba(255, 255, 255, 0.2)";this._renderBorders(a);this._renderGrid(a);a.scale(1/
b,1/c)},_renderOverlay:function(a){var b=a.canvas,c=Math.ceil(-this.getWidth()/2-this.getLeft()),d=Math.ceil(-this.getWidth()/2),e=Math.ceil(this.getWidth()/2),f=Math.ceil(this.getWidth()/2+(b.width-this.getWidth()-this.getLeft())),g=Math.ceil(-this.getHeight()/2-this.getTop()),h=Math.ceil(-this.getHeight()/2),k=Math.ceil(this.getHeight()/2);b=Math.ceil(this.getHeight()/2+(b.height-this.getHeight()-this.getTop()));a.fillRect(c,g,f-c,h-g);a.fillRect(c,h,d-c,k-h);a.fillRect(e,h,f-e,k-h);a.fillRect(c,
k,f-c,b-k)},_renderBorders:function(a){a.beginPath();a.moveTo(-this.getWidth()/2,-this.getHeight()/2);a.lineTo(this.getWidth()/2,-this.getHeight()/2);a.lineTo(this.getWidth()/2,this.getHeight()/2);a.lineTo(-this.getWidth()/2,this.getHeight()/2);a.lineTo(-this.getWidth()/2,-this.getHeight()/2);a.stroke()},_renderGrid:function(a){a.beginPath();a.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2);a.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2);a.stroke();a.beginPath();
a.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2);a.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2);a.stroke();a.beginPath();a.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight());a.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight());a.stroke();a.beginPath();a.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight());a.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight());a.stroke()}});g.create=function(){$(f).appendTo("#"+
b);$("#"+a+"_modal_crop_affirm").click(function(){var b=Math.ceil(m.getLeft()/t*r),c=Math.ceil(m.getTop()/u*w),d=Math.ceil(m.getWidth()/t*r),f=Math.ceil(m.getHeight()/u*w);0>b?b=0:b>=r&&(b=r-1);0>c?c=0:c>=w&&(c=w-1);0>=d?d=1:d>r&&(d=r);0>=f?f=1:f>w&&(f=w);e&&e([Math.round(b/r*1E6)/1E6,Math.round(c/w*1E6)/1E6,Math.round(d/r*1E6)/1E6,Math.round(f/w*1E6)/1E6]);$("#"+a+"_modal_crop").foundation("reveal","close")});$("#"+a+"_modal_crop_cancel").click(function(){$("#"+a+"_modal_crop").foundation("reveal",
"close")});c=!0;return g};g.initImage=function(b,e,f,C){if(c){k=b;$("#"+a+"_crop_area").html(d);h=new fabric.Canvas(a+"_canvas");h.imageSmoothingEnabled=!0;$("#"+a+"_crop_area").css("width",500);$("#"+a+"_crop_area").css("height",350);$("#"+a+"_canvas").attr("width",500);$("#"+a+"_canvas").attr("height",350);h.on("object:moving",g.limitMovement);h.on("object:scaling",g.limitScaling);h.on("object:modified",g.afterModified);h.on("selection:cleared",function(a,b){h.setActiveObject(m)});var y=!1,A=_.cloneDeep(f);
A&&4==A.length&&(y=!0);var v=function(b){if(b){r=b.width;w=b.height;b.top=0;b.left=0;b.angle=0;b.flipX=!1;b.flipY=!1;b.width>b.height?(b.scaleToWidth(500),u=b.getHeight(),t=500):(b.scaleToHeight(350),t=b.getWidth(),u=350);$("#"+a+"_crop_area").css("width",t);$("#"+a+"_crop_area").css("height",u);$("#"+a+"_canvas").attr("width",t);$("#"+a+"_canvas").attr("height",u);h.setWidth(t);h.setHeight(u);m=new z({left:0,top:0,width:t,height:u,fill:"none",borderColor:"rgba(0,112,149,1)",cornerColor:"rgba(0,112,149,1)",
cornerSize:20,transparentCorners:!1,centeredScaling:!1,lockScalingFlip:!0,lockRotation:!0,minScaleLimit:.1,originX:"left",originY:"top"});m.setControlsVisibility({mtr:!1});h.add(m);if(A&&4==A.length){A[0]*=r;A[2]*=r;A[1]*=w;A[3]*=w;if(0>A[0]||A[0]>=r)A[0]=0;if(0>A[1]||A[1]>=w)A[1]=0;if(0>=A[2]||A[2]+A[0]>r)A[2]=r;if(0>=A[3]||A[3]+A[1]>w)A[3]=w;m.set({left:A[0]/r*t,top:A[1]/w*u,width:A[2]/r*t,height:A[3]/w*u});y=!0}else m.set({left:.1*t,top:.1*u,width:.8*t,height:.8*u});m.setCoords();C&&1==C?(n=m.lockUniScaling=
!0,q=m.getWidth()/m.getHeight()):n=!1;h.calcOffset();x=m.getWidth();B=m.getHeight();F=D=30;h.setBackgroundImage(b,function(){e?fabric.Image.fromURL(CIPTA.homeURL+"/assets/img/editor/back.png",function(a){a.selectable=!0;a.left=m.left;a.top=m.top;a.width=m.width;a.height=m.height;a.setScaleX(m.scaleX);a.setScaleY(m.scaleY);a.setCoords();fabric.Image.fromURL(e,function(b){b.hasControls=!1;b.selectable=!1;b.left=m.left;b.top=m.top;b.width=m.width;b.height=m.height;b.globalCompositeOperation="multiply";
b.setOpacity(.7);b.setScaleX(m.scaleX);b.setScaleY(m.scaleY);b.setCoords();b.filters.push(new fabric.Image.filters.Grayscale,new fabric.Image.filters.Brightness({brightness:255}),new fabric.Image.filters.Mask({mask:a}));b.applyFilters(function(){h.add(b);b.sendToBack();h.setActiveObject(m);h.calcOffset();h.renderAll()});l=b},{crossOrigin:"anonymous"})}):(l=null,h.setActiveObject(m),h.calcOffset(),h.renderAll())},{originX:"left",originY:"top",crossOrigin:"anonymous"})}};e||y?(b=k.meta.content.getImagePreviewURL(!0),
fabric.Image.fromURL(b,function(a){v(a)},{crossOrigin:"anonymous"})):k.clone(function(a){v(a)})}return g};g.cropImage=function(){return g};return g},ciptaClipartPanel=function(a,b,e,f){var d='<h2 id="'+a+'_caption">Tambah Clipart</h2>\n<div class="row">\n        <div class="large-12 medium-12 small-12 columns medium-text">\n        Kategori:</div>\n</div>\n<div class="row">\n        <div class="large-4 medium-5 small-5 columns panel-label" id="'+a+'_widget_clipart_category">\n        </div>\n        <div class="large-4 medium-4 small-4 large-offset-3 medium-offset-1 small-offset-1 columns" style="padding-right:0px;">\n                <input maxlength="100" style="margin:0px;" type="text" id="'+
a+'_search_1" placeholder="Cari Clipart..." />\n        </div>\n        <div class="large-1 medium-2 small-2 end columns" style="padding-left:0px;">\n                <a id="'+a+'_search_clipart" class="button secondary postfix" style="margin-left:-4px; padding-bottom:5px; border-top-right-radius:5px; border-bottom-right-radius:5px; margin-bottom:0px;"><i class="icon-search fs0"></i></a>        </div>\n</div>\n<div class="row small-text" style="margin-top:0px;">\n        <div class="large-12 columns" id="'+
a+'_widget_1" style="width: 100%; height: 375px; overflow-y: auto;">\n        </div>\n</div>\n<div class="row" style="margin-top:20px;">\n   <div class="large-3 medium-4 small-4 large-offset-6 medium-offset-4 small-offset-4 columns">\n                <a href="#" id="'+a+'_button_2" class="button expand tiny cipta-button-lightgray close-reveal-modal" style="position:relative; top:0px; left:0px; line-height:normal">Batal</a>\n   </div>\n   <div class="large-3 medium-4 small-4 columns">\n                <a href="#" id="'+
a+'_button_1" class="button expand tiny cipta-button-darkblue">Pilih Clipart</a>\n   </div>\n</div>\n',g=[],c=!1,h="add",k=null,m={updateClipartList:function(b,d){if(c){g[1].disable();$("#"+a+"_search_clipart").addClass("disabled");$("#"+a+"_search_1").prop("disabled",!0);try{g[0].fillClipartList(b,function(){g[1].enable();$("#"+a+"_search_clipart").removeClass("disabled");$("#"+a+"_search_1").prop("disabled",!1)},d)}catch(q){g[1].enable(),$("#"+a+"_search_clipart").removeClass("disabled"),$("#"+
a+"_search_1").prop("disabled",!1)}}},create:function(e){$(d).appendTo("#"+b);e||(e=8);g.push(ciptaClipartWidget(a+"_clipart_1",a+"_widget_1","clipart",e));g[0].create("popular",function(b){$("#"+a+"_button_1").trigger("click")},null,!0,function(){g[1].enable();$("#"+a+"_search_clipart").removeClass("disabled");$("#"+a+"_search_1").prop("disabled",!1)});g[1]=ciptaFancyDropDownWidget(a+"_clipart_cat_1",a+"_widget_clipart_category",{popular:"Populer",alfabet:"Alfabet & Angka","bentuk,simbol":"Bentuk & Simbol",
binatang:"Binatang",event:"Event / Acara",fashion:"Fashion",indonesia:"Indonesia",internasional:"Internasional",komik:"Komik",lucu:"Lucu","makanan,minuman":"Makanan & Minuman",militer:"Militer",musik:"Musik",olahraga:"Olah Raga","kerja,pekerjaan":"Pekerjaan","sains,science,scifi":"Sains & Fiksi Sains",sekolah:"Sekolah",spiritual:"Spiritual",transportasi:"Transportasi",universitas:"Universitas"},null,{searchbox:!1,allowClear:!1,"default":"popular"});g[1].create(function(b){$("#"+a+"_search_1").val("");
m.updateClipartList(b,"rating")});g[1].disable();$("#"+a+"_search_clipart").addClass("disabled");$("#"+a+"_search_1").prop("disabled",!0);$("#"+a+"_button_1").click(function(){var a=g[0].getSelected();null!=a&&(g[0].resetSelected(),"add"==h&&m.addClipart(a),f&&$("#"+f).foundation("reveal","close"),$.isFunction(k)&&k(a))});$("#"+a+"_button_1").dblclick(function(){$("#"+a+"_button_1")});$("#"+a+"_search_clipart").click(function(){if(!$("#"+a+"_search_clipart").hasClass("disabled")){var b=$("#"+a+"_search_1").val();
1<=b.length&&(g[1].setSelected(-1),m.updateClipartList(b))}});$("#"+a+"_search_1").keydown(function(b){13==b.keyCode&&(b.preventDefault(),$("#"+a+"_search_clipart").trigger("click"))});c=!0;return m},addClipart:function(a){if(!e)throw"Error: Invalid Canvas Object";if(null==a)throw"Invalid Clipart ID: Please try again.";var b=ciptaCliparts.getClipartbyID(a),c=ciptaImage();c.setFilename(b.filename);c.setType("clipart");c.setClipart("id",a);c.setClipart("iscolorable",b.iscolorable);c.setClipart("colors",
b.info&&b.info.colors?_.cloneDeep(b.info.colors):null);c.setClipart("orig_colors",b.info&&b.info.colors?_.cloneDeep(b.info.colors):null);c.setClipart("usage",b.usage);c.setClipart("type",b.type);c.setWidth(b.info&&b.info.width?b.info.width:null);c.setHeight(b.info&&b.info.height?b.info.height:null);b.usage==ASSET_SILHOUETTE?c.setOverlay("type",99):c.setOverlay("type",1);CIPTA.editor_type==EDITOR_DESIGN&&(c.setTemplate("iscustom",!0),c.setTemplate("islocked",!1),c.setTemplate("istemplate",!1),c.setTemplate("qclipart",
!0),b.iscolorable?c.setTemplate("qclipcolor",!0):c.setTemplate("qclipcolor",!1),c.setTemplate("qcrop",!1),c.setTemplate("qimage",!1),c.setTemplate("replacemode","fitwidth"));c.setPreview(c.getClipartPreviewURL());e.addImage(c);return m},close:function(){g[1].enable();$("#"+a+"_search_clipart").removeClass("disabled");$("#"+a+"_search_1").prop("disabled",!1)},searchClipart:function(b){$("#"+a+"_search_1").val(b);$("#"+a+"_search_clipart").trigger("click")},showModal:function(b,c,d){f&&(h=b?b:"add",
"update"==h?$("#"+a+"_caption").html("Ganti Clipart"):$("#"+a+"_caption").html("Tambah Clipart"),k=c,$("#"+f).foundation("reveal","open"),d&&!_.isEmpty(_.trim(d))&&m.searchClipart(d))},closeModal:function(){f&&$("#"+f).foundation("reveal","close")},getModalID:function(){return f}};return m},ciptaProductEditPanel=function(a,b,e){var f='<div class="row">\n   <div class="large-12 columns">\n       <div class="cipta-color-box" id="'+a+'_widget_1"></div>\n   </div>\n</div>\n<div class="row">\n   <div class="large-12 columns">\n       <div class="editor-thumb-list" id="'+
a+'_widget_2"></div>\n   </div>\n</div>',d=[],g={create:function(){$(f).appendTo("#"+b);"tees"==ciptaProductAttr.getProductType()&&(d.push(ciptaColorSelector(a+"_colorsel_1",a+"_widget_1")),d[0].create(ciptaProductAttr.getProductAttrDetail("attr_tees_color_id"),ciptaProductAttr.getProductAttrTreeRoot(),0,function(a){a=ciptaProductAttr.getDefaultProductIDByAttrID(a);null!=a&&e.updateProduct(a)}));return g},show:function(){$("#"+b).show();return g},hide:function(){$("#"+b).hide();return g}};return g},
ciptaMockupThumbs=function(a,b,e){var f='<div class="editor-thumb-list large-12 medium-12" id="'+a+'_widget_1"></div>\n',d=[],g={create:function(){$(f).appendTo("#"+b);var c=e.getMockupThumbs();d.push(ciptaMockupSelector(a+"_sel",a+"_widget_1"));d[0].create(c,function(a){e.updateMockup(a)});return g},refresh:function(){$("#"+a+"_widget_1").html("");var b=e.getMockupThumbs();d.push(ciptaMockupSelector(a+"_sel",a+"_widget_1"));d[0].create(b,function(a){e.updateMockup(a)});return g},selectMockup:function(a){d&&
d[0]&&d[0].set_selected_mockup(a);return g},show:function(){$("#"+b).show();return g},hide:function(){$("#"+b).hide();return g}};return g},ciptaQuickEditPanel=function(a,b,e){var f='<div id="'+a+'_modal_crop"></div>\n<div id="'+a+'_modal_replace" data-reveal class="reveal-modal medium" data-options="close_on_background_click:false">\n   <h2>Ganti Gambar</h2>\n     Format gambar yang dapat diproses antara lain adalah: <strong>.jpg</strong> dan <strong>.png</strong><br/><br/>\n     <span class="medium-text">Mohon jangan mengupload gambar yang berbau SARA, kekerasan, atau pornografi. \n     Sebelum dicetak, setiap desain akan melalui proses moderasi terlebih dahulu dan pihak Ciptaloka.com \n     berhak untuk menolak desain yang kami anggap melanggar aturan tersebut.<br/><br/>\n     Silahkan pilih gambar yang akan di upload :</span>\n   <a class="close-reveal-modal">&#215;</a>\n   <div id="'+
a+'_modal_upload"> </div>\n</div>\n<div class="row">\n  <div class="large-11 medium-12 small-12 large-offset-1 medium-offset-0 small-offset-0 columns" style="max-height: 350px; overflow-y: auto;" id="'+a+'_content">\n  </div>        \n</div>        \n',d=[],g=0,c=[],h=null,k=null,m=null,l={create:function(){$(f).appendTo("#"+b);h=ciptaImageReplacePanel(a+"_replaceimage",a+"_modal_replace",e,function(b){l.replaceImage(b);$("#"+a+"_modal_replace").foundation("reveal","close")});h.create();m=ciptaImageCropPanel(a+
"_cropimage",a+"_modal_crop",function(a){l.cropImage(a)});m.create();return l},init:function(){if(e){$("#"+a+"_content").html('<label class="panel-label">Ganti Teks / Warna / Gambar</label>');d=[];c=[];var b=0,f=e.getObjects("text");_.forEach(f,function(f){if(1==f.meta.content.getTemplate("iscustom")&&1==f.meta.content.getTemplate("istemplate")&&(1==f.meta.content.getTemplate("qtext")||1==f.meta.content.getTemplate("qcolor")||1==f.meta.content.getTemplate("qfont"))){1!=f.meta.content.getTemplate("qtext")||
1!=f.meta.content.getTemplate("qcolor")||f.meta.content.getTemplate("qfont");$('   <div class="row quickedit-bar" id="qeditbar_'+b+'">\n    <div class="large-12 medium-12 small-12 columns">\n     <div class="row">\n       <div class="large-2 medium-3 small-2 columns" id="'+a+"_widget_color"+b+'"></div>\n       <div class="large-8 medium-6 small-8 columns" id="'+a+"_widget_text"+b+'"></div>\n       <div class="large-2 medium-3 small-2 columns" id="'+a+"_widget_delete"+b+'"></div>\n     </div>\n    </div>\n   </div>\n').appendTo("#"+
a+"_content");var g=b;1==f.meta.content.getTemplate("qtext")?(d["text"+b]=ciptaInputWidget(a+"_text"+b,a+"_widget_text"+b,100),d["text"+b].create(),d["text"+b].onInput(function(){l.editObject("text",g)},750,1E3)):(d["text"+b]=ciptaInputWidget(a+"_text"+b,a+"_widget_text"+b,100,"disabled"),d["text"+b].create());d["text"+b].setInput(f.meta.content.getText());1==f.meta.content.getTemplate("qcolor")&&(d["color"+b]=ciptaColorPickerWidget(a+"_color"+b,a+"_widget_color"+b),d["color"+b].create(function(a){l.editObject("text",
g,!0)}),d["color"+b].setColor(f.meta.content.getColor()));d["delete"+b]=ciptaButtonWidget(a+"_delete_button"+b,a+"_widget_delete"+b);d["delete"+b].create(null,"icon-trash fs1",function(){e.deselectAll();e.deleteObject(f,function(){$("#qeditbar_"+g).hide()})},"",!0,"cipta-button-lightgray expand",'style="margin:2px;padding:8px;"');c[b]=f;b+=1}});f=e.getObjects("image");_.forEach(f,function(f){if(1==f.meta.content.getTemplate("iscustom")&&1==f.meta.content.getTemplate("istemplate")&&(1==f.meta.content.getTemplate("qimage")||
1==f.meta.content.getTemplate("qcrop")||1==f.meta.content.getTemplate("qimgcolor")||1==f.meta.content.getTemplate("qclipart")||1==f.meta.content.getTemplate("qclipcolor"))){var g=b;c[b]=f;"clipart"==f.meta.content.getType()?($('   <div class="row quickedit-bar" id="qeditbar_'+b+'">\n       <div class="large-2 medium-3 small-2 columns" id="'+a+"_widget_thumb"+b+'">\n       </div>\n       <div class="large-6 medium-9 small-6 columns" id="'+a+"_widget_clipcolor"+b+'">\n       </div>\n       <div class="large-2 medium-6 small-2 columns" id="'+
a+"_widget_replace"+b+'">\n       </div>\n       <div class="large-2 medium-3 small-2 columns end" id="'+a+"_widget_delete"+b+'">\n       </div>\n   </div>\n').appendTo("#"+a+"_content"),$("#"+a+"_widget_thumb"+b).html('<img id="'+a+"_img_thumb"+b+'" src="'+f.meta.content.getPreview().thumb_img+'" style="max-height:50px; float:left;">'),1==f.meta.content.getTemplate("qclipcolor")&&1==f.meta.content.getClipart("iscolorable")?(d["colorpicker"+b]=[],$.each(f.meta.content.getClipart("colors"),function(c,
h){d["colorpicker"+b].push(ciptaColorPickerWidget(a+"_color_"+b+"_"+c,a+"_widget_clipcolor"+b));d["colorpicker"+b][c].create(function(b){f.meta.content.getClipart("colors")[c]=b;f.meta.content.setPreview(f.meta.content.getClipartPreviewURL());e.editImage(f.meta.content,f,null,"fit");$("#"+a+"_img_thumb"+g).attr("src",f.meta.content.getPreview().thumb_img)});d["colorpicker"+b][c].setColor(h)})):$("#"+a+"_widget_clipcolor"+b).html("&nbsp;"),1==f.meta.content.getTemplate("qclipart")?(d["replace"+b]=
ciptaButtonWidget(a+"_replace_button"+b,a+"_widget_replace"+b),d["replace"+b].create(null,null,function(){e.getModal("addclipart").showModal("update",function(a){k=g;l.replaceClipart(a)},f.meta.content.getTemplate("qclipquery"))},"Ganti",!0,"cipta-button-lightgray expand")):$("#"+a+"_widget_replace"+b).html("&nbsp;")):1==f.meta.content.getTemplate("qimgcolor")&&1==f.meta.content.getOthers("iscolorable")?($('   <div class="row quickedit-bar" id="qeditbar_'+b+'">\n       <div class="large-2 medium-3 small-2 columns" id="'+
a+"_widget_thumb"+b+'">\n       </div>\n       <div class="large-8 medium-6 small-7 columns" id="'+a+"_widget_imgcolor"+b+'">\n       </div>\n       <div class="large-2 medium-3 small-3 columns end" id="'+a+"_widget_delete"+b+'">\n       </div>\n   </div>\n').appendTo("#"+a+"_content"),$("#"+a+"_widget_thumb"+b).html('<img id="'+a+"_img_thumb"+b+'" src="'+f.meta.content.getPreview().thumb_img+'" style="max-height:50px; float:left;">'),d["colorpicker"+b]=[],$.each(f.meta.content.getOthers("colors"),
function(c,h){d["colorpicker"+b].push(ciptaColorPickerWidget(a+"_color_"+b+"_"+c,a+"_widget_imgcolor"+b));d["colorpicker"+b][c].create(function(b){f.meta.content.getOthers("colors")[c]=b;f.meta.content.setPreview(f.meta.content.getImagePreviewURL());e.editImage(f.meta.content,f,null,"fit");$("#"+a+"_img_thumb"+g).attr("src",f.meta.content.getPreview().thumb_img)});d["colorpicker"+b][c].setColor(h)})):($('   <div class="row quickedit-bar" id="qeditbar_'+b+'">\n       <div class="large-2 medium-6 small-6 columns" id="'+
a+"_widget_thumb"+b+'">\n       </div>\n       <div class="large-4 medium-6 small-6 columns" id="'+a+"_widget_replace"+b+'">\n       </div>\n       <div class="large-4 medium-6 small-6 columns" id="'+a+"_widget_crop"+b+'">\n       </div>\n       <div class="large-2 medium-3 small-3 columns end" id="'+a+"_widget_delete"+b+'">\n       </div>\n   </div>\n').appendTo("#"+a+"_content"),$("#"+a+"_widget_thumb"+b).html('<img id="'+a+"_img_thumb"+b+'" src="'+f.meta.content.getPreview().thumb_img+'" style="max-height:50px; float:left;">'),
1==f.meta.content.getTemplate("qimage")?(d["replace"+b]=ciptaButtonWidget(a+"_replace_button"+b,a+"_widget_replace"+b),d["replace"+b].create(null,"icon-loop2 fs1",function(){k=g;$("#"+a+"_modal_replace").foundation("reveal","open")},"Upload Gambar",!0,"cipta-button-lightgray expand",'data-reveal-id="'+a+'_modal_replace"'),$("#"+a+"_img_thumb"+b).unbind("click").click(function(){d["replace"+g].triggerClick()})):$("#"+a+"_widget_replace"+b).html("&nbsp;"),1==f.meta.content.getTemplate("qcrop")?(d["crop"+
b]=ciptaButtonWidget(a+"_crop_button"+b,a+"_widget_crop"+b),d["crop"+b].create(null,"icon-crop fs1",function(){var a=c[g].meta.content.getMaskURL(),b=c[g].meta.content.getCrop(),d=c[g].meta.content.getTemplate("replacemode");m.initImage(c[g],a,b,d&&"crop"!=d?!1:!0);k=g},"Crop",!0,"cipta-button-lightgray expand",'data-reveal-id="'+m.getModalID()+'"')):$("#"+a+"_widget_crop"+b).html("&nbsp;"));d["delete"+b]=ciptaButtonWidget(a+"_delete_button"+b,a+"_widget_delete"+b);d["delete"+b].create(null,"icon-trash fs1",
function(){e.deselectAll();e.deleteObject(f,function(){$("#qeditbar_"+g).hide()})},"",!0,"cipta-button-lightgray expand");b+=1}});0>=b&&$("#"+a+"_content").html("");g=b}return l},editObject:function(a,b,f){if(!e||!c[b])throw"Error: Invalid Canvas Object";"text"==a&&(d["text"+b]&&(a=d["text"+b].getInput(),c[b].meta.content.setText(a)),d["font"+b]&&(a=d["font"+b].getSelected(),c[b].meta.content.setFontID(a)),d["color"+b]&&(a=d["color"+b].getColor(),c[b].meta.content.setColor(a)),c[b].meta.content.createPreview(function(a){f?
e.editText(a,c[b],function(a){c[b]=a},"fit"):e.editText(a,c[b],function(a){c[b]=a})}));return l},updateAllTexts:function(){if(!e)throw"Error: Invalid Canvas Object";for(var a=!1,b=[],f=0;f<g;f++)if(d["text"+f]&&c[f]){var h=d["text"+f].getInput();c[f].meta.content.getText()!=h&&(c[f].meta.content.setText(h),a=!0,b.push(f))}if(a){var k=function(a){a<b.length&&c[b[a]].meta.content.createPreview(function(d){e.editText(d,c[b[a]],function(d){c[b[a]]=d;k(a+1)})})};k(0)}return l},replaceImage:function(b){if(!e)throw"Error: Invalid Canvas Object";
if(!b._meta||"SUCCESS"!=b._meta.status)throw"Server Error: Please try again later";if(null!=k){var d=c[k].meta.content.clone(),f=c[k];c[k].meta.content=d;d.setFilename(b.result.details.filename);var g=d.getTemplate("replacemode");var h="proportional";"fitboth"==g?(d.setCrop([]),h="fit"):"fitwidth"==g?(d.setCrop([]),h="width"):"fitheight"==g?(d.setCrop([]),h="height"):(g=f.getWidth()/f.getHeight(),h=b.result.width/b.result.height,g>h?(f=(1-b.result.width/f.getWidth()*f.getHeight()/b.result.height)/
2,0>f&&(f=0),.5<f&&(f=.5),d.setCrop([0,Math.round(1E6*f)/1E6,1,Math.round(1E6*(1-2*f))/1E6])):g<h&&(f=(1-b.result.height/f.getHeight()*f.getWidth()/b.result.width)/2,0>f&&(f=0),.5<f&&(f=.5),d.setCrop([Math.round(1E6*f)/1E6,0,Math.round(1E6*(1-2*f))/1E6,1])),h="fit");d.setPreview(d.getImagePreviewURL());b.result.filetype&&d.setOthers("filetype",b.result.filetype);d.setOthers("iscolorable",!1);d.setOthers("colors",[]);d.setOthers("orig_colors",[]);e.editImage(d,c[k],function(b){c[k]=b;$("#"+a+"_widget_thumb"+
k).html('<img src="'+c[k].meta.content.getPreview().thumb_img+'" style="height:60px; float:left; ">')},h)}return l},isReplacing:function(){return h.isUploading()},cancelReplacing:function(){h.cancelUpload()},cropImage:function(a){null!=k&&(c[k].meta.content.setCrop(a),c[k].meta.content.setPreview(c[k].meta.content.getImagePreviewURL()),e.editImage(c[k].meta.content,c[k],function(a){c[k]=a}))},replaceClipart:function(a){if(!e)throw"Error: Invalid Canvas Object";if(null==a)throw"Invalid Clipart ID: Please try again.";
if(null!=k){var b=ciptaCliparts.getClipartbyID(a),d=c[k].meta.content.clone(),f=c[k];c[k].meta.content=d;d.setFilename(b.filename);d.setClipart("id",a);d.setClipart("iscolorable",b.iscolorable);d.setClipart("colors",b.info&&b.info.colors?_.cloneDeep(b.info.colors):null);d.setClipart("orig_colors",b.info&&b.info.colors?_.cloneDeep(b.info.colors):null);d.setClipart("usage",b.usage);d.setClipart("type",b.type);d.setWidth(b.info&&b.info.width?b.info.width:null);d.setHeight(b.info&&b.info.height?b.info.height:
null);a=d.getTemplate("replacemode");b="proportional";"fitboth"==a?(d.setCrop([]),b="fit"):"fitwidth"==a?(d.setCrop([]),b="width"):"fitheight"==a?(d.setCrop([]),b="height"):(a=f.getWidth()/f.getHeight(),b=img.result.width/img.result.height,a>b?(f=(1-img.result.width/f.getWidth()*f.getHeight()/img.result.height)/2,0>f&&(f=0),.5<f&&(f=.5),d.setCrop([0,Math.round(1E6*f)/1E6,1,Math.round(1E6*(1-2*f))/1E6])):a<b&&(f=(1-img.result.height/f.getHeight()*f.getWidth()/img.result.width)/2,0>f&&(f=0),.5<f&&(f=
.5),d.setCrop([Math.round(1E6*f)/1E6,0,Math.round(1E6*(1-2*f))/1E6,1])),b="fit");d.setPreview(d.getClipartPreviewURL());e.editImage(d,c[k],function(a){c[k]=a;l.init()},b)}return l},isShown:function(){return $("#"+b).is(":visible")},show:function(){CIPTA.editor_type==EDITOR_CUSTOM&&(l.init(),$("#"+b).show());return l},hide:function(){$("#"+b).hide();return l},block:function(){$("#"+b).block({message:null,overlayCSS:{backgroundColor:"#CCC",opacity:.05,cursor:"wait"}})},unblock:function(){$("#"+b).unblock()}};
return l},ciptaProductItemPanel=function(a,b,e,f){var d=[],g=null,c={},h={},k={},m=[];k.on=function(a,b){a&&b&&(m[a]=b)};k.selectProductAttribute=function(a){};k.displayAttributes=function(b){$("#"+a+"_product_attrs").html("");$("#"+a+"_product_attrs2").html("");if("tees"==ciptaProductAttr.getProductType()){var c=ciptaProductAttr.getProductAttrTreeRoot();ciptaProductAttr.getProductAttrDetail(ciptaProductAttr.getSelectableAttribute());d.colorsel1=ciptaColorSelector(a+"_colorsel_1",a+"_product_attrs");
if(!_.isUndefined(b)&&!_.isUndefined(b.attr_tees_color_id)&&0<b.attr_tees_color_id)var f=b.attr_tees_color_id,g=_.findKey(c,function(a){return a==f});else g=0,f=c[0];d.colorsel1.create(ciptaProductAttr.getProductAttrDetail("attr_tees_color_id"),c,g,function(a){var b=ciptaProductAttr.getDefaultProductIDByAttrID(a);null!=b&&e.updateProduct(b);ciptaProductInfo.setProductAttrID("attr_tees_color_id",a)});null!=f&&(c=ciptaProductAttr.getDefaultProductIDByAttrID(f),null!=c&&e.updateProduct(c),ciptaProductInfo.setProductAttrID("attr_tees_color_id",
f),!_.isUndefined(b)&&!_.isUndefined(b.attr_tees_size_id)&&0<b.attr_tees_size_id&&ciptaProductInfo.setProductAttrID("attr_tees_size_id",b.attr_tees_size_id))}else"casing"==ciptaProductAttr.getProductType()?!_.isUndefined(b)&&!_.isUndefined(b.attr_casings_material_id)&&0<b.attr_casings_material_id?(ciptaProductInfo.setProductAttrID("attr_casings_material_id",b.attr_casings_material_id),c=ciptaProductAttr.getDefaultProductIDByAttrID(b.attr_casings_material_id),null!=c&&e.updateProduct(c)):(c=ciptaProductAttr.getDefaultProductAttrID(),
e.updateProduct(c)):"slate"==ciptaProductAttr.getProductType()?!_.isUndefined(b)&&!_.isUndefined(b.attr_slate_size_id)&&0<b.attr_slate_size_id?(c=ciptaProductAttr.getDefaultProductIDByAttrID(b.attr_slate_size_id),null!=c&&e.updateProduct(c),ciptaProductInfo.setProductAttrID("attr_slate_size_id",b.attr_slate_size_id)):(c=ciptaProductAttr.getDefaultProductAttrID(),e.updateProduct(c)):(c=ciptaProductAttr.getDefaultProductAttrID(),e.updateProduct(c,!1,!0))};k.create=function(c,e,h,r,w,t){if(!c||0>=c)c=
2;4>=r.length&&(c=1);$('<div class="row" style="margin-top:15px;">\n   <div class="large-11 medium-11 columns large-offset-1 medium-offset-1 panel-label">\n       Pilih Jenis Produk\n   </div>\n</div>\n<div class="row">\n   <div class="large-11 medium-11 columns large-offset-1 medium-offset-1" id="'+a+'_product_items" style="height:'+(250*c+50)+'px; overflow-y: auto; border:1px solid #e9e9e9; border-radius:8px;">\n   </div>\n</div>\n<div class="row" style="margin-top:10px;">\n   <div class="large-11 medium-11 columns large-offset-1 medium-offset-1" id="'+
a+'_product_attrs"></div>\n</div>\n<div class="row" style="margin-top:10px;">\n   <div class="large-5 medium-5 small-5 columns  large-offset-1 medium-offset-1 small-offset-1" id="'+a+'_product_attrs2"></div>\n</div>\n<div class="row" style="margin-top:5px;" id="'+a+'_ok">\n   <div class="large-12 medium-12 small-12 columns">\n       <a class="button right tiny cipta-button-darkblue" id="'+a+'_ok_button">&nbsp;&nbsp;&nbsp;Pilih&nbsp;&nbsp;&nbsp;</a>\n   </div>\n</div>\n<div class="row" style="margin-top:5px;" id="'+
a+'_next">\n   <div class="large-12 medium-12 small-12 columns">\n       <a class="button right tiny cipta-button-darkblue" id="'+a+'_next_button"><i class="icon-arrow-right2 fs0"></i>&nbsp;&nbsp;&nbsp;Lanjutkan&nbsp;&nbsp;&nbsp;</a>\n   </div>\n</div>\n<div class="row" style="margin-top:20px;">\n   <div class="large-11 medium-11 columns large-offset-1 medium-offset-1 medium-text" id="'+a+'_product_info"></div>\n</div>\n').appendTo("#"+b);d.itemlist=ciptaGridBoxWidget(a+"_grid",a+"_product_items",
{itemgrid:4,imgwidth:100});d.itemlist.create(r,!0,function(b){g=b;var c=_.findKey(r,function(a){return a.id==g});_.isUndefined(c)?$("#"+a+"_product_info").html(""):$("#"+a+"_product_info").html(r[c].description);f&&f(b)});e&&0<=e?(d.itemlist.setSelected(e),g=e):(d.itemlist.setSelected(r[0].id),g=r[0].id);ciptaProductInfo.setProductItemID(g);c=_.findKey(r,function(a){return a.id==g});_.isUndefined(c)?$("#"+a+"_product_info").html(""):$("#"+a+"_product_info").html(r[c].description);w?($("#"+a+"_ok").show(),
$("#"+a+"_ok").click(function(){m.ok_button&&m.ok_button()})):$("#"+a+"_ok").hide();t?($("#"+a+"_next").show(),$("#"+a+"_next").click(function(a){m.next_button&&m.next_button(a)})):$("#"+a+"_next").hide();return k};k.refresh=function(){var a=ciptaProductInfo.getProductItemID();0<a&&(d.itemlist.setSelected(a),g=a,a=ciptaProductInfo.getProductAttrs(),k.displayAttributes(a));return k};k.getSelectedAttributes=function(){return c};k.getSelectedAttributesDefault=function(){return h};k.show=function(){$("#"+
b).show();return k};k.hide=function(){$("#"+b).hide();return k};k.setTitle=function(b){$("#"+a+"_title").html(b)};return k},ciptaProductInfoPanel=function(a,b,e,f,d,g){d&&""!=d||(d="Tambah ke Keranjang");var c='       <a href="/scart/" id="'+a+'_save" class="button tiny cipta-button-lightgray"><i class="icon-floppy-disk fs0"> </i> Save Design</a>\n',h=function(){var b='<div class="row">\n   <div class="large-11 medium-12 columns large-offset-1 medium-offset-0" id="'+a+'_product_info">\n   </div>\n</div>\n<div id="product_details" style="display:none;">\n <div class="row" style="margin-top:0px;">\n   <div class="large-11 medium-12 small-12 columns large-offset-1" id="'+
a+'_product_price"></div>\n   <div class="large-11 medium-12 small-12 columns large-offset-1" id="'+a+'_product_disc_price"></div>\n </div>\n';CIPTA.editor_type==EDITOR_DESIGN&&(b+=' <div class="row" style="margin-top:15px">\n   <div class="large-11 medium-11 columns large-offset-1 medium-offset-1 panel-label">\n       Apakah desain ini bisa di-custom oleh pengguna: \n       <sup><span data-tooltip aria-haspopup="true" class="has-tip nodot radius" title="Aktifkan pilihan ini untuk memperbolehkan pengguna melakukan kustomisasi (perubahan) terhadap desain ini. <br/><br/>Silahkan pelajari lebih lanjut mengenai opsi kustomisasi di halaman tutorial."><i class="icon-question-circle fs1 icon-gray9"></i></span></sup>\n   </div>\n </div>\n <div class="row" style="margin-bottom:10px;">\n   <div class="large-11 medium-11 columns large-offset-1 medium-offset-1" id="'+
a+'_is_customable">\n   </div>\n </div>\n');b+=' <div class="row">\n   <div class="large-11 medium-12 small-12 columns large-offset-1" id="'+a+'_product_attr_front"></div>\n </div>\n <div class="row">\n   <div class="large-11 medium-12 small-12 columns large-offset-1" id="'+a+'_product_attr_fields"></div>\n </div>\n <div class="row">\n   <div class="large-11 medium-12 small-12 columns large-offset-1" id="'+a+'_product_attr_back"></div>\n </div>\n';CIPTA.editor_type!=EDITOR_DESIGN&&(b=b+' <div class="row" style="margin-top:20px;">\n   <div class="large-11 medium-12 small-12 columns large-offset-1">\n   <label class="panel-label">Jumlah:</label>\n   </div>\n </div>\n <div class="row" style="margin-top:0px;">\n   <div class="large-2 medium-4 small-3 columns large-offset-1" id="'+
a+'_product_amount">\n   </div>\n </div>\n <div class="row" style="margin-top:10px;">\n   <div class="large-11 medium-12 small-12 columns large-offset-1" id="'+a+'_stock" style="font-weight:bold; color:#f27559;">\n   </div>\n </div>\n <div class="text-right medium-text" style="margin-top:10px; color:#CC3333;">\n    <i class="icon-gift2 fs0" style="vertical-align:bottom;"></i> Made by Order (barang akan dikirim antara 1-3 hari kerja)\n </div>\n');b+=' <div class="row" style="margin-top:10px;">\n   <div class="large-5 medium-5 large-offset-1 medium-offset-1 small-6 columns">\n';
CIPTA.editor_type==EDITOR_DESIGN||CIPTA.is_cipta_custom&&CIPTA.is_cart_edit&&CIPTA.custom_hash||!CIPTA.is_logged_in||(b+=c);b=CIPTA.editor_type==EDITOR_DESIGN?b+('   </div>\n   <div class="large-6 medium-6 small-6 columns text-right" style="margin-top:40px;">\n       <a href="#" class="button tiny cipta-button-darkblue smaller expand" id="'+a+'_save"><i class="icon-edit fs1"></i> &nbsp;'+d+"</a>\n   </div>\n </div>\n"):b+('   </div>\n   <div class="large-6 medium-6 small-6 columns text-right">\n       <a href="#" class="button tiny cipta-button-orange smaller expand" id="'+
a+'_add_to_cart"><i class="icon-cart2 fs1"></i> &nbsp;'+d+"</a>\n   </div>\n </div>\n");return b+=' <div class="row" style="margin-top:40px;">\n   <div class="large-11 medium-12 small-12 columns large-offset-1">\n       <div class="row" style="background:#f0f0f0; background-color:#f8f8f8;">\n           <div class="large-12 medium-12 small-12 columns" id="'+a+'_product_info_2">\n           </div>\n           <div class="large-12 medium-12 small-12 columns" style="margin-top:30px;" id="'+a+'_product_info_3">\n           </div>\n       </div>\n   </div>\n </div>\n</div>\n'},
k=!1,m=[],l=!1,n={},q=[];n.on=function(a,b){a&&b&&(q[a]=b)};n.displayPrice=function(b){var c=ciptaProductAttr.getProductAttrTreeID(ciptaProductInfo.getProductAttrs());c||(c=b);b=ciptaProductAttr.getPrice(c);e&&ciptaProductInfo.setNsurfaces(e.getActiveSurfaces());1<ciptaProductInfo.getNsurfaces()&&(b=parseInt(b)+parseInt((ciptaProductInfo.getNsurfaces()-1)*ciptaProductAttr.getPrice2(c)));c="";if(CIPTA.editor_type!=EDITOR_DESIGN&&(CIPTA.is_cipta_design&&CIPTA.design_hash?CIPTA.cipta_user_id&&CIPTA.cipta_design&&
CIPTA.cipta_design.cipta_user_id&&CIPTA.cipta_design.cipta_user_id==CIPTA.cipta_user_id?c='<br/><span style="color:#666;font-weight:normal;font-size:0.9em;"> (harga untuk desain milik sendiri)</span>':(b=parseInt(b)+Math.round(b*(parseInt(CIPTA.cipta_design.price_markup)/100)),b=1E3*Math.ceil(b/1E3)):CIPTA.cipta_design_original&&CIPTA.cipta_design_original.price_markup&&(CIPTA.cipta_user_id&&CIPTA.cipta_design&&CIPTA.cipta_design.cipta_user_id&&CIPTA.cipta_design.cipta_user_id==CIPTA.cipta_user_id?
c='<br/><span style="color:#666;font-weight:normal;font-size:0.9em;"> (harga untuk desain milik sendiri)</span>':(b=parseInt(b)+Math.round(b*(parseInt(CIPTA.cipta_design_original.price_markup)/100)),b=1E3*Math.ceil(b/1E3))),CIPTA.discount_table&&!_.isEmpty(CIPTA.discount_table))){var d=ciptaProductInfo.getProductItemID(),f=null;CIPTA.is_cipta_design||CIPTA.cipta_design_original||CIPTA.design_hash?CIPTA.discount_table[d]&&(f=CIPTA.discount_table[d].disc_design):CIPTA.discount_table[d]&&(f=CIPTA.discount_table[d].disc_custom);
f&&0<f&&(d=b-b*parseFloat(f)/100,d=1E3*Math.ceil(d/1E3),$("#"+a+"_product_disc_price").html('Harga Diskon  <span class="normal-text">('+parseInt(f)+'%)</span>:&nbsp; <span class="price-large">'+parseInt(d).formatMoney(0,",",".")+"</span>"+c))}b?f&&0<f?$("#"+a+"_product_price").html('<span class="price-large-gray-crossed">'+parseInt(b).formatMoney(0,",",".")+"</span>"):CIPTA.editor_type!=EDITOR_DESIGN?$("#"+a+"_product_price").html('<span class="price-large">'+parseInt(b).formatMoney(0,",",".")+"</span>"):
$("#"+a+"_product_price").html("<span>Harga Dasar: "+parseInt(b).formatMoney(0,",",".")+"</span>"):$("#"+a+"_product_price").html("")};n.isStockAvailable=function(){var a=ciptaProductAttr.getProductAttrTreeID(ciptaProductInfo.getProductAttrs());if(a)return 1==ciptaProductAttr.getStock(a)?!0:!1};n.displaySizeChart=function(a,b,c,d){var e="";_.forEach(b,function(b){b=c[b];e+='  <div class="row medium-text" style="padding-top:5px; padding-bottom:5px; border-top: 1px solid #eee;" id="'+a+"_schart_"+b.id+
'">\n      <div class="large-4 medium-4 small-4 columns">'+b.public_name+'</div>\n      <div class="large-4 medium-4 small-4 columns">'+b.width+' cm </div>\n      <div class="large-4 medium-4 small-4 columns">'+b.length+" cm </div>\n  </div>\n"});b='<div class="medium-text" id="'+a+'_sizechart"><strong>Panduan Ukuran Baju</strong><br/>\nLebar baju diukur mulai dari ujung kiri sampai ke ujung kanan, sedangkan panjang baju diukur mulai dari bahu sampai ke ujung bawah baju.\nToleransi ukuran kurang lebih 1cm - 2cm. Jika menginginkan kaos yang lebih longgar, harap pilih satu ukuran lebih besar.\n</div>\n<div class="row medium-text" style="margin-top:15px;">\n <div class="large-6 medium-10 small-10 columns">\n  <div class="row medium-text" style="margin-top:15px;">\n      <div class="large-4 medium-4 small-4 columns"><strong>Ukuran</strong></div>\n      <div class="large-4 medium-4 small-4 columns"><strong>Lebar</strong></div>\n      <div class="large-4 medium-4 small-4 columns end"><strong>Panjang</strong></div>\n  </div>\n'+
e+' </div>\n <div class="large-6 medium-10 small-10 columns text-center">\n  <img src="/assets/img/tees-sizing.png" style="max-width:150px; margin-top:40px;">';" </div>\n</div>\n";$("#"+a).html(b);d&&($("#"+a+"_schart_"+d).css("font-weight","bold"),$("#"+a+"_schart_"+d).css("background","#ddd"),$("#"+a+"_schart_"+d).css("background-color","#ddd"))};n.displayBgcolorSelector=function(a,b){$("#"+b).append(' <div class="row" style="margin-top:20px;">\n   <div class="large-12 medium-12 small-12 columns panel-label">Warna Background :</div>\n   <div class="large-12 medium-12 small-12 columns" id="'+
b+'_attr_bgcolor"></div>\n </div>\n');m[a]=ciptaColorPickerWidget(b+"_backcolor",b+"_attr_bgcolor");m[a].create(function(a){e&&e.setSurfaceBackgroundColor(a)},null,!0);if(e){var c=e.getSurfaceBackgroundColor();c&&m[a].setColor(c)}};n.setBgcolor=function(a){_.isUndefined(m.select_bgcolor)||(a?m.select_bgcolor.setColor(a):m.select_bgcolor.setColor(null))};n.displaySubtypeItems=function(a,b,c,d){$("#"+b).append(' <div class="row" style="margin-top:20px;">\n   <div class="large-12 medium-12 small-12 columns panel-label">Pilih Tipe :</div>\n   <div class="large-12 medium-12 small-12 columns" id="'+
b+'_product_subtype"></div>\n </div>\n <div class="row" style="margin-top:20px;">\n   <div class="large-12 medium-12 small-12 columns panel-label">Pilih Jenis :</div>\n   <div class="large-12 medium-12 small-12 columns" id="'+b+'_product_item"></div>\n </div>\n');c=ciptaProductInfo.getProductItemID();d=(d=ciptaProductItem.getProductDetail(c))&&d.product_subtype_id?d.product_subtype_id:null;var e=ciptaProductSubtype.getGridList(),f=[];_.forEach(e,function(a){f.push({key:a.id,label:a.label})});m[a+
"_subtype"]=ciptaFancyDropDownWidget(b+"_subtype_list",b+"_product_subtype",f,null,{searchbox:!1,placeholder:"silahkan pilih","default":d,width:"70%"});m[a+"_subtype"].create(function(c){$("#"+b+"_product_item").html("");c=ciptaProductItem.getGridList(c);var d=[];_.forEach(c,function(a){d.push({key:a.id,label:a.label})});m[a+"_item"]=ciptaFancyDropDownWidget(b+"_item_list",b+"_product_item",d,null,{searchbox:!1,placeholder:"silahkan pilih","default":null,width:"70%"});m[a+"_item"].create(function(a){ciptaProductInfo.setProductItemID(a);
ciptaProductAttr.retrieveProducts(a,"item");n.fillPanel(l,!1)})});d=ciptaProductItem.getGridList(d);var g=[];_.forEach(d,function(a){g.push({key:a.id,label:a.label})});m[a+"_item"]=ciptaFancyDropDownWidget(b+"_item_list",b+"_product_item",g,null,{searchbox:!1,placeholder:"silahkan pilih","default":c,width:"70%"});m[a+"_item"].create(function(a){ciptaProductInfo.setProductItemID(a);ciptaProductAttr.retrieveProducts(a,"item");n.fillPanel(l,!1)})};n.displayItems=function(a,b,c,d,e){$("#"+b).append(' <div class="row" style="margin-top:20px;">\n   <div class="large-12 medium-12 small-12 columns panel-label">Pilih Jenis :</div>\n   <div class="large-12 medium-12 small-12 columns" id="'+
b+'_product_item"></div>\n </div>\n');c=ciptaProductInfo.getProductItemID();d=ciptaProductItem.getProductDetail(c);e=_.isUndefined(e)||0==e?d&&d.product_subtype_id?d.product_subtype_id:null:null;e=ciptaProductItem.getGridList(e);var f=[];_.forEach(e,function(a){f.push({key:a.id,label:a.label})});m[a+"_item"]=ciptaFancyDropDownWidget(b+"_item_list",b+"_product_item",f,null,{searchbox:!1,placeholder:"silahkan pilih","default":c,width:"70%"});m[a+"_item"].create(function(a){ciptaProductInfo.setProductItemID(a);
ciptaProductAttr.retrieveProducts(a,"item");n.fillPanel(l,!1)})};n.displayAttributes=function(b,c,d,f){var g=ciptaProductAttr.getAttrFields(),h,k=!1;0==b&&$("#"+a+"_product_attr_fields").html("");if(b<g.fields.length&&!_.isUndefined(g.fields[b])){var l=a+"_product_attrs"+(b+1);var t="undefined"!=typeof c?Object.keys(c):null;var q=g.fields[b];var y=g.display[b];y=y.toLowerCase();g=g.public_name[b];var A=ciptaProductAttr.getProductAttrDetail(q);var C=[];var r=[];_.forEach(t,function(a){r.push(A[a])});
r=_.sortBy(r,function(a){return parseInt(a.sort_order)});_.forEach(r,function(a){C.push(a.id)});t=C;"hidden"!=y&&"none"!=y&&(0==$("#"+l).length?$("#"+a+"_product_attr_fields").append(' <div class="row" style="margin-top:20px;">\n   <div class="large-12 medium-12 small-12 columns" id="'+l+'"></div>\n   <div class="large-12 medium-12 small-12 columns medium-text" id="'+l+'_footer"></div>\n </div>\n'):$("#"+l).html(""),$("#"+l).html('<span class="panel-label">Pilih '+g+':</span> <span class="medium-text" id="'+
l+'_label"></span><br/>'));g=h=void 0;d&&!_.isUndefined(d[q])&&(h=d[q],g=_.findKey(t,function(a){return a==h}));if(_.isUndefined(g)&&(_.isObject(f)&&0==f.available||!_.isObject(f)&&0==f))h=t[0],g=0,k=!0;else{if(_.isUndefined(g)||_.isObject(f)&&_.isObject(f.children[h])&&!f.children[h].available||_.isObject(f)&&!_.isObject(f.children[h])&&0==f.children[h])for(var u=0;u<t.length;u++)if(_.isObject(f.children[t[u]])&&f.children[t[u]].available||1==f.children[t[u]]){h=t[u];g=u;k=!0;break}_.isUndefined(g)&&
(h=t[0],g=0,k=!0)}if("color"==y)m[b]=ciptaColorSelector(l),m[b].create(A,t,g,function(a){ciptaProductInfo.setProductAttrID(q,a);A[a]&&A[a].public_name&&$("#"+l+"_label").html(A[a].public_name);_.isObject(f)?n.displayAttributes(b+1,c[a],d,f.children[a]):n.displayAttributes(b+1,c[a],d,f)}),A[h]&&A[h].public_name&&$("#"+l+"_label").html(A[h].public_name);else if("tees_size"==y)m[b]=ciptaButtonSelector(l),sel_attr_ix=k?null:g,CIPTA.editor_type==EDITOR_DESIGN&&null==sel_attr_ix&&(sel_attr_ix=0),m[b].create(A,
t,sel_attr_ix,function(e){ciptaProductInfo.setProductAttrID(q,e);A[e]&&A[e].public_name&&A[e].width&&A[e].length&&$("#"+l+"_footer").html(A[e].public_name+", Lebar: "+A[e].width+"cm, Panjang: "+A[e].length+'cm, &nbsp;<a href="#'+a+'_product_info_3_sizechart">lihat panduan ukuran</a>');n.displaySizeChart(a+"_product_info_3",t,A,e);_.isObject(f)?n.displayAttributes(b+1,c[e],d,f.children[e]):n.displayAttributes(b+1,c[e],d,f)}),k?n.displaySizeChart(a+"_product_info_3",t,A):(A[h]&&A[h].public_name&&A[h].width&&
A[h].length&&$("#"+l+"_footer").html(A[h].public_name+", Lebar: "+A[h].width+"cm, Panjang: "+A[h].length+'cm, &nbsp;<a href="#'+a+'_sizechart">lihat panduan ukuran</a>'),n.displaySizeChart(a+"_product_info_3",t,A,h));else if("select"==y||"select_medium"==y||"select_small"==y){var w={};_.forEach(t,function(a){w[a]=A[a].public_name});g="resolve";"select_medium"==y?g="70%":"select_small"==y&&(g="50%");m[b]=ciptaFancyDropDownWidget(l+"_select",l,w,null,{searchbox:!1,placeholder:"silahkan pilih","default":h,
width:g,order:t});m[b].create(function(a){ciptaProductInfo.setProductAttrID(q,a);_.isObject(f)?n.displayAttributes(b+1,c[a],d,f.children[a]):n.displayAttributes(b+1,c[a],d,f)})}null!=h&&(g=!0,"tees_size"!=y?ciptaProductInfo.setProductAttrID(q,h):k?(ciptaProductInfo.unsetProductAttrID(q),g=!1):ciptaProductInfo.setProductAttrID(q,h),_.isObject(f)?g?n.displayAttributes(b+1,c[h],d,f.children[h]):n.displayAttributes(b+1,c[h],d,f.available):n.displayAttributes(b+1,c[h],d,f))}else null==c||_.isObject(c)||
e.updateProduct(c),n.displayPrice(c),CIPTA.editor_type!=EDITOR_DESIGN&&(y=n.isStockAvailable(),1==f||1==y?($("#"+a+"_stock").html(""),m.amount.enable(),$("#"+a+"_add_to_cart").removeClass("disabled")):($("#"+a+"_stock").html("maaf, untuk sementara stok untuk produk ini habis"),m.amount.disable(),$("#"+a+"_add_to_cart").addClass("disabled")));0==b&&($("#"+a+"_product_attr_front").html(""),$("#"+a+"_product_attr_back").html(""),y=ciptaProductAttr.getDisplayOptions())&&(y.attr_front&&_.forEach(y.attr_front,
function(b){"select_subtype_item"==b?n.displaySubtypeItems("select_subtype_item",a+"_product_attr_front",c,d):"select_item"==b?n.displayItems("select_item",a+"_product_attr_front",c,d):"select_item_type"==b&&n.displayItems("select_item_type",a+"_product_attr_front",c,d,!0)}),y.attr_back&&_.forEach(y.attr_back,function(b){"select_bgcolor"==b&&n.displayBgcolorSelector("select_bgcolor",a+"_product_attr_back")}))};n.fillPanel=function(b,c){var d=ciptaProductInfo.getProductItemID();if(k&&0<d){product_detail=
ciptaProductItem.getProductDetail(d);$("#"+a+"_product_info").html("");CIPTA.is_cipta_design&&CIPTA.cipta_design&&$('<div class="normal-text">'+CIPTA.cipta_design.title+"</div>").appendTo("#"+a+"_product_info");$('<h4 class="product-info-design">'+product_detail.public_name+" Custom</h4>").appendTo("#"+a+"_product_info");$("#"+a+"_product_info_2").html("");$('<strong class="medium-text">'+product_detail.public_name+"</strong><br/>").appendTo("#"+a+"_product_info_2");$('<span class="medium-text">'+
product_detail.description+"</span>").appendTo("#"+a+"_product_info_2");d=ciptaProductInfo.getProductAttrs();for(var e=ciptaProductInfo.getAmount(),f={},g=1;g<=MAX_CART_ITEMS;g++)f[g]=g;$("#"+a+"_product_amount").html("");m.amount=ciptaFancyDropDownWidget(a+"_amount_1",a+"_product_amount",f,null,{searchbox:!1,allowClear:!1,"default":e});m.amount.create(function(a){ciptaProductInfo.setAmount(a)});if(_.isUndefined(c)||!c)e=ciptaProductAttr.getAttrTree(),f=ciptaProductAttr.computeStockTree(e),n.displayAttributes(0,
e,d,f);CIPTA.is_locked&&$("#product_info_product_attrs1").hide();b?($("#product_details").show(),l=!0):l=!1}};n.create=function(c){$(h()).appendTo("#"+b);k=!0;n.fillPanel(c,!0);CIPTA.editor_type==EDITOR_DESIGN&&(c=e&&e.isCustom()?!0:!1,m.is_design_custom=ciptaCheckboxWidget(a+"_is_design_custom",a+"_is_customable",c),m.is_design_custom.create(function(a){e&&e.setCustomable(a)}));$("#"+a+"_add_to_cart").click(function(){!$("#"+a+"_add_to_cart").hasClass("disabled")&&q.add_to_cart&&q.add_to_cart();
return!1});$("#"+a+"_save").click(function(){!$("#"+a+"_save").hasClass("disabled")&&q.save_design&&q.save_design();return!1});return n};n.showDetail=function(){$("#product_details").show();l=!0};n.hideDetail=function(){$("#product_details").hide();l=!1};n.show=function(a){(_.isUndefined(a)||1==a)&&n.fillPanel(l);$("#"+b).show();CIPTA.is_locked&&$("#product_info_product_attrs1").hide();return n};n.hide=function(){$("#"+b).hide();return n};n.setCustomizable=function(a){m.is_design_custom.setChecked(a);
e&&e.setCustomable(a)};return n},ciptaDesignListPanel=function(a,b,e,f){var d='<div class="row">\n        <div class="large-4 medium-4 small-4 large-offset-7 medium-offset-6 small-offset-6 columns" style="padding-right:0px;">\n                <input maxlength="100" style="margin:0px;" type="text" id="'+a+'_search_1" placeholder="Cari Desain..." />\n        </div>\n        <div class="large-1 medium-2 small-2 end columns" style="padding-left:0px;">\n                <a id="'+a+'_search_design" class="button secondary postfix" style="margin-left:-4px; padding-bottom:5px; border-top-right-radius:5px; border-bottom-right-radius:5px; margin-bottom:0px;"><i class="icon-search fs0"></i></a>        </div>\n</div>\n<div class="row small-text" style="margin-top:20px;">\n        <div class="large-12 columns" id="'+
a+'_widget_1" style="width: 100%; height: 375px; overflow-y: auto;">\n        </div>\n</div>\n<div class="row" style="margin-top:20px;">\n   <div class="large-3 medium-4 small-4 large-offset-6 medium-offset-4 small-offset-4 columns">\n                <a href="#" id="'+a+'_button_2" class="button expand tiny cipta-button-lightgray close-reveal-modal" style="position:relative; top:0px; left:0px; line-height:normal">Batal</a>\n   </div>\n   <div class="large-3 medium-4 small-4 columns">\n                <a href="#" id="'+
a+'_button_1" class="button expand tiny cipta-button-darkblue">Load Design</a>\n   </div>\n</div>\n',g=[],c=[],h={},k=!1,m={updateDesignList:function(){if(k)try{var b=ciptaRequest.buildRequestURI("design_list"),d=null;ciptaRequest.requestGET(b,!0,function(b){c=[];h={};_.forEach(b,function(a){_.isString(a.default_print_methods)&&(a.default_print_methods=JSON.parse(a.default_print_methods));d=CIPTA.API2URL+API_DESIGN_MOCKUP+"?imgid="+a.hash+"&m="+a.mock_id+"&s=0&p="+a.default_print_methods[0]+"&z=m&rnd="+
Math.floor(1E5*Math.random()+1);c.push({id:a.hash,label:a.title,img:d});h[a.hash]=d});g[0].clearAll();g[0].create(c,!0,function(a){},function(b){$("#"+a+"_button_1").trigger("click")})})}catch(q){}},create:function(c){$(d).appendTo("#"+b);c||(c=5);g.push(ciptaGridBoxWidget(a+"_design_1",a+"_widget_1",{itemgrid:c,imgwidth:200}));$("#"+a+"_button_1").click(function(){var a=g[0].getSelected();null!=a&&(g[0].resetSelected(),f&&f(a,_.isNull(h[a])?null:h[a]))});$("#"+a+"_search_design").click(function(){});
$("#"+a+"_search_1").keydown(function(b){13==b.keyCode&&(b.preventDefault(),$("#"+a+"_search_design").trigger("click"))});k=!0;return m},close:function(){g[1].enable();$("#"+a+"_search_clipart").removeClass("disabled");$("#"+a+"_search_1").prop("disabled",!1)}};return m},ciptaRenderPanel=function(a,b,e,f){var d='<h2 id="'+a+'_caption">Preview Hasil Jadi</h2>\n<div class="row">\n        <div class="large-12 medium-12 small-12 columns medium-text text-center" id="'+a+'_content">\n           <img id="'+
a+'_content_image" style="max-width:450px; width:400px;">\n        </div>\n        <div class="large-12 medium-12 small-12 columns medium-text text-center" id="'+a+'_wait">\n           <img src="/assets/img/icons/loader2.gif">&nbsp;            Mohon menunggu, sedang membuat preview...        </div>\n        <div class="large-12 medium-12 small-12 columns medium-text text-center" id="'+a+'_thumbs">\n        </div>\n</div>\n<div class="row" style="margin-top:20px;">\n   <div class="large-3 medium-4 small-4 large-offset-9 medium-offset-8 small-offset-8 columns">\n        <a href="#" id="'+
a+'_button_2" class="button expand tiny cipta-button-lightgray close-reveal-modal" style="position:relative; top:0px; left:0px; line-height:normal">Close</a>\n   </div>\n</div>\n',g=null,c={create:function(){$(d).appendTo("#"+b);$("#"+a+"_content").hide();$("#"+a+"_thumbs").hide();$("#"+a+"_wait").hide();return c},setImageList:function(a){g=a;c.setThumbnails(g,function(b){c.setContentImage(a[b].thumb[0].ObjectURL)});a[0]&&a[0].thumb[0]&&a[0].thumb[0].ObjectURL&&c.setContentImage(a[0].thumb[0].ObjectURL)},
setContentImage:function(b){$("#"+a+"_content_image").attr("src",b);$("#"+a+"_content").show();$("#"+a+"_wait").hide()},setThumbnails:function(b,c){$("#"+a+"_thumbs").html("");ciptaMockupSelector(a+"_sel",a+"_thumbs").create(b,function(a){c&&c(a)});$("#"+a+"_thumbs").show()},showModal:function(){f&&($("#"+a+"_content").hide(),$("#"+a+"_thumbs").hide(),$("#"+a+"_wait").show(),$("#"+f).foundation("reveal","open"))},closeModal:function(){f&&$("#"+f).foundation("reveal","close")},getModalID:function(){return f}};
return c},ciptaProduct=function(a){var b="undefined"!==typeof a?a:ciptaProductAttr,e=null,f=null,d=null,g=null,c={init:function(){e=b.getDefaultProduct();f=0;g=d="default";return c},selectProduct:function(a){a&&(e=b.getProduct(a),f=0,g=d="default")},getProductAttrID:function(){if(null!=e)return e.id},getMockupThumbs:function(){var a=[];if(null!=e&&"undefined"!=typeof e.product_mockups){var b=!1;$.each(e.product_mockups,function(c,d){d.layers&&d.layers.rendering?0==b&&(a[c]={id:d.id,public_name:d.public_name,
thumb:d.layers.thumb},b=!0):a[c]={id:d.id,public_name:d.public_name,thumb:d.layers.thumb}})}return a},getMockups:function(){return null!=e&&"undefined"!=typeof e.product_mockups?e.product_mockups:null},getSurfaceNumbers:function(){var a=[];null!=e&&"undefined"!=typeof e.product_mockups&&$.each(e.product_mockups,function(b,c){a.push(c.surface_order)});return a},setActiveMockup:function(a){f=a},getActiveMockup:function(){return f},getActiveMockupImages:function(){return null!=f&&null!=e&&"undefined"!=
typeof e.product_mockups[f]&&"undefined"!=typeof e.product_mockups[f].layers.images?e.product_mockups[f].layers.images:null},getActiveMockupSurfaceOrder:function(){return null!=f&&null!=e&&"undefined"!=typeof e.product_mockups[f]?e.product_mockups[f].surface_order:null},getActiveCanvasCoord:function(){return null!=d&&null!=e&&"undefined"!=typeof e.product_mockups[f]&&"undefined"!=typeof e.product_mockups[f].layers.canvas_coord&&"undefined"!=typeof e.product_mockups[f].layers.canvas_coord[d]?_.cloneDeep(e.product_mockups[f].layers.canvas_coord[d]):
null},getActiveEditorCoord:function(){return null!=g&&null!=e&&"undefined"!=typeof e.product_mockups[f]&&"undefined"!=typeof e.product_mockups[f].layers.editor_coord&&"undefined"!=typeof e.product_mockups[f].layers.editor_coord[g]?_.cloneDeep(e.product_mockups[f].layers.editor_coord[g]):null},getActiveMappingMode:function(){return null!=e&&"undefined"!=typeof e.product_mockups[f]&&"undefined"!=typeof e.product_mockups[f].mapping_mode?e.product_mockups[f].mapping_mode:null},getActiveMockupDPIRatio:function(){return null!=
f&&null!=e&&"undefined"!=typeof e.product_mockups[f]&&"undefined"!=typeof e.product_mockups[f].min_dpi_ratio?e.product_mockups[f].min_dpi_ratio:null},getActiveMockupCanvasBorder:function(){return null!=f&&null!=e&&"undefined"!=typeof e.product_mockups[f]&&"undefined"!=typeof e.product_mockups[f].canvas_border?e.product_mockups[f].canvas_border:null}};return c};"undefined"!==typeof module&&(module.exports={ciptaProductNode:function(a){return ciptaProduct(a)}});
var ciptaMockup=function(){var a=!1,b=null,e=null,f=null,d=null,g=null,c=null,h=null,k=null,m={initCanvasNode:function(c){e=c.fabric;b=c;f=e.createCanvasForNode(500,500);d=e.createCanvasForNode(500,500);a=!0},initCanvas:function(b,h,k){e=fabric;f=new fabric.Canvas(b);d=new fabric.Canvas(h);g=b;c=h;a=!1},loadMockups:function(a){h=a},loadDesigns:function(a){k=a},renderPreview:function(b,f,g){b&&""!=b&&1==a?(d.setWidth(b.img_dim.width*f),d.setHeight(b.img_dim.height*f),c&&($("#"+c).attr("width",b.img_dim.width*
f),$("#"+c).attr("height",b.img_dim.height*f)),d.setZoom(f),d.loadFromJSON(b.fabric,function(){for(var a=d.size(),b=0;b<a;b++){var c=d.item(b);if(1>=c.getElement().width&&1>=c.getElement().height){g&&g(null);return}c.resizeFilters.push(new e.Image.filters.Resize({resizeType:"sliceHack"}))}var f=function(a,b,c){if(a>=b||500<=a)return c&&c(),1;var e=d.item(a);e.applyFilters(function(){f(a+1,b,c)},e.resizeFilters,e._filteredEl||e._originalElement,!0)};f(0,d.size(),function(){d.renderAll();var a=[],b=
d.createPNGStream();b.on("data",function(b){a.push(b)});b.on("end",function(){var b=Buffer.concat(a);d.clear();d.dispose();g&&g(b)})})})):g&&g()},renderJSON:function(a,b){if(k&&"undefined"!==typeof k[a]){var f=k[a];d.setWidth(f.img_dim.width);d.setHeight(f.img_dim.height);c&&($("#"+c).attr("width",f.img_dim.width),$("#"+c).attr("height",f.img_dim.height));d.loadFromJSON(f.fabric,function(){var c=function(a,b,f){if(a>=b||500<=a)return f&&f(),1;obj=d.item(a);obj.hasControls=!1;var g=new e.Image.filters.Resize({resizeType:"sliceHack",
scaleX:obj.scaleX,scaleY:obj.scaleY});obj.scaleX=1;obj.scaleY=1;obj.filters.push(g);obj.applyFilters(function(){a+1<b?c(a+1,b,f):f&&f()})};nobj=d.size();c(0,nobj,function(){d.renderAll();var c=d.toDataURL({format:"png"});d.clear();d.dispose();k[a].png=c;b&&b(c)})})}else b&&b()},renderMockup:function(c,d,q,r){var l=!1,n=0,u=0;a?_.forEach(h[c].layers.images,function(a){a.width>n&&(n=a.width);a.height>u&&(u=a.height)}):$.each(h[c].layers.images,function(a,b){b.width>n&&(n=b.width);b.height>u&&(u=b.height)});
f.setWidth(n);f.setHeight(u);null!==g&&($("#"+g).attr("width",n),$("#"+g).attr("height",u));if(null==d||"undefined"==typeof d)d="default";if("object"==typeof h[c].layers.canvas_coord[d])var x=h[c].layers.canvas_coord[d];else if("object"==typeof h[c].layers.canvas_coord["default"])x=h[c].layers.canvas_coord["default"];else throw"Error: Invalid Canvas Coordinate";if("object"==typeof h[c].surfaces)var B=h[c].surfaces;else throw"Error: Invalid Surface Order";var D=function(a,b,d,e){if(a>=b)e&&e();else{var g=
h[c].layers.images[a],k={};-1<g.url.indexOf("amazonaws.com")?k.crossOrigin="anonymous":k.crossOrigin="";"number"==typeof g.left&&(k.left=g.left);"number"==typeof g.top&&(k.top=g.top);"number"==typeof g.opacity&&(k.opacity=g.opacity);"background"!=g.position&&"bottom"!=g.position||"background"!=d?"top"!=g.position&&"foreground"!=g.position||"foreground"!=d?a+1<b?D(a+1,b,e):e&&e():f.setOverlayImage(g.url,function(){a+1<b?D(a+1,b,e):e&&e()},k):f.setBackgroundImage(g.url,function(){a+1<b?D(a+1,b,e):e&&
e()},k)}},F=function(){D(0,h[c].layers.images.length,"foreground",function(){var c=f.getWidth(),d=f.getHeight(),e={};if(a){var g=function(a,h,k){if(a>=h)k&&k();else{f.getZoom()!=q[a]&&(f.setZoom(q[a]),f.setWidth(Math.floor(c*q[a])),f.setHeight(Math.floor(d*q[a])));f.renderAll();var l=f.createJPEGStream({bufsize:32768,quality:80,progressive:!1}),m=new b.memstream.WritableStream;l.on("data",function(a){m.write(a)});l.on("end",function(){var c=b.uuid.v4()+".jpg";b.S3.uploadFileStream(b.config.aws_s3.bucket_ciptaloka_mockups,
b.config.aws_s3.folder_custom,c,m.toBuffer(),!0,function(d,l){l||(e[q[a]]={width:f.getWidth(),height:f.getHeight(),filename:c,url:b.config.aws_s3.url_ciptaloka_mockups_custom+c});a+1<h?g(a+1,h,k):k&&k()})})}};g(0,q.length,function(){f.clear();f.dispose();r&&r(e,l)})}else $.each(q,function(a,b){f.getZoom()!=b&&(f.setZoom(b),f.setWidth(Math.floor(c*b)),f.setHeight(Math.floor(d*b)));f.renderAll();var g=f.toDataURL({format:"jpeg"});e[b]={width:f.getWidth(),height:f.getHeight(),jpg:g}}),f.clear(),r&&r(e,
l)})};D(0,h[c].layers.images.length,"background",function(){if(null!=k&&null!==k[B[0]]&&"undefined"!==typeof k[B[0]]){var a=k[B[0]],b=function(a){e.Image.fromURL(a.png,function(b){b.hasControls=!1;var c=(x[2]-x[0])/a.canvas_dim.width,d=(x[3]-x[1])/a.canvas_dim.height;c=c<d?c:d;b.set({top:b.get("top")*c,left:b.get("left")*c,width:b.get("width")*c,height:b.get("height")*c});var e=a.offset.x*c,g=a.offset.y*c,h=a.img_dim.width*c,k=a.img_dim.height*c;b.setLeft(x[0]+e);b.setTop(x[1]+g);b.setClipTo(function(a){var b=
-e-h/2;Math.abs(b)>h/2&&(b=-(h/2));var c=-g-k/2;Math.abs(c)>k/2&&(c=-(k/2));var d=x[2]-x[0]-e;Math.abs(d)>x[2]-x[0]&&(d=x[2]-x[0]);var f=x[3]-x[1]-g;Math.abs(f)>x[3]-x[1]&&(f=x[3]-x[1]);a.rect(b,c,d,f)});f.add(b);F()})};"undefined"===typeof a.png||null===a.png?m.renderJSON(B[0],function(){"undefined"!==typeof a.png||null!==a.png?b(a):(l=!0,F())}):b(a)}else l=!0,F()})}};return m};"undefined"!==typeof module&&(module.exports={ciptaMockupNode:function(){return ciptaMockup()}});
var ciptaCanvas=function(a,b,e,f){var d=null,g=[],c=null,h=null,k=null,m=null,l=null,n=null,q=null,r=null,w=null,t=!1,u=!1,x=!1,B=[],D=!1,F=[],z=null,v={initAllObject:function(a,b,c,e){a=b/a;c=e/c;var f=a<c?a:c;d.forEachObject(function(a,b,c){a.set({left:a.get("left")*f,top:a.get("top")*f,scaleX:a.getScaleX()*f,scaleY:a.getScaleY()*f});a.setCoords()})},resizeAllObject:function(a,b,c,e,f,g,h,k,l,m){a=parseInt(a);b=parseInt(b);c=parseInt(c);e=parseInt(e);f=parseInt(f);g=parseInt(g);h=parseInt(h);k=
parseInt(k);if(a!=f||b!=g||c!=h||e!=k){var y=c-a,A=e-b,n=h-f,t=k-g,q=n/y,C=t/A,r=Math.abs(1-q),u=Math.abs(1-C),w;var H=w=0;var z=1;var x=v.computeBBox(d,!0);var B=_.clone(x);l&&(x.minx-=a,x.maxx-=a,x.miny-=b,x.maxy-=b);z=r<u?q:C;if(_.isFinite(x.minx)&&_.isFinite(x.maxx)&&_.isFinite(x.miny)&&_.isFinite(x.maxy)){var G=0>x.miny?0:x.miny;var S=x.maxy>A?A:x.maxy;var M=0>x.minx?0:x.minx;var D=x.maxx>y?y:x.maxx;q=x.maxy-x.miny;C=x.maxx-x.minx;var P=(S-G)*z;var F=(D-M)*z;r<u&&P>t?z=(S-G)/A*z*t/P:r>u&&F>n&&
(z=(D-M)/y*z*n/F);if(r<u&&t<A||r>u)r=x.miny,u=A-x.maxy,0>r&&0<=u?(r=x.maxy,H=Math.round(r*q*z/(r+(q-r))-x.maxy*z)):0>u&&0<=r?(r=A-x.miny,H=Math.round(t-r*q*z/(r+(q-r))-x.miny*z)):0>r&&0>u?(r=(x.miny+x.maxy)/2,H=Math.round(r/A*t-q*z/2-x.miny*z)):H=Math.round(r*(t-q*z)/(u+r)-x.miny*z);r=x.minx;u=y-x.maxx;0>r&&0<=u?(r=x.maxx,w=Math.round(r*C*z/(r+(C-r))-x.maxx*z)):0>u&&0<=r?(r=y-x.minx,w=Math.round(n-r*C*z/(r+(C-r))-x.minx*z)):0>r&&0>u?(r=(x.minx+x.maxx)/2,w=Math.round(r/y*n-C*z/2-x.minx*z)):w=Math.round(r*
(n-C*z)/(u+r)-x.minx*z)}if(1==m){x=B;m=!1;if(_.isFinite(x.minx)&&_.isFinite(x.maxx)&&_.isFinite(x.miny)&&_.isFinite(x.maxy)&&.05<Math.abs(y/A-n/t)){y=A=0;x.minx>a&&(A+=x.minx-a);x.maxx<c&&(A+=c-x.maxx);x.miny>b&&(y+=x.miny-b);x.maxy<e&&(y+=e-x.maxy);c=(x.maxx-x.minx)*z;e=(x.maxy-x.miny)*z;var L=x.minx*z+w;var O=x.miny*z+H;25>=A&&(c-25<h-f?(n=h-f+20,z=n/(x.maxx-x.minx),h=(x.maxy-x.miny)*z,L=l?f-4:0,c=n,e=h):l&&L>f?L=f-4:l&&L+c<h?L=L+(h-(L+c))+8:!l&&0<L?L=0:!l&&L+c<n&&(L=L+(n-(L+c))+8),m=!0);25>=y&&
(e-25<k-g?(h=k-g+20,z=h/(x.maxy-x.miny),n=(x.maxx-x.minx)*z,O=l?g-3:0,c=n,e=h):l&&O>g?O=g-3:l&&O+e<k?O=O+(k-(O+e))+8:!l&&0<O?O=0:!l&&O+e<t&&(O=O+(t-(O+e))+8),m=!0)}m?H=w=0:L=O=void 0}d.forEachObject(function(c,d,e){l?(d=_.isUndefined(L)||_.isUndefined(x)?f-(a-c.get("left"))*z+w:L+(c.get("left")-x.minx)*z,e=_.isUndefined(O)||_.isUndefined(x)?g-(b-c.get("top"))*z+H:O+(c.get("top")-x.miny)*z):(d=_.isUndefined(L)||_.isUndefined(x)?c.get("left")*z+w:L+(c.get("left")-x.minx)*z,e=_.isUndefined(O)||_.isUndefined(x)?
c.get("top")*z+H:O+(c.get("top")-x.miny)*z);c.set({left:d,top:e,scaleX:c.getScaleX()*z,scaleY:c.getScaleY()*z});c.setCoords()})}},isEmpty:function(){for(var a=0;a<g.length;a++)if(0<g[a].getObjects().length)return!1;return!0},setCustomable:function(a){D=a?!0:!1},isCustom:function(){return D},isTemplate:function(){for(var a=0;a<g.length;a++)for(var b=g[a].getObjects(),c=0;c<b.length;c++)if(b[c].meta&&"text"==b[c].meta.type&&b[c].meta.content&&b[c].meta.content.attr&&b[c].meta.content.attr.template&&
1==b[c].meta.content.attr.template.iscustom&&1==b[c].meta.content.attr.template.istemplate&&(1==b[c].meta.content.attr.template.qcolor||1==b[c].meta.content.attr.template.qfont||1==b[c].meta.content.attr.template.qtext)||b[c].meta&&"image"==b[c].meta.type&&b[c].meta.content&&b[c].meta.content.attr&&b[c].meta.content.attr.template&&1==b[c].meta.content.attr.template.iscustom&&1==b[c].meta.content.attr.template.istemplate&&(1==b[c].meta.content.attr.template.qcrop||1==b[c].meta.content.attr.template.qimage||
1==b[c].meta.content.attr.template.qimgcolor||1==b[c].meta.content.attr.template.qclipart||1==b[c].meta.content.attr.template.qclipcolor))return!0;return!1},isPlaceholder:function(){for(var a=0;a<g.length;a++)for(var b=g[a].getObjects(),c=0;c<b.length;c++)if(b[c].meta&&"text"==b[c].meta.type&&b[c].meta.content&&b[c].meta.content.attr&&b[c].meta.content.attr.template&&1==b[c].meta.content.attr.template.isplaceholder||b[c].meta&&"image"==b[c].meta.type&&b[c].meta.content&&b[c].meta.content.attr&&b[c].meta.content.attr.template&&
1==b[c].meta.content.attr.template.isplaceholder)return!0;return!1},disableSelection:function(){h=null;d.deactivateAll();d.selection=!1;for(var a=0;a<g.length;a++)g[a].selection=!1,0<g[a].getObjects().length&&g[a].forEachObject(function(a){a.selectable=!1});x=!0;$("#"+e+"_"+c.getActiveMockup()).addClass("cipta-canvas-border-invisible")},enableSelection:function(){for(var a=0;a<g.length;a++)g[a].selection=!0,0<g[a].getObjects().length&&g[a].forEachObject(function(a){a.selectable=!0});x=!1;$("#"+e+
"_"+c.getActiveMockup()).removeClass("cipta-canvas-border-invisible")},getActiveObjectType:function(){return"image"==h.type&&"text"==h.meta.type?"text":"image"==h.type&&"image"==h.meta.type?"image":"other"},getSurfaceList:function(){for(var a=[],b=0;b<g.length;b++)0<g[b].getObjects().length&&a.push(b);return a},enableCanvasBorder:function(){u=!0},disableCanvasBorder:function(){u=!1},setCanvasCoord:function(a,b,h,k,l,m){var y=h?h:a;_.isUndefined(m)&&(m=0);$("#"+e+"_"+l).css("left",y[0]+"px");$("#"+
e+"_"+l).css("top",y[1]-2+"px");$("#"+e+"_"+l).css("width",y[2]-y[0]+"px");$("#"+e+"_"+l).css("height",y[3]-y[1]+"px");$("#"+f+"_"+l).attr("width",y[2]-y[0]+"px");$("#"+f+"_"+l).attr("height",y[3]-y[1]+"px");w={left:0,top:0,width:y[2]-y[0],height:y[3]-y[1]};null!=d&&d.deactivateAll();0<g.length&&(d=g[l]);null!=d&&(d.getWidth(),d.getHeight(),d.setWidth(y[2]-y[0]),d.setHeight(y[3]-y[1]),d.calcOffset(),b&&(k&&4==k.length&&(b[0]-=k[0],b[1]-=k[1],b[2]-=k[0],b[3]-=k[1]),h&&4==h.length&&(a[0]-=h[0],a[1]-=
h[1],a[2]-=h[0],a[3]-=h[1]),v.resizeAllObject(b[0],b[1],b[2],b[3],a[0],a[1],a[2],a[3],h?!0:!1,m)),d.calcOffset(),d.renderAll());1==c.getActiveMockupCanvasBorder()?v.enableCanvasBorder():v.disableCanvasBorder()},setCanvasBackground:function(a,c,f,g){if(null!=d){var h=g?{left:-g[0],top:-g[1],crossOrigin:"anonymous"}:f?{left:-f[0],top:-f[1],crossOrigin:"anonymous"}:{crossOrigin:"anonymous"};var k=!1,l=!1;$.each(a,function(a,c){$("#"+b).css("width",c.width+"px");$("#"+b).css("height",c.height+"px");if("background"==
c.position||"bottom"==c.position)$("#"+b).css("background-image","url('"+c.ObjectURL+"')"),k=!0;else if("top"==c.position||"foreground"==c.position)d.setOverlayImage(c.ObjectURL,d.renderAll.bind(d),h),l=!0});k||$("#"+b).css("background-image","none");l||d.setOverlayImage(null,d.renderAll.bind(d))}$("#"+e+"_"+c).show()},limitScaling:function(a){if(c&&a.meta&&"image"==a.meta.type&&("user"==a.meta.content.attr.type||"clipart"==a.meta.content.attr.type&&0==a.meta.content.attr.clipart.type)&&0<a.meta.content.attr.width&&
0<a.meta.content.attr.height){var b=c.getActiveMockupDPIRatio(),e=b*a.meta.content.attr.width;b*=a.meta.content.attr.height;var f=a.meta.content.getCrop();_.isEmpty(f)||(f[2]&&(e*=f[2]),f[3]&&(b*=f[3]));f=e/a.width;var g=b/a.height,h=!1;a.getWidth()>e&&(a.setScaleX(f),h=!0);a.getHeight()>b&&(a.setScaleY(g),h=!0);h?($.notifier("Untuk menjaga kualitas print, gambar tidak dapat diperbesar lagi. Silahkan gunakan gambar dengan resolusi lebih tinggi."),a.set({left:B[0],top:B[1]}),a.setCoords(),d.calcOffset()):
(B[0]=a.left,B[1]=a.top)}},adjustCornerSize:function(a){var b=a.getWidth()<a.getHeight()?.25*a.getWidth():.25*a.getHeight();5>b?b=5:18<b&&(b=18);a.cornerSize=b;a.cornerColor="#126594";a.borderColor="#126594"},on:function(a,b){a&&b&&(F[a]=b)},init:function(a){fabric.Object.NUM_FRACTION_DIGITS=17;for(y=0;5>y;y++)d=new fabric.Canvas(f+"_"+y),d.selection=!0,d.perPixelTargetFind=!0,d.targetFindTolerance=4,d.centeredScaling=!0,d.imageSmoothingEnabled=!0,d.controlsAboveOverlay=!0,d.on("object:selected",
function(a,b){if(x)return h=null,d.deactivateAllWithDispatch(),!0;if(h!=a.target){h=a.target;var c=!1,e=!1;k&&"image"==h.type&&"text"==h.meta.type?CIPTA.editor_type==EDITOR_CUSTOM&&(CIPTA.cipta_design||CIPTA.cipta_design_original)&&h.meta.content.attr&&h.meta.content.attr.template&&!_.isUndefined(h.meta.content.attr.template.iscustom)&&0==h.meta.content.attr.template.iscustom?e=!0:(k.initText(h),c=!0):m&&"image"==h.type&&"image"==h.meta.type&&(CIPTA.editor_type==EDITOR_CUSTOM&&(CIPTA.cipta_design||
CIPTA.cipta_design_original)&&h.meta.content.attr&&h.meta.content.attr.template&&!_.isUndefined(h.meta.content.attr.template.iscustom)&&0==h.meta.content.attr.template.iscustom?e=!0:(m.initImage(h),c=!0));if(c&&F["object:selected"])F["object:selected"](h);else if(e&&F["selection:cleared"])F["selection:cleared"]()}}),d.on("selection:cleared",function(a,b){h=null;if(F["selection:cleared"])F["selection:cleared"]()}),d.on("mouse:down",function(a){!t&&u&&($("#"+e+"_"+c.getActiveMockup()).addClass("cipta-canvas-border"),
t=!0)}),d.on("mouse:up",function(a){t&&u&&($("#"+e+"_"+c.getActiveMockup()).removeClass("cipta-canvas-border"),t=!1)}),d.onBeforeScaleRotate=function(a){B[0]=a.left;B[1]=a.top},d.on("object:scaling",function(a){v.limitScaling(a.target)}),d.on("touch:gesture",function(a){v.limitScaling(a.target)}),d.on("object:modified",function(a){v.adjustCornerSize(h);h.setCoords();d.renderAll();k&&"image"==h.type&&"text"==h.meta.type?k.updateRotation(h.angle):m&&"image"==h.type&&"image"==h.meta.type&&m.updateRotation(h.angle)}),
g.push(d),$("#"+e+"_"+y).hide();c=ciptaProduct();c.init();a&&c.selectProduct(a);var b={},l=c.getMockups();_.forEach(_.keys(l),function(a){_.isUndefined(b[l[a].surface_order])&&(b[l[a].surface_order]=a)});a=_.keys(b);for(var y=a.length-1;0<=y;y--){var n=a[y];c.setActiveMockup(b[n]);v.setCanvasCoord(c.getActiveCanvasCoord(),null,c.getActiveEditorCoord(),null,n,c.getActiveMappingMode())}d=g[a[0]];v.setCanvasBackground(c.getActiveMockupImages(),n,c.getActiveCanvasCoord(),c.getActiveEditorCoord());v.enableKeyboard()},
updateProduct:function(a,b,d){if(a&&c.getProductAttrID()!=a||b){d&&(l.selectMockup(0),this.updateMockup(0));var e=c.getActiveMockup(),f={},g=c.getMockups();f[g[e].surface_order]=e;_.forEach(_.keys(g),function(a){_.isUndefined(f[g[a].surface_order])&&(f[g[a].surface_order]=a)});var h={},k={};_.forEach(_.keys(f),function(a){c.setActiveMockup(f[a]);h[a]=c.getActiveCanvasCoord();k[a]=c.getActiveEditorCoord()});a&&c.getProductAttrID()!=a&&c.selectProduct(a);var m={},n=c.getMockups();_.isUndefined(n[e])||
n[e].surface_order!=g[e].surface_order||(m[n[e].surface_order]=e);_.forEach(_.keys(n),function(a){_.isUndefined(m[n[a].surface_order])&&(m[n[a].surface_order]=a)});_.forEach(_.keys(m),function(a){c.setActiveMockup(m[a]);var b=h[a]?h[a]:null;a=k[a]?k[a]:null;v.setCanvasCoord(c.getActiveCanvasCoord(),b,c.getActiveEditorCoord(),a,c.getActiveMockupSurfaceOrder(),c.getActiveMappingMode())});_.isUndefined(n[e])||d?(a=_.keys(n)[0],c.setActiveMockup(a)):(c.setActiveMockup(e),a=e);v.setCanvasCoord(c.getActiveCanvasCoord(),
c.getActiveCanvasCoord(),c.getActiveEditorCoord(),c.getActiveEditorCoord(),c.getActiveMockupSurfaceOrder(),c.getActiveMappingMode());v.setCanvasBackground(c.getActiveMockupImages(),c.getActiveMockupSurfaceOrder(),c.getActiveCanvasCoord(),c.getActiveEditorCoord());l.refresh();l.selectMockup(a);if(b)return m}},getActiveProduct:function(){return c},getMockupThumbs:function(){if(null!=c)return c.getMockupThumbs()},renderMockup:function(a){v.retrieveContent(function(b){var c=ciptaProductInfo.getPrintMethod();
c||(c=ciptaProductInfo.getAllInfo(),c=ciptaProductAttr.getDefaultPrintMethod(c.product_attr_id));b={m:a,raw:{design:JSON.stringify(b)},p:c};b=ciptaRequest.packdt(b);b={_pckdata:b};ciptaRequest.postData(ciptaRequest.action_mockup_custom,!0,b,function(b){var c=[];_.isArray(b)||_.isObject(b)?_.forEach(a,function(a){b[a]&&c.push({id:a,public_name:"",thumb:[{ObjectURL:"data:image/jpeg;base64,"+b[a]}]})}):c.push({id:1,public_name:"",thumb:[{ObjectURL:"data:image/jpeg;base64,"+b}]});r.setImageList(c)},function(){},
!0)})},updateMockup:function(a){var b=c.getMockups(),f=c.getActiveMockup();d&&d.deactivateAllWithDispatch();if(_.isUndefined(b[a].layers)||_.isUndefined(b[a].layers.rendering))a!=f&&($("#"+e+"_"+f).hide(),b[f].surface_order==b[a].surface_order?(b=c.getActiveCanvasCoord(),f=c.getActiveEditorCoord()):f=b=null,c.setActiveMockup(a),v.setCanvasCoord(c.getActiveCanvasCoord(),b,c.getActiveEditorCoord(),f,c.getActiveMockupSurfaceOrder(),c.getActiveMappingMode()),v.setCanvasBackground(c.getActiveMockupImages(),
c.getActiveMockupSurfaceOrder(),c.getActiveCanvasCoord(),c.getActiveEditorCoord()),n&&n.setBgcolor(v.getSurfaceBackgroundColor()));else{if(r){var g=[];_.forEach(b,function(a){_.isUndefined(a.layers)||_.isUndefined(a.layers.rendering)||(g[a.sort_order]=a.id)});r.showModal();v.renderMockup(g)}l.selectMockup(f)}},assignEditingPanel:function(a,b){"text"==a?k=b:"image"==a?m=b:"thumbs"==a?l=b:"quickedit"!=a&&"productinfo"==a&&(n=b)},assignModal:function(a,b){"addclipart"==a?q=b:"render"==a&&(r=b)},getModal:function(a){if("addclipart"==
a)return q;if("render"==tyoe)return r},blockCanvas:function(){$("#canvas_background").block({message:null,overlayCSS:{backgroundColor:"#CCC",opacity:.1,cursor:"wait"}});$("#canvas_wait").show()},unblockCanvas:function(){$("#canvas_background").unblock();$("#canvas_wait").hide()},blockAllPanels:function(){k.block();m.block()},unblockAllPanels:function(){k.unblock();m.unblock()},deselectAll:function(){null!=d&&(d.deactivateAll(),d.renderAll())},deselectAllWithDispatch:function(){null!=d&&(d.deactivateAllWithDispatch(),
d.renderAll())},reSelectSelected:function(){if(h){var a=h;d.deactivateAllWithDispatch();d.setActiveObject(a)}},enableKeyboard:function(){Mousetrap.bind("del",function(){h&&v.deleteObject()});Mousetrap.bind("ctrl+c",function(){h&&v.copyObject()});Mousetrap.bind("ctrl+x",function(){h&&v.cutObject()});Mousetrap.bind("ctrl+v",function(){z&&v.pasteObject()});Mousetrap.bind("up",function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveUp())});Mousetrap.bind("down",function(a){h&&(a.preventDefault?
a.preventDefault():a.returnValue=!1,v.moveDown())});Mousetrap.bind("left",function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveLeft())});Mousetrap.bind("right",function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveRight())});Mousetrap.bind("shift+up",function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveUp(5))});Mousetrap.bind("shift+down",function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveDown(5))});Mousetrap.bind("shift+left",
function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveLeft(5))});Mousetrap.bind("shift+right",function(a){h&&(a.preventDefault?a.preventDefault():a.returnValue=!1,v.moveRight(5))})},disableKeyboard:function(){Mousetrap.reset()},copyImageProperty:function(a,b,c,d,e){c&&"width"==c?(b.scaleToWidth(Math.round(a.getWidth())),b.setScaleX(a.getScaleX()),b.setScaleY(a.getScaleY())):c&&"proportional"==c?(b.setScaleX(a.getScaleX()),b.setScaleY(a.getScaleY()),c=a.getWidth()/(b.getScaleX()*
b.width),b.setScaleX(c*b.getScaleX()),b.setScaleY(c*b.getScaleY())):c&&"height"==c?(b.scaleToHeight(Math.round(a.getHeight())),b.setScaleX(a.getScaleX()),b.setScaleY(a.getScaleY())):c&&"fit"==c&&(b.setScaleX(a.width*a.getScaleX()/b.width),b.setScaleY(a.height*a.getScaleY()/b.height));b.setCoords();c=a.getAngle();a.setAngle(0).setCoords();b.left=d&&"right"==d?a.left+a.getWidth()-b.getWidth():d&&"center"==d?a.left+a.getWidth()/2-b.getWidth()/2:a.left;b.top=e&&"bottom"==e?a.top+a.getHeight()-b.getHeight():
e&&"center"==e?a.top+a.getHeight()/2-b.getHeight()/2:a.top;b.setAngle(c).setCoords();a.setAngle(c).setCoords();b.setOpacity(a.getOpacity());b.setFlipX(a.getFlipX());b.setFlipY(a.getFlipY());b.setCoords()},adjustImageProperty:function(a,b,c,d,e){c&&"width"==c?(c=a.width/b.width,b.setScaleX(c),b.setScaleY(c)):c&&"proportional"==c?(c=a.width/b.width,b.setScaleX(c),b.setScaleY(c)):c&&"height"==c?(c=a.height/b.height,b.setScaleX(c),b.setScaleY(c)):c&&"fit"==c&&(b.setScaleX(a.width/b.width),b.setScaleY(a.height/
b.height));b.setCoords();c=b.getAngle();b.setAngle(0).setCoords();b.left=d&&"right"==d?a.zleft+a.zwidth-b.getWidth():d&&"center"==d?a.zleft+a.zwidth/2-b.getWidth()/2:a.zleft;b.top=e&&"bottom"==e?a.ztop+a.zheight-b.getHeight():e&&"center"==e?a.ztop+a.zHeight/2-b.getHeight()/2:a.ztop;b.setAngle(c).setCoords()},copyZIndex:function(a,b){var c=d.getObjects().indexOf(a);b.moveTo(c)},recursiveDelete:function(a,b){for(var c in a)"object"==typeof a[c]&&10>=b&&v.recursiveDelete(a[c],b+1),delete a[c],a[c]=void 0},
deleteObj:function(a){for(var b in a)delete a[b],a[b]=void 0},addText:function(a){preview=a.getPreview();var b={crossOrigin:"anonymous"};v.blockCanvas();v.blockAllPanels();try{fabric.Image.fromURL(preview.img,function(b){!b._element||1>=b._element.width&&1>=b._element.height?$.notifier("System Error, Unable to Add Text. Please Try Again Later.","error"):(b.scaleToWidth(.7*w.width),b.left=.3*w.width/2,b.top=.2*w.height,b.panel={},b.meta={},b.meta.type="text",b.meta.content=a,v.adjustCornerSize(b),
b.resizeFilters.push(new fabric.Image.filters.Resize({resizeType:"sliceHack"})),b.setCoords(),d.add(b),d.setActiveObject(b),h=d.getActiveObject(),b.applyFilters(d.renderAll.bind(d),b.resizeFilters,b._filteredEl||b._originalElement,!0),d.renderAll(),x&&(b.selectable=!1));v.unblockCanvas();v.unblockAllPanels()},b)}catch(C){console.log(C),sweetAlert("System Error",C+"<br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error"),v.unblockCanvas(),v.unblockAllPanels()}return v},editText:function(a,
b,c,e){var f=a.getPreview();v.blockCanvas();v.blockAllPanels();try{b&&b!=h||(b=h);var g={width:b.getWidth(),height:b.getHeight(),scaleX:b.getScaleX(),scaleY:b.getScaleY()},k=new Image;k.crossOrigin="anonymous";k.addEventListener?k.addEventListener("error",function(a){console.log(a);$.notifier("Error: Cannot Update Text, Please try again later!","error");v.unblockCanvas();v.unblockAllPanels();a.preventDefault()}):k.attachEvent("onerror",function(a){console.log(a);$.notifier("Error: Cannot Update Text, Please try again later!",
"error");v.unblockCanvas();v.unblockAllPanels();return!1});k.onload=function(){if(1>=k.width&&1>=k.height)return $.notifier("Error: Cannot Update Text, Please try again later!","error"),v.unblockCanvas(),v.unblockAllPanels(),!1;var f=b.getAngle();b.setAngle(0).setCoords();g.zleft=b.left;g.ztop=b.top;g.zwidth=b.getWidth();g.zheight=b.getHeight();b.setAngle(f).setCoords();b.setElement(k);(f=a.getTemplate("customalign"))||(f="center");var h=a.getTemplate("replacemode");h=e&&""!=e&&"default"!=e?e:!h||
"default"==h||"fitwidth"!=h&&"fitheight"!=h&&"fitboth"!=h?0<a.getShape("type")&&30<=a.getShape("amount")?"width":"height":"fitwidth"==h?"width":"fitheight"==h?"height":"fit";v.adjustImageProperty(g,b,h,f);b.getWidth()>w.width&&(b.left=0,f=w.width/b.width,b.setScaleX(f),b.setScaleY(f),b.setCoords());b.applyFilters(d.renderAll.bind(d),b.resizeFilters,b._filteredEl||b._originalElement,!0);d.renderAll();c&&c(b);v.unblockCanvas();v.unblockAllPanels()};k.src=f.img}catch(O){console.log(O),sweetAlert("System Error",
O+"<br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error"),v.unblockCanvas(),v.unblockAllPanels()}},addImage:function(a){var b=a.getPreview(),e={crossOrigin:"anonymous"};v.blockCanvas();v.blockAllPanels();try{fabric.Image.fromURL(b.thumb_img,function(b){if(!b._element||1>=b._element.width&&1>=b._element.height)$.notifier("System Error, Unable to Add Image. Please Try Again Later.","error");else{b.scaleToWidth(.6*w.width);b.setLeft(.2*w.height);b.setTop(.15*w.height);v.adjustCornerSize(b);
if(c&&("user"==a.attr.type||"clipart"==a.attr.type&&0==a.attr.clipart.type)&&0<a.attr.width&&0<a.attr.height){var e=c.getActiveMockupDPIRatio(),f=e*a.attr.width;e*=a.attr.height;b.getWidth()>f&&b.scaleToWidth(f-1);b.getHeight()>e&&b.scaleToHeight(e-1)}b.panel={};b.meta={};b.meta.type="image";b.meta.content=a;b.resizeFilters.push(new fabric.Image.filters.Resize({resizeType:"sliceHack"}));d.add(b);d.setActiveObject(b);h=d.getActiveObject();h.centerH();h.setCoords();d.calcOffset();x&&(b.selectable=!1);
b.applyFilters(d.renderAll.bind(d),b.resizeFilters,b._filteredEl||b._originalElement,!0);d.renderAll()}v.unblockCanvas();v.unblockAllPanels()},e)}catch(H){console.log(H),sweetAlert("System Error",H+"<br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error"),v.unblockCanvas(),v.unblockAllPanels()}return v},isTainted:function(a){try{return a.getImageData(0,0,1,1),!1}catch(A){return 18===A.code}},editImage:function(a,b,c,e){a=a.getPreview();v.blockCanvas();v.blockAllPanels();
try{b&&b!=h||(b=h);var f={width:b.getWidth(),height:b.getHeight(),scaleX:b.getScaleX(),scaleY:b.getScaleY()},g=new Image;g.crossOrigin="anonymous";g.addEventListener?g.addEventListener("error",function(a){console.log(a);$.notifier("Error: Cannot Update Image, Please try again later!","error");v.unblockCanvas();v.unblockAllPanels();a.preventDefault()}):g.attachEvent("onerror",function(a){console.log(a);$.notifier("Error: Cannot Update Image, Please try again later!","error");v.unblockCanvas();v.unblockAllPanels();
return!1});g.onload=function(){if(1>=g.width&&1>=g.height)return $.notifier("Error: Cannot Update Image, Please try again later!","error"),v.unblockCanvas(),v.unblockAllPanels(),!1;var a=b.getAngle();b.setAngle(0).setCoords();f.zleft=b.left;f.ztop=b.top;f.zwidth=b.getWidth();f.zheight=b.getHeight();b.setAngle(a).setCoords();b.setElement(g);e&&""!=e?v.adjustImageProperty(f,b,e):v.adjustImageProperty(f,b,"proportional");B[0]=b.left;B[1]=b.top;v.limitScaling(b);b.applyFilters(d.renderAll.bind(d),b.resizeFilters,
b._filteredEl||b._originalElement,!0);d.renderAll();c&&c(b);v.unblockCanvas();v.unblockAllPanels()};g.src=a.thumb_img}catch(M){console.log(M),sweetAlert("System Error",M+"<br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error"),v.unblockCanvas(),v.unblockAllPanels()}},setSurfaceBackgroundColor:function(a){d.backgroundColor=a;d.renderAll()},getSurfaceBackgroundColor:function(){return d&&d.backgroundColor?d.backgroundColor:null},setOpacity:function(a){h&&(h.setOpacity(a),
d.renderAll())},scaleIn:function(){h&&(B[0]=h.left,B[1]=h.top,h.setScaleX(h.getScaleX()+.05),h.setScaleY(h.getScaleY()+.05),v.limitScaling(h),v.adjustCornerSize(h),h.setCoords(),d.renderAll())},scaleOut:function(){h&&(h.setScaleX(h.getScaleX()-.05),h.setScaleY(h.getScaleY()-.05),v.adjustCornerSize(h),h.setCoords(),d.renderAll())},alignCenter:function(){if(h){if(c.getActiveEditorCoord()){var a=c.getActiveCanvasCoord(),b=h.getWidth();a=Math.round(Math.round((a[2]-a[0])/2)+parseInt(a[0])-b/2);h.setLeft(a)}else h.centerH();
h.setCoords();d.renderAll()}},moveLeft:function(a){if(h){if(!a||1>a)a=1;h.left-=a;h.setCoords();d.calcOffset();d.renderAll()}},moveRight:function(a){if(h){if(!a||1>a)a=1;h.left+=a;h.setCoords();d.calcOffset();d.renderAll()}},moveUp:function(a){if(h){if(!a||1>a)a=1;h.top-=a;h.setCoords();d.calcOffset();d.renderAll()}},moveDown:function(a){if(h){if(!a||1>a)a=1;h.top+=a;h.setCoords();d.calcOffset();d.renderAll()}},flipVertical:function(){h&&(0==h.getFlipX()?h.setFlipX(!0):h.setFlipX(!1),h.setCoords(),
d.renderAll())},flipHorizontal:function(){h&&(0==h.getFlipY()?h.setFlipY(!0):h.setFlipY(!1),h.setCoords(),d.renderAll())},rotate:function(a){h&&(h.setAngle(a),h.setCoords(),d.renderAll())},bringForward:function(){h&&(h.bringForward(!0),h.setCoords(),d.renderAll())},bringToFront:function(){h&&(h.bringToFront(),h.setCoords(),d.renderAll())},sendBackward:function(){h&&(h.sendBackwards(!0),h.setCoords(),d.renderAll())},sendToBack:function(){h&&(h.sendToBack(),h.setCoords(),d.renderAll())},deleteObject:function(a,
b){var e=null;a?e=a:h&&(e=h);if(e){if(e&&"text"==e.meta.type)var f=e.meta.content.getPreview().img;else e&&"image"==e.meta.type&&(f=e.meta.content.getPreview().thumb_img);f&&$("#deletepanel").html('<img src="'+f+'" style="height:100px">');$("#modal_delete").foundation("reveal","open");$("#modal_delete_yes").unbind("click").click(function(){if(e){e.remove();d.renderAll();if(CIPTA.editor_type!=EDITOR_DESIGN&&(CIPTA.is_cipta_design&&CIPTA.design_hash||CIPTA.design_hash_original)&&v.isEmpty()){var a=
c.getProductAttrID();_.isUndefined(a)||!a?window.location=URL_EDITOR_CUSTOM_ATTR(ciptaProductInfo.getProductItemID(),0):window.location=URL_EDITOR_CUSTOM_ATTR(ciptaProductInfo.getProductItemID(),a);return}b&&b()}$("#modal_delete").foundation("reveal","close")});$("#modal_delete_no").unbind("click").click(function(){$("#modal_delete").foundation("reveal","close")})}},cloneObject:function(a,b){a.clone(function(c){c?(c.panel={},a.panel&&(c.panel=_.cloneDeep(a.panel)),c.meta={},c.meta.type=a.meta.type,
c.meta.content=a.meta.content.clone(),c.resizeFilters.push(new fabric.Image.filters.Resize({resizeType:"sliceHack"})),c.applyFilters(function(){b&&b(c)},c.resizeFilters,c._filteredEl||c._originalElement,!0)):b&&b(null)})},copyObject:function(){h&&v.cloneObject(h,function(a){a?z=a:$.notifier("Error: Cannot Copy Object")})},cutObject:function(){h&&v.cloneObject(h,function(a){a?(z=a,h.remove(),d.renderAll()):$.notifier("Error: Cannot Cut Object")})},pasteObject:function(){z&&v.cloneObject(z,function(a){a?
(a.set("top",a.top+15),a.set("left",a.left+15),d.add(a),d.setActiveObject(a),h=d.getActiveObject(),d.renderAll()):$.notifier("Error: Cannot Paste Object")})},lockObject:function(){h&&(h.lockMovementX=!0,h.lockMovementY=!0,h.lockRotation=!0,h.lockScalingX=!0,h.lockScalingY=!0,h.lockUniScaling=!0,h.selectable=!0,h.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!1,br:!1,tl:!1,tr:!1,mtr:!1}),d.renderAll())},unlockObject:function(){h&&(h.lockMovementX=!1,h.lockMovementY=!1,h.lockRotation=!1,h.lockScalingX=
!1,h.lockScalingY=!1,h.lockUniScaling=!1,h.selectable=!0,h.setControlsVisibility({mt:!0,mb:!0,ml:!0,mr:!0,bl:!0,br:!0,tl:!0,tr:!0,mtr:!0}),d.renderAll())},computeBBox:function(a,b){var c={minx:Infinity,maxx:-Infinity,miny:Infinity,maxy:-Infinity},d;b=_.isUndefined(b)||1!=b?!1:!0;a.forEachObject(function(a){d=a.getBoundingRect();d.left<c.minx&&(c.minx=d.left);d.top<c.miny&&(c.miny=d.top);d.width+d.left>c.maxx&&(c.maxx=d.width+d.left,0==b&&(c.maxx+=10));d.height+d.top>c.maxy&&(c.maxy=d.height+d.top,
0==b&&(c.maxy+=10))});return c},retrieveContent:function(a){var b=[];if(null!=c)try{var d=v.updateProduct(null,!0),e=_.keys(d),f=c.getActiveMockup(),h=function(a,f,k){var l=e[a];if(5<=l)throw sweetAlert("System Error","Maximum number of surfaces exceeded. <br/>Silahkan hubungi Customer Support kami.","error"),"Error! Maximum number of surfaces exceeded";c.setActiveMockup(d[l]);for(var m=g[l].size(),n=0;n<m;n++){var t=g[l].item(n);t&&(1>=t.getWidth()||1>=t.getHeight())&&t.remove()}if(0<g[l].size()||
g[l].backgroundColor){m=g[l].toJSON(["meta"]);var q=v.computeBBox(g[l]);t=c.getActiveEditorCoord();var r=c.getActiveCanvasCoord();if(t){n={width:Math.round(r[2]-r[0]),height:Math.round(r[3]-r[1])};var u={x:Math.round(q.minx)-(r[0]-t[0]),y:Math.round(q.miny)-(r[1]-t[1])}}else n={width:Math.round(g[l].getWidth()),height:Math.round(g[l].getHeight())},u={x:Math.round(q.minx),y:Math.round(q.miny)};t=Math.round(q.maxx-q.minx);r=Math.round(q.maxy-q.miny);isFinite(t)||(t=0);isFinite(r)||(r=0);isFinite(u.x)||
(u.x=0);isFinite(u.y)||(u.y=0);m.objects&&(500<m.objects.length&&(m.objects=m.objects.slice(0,500)),_.forEach(m.objects,function(a){a.left-=q.minx;a.top-=q.miny;a.filters=[]}));m.overlayImage&&delete m.overlayImage;b[l]={};b[l].fabric=JSON.stringify(m);b[l].canvas_dim=n;b[l].offset=u;b[l].img_dim={width:t,height:r}}a+1<f&&5>a+1?h(a+1,f,k):k&&k()};h(0,e.length,function(){0>=b.length&&(b=null);c.setActiveMockup(f);a&&a(b)})}catch(M){console.log(M)}return null},save:function(){v.retrieveContent(function(a){ciptaRequest.submitCustomDesign("",
JSON.stringify(a),c.getProductAttrID(),1,!1,function(a){})})},load:function(a,b,e){d.clear();d.loadFromJSON(a.fabric,function(){for(var f=c.getActiveEditorCoord(),g=c.getActiveCanvasCoord(),h=[],k=d.size(),l=0;l<k;l++){var m=d.item(l);if(m&&m.meta&&m.meta.content&&m.meta.content.attr&&m.meta.content.attr.template&&m.meta.content.attr.template.isplaceholder&&1==m.meta.content.attr.template.isplaceholder&&CIPTA.editor_type!=EDITOR_DESIGN)h.push(m);else if(m&&1>=m.getWidth()||1>=m.getHeight())h.push(m);
else{if(m&&1>=m.getElement().width&&1>=m.getElement().height)throw e&&e(null),sweetAlert("System Error","Cannot Load Design Image <br/>Silahkan hubungi Customer Support kami.","error"),"Error! Cannot Load Design Image";if(m&&"text"==m.meta.type){var n=ciptaText();n.initialize(m.meta.content.attr,m.meta.content.preview);m.meta.content=n;m.panel={};m.resizeFilters.push(new fabric.Image.filters.Resize({resizeType:"sliceHack"}));m.meta.content.attr.template&&!_.isEmpty(m.meta.content.attr.template)&&
!_.isUndefined(m.meta.content.attr.template.islocked)&&m.meta.content.attr.template.islocked&&(m.lockMovementX=!0,m.lockMovementY=!0,m.lockRotation=!0,m.lockScalingX=!0,m.lockScalingY=!0,m.lockUniScaling=!0,m.selectable=!0,m.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!1,br:!1,tl:!1,tr:!1,mtr:!1}))}else m&&"image"==m.meta.type&&(n=ciptaImage(),n.initialize(m.meta.content.attr,m.meta.content.preview),m.meta.content=n,m.panel={},m.resizeFilters.push(new fabric.Image.filters.Resize({resizeType:"sliceHack"})),
m.meta.content.attr.template&&!_.isEmpty(m.meta.content.attr.template)&&!_.isUndefined(m.meta.content.attr.template.islocked)&&m.meta.content.attr.template.islocked&&(m.lockMovementX=!0,m.lockMovementY=!0,m.lockRotation=!0,m.lockScalingX=!0,m.lockScalingY=!0,m.lockUniScaling=!0,m.selectable=!0,m.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!1,br:!1,tl:!1,tr:!1,mtr:!1})));if(m){if(f){n=g[0]-f[0];var t=g[1]-f[1];m.setLeft(m.getLeft()+a.offset.x+n);m.setTop(m.getTop()+a.offset.y+t)}else m.setLeft(m.getLeft()+
a.offset.x),m.setTop(m.getTop()+a.offset.y);v.adjustCornerSize(m);m.setCoords()}}}_.forEach(h,function(a){a.remove()});f?v.resizeAllObject(g[0],g[1],parseInt(g[0])+parseInt(a.canvas_dim.width),parseInt(g[1])+parseInt(a.canvas_dim.height),g[0],g[1],g[2],g[3],f,c.getActiveMappingMode()):v.initAllObject(a.canvas_dim.width,d.getWidth(),a.canvas_dim.height,d.getHeight());var q=function(a,b,c){if(a>=b||500<=a)return c&&c(),1;var e=d.item(a);e.applyFilters(function(){q(a+1,b,c)},e.resizeFilters,e._filteredEl||
e._originalElement,!0)};q(0,d.size(),function(){d.calcOffset();d.renderAll();b&&b()})});return v},loadAllDesigns:function(a,b){for(var e=d,f=0;f<g.length;f++)g[f].clear();var h=-1,k=function(b,e,f){b<a.length?_.isEmpty(a[b])||_.isEmpty(a[b].fabric)?k(b+1,e):(d=g[b],c.setActiveMockup(b),v.load(a[b],function(){-1==h&&(h=b);k(b+1,e)},function(){f&&f()})):e&&e()};k(0,function(){d=e;var a=c.getSurfaceNumbers();a=_.uniq(a);for(var f=0;f<a.length;f++)c.setActiveMockup(a[f]),v.setCanvasCoord(c.getActiveCanvasCoord(),
c.getActiveCanvasCoord(),c.getActiveEditorCoord(),c.getActiveEditorCoord(),c.getActiveMockupSurfaceOrder(),c.getActiveMappingMode());0<=h&&(v.updateMockup(h),l.selectMockup(h));b&&b()},function(){for(var a=0;a<g.length;a++)g[a].clear();b&&b()})},getObjects:function(a){var b=d.getObjects();if(!a||"text"!=a&&"image"!=a&&"clipart"!=a)return b;var c=[];_.forEach(b,function(b){b.meta.type==a&&c.push(b)});return c},getActiveSurfaces:function(){var a=c.getSurfaceNumbers();a=_.uniq(a);for(var b=0,d=0;d<a.length;d++)0<
g[a[d]].getObjects().length&&b++;return b}};return v};$.notifier=function(a,b,e){b||(b="warn");e?"global"==e?$.notify(a,{position:"top left",arrowShow:!1,className:b,autoHideDelay:5E3}):$("#"+e).notify(a,{position:"top left",arrowShow:!1,className:b,autoHideDelay:5E3}):$("#editor_area").notify(a,{position:"top left",arrowShow:!1,className:b,autoHideDelay:5E3})};sweetAlert.setDefaults({animation:!1,html:!0,allowOutsideClick:!0});
$(function(){_.isUndefined(CIPTA.cipta_design)||_.isEmpty(CIPTA.cipta_design)||_.isUndefined(CIPTA.cipta_design._pckdata)||(CIPTA.cipta_design=JSON.parse(ciptaRequest.unpackdt(CIPTA.cipta_design._pckdata)));_.isUndefined(CIPTA.cipta_custom)||_.isEmpty(CIPTA.cipta_custom)||_.isUndefined(CIPTA.cipta_custom._pckdata)||(CIPTA.cipta_custom=JSON.parse(ciptaRequest.unpackdt(CIPTA.cipta_custom._pckdata)));var a=shopCart(CONSTANT,"scart",CONSTANT.COOKIE_EXPIRE,CONSTANT.COOKIE_DOMAIN,store);CIPTA.trformat=
"png";CIPTA.checkout=!1;CIPTA.is_advanced_editor=!0;CIPTA.is_finished_design=!1;$("#main_section").block({message:"Loading... Please Wait",overlayCSS:{backgroundColor:"#999",opacity:.2,cursor:"wait"}});if(CIPTA.editor_type==EDITOR_DESIGN){ciptaProductSubtype.retrieveProductSubtypes(CIPTA.product_type_id);var b=ciptaProductSubtype.getProductSubtypes(),e=[];_.forEach(b,function(a){e.push(a.id)});ciptaProductItem.retrieveProductItems(e);if(_.isUndefined(CIPTA.edit_design)||_.isEmpty(CIPTA.edit_design))b=
ciptaProductItem.getProductItems(),0<b.length?(ciptaProductAttr.retrieveProducts(b[0].id),CIPTA.product_item_id=b[0].id):sweetAlert("System Error","Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error"),CIPTA.is_edit_design=!1;else{try{CIPTA.edit_design.design=JSON.parse(CIPTA.edit_design.design);for(b=0;b<CIPTA.edit_design.design.length;b++)_.isObject(CIPTA.edit_design.design[b])&&(CIPTA.edit_design.design[b].fabric=JSON.parse(CIPTA.edit_design.design[b].fabric));CIPTA.is_edit_design=
!0}catch(t){CIPTA.edit_design=void 0,CIPTA.is_edit_design=!1}ciptaProductAttr.retrieveProducts(CIPTA.product_item_id);$("#dashboard-header").html("<span>Edit Produk : "+CIPTA.edit_design.title+"</span>")}$("#description_panel").hide();$("#bottom_panel").hide()}else{if(_.isUndefined(CIPTA.cipta_design)||_.isEmpty(CIPTA.cipta_design))if(_.isUndefined(CIPTA.cipta_custom)||_.isEmpty(CIPTA.cipta_custom))CIPTA.is_cipta_design=!1,CIPTA.is_cipta_custom=!1;else try{CIPTA.cipta_custom.design=JSON.parse(CIPTA.cipta_custom.design),
_.forEach(CIPTA.cipta_custom.design,function(a){_.isEmpty(a)||_.isEmpty(a.fabric)||(a.fabric=JSON.parse(a.fabric))}),CIPTA.is_cipta_custom=!0}catch(t){CIPTA.cipta_custom=void 0,CIPTA.is_cipta_custom=!1}else try{CIPTA.cipta_design.design=JSON.parse(CIPTA.cipta_design.design),_.forEach(CIPTA.cipta_design.design,function(a){a.fabric=JSON.parse(a.fabric)}),CIPTA.is_cipta_design=!0}catch(t){CIPTA.cipta_design=void 0,CIPTA.is_cipta_design=!1}ciptaProductSubtype.retrieveProductSubtypes(CIPTA.product_type_id);
b=ciptaProductSubtype.getProductSubtypes();e=[];_.forEach(b,function(a){e.push(a.id)});ciptaProductItem.retrieveProductItems(e);ciptaProductAttr.retrieveProducts(CIPTA.product_item_id)}var f=ciptaCanvas("canvas_editpanel","canvas_background","canvas_placeholder","canvas_area");_.isUndefined(CIPTA.product_attr_id)?f.init():f.init(CIPTA.product_attr_id);$("#canvas_wait").hide();var d=ciptaQuickEditPanel("quickedit","quickedit_panel",f);d.create();f.assignEditingPanel("quickedit",d);var g=ciptaTextPanel("addtext",
"textpanel",f,function(){$("#modal_addtext").foundation("reveal","close")});g.create();var c=ciptaTextEditPanel("edittext","text_editpanel",f);c.create();f.assignEditingPanel("text",c);c.hide();var h=ciptaImagePanel("addimage","imagepanel",f,function(){$("#modal_addimage").foundation("reveal","close")});h.create();var k=ciptaImageEditPanel("editimage","image_editpanel",f);k.create();f.assignEditingPanel("image",k);k.hide();var m=ciptaClipartPanel("addclipart","clipartpanel",f,"modal_addclipart");
m.create();f.assignModal("addclipart",m);b=ciptaProductEditPanel("editproduct","product_editpanel",f);b.create();b.hide();b=ciptaMockupThumbs("selectmockup","mockup_thumbspanel",f);b.create();f.assignEditingPanel("thumbs",b);b=ciptaRenderPanel("previewrender","renderpanel",f,"modal_previewrender");b.create();f.assignModal("render",b);if(CIPTA.editor_type==EDITOR_DESIGN){var l=ciptaProductItemPanel("product_items","product_itemspanel",f,function(a){ciptaProductAttr.retrieveProducts(a,"item");l.displayAttributes();
ciptaProductInfo.setProductItemID(a)});b=ciptaProductItem.getGridList();l.create(1.3,CIPTA.product_item_id,CIPTA.editor_type,b,!0,!1);_.isUndefined(CIPTA.product_attr_id)?l.displayAttributes():(b=ciptaProductAttr.getProduct(CIPTA.product_attr_id))&&b.attrs&&!_.isUndefined(b.attrs)?l.displayAttributes(b.attrs):l.displayAttributes();l.hide();l.on("ok_button",function(){l.hide();q.show()})}else l=ciptaProductItemPanel("product_items","product_itemspanel",f,function(a){ciptaProductAttr.retrieveProducts(a,
"item");l.displayAttributes();ciptaProductInfo.setProductItemID(a)}),b=ciptaProductItem.getGridList(),CIPTA.is_cipta_design?(l.create(1,CIPTA.cipta_design.product_item_id,CIPTA.editor_type,b,!0),_.isUndefined(CIPTA.cipta_design.product_attr_id)||((b=ciptaProductAttr.getProduct(CIPTA.cipta_design.product_attr_id))&&!_.isUndefined(b.attrs)?l.displayAttributes(b.attrs):l.displayAttributes())):(CIPTA.is_cipta_custom?l.create(1,CIPTA.product_item_id,!1,b,!0):CIPTA.product_item_id&&0<CIPTA.product_item_id?
l.create(1,CIPTA.product_item_id,!1,b,!0):l.create(1,b[0].id,!1,b,!0),_.isUndefined(CIPTA.product_attr_id)?l.displayAttributes():(b=ciptaProductAttr.getProduct(CIPTA.product_attr_id))&&!_.isUndefined(b.attrs)?l.displayAttributes(b.attrs):l.displayAttributes()),l.on("ok_button",function(){l.hide();q.show();0==CIPTA.is_finished_design?(d.show(),CIPTA.info_panel_detail||$("#bottom_panel").show(),CIPTA.is_cipta_design||$("#description_panel").show()):$("#toolbar_review").css("visibility","visible");0!=
CIPTA.is_advanced_editor||CIPTA.is_finished_design||$("#panel_advanced_toggle").show()}),l.hide();if(CIPTA.editor_type!=EDITOR_DESIGN){var n=null;b=null;CIPTA.is_cipta_custom&&CIPTA.is_cart_edit&&(n="Edit Produk",$("#finish_design2").find("span").html("&nbsp;Lanjut"));CIPTA.is_cipta_custom&&(CIPTA.is_cart_edit||CIPTA.is_cart_add)&&(b=!0);var q=ciptaProductInfoPanel("product_info","product_infopanel",f,function(){},n,b);q.create(!1);CIPTA.info_panel_detail=!1;CIPTA.is_locked&&$("#product_info_product_attrs1").hide();
q.on("add_to_cart",function(){var b=ciptaProductInfo.getAllInfo();if(_.isUndefined(b.product_attr_id)||_.isNull(b.product_attr_id))return $.notifier("Silahkan pilih opsi terlebih dahulu !"),!1;var c=ciptaProductAttr.getDefaultPrintMethod(b.product_attr_id);c&&(ciptaProductInfo.setPrintMethod(c),b=ciptaProductInfo.getAllInfo());$("#product_info_add_to_cart").html('<img src="/assets/img/icons/loader1.gif" style="width:18px; height:18px;"> Mohon Tunggu... Sedang memproses');$("#product_info_add_to_cart").addClass("disabled");
f.retrieveContent(function(c){if(null==c)throw null==n?$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;Tambah ke Keranjang'):$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;'+n),$("#product_info_add_to_cart").removeClass("disabled"),sweetAlert("Desain Kosong","Desain masih kosong!<br/>Silahkan tambah gambar / tulisan / warna dulu.","warning"),"Desain masih kosong: Silahkan tambah gambar/tulisan/warna dulu";if(CIPTA.last_content&&CIPTA.last_content.content&&
JSON.stringify(CIPTA.last_content.content)==JSON.stringify(c)&&CIPTA.last_content.info&&CIPTA.last_content.info.product_attr_id==b.product_attr_id)ciptaRequest.postData(ciptaRequest.action_detail_custom,!0,{hash:CIPTA.last_content.info.hash},function(c){b.hash=CIPTA.last_content.info.hash;b.surfaces=CIPTA.last_content.info.surfaces;CIPTA.last_content.info=b;c.qty=b.amount;c.itemtype="custom";a.addItemToCart(c);CIPTA.checkout=!0;window.location=URL_CART_VIEW_ASKMODAL(b.hash)},function(a){null==n?$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;Tambah ke Keranjang'):
$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;'+n);$("#product_info_add_to_cart").removeClass("disabled");sweetAlert("System Error",a+"<br/>Gagal merekam desain!<br/><br/>Silahkan coba lagi.","error");throw"System Error: Gagal merekam desain. Silahkan coba lagi atau hubungi customer service kami.";},!0);else{var d={};_.forEach(c,function(a,c){_.isEmpty(a)||(d[c]=b.print_method)});CIPTA.is_cipta_custom&&CIPTA.is_cart_edit&&CIPTA.custom_hash?ciptaRequest.submitCustomDesign("edit",
CIPTA.custom_hash,"",JSON.stringify(c),b.product_attr_id,JSON.stringify(d),!0,function(d){b.surfaces=[];_.forEach(_.keys(c),function(a){null!=c[a]&&b.surfaces.push(a)});b.hash=d.hashid;CIPTA.last_content={content:c,info:b};var e={hashid:CIPTA.custom_hash,itemtype:"custom"};a.isItemExist(e)?(a.deleteItemFromCart(e),e=d,e.qty=b.amount,e.itemtype="custom",a.addItemToCart(e),CIPTA.checkout=!0,window.location=URL_CART_VIEW):(CIPTA.checkout=!0,window.location=URL_DASHBOARD_SAVED_DESIGN)},function(a){null==
n?$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;Tambah ke Keranjang'):$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;'+n);$("#product_info_add_to_cart").removeClass("disabled");sweetAlert("System Error",a+"<br/>Gagal merekam desain!<br/><br/>Silahkan coba lagi.","error");throw"System Error: Gagal merekam desain. Silahkan coba lagi atau hubungi customer service kami.";}):ciptaRequest.submitCustomDesign("add",null,"",JSON.stringify(c),b.product_attr_id,
JSON.stringify(d),!0,function(d){b.surfaces=[];_.forEach(_.keys(c),function(a){null!=c[a]&&b.surfaces.push(a)});b.hash=d.hashid;CIPTA.last_content={content:c,info:b};d.qty=b.amount;d.itemtype="custom";a.addItemToCart(d);CIPTA.is_cipta_custom&&CIPTA.is_cart_add?(CIPTA.checkout=!0,window.location=URL_CART_VIEW):(CIPTA.checkout=!0,window.location=URL_CART_VIEW_ASKMODAL(b.hash))},function(a){null==n?$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;Tambah ke Keranjang'):$("#product_info_add_to_cart").html('<i class="icon-cart2 fs1"></i> &nbsp;'+
n);$("#product_info_add_to_cart").removeClass("disabled");sweetAlert("System Error",a+"<br/>Gagal merekam desain!<br/><br/>Silahkan coba lagi.","error");throw"System Error: Gagal merekam desain. Silahkan coba lagi atau hubungi customer service kami.";})}})});q.on("save_design",function(){var a=ciptaProductInfo.getAllInfo();if(_.isUndefined(a.product_attr_id)||_.isNull(a.product_attr_id)){var b=f.getActiveProduct().getProductAttrID();if(_.isUndefined(b)||!b)return $.notifier("Error: gagal merekam desain. Silahkan coba lagi.",
"error"),!1}else b=a.product_attr_id;if(f.isEmpty())return $.notifier("Desain masih kosong. Silahkan tambahkan gambar/teks terlebih dahulu."),!1;var c=ciptaProductAttr.getDefaultPrintMethod(b);c&&(ciptaProductInfo.setPrintMethod(c),a=ciptaProductInfo.getAllInfo());$("#modal_savecustom").foundation("reveal","open");$("#button_savecustom").click(function(){$("#modal_savecustom").foundation("reveal","close");$("#product_info_save").html('<img src="/assets/img/icons/loader1.gif" style="width:18px; height:18px;"> <span style="color:#666">Mohon Tunggu...</span>');
$("#product_info_save").addClass("disabled");$("#product_info_add_to_cart").addClass("disabled");f.retrieveContent(function(c){var d={};_.forEach(c,function(b,c){_.isEmpty(b)||(d[c]=a.print_method)});var e=$("#modal_savecustom_title").val();e&&0<e.length||(e="");ciptaRequest.submitCustomDesign("add",null,e,JSON.stringify(c),b,JSON.stringify(d),!0,function(b){a.surfaces=[];_.forEach(_.keys(c),function(b){null!=c[b]&&a.surfaces.push(b)});a.hash=b.hashid;CIPTA.last_content={content:c,info:a};CIPTA.is_cipta_custom=
!0;CIPTA.is_cart_edit=!0;CIPTA.custom_hash=b.hashid;CIPTA.checkout=!0;window.location=URL_DASHBOARD_SAVED_DESIGN},function(a){$("#product_info_save").html('<i class="icon-floppy-disk fs0"> </i> Save Design');$("#product_info_save").removeClass("disabled");$("#product_info_add_to_cart").removeClass("disabled");sweetAlert("System Error",a+"<br/>Gagal merekam desain!<br/><br/>Silahkan coba lagi.","error");throw"System Error: Gagal merekam desain. Silahkan coba lagi atau hubungi customer service kami.";
},{is_save_design:!0})})})})}else{n=CIPTA.is_edit_design?"Edit Produk":"Tambah Produk";q=ciptaProductInfoPanel("product_info","product_infopanel",f,function(){},n,null);q.create(!1);q.setCustomizable(!0);CIPTA.info_panel_detail=!1;var r=function(a){if(CIPTA.editor_type==EDITOR_DESIGN){if(f.isEmpty())return $.notifier("Desain Kosong. Silahkan tambahkan gambar/teks dahulu."),!1;var b=$("#product_info_save").html();try{$("#product_info_save").html('<img src="/assets/img/icons/loader1.gif" style="width:18px; height:18px;"> <span style="color:#666">Mohon Tunggu...</span>'),
$("#product_info_save").addClass("disabled"),f.retrieveContent(function(c){ciptaDesign.setDesign(c,f.isCustom(),f.isTemplate(),f.isPlaceholder());ciptaDesign.setProductTypeID(CIPTA.product_type_id);ciptaDesign.setCiptaStoreID(CIPTA.store_id);c=f.getActiveProduct();ciptaDesign.setProductAttrID(c.getProductAttrID());ciptaDesign.setProductItemID(ciptaProductInfo.getProductItemID());ciptaDesign.addEditDesign(a,function(b){"add"==a?(CIPTA.hash=b.hash,window.location=URL_DESIGN_INFO_ADD(CIPTA.store_id,
CIPTA.product_type_id,CIPTA.hash)):window.location=URL_DESIGN_PRODUCT_LIST(CIPTA.store_id);CIPTA.checkout=!0},function(a){msg="";a&&a.userMessage&&(msg=msg+a.userMessage+".<br/>");a&&a.errorCode&&(msg=msg+" Error Code: "+a.errorCode+".<br/>");sweetAlert("Gagal merekam desain!",msg+"Silahkan coba lagi.","error");$("#product_info_save").html(b);$("#product_info_save").removeClass("disabled")},function(a){$.notifier(a)})})}catch(x){return $("#product_info_save").html(b),$("#product_info_save").removeClass("disabled"),
console.log(x),sweetAlert("System Error",x+"<br/>Tidak dapat merekam desain<br/>Silahkan coba lagi.","error"),f.unblockCanvas(),f.unblockAllPanels(),!0}}};q.on("save_design",function(){CIPTA.is_edit_design?r("edit"):r("add")})}f.assignEditingPanel("productinfo",q);if(CIPTA.is_cipta_design)try{f.loadAllDesigns(CIPTA.cipta_design.design,function(){f.isTemplate()?(CIPTA.is_using_template=!0,CIPTA.is_advanced_editor=!1,$("#toolbar_simple").show(),$("#panel_advanced_toggle").show(),$("#toolbar_advanced").hide(),
d.show(),q.show()):(CIPTA.is_advanced_editor=!0,$("#toolbar_simple").hide(),$("#panel_advanced_toggle").hide(),$("#bottom_panel").hide(),$("#toolbar_advanced").show(),d.hide(),q.showDetail(),q.show(),CIPTA.info_panel_detail=!0)}),$("#description_panel").hide()}catch(t){sweetAlert("System Error","Tidak dapat memuat desain! <br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error")}else if(CIPTA.is_cipta_custom)try{f.loadAllDesigns(CIPTA.cipta_custom.design,function(){CIPTA.is_advanced_editor=
!0;$("#toolbar_simple").hide();$("#panel_advanced_toggle").hide();$("#toolbar_advanced").show();d.show();$("#description_panel").hide();f.isTemplate()||(q.showDetail(),CIPTA.info_panel_detail=!0,CIPTA.is_using_template=!0,$("#bottom_panel").hide());q.show();CIPTA.is_cipta_custom&&CIPTA.is_cart_add&&f.isTemplate()&&w();if(!_.isEmpty(CIPTA.cipta_custom.print_methods)){var a=_.max(JSON.parse(CIPTA.cipta_custom.print_methods));a&&ciptaProductInfo.setPrintMethod(a)}})}catch(t){sweetAlert("System Error",
"Tidak dapat memuat desain! <br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error")}else if(CIPTA.is_edit_design)try{f.loadAllDesigns(CIPTA.edit_design.design,function(){CIPTA.is_advanced_editor=!0;$("#toolbar_simple").hide();$("#panel_advanced_toggle").hide();$("#bottom_panel").hide();$("#toolbar_advanced").show();d.hide();q&&(q.showDetail(),q.show());CIPTA.info_panel_detail=!0;l&&l.refresh()}),$("#modal_savetemplate_title").val(CIPTA.edit_design.title),$("#modal_savetemplate_description").val(CIPTA.edit_design.description),
$("#modal_savetemplate_tags1").val(CIPTA.edit_design.tags1),CIPTA.is_customable?q.setCustomizable(!0):q.setCustomizable(!1),l.setTitle('Judul Desain: <span style="color:#126594;">'+CIPTA.edit_design.title+"</span>")}catch(t){sweetAlert("System Error","Tidak dapat memuat desain! <br/>Silahkan coba beberapa saat lagi atau hubungi Customer Support kami.","error")}else CIPTA.is_advanced_editor=!0,$("#toolbar_simple").hide(),$("#panel_advanced_toggle").hide(),$("#toolbar_advanced").show(),q&&(q.showDetail(),
q.show()),CIPTA.info_panel_detail=!0,$("#bottom_panel").hide();f.on("object:selected",function(){l.hide();$("#description_panel").hide();CIPTA.info_panel_detail?$("#bottom_panel2").show():$("#bottom_panel").show();CIPTA.is_advanced_editor&&q.hide();if(0==CIPTA.is_advanced_editor)return q.show(),d.isShown()||d.show(),!0;CIPTA.editor_type!=EDITOR_DESIGN&&d.hide();var a=f.getActiveObjectType();"text"==a?(c.show(),k.hide()):"image"==a&&(c.hide(),k.show())});f.on("selection:cleared",function(){c.hide();
k.hide();$("#selamat_datang").hide();CIPTA.info_panel_detail&&$("#bottom_panel2").hide();q.show();0==CIPTA.is_finished_design?(d.show(),CIPTA.is_cipta_design||CIPTA.is_cipta_custom||$("#description_panel").show()):d.hide()});$("#canvas_editpanel").click(function(a){f.deselectAllWithDispatch()});b=function(a){a.stopPropagation()};$("#canvas_placeholder_0").bind("click",b);$("#canvas_placeholder_1").bind("click",b);$("#canvas_placeholder_2").bind("click",b);$("#add_clipart").click(function(){m.showModal("add")});
$("#link_clipart").click(function(){$("#add_clipart").trigger("click")});$("#toggle_advanced").click(function(){$("#toolbar_simple").hide();$("#panel_advanced_toggle").hide();$("#toolbar_advanced").show();CIPTA.is_advanced_editor=!0;f.reSelectSelected()});$("#toggle_advanced2").click(function(){$("#toggle_advanced").trigger("click")});var w=function(){CIPTA.is_finished_design=!0;f.disableSelection();$("#toolbar_simple").hide();$("#toolbar_advanced").hide();$("#panel_advanced_toggle").hide();$("#bottom_panel").hide();
$("#description_panel").hide();d.hide();k.hide();c.hide();l.hide();d&&d.updateAllTexts();ciptaProductInfo.setNsurfaces(f.getActiveSurfaces());q.showDetail();q.show();$("#toolbar_review").show();$("#toolbar_review").css("visibility","visible")};$("#finish_design").click(function(){w()});$("#finish_design2").click(function(){w()});$("#close_panel").click(function(){f.deselectAllWithDispatch()});$("#back_to_designer").click(function(){CIPTA.is_advanced_editor?$("#toolbar_advanced").show():($("#toolbar_simple").show(),
$("#panel_advanced_toggle").show());CIPTA.is_cipta_design||CIPTA.is_cipta_custom||$("#description_panel").show();$("#bottom_panel").show();d.show();k.hide();c.hide();l.hide();f.enableSelection();q.hideDetail();q.show();$("#toolbar_review").hide();CIPTA.is_finished_design=!1});$("#select_products").click(function(){f.deselectAllWithDispatch();d.hide();$("#description_panel").hide();$("#bottom_panel").hide();l.refresh();l.show();q.hide()});$("#select_products2").click(function(){$("#select_products").trigger("click")});
$("#select_products3").click(function(){$("#select_products").trigger("click")});$("#modal_cart_more").click(function(){$("#modal_cart").foundation("reveal","close")});$("#modal_cart_checkout").click(function(){CIPTA.checkout=!0});"casing"==ciptaProductAttr.getProductType()&&$("#select_products").hide();$(document).foundation({reveal:{animation:"fade",animation_speed:100},tooltip:{disable_for_touch:!0}});$(document).on("open.fndtn.reveal","[data-reveal]",function(){});$(document).on("opened.fndtn.reveal",
"[data-reveal]",function(a){"fndtn.reveal"===a.namespace&&(f.disableKeyboard(),a=$(this),"modal_addtext"==a[0].id?(g.enableAll(),g.focusText()):"modal_addimage"==a[0].id?h.init():"modal_cart"==a[0].id?(CIPTA.checkout=!0,renderViewCart()):"modal_savetemplate"==a[0].id?$("#modal_savetemplate_title").focus():"modal_savetemplate_as"==a[0].id?$("#modal_savetemplate_as_title").focus():"modal_loadtemplate"==a[0].id?CIPTA.editor_type==EDITOR_DESIGN&&designListPanel1.updateDesignList():"modal_savecustom"==
a[0].id&&$("#modal_savecustom_title").focus())});$(document).on("closed.fndtn.reveal","[data-reveal]",function(a){"fndtn.reveal"===a.namespace&&(f.enableKeyboard(),"modal_cart"==$(this)[0].id&&(CIPTA.checkout=!1))});$(document).on("close.fndtn.reveal","[data-reveal]",function(){var a=$(this);"modal_addimage"==a[0].id?h.isUploading()&&h.cancelUpload():"editimage_modal_replace"==a[0].id?k.isReplacing()&&k.cancelReplacing():"quickedit_modal_replace"==a[0].id?d.isReplacing()&&d.cancelReplacing():"modal_addclipart"==
a[0].id&&m.close()});$("#main_section").unblock();$("#canvas_editpanel").show();$("#toolbox_panel").show();$("#main_section").show();window.onbeforeunload=function(){if(!f.isEmpty()&&!CIPTA.checkout&&!CIPTA.refresh)return"Desain yang sudah ada akan terhapus kalau keluar dari editor. Yakin mau keluar dari online editor ?"}}); 
